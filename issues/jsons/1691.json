{
    "url": "https://api.github.com/repos/pallets/flask/issues/1691",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/1691/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/1691/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/1691/events",
    "html_url": "https://github.com/pallets/flask/issues/1691",
    "id": 126314794,
    "node_id": "MDU6SXNzdWUxMjYzMTQ3OTQ=",
    "number": 1691,
    "title": "get_send_file_max_age doesn't work in blueprint",
    "user": {
        "login": "hongy19",
        "id": 7909177,
        "node_id": "MDQ6VXNlcjc5MDkxNzc=",
        "avatar_url": "https://avatars1.githubusercontent.com/u/7909177?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hongy19",
        "html_url": "https://github.com/hongy19",
        "followers_url": "https://api.github.com/users/hongy19/followers",
        "following_url": "https://api.github.com/users/hongy19/following{/other_user}",
        "gists_url": "https://api.github.com/users/hongy19/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/hongy19/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/hongy19/subscriptions",
        "organizations_url": "https://api.github.com/users/hongy19/orgs",
        "repos_url": "https://api.github.com/users/hongy19/repos",
        "events_url": "https://api.github.com/users/hongy19/events{/privacy}",
        "received_events_url": "https://api.github.com/users/hongy19/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 357932495,
            "node_id": "MDU6TGFiZWwzNTc5MzI0OTU=",
            "url": "https://api.github.com/repos/pallets/flask/labels/blueprints",
            "name": "blueprints",
            "color": "1d76db",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 5,
    "created_at": "2016-01-13T00:58:32Z",
    "updated_at": "2016-06-03T07:13:53Z",
    "closed_at": "2016-06-03T07:11:10Z",
    "author_association": "NONE",
    "body": "I have a small Flask program which serves static file by itself instead of nginx. I want to change cache time for png file by get_send_max_age function. It works in Flask class, but it doesn't work if I implement it in blueprint.\n\nPython 3.5\nFlask 0.10.1\nWerkzeug 0.11.2\n\nFlask implementation\n\n``` python\nclass MyFlask(Flask):\n    def get_send_file_max_age(self,name):\n        print(\"my function works\")\n        print(name)\n        if name.lower().endswith('.png'):\n            return 0\n        else:\n            return Flask.get_send_file_max_age(self,name)\napp = MyFlask(__name__)\n```\n\nBlueprint implementation\n\n``` python\nclass MyBlueprint(Blueprint):\n    def get_send_file_max_age(self,name):\n        print(\"my function works\")\n        print(name)\n        if name.lower().endswith('.png'):\n            return 0\n        else:\n            return Blueprint.get_send_file_max_age(self,name)\ntest = MyBlueprint('test',__name__)\n```\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/171119115",
            "html_url": "https://github.com/pallets/flask/issues/1691#issuecomment-171119115",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1691",
            "id": 171119115,
            "node_id": "MDEyOklzc3VlQ29tbWVudDE3MTExOTExNQ==",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-01-13T01:07:21Z",
            "updated_at": "2016-01-13T01:08:47Z",
            "author_association": "MEMBER",
            "body": "`send_file` has nothing blueprint-specific, so I'm pretty sure you cannot override it on a blueprint level.\n\nBut what you can do is checking `request.blueprint` (contains the name of the blueprint) in your custom `MyFlask.get_send_file_max_age` method and return something else based on the blueprint.\n\n---\n\nEdit: Just checked, according to CHANGES it should be supported in Blueprints (still seems weird) but it isn't..\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/171162895",
            "html_url": "https://github.com/pallets/flask/issues/1691#issuecomment-171162895",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1691",
            "id": 171162895,
            "node_id": "MDEyOklzc3VlQ29tbWVudDE3MTE2Mjg5NQ==",
            "user": {
                "login": "hongy19",
                "id": 7909177,
                "node_id": "MDQ6VXNlcjc5MDkxNzc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/7909177?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/hongy19",
                "html_url": "https://github.com/hongy19",
                "followers_url": "https://api.github.com/users/hongy19/followers",
                "following_url": "https://api.github.com/users/hongy19/following{/other_user}",
                "gists_url": "https://api.github.com/users/hongy19/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/hongy19/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hongy19/subscriptions",
                "organizations_url": "https://api.github.com/users/hongy19/orgs",
                "repos_url": "https://api.github.com/users/hongy19/repos",
                "events_url": "https://api.github.com/users/hongy19/events{/privacy}",
                "received_events_url": "https://api.github.com/users/hongy19/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-01-13T04:30:37Z",
            "updated_at": "2016-01-13T04:30:37Z",
            "author_association": "NONE",
            "body": "hi ThiefMaster,\naccording to Flask [documentation](http://flask.pocoo.org/docs/0.10/api/#blueprint-objects), blueprint should support get_send_file_max_age function, but weird thing is example in blueprint part is still Flask class\n\n> get_send_file_max_age(filename)\n> Provides default cache_timeout for the send_file() functions.\n> By default, this function returns SEND_FILE_MAX_AGE_DEFAULT from the configuration of current_app.\n> Static file functions such as send_from_directory() use this function, and send_file() calls this function on current_app when the given cache_timeout is None. If a cache_timeout is given in send_file(), that timeout is used; otherwise, this method is called.\n> This allows subclasses to change the behavior when sending files based on the filename. For example, to set the cache timeout for .js files to 60 seconds:\n> \n> ``` python\n> class MyFlask(flask.Flask):\n>     def get_send_file_max_age(self, name):\n>         if name.lower().endswith('.js'):\n>             return 60\n>         return flask.Flask.get_send_file_max_age(self, name)\n> ```\n> \n> New in version 0.9.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/185543573",
            "html_url": "https://github.com/pallets/flask/issues/1691#issuecomment-185543573",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1691",
            "id": 185543573,
            "node_id": "MDEyOklzc3VlQ29tbWVudDE4NTU0MzU3Mw==",
            "user": {
                "login": "rayalan",
                "id": 2250337,
                "node_id": "MDQ6VXNlcjIyNTAzMzc=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/2250337?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/rayalan",
                "html_url": "https://github.com/rayalan",
                "followers_url": "https://api.github.com/users/rayalan/followers",
                "following_url": "https://api.github.com/users/rayalan/following{/other_user}",
                "gists_url": "https://api.github.com/users/rayalan/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/rayalan/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rayalan/subscriptions",
                "organizations_url": "https://api.github.com/users/rayalan/orgs",
                "repos_url": "https://api.github.com/users/rayalan/repos",
                "events_url": "https://api.github.com/users/rayalan/events{/privacy}",
                "received_events_url": "https://api.github.com/users/rayalan/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-02-18T05:02:33Z",
            "updated_at": "2016-02-18T05:02:33Z",
            "author_association": "NONE",
            "body": "I just ran into this myself. The get_send_file_max_age() function on the blueprint is separate from the one on the main flask app. So you'd need do something like:\n\n```\nclass MyBlueprint(flask.Blueprint):\n    def get_send_file_max_age(self, name):\n        # Repeat custom code here or else figure out how to call into the main app.\n...\nfrom somewhere import MyBlueprint\nblueprint_example = MyBlueprint(...)\n```\n\nI agree it is confusing to have to customize the logic for each blueprint. It'd be a little easier if the blueprint could call into the main app, but I'm not sure it can do that.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/223455170",
            "html_url": "https://github.com/pallets/flask/issues/1691#issuecomment-223455170",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1691",
            "id": 223455170,
            "node_id": "MDEyOklzc3VlQ29tbWVudDIyMzQ1NTE3MA==",
            "user": {
                "login": "prachikhadke",
                "id": 1641236,
                "node_id": "MDQ6VXNlcjE2NDEyMzY=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1641236?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/prachikhadke",
                "html_url": "https://github.com/prachikhadke",
                "followers_url": "https://api.github.com/users/prachikhadke/followers",
                "following_url": "https://api.github.com/users/prachikhadke/following{/other_user}",
                "gists_url": "https://api.github.com/users/prachikhadke/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/prachikhadke/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/prachikhadke/subscriptions",
                "organizations_url": "https://api.github.com/users/prachikhadke/orgs",
                "repos_url": "https://api.github.com/users/prachikhadke/repos",
                "events_url": "https://api.github.com/users/prachikhadke/events{/privacy}",
                "received_events_url": "https://api.github.com/users/prachikhadke/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-06-02T23:45:48Z",
            "updated_at": "2016-06-02T23:45:48Z",
            "author_association": "CONTRIBUTOR",
            "body": "1. Created requirements.txt with:\n   \n   ```\n   Flask==0.10.1\n   Werkzeug==0.11.2\n   ```\n2. Created a virtualenv with python 3.5:\n   \n   ```\n   mkvirtualenv temp -p /usr/local/bin/python3.5\n   ```\n3. Installed dependencies:\n   \n   ```\n   pip install -r requirements.txt\n   ```\n4. Created flask_test.py and blueprint_test.py and ran them:\n   \n   **#flask_test.py**\n   \n   ```\n   from flask import Flask\n   \n   class MyFlask(Flask):\n       def get_send_file_max_age(self,name):\n           print(\"my function works\")\n           print(name)\n           if name.lower().endswith('.png'):\n               return 0\n           else:\n               return Flask.get_send_file_max_age(self, name)\n   \n   app = MyFlask(__name__)\n   with app.app_context():\n       app.get_send_file_max_age('cube.png')\n       app.get_send_file_max_age('scream.gif')\n   ```\n   \n   **#blueprint_test.py**\n   \n   ```\n   from flask import Flask\n   from flask import Blueprint\n   \n   class MyBlueprint(Blueprint):\n       def get_send_file_max_age(self,name):\n           print(\"my function works\")\n           print(name)\n           if name.lower().endswith('.png'):\n               return 0\n           else:\n               return Blueprint.get_send_file_max_age(self,name)\n   \n   app = Flask(__name__)\n   with app.app_context():\n       test = MyBlueprint('test',__name__)\n       test.get_send_file_max_age('cube.png')\n       test.get_send_file_max_age('scream.gif')\n   ```\n   \n   where `cube.png` and `scream.gif` are images from the internet.\n5. Ran `flask_test.py` and `blueprint_test.py` successfully. Could not reproduce the issue.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/223507256",
            "html_url": "https://github.com/pallets/flask/issues/1691#issuecomment-223507256",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1691",
            "id": 223507256,
            "node_id": "MDEyOklzc3VlQ29tbWVudDIyMzUwNzI1Ng==",
            "user": {
                "login": "jeffwidman",
                "id": 483314,
                "node_id": "MDQ6VXNlcjQ4MzMxNA==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/483314?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/jeffwidman",
                "html_url": "https://github.com/jeffwidman",
                "followers_url": "https://api.github.com/users/jeffwidman/followers",
                "following_url": "https://api.github.com/users/jeffwidman/following{/other_user}",
                "gists_url": "https://api.github.com/users/jeffwidman/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/jeffwidman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jeffwidman/subscriptions",
                "organizations_url": "https://api.github.com/users/jeffwidman/orgs",
                "repos_url": "https://api.github.com/users/jeffwidman/repos",
                "events_url": "https://api.github.com/users/jeffwidman/events{/privacy}",
                "received_events_url": "https://api.github.com/users/jeffwidman/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-06-03T07:11:10Z",
            "updated_at": "2016-06-03T07:13:53Z",
            "author_association": "MEMBER",
            "body": "@prachikhadke Thanks for this and all your other hard work at the Pycon Sprint today!\n\nI'm going to go ahead and close this, if someone is still hitting this, please post example code to reproduce and we can take another look.\n"
        }
    ]
}