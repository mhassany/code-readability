{
    "url": "https://api.github.com/repos/pallets/flask/issues/2188",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2188/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2188/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2188/events",
    "html_url": "https://github.com/pallets/flask/issues/2188",
    "id": 208781793,
    "node_id": "MDU6SXNzdWUyMDg3ODE3OTM=",
    "number": 2188,
    "title": "Input stream not automatically drained at teardown.",
    "user": {
        "login": "Parakleta",
        "id": 11205202,
        "node_id": "MDQ6VXNlcjExMjA1MjAy",
        "avatar_url": "https://avatars3.githubusercontent.com/u/11205202?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Parakleta",
        "html_url": "https://github.com/Parakleta",
        "followers_url": "https://api.github.com/users/Parakleta/followers",
        "following_url": "https://api.github.com/users/Parakleta/following{/other_user}",
        "gists_url": "https://api.github.com/users/Parakleta/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/Parakleta/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Parakleta/subscriptions",
        "organizations_url": "https://api.github.com/users/Parakleta/orgs",
        "repos_url": "https://api.github.com/users/Parakleta/repos",
        "events_url": "https://api.github.com/users/Parakleta/events{/privacy}",
        "received_events_url": "https://api.github.com/users/Parakleta/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 17,
    "created_at": "2017-02-20T04:32:41Z",
    "updated_at": "2018-02-24T00:05:01Z",
    "closed_at": "2018-02-24T00:05:01Z",
    "author_association": "NONE",
    "body": "I'm not sure if this is intended behaviour and maybe I should know better, but I spent ages trying to figure out why I was getting a `code 400, message Bad request syntax` error and it turned out to be because I was not consuming the data associated with a request when raising an `Unauthorized` exception.\r\n\r\nThis seems to be a massive hole because if you are not expecting data with a request and so don't read anything then that data is left in the input stream (assuming `keep-alive`) and so forms the start of the next request.  In fact I have even tried sending a request with another request in the data and Flask processes that data as if it were the next request and sends that in response to the following request.\r\n\r\nI have resolved this issue by copying the body of the `finally` clause in the `wrapper` function inside `exhaust_stream` from `formparser.py` in [pallets/werkzeug](http://github.com/pallets/werkzeug) and having this new function decorated with `@app.teardown_request`.  This ensures that the input stream is always drained after every request and so left over data is not mis-interpreted as the start of the next request.\r\n\r\nAnyway, if I am expected to handle this situation manually as I have done can something be added to the documentation (or if it's already there can you point it out to me, somehow I couldn't find it).  Otherwise, I think Flask should drain the input stream so that subsequent requests are always correctly aligned.",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/280987516",
            "html_url": "https://github.com/pallets/flask/issues/2188#issuecomment-280987516",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2188",
            "id": 280987516,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4MDk4NzUxNg==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-02-20T04:50:33Z",
            "updated_at": "2017-02-20T04:50:33Z",
            "author_association": "MEMBER",
            "body": "Please add a minimal example that demonstrates the issue."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/280993748",
            "html_url": "https://github.com/pallets/flask/issues/2188#issuecomment-280993748",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2188",
            "id": 280993748,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4MDk5Mzc0OA==",
            "user": {
                "login": "Parakleta",
                "id": 11205202,
                "node_id": "MDQ6VXNlcjExMjA1MjAy",
                "avatar_url": "https://avatars3.githubusercontent.com/u/11205202?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/Parakleta",
                "html_url": "https://github.com/Parakleta",
                "followers_url": "https://api.github.com/users/Parakleta/followers",
                "following_url": "https://api.github.com/users/Parakleta/following{/other_user}",
                "gists_url": "https://api.github.com/users/Parakleta/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/Parakleta/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Parakleta/subscriptions",
                "organizations_url": "https://api.github.com/users/Parakleta/orgs",
                "repos_url": "https://api.github.com/users/Parakleta/repos",
                "events_url": "https://api.github.com/users/Parakleta/events{/privacy}",
                "received_events_url": "https://api.github.com/users/Parakleta/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-02-20T05:49:56Z",
            "updated_at": "2017-02-20T05:51:32Z",
            "author_association": "NONE",
            "body": "```python\r\nfrom flask import Flask\r\nfrom werkzeug.serving import WSGIRequestHandler\r\n\r\nWSGIRequestHandler.protocol_version = \"HTTP/1.1\"\r\napp = Flask(__name__)\r\n\r\n@app.route(\"/\")\r\n    return \"Hello World!\\n\"\r\n\r\nif __name__ == \"__main__\":\r\n    app.run()\r\n```\r\n\r\nThen run on the command line in `bash` or `zsh`:\r\n```sh\r\ncurl -X GET --data-binary $'GET /index.html HTTP/1.1\\r\\n' http://localhost:5000/ http://localhost:5000/\r\n```\r\n\r\nThe output from Flask where it is running is:\r\n```\r\n * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)\r\n127.0.0.1 - - [20/Feb/2017 16:46:47] \"GET / HTTP/1.1\" 200 -\r\n127.0.0.1 - - [20/Feb/2017 16:46:47] \"GET /index.html HTTP/1.1\" 404 -\r\n127.0.0.1 - - [20/Feb/2017 16:46:47] code 400, message Bad HTTP/0.9 request type ('Host:')\r\n127.0.0.1 - - [20/Feb/2017 16:46:47] \"Host: localhost:5000\" 400 -\r\n```\r\n\r\nThe error here is slightly different to what I was getting in my full application, but from the same section of code (I had `code 400, message Bad request syntax`)."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/283179531",
            "html_url": "https://github.com/pallets/flask/issues/2188#issuecomment-283179531",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2188",
            "id": 283179531,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4MzE3OTUzMQ==",
            "user": {
                "login": "aradnaev",
                "id": 17343325,
                "node_id": "MDQ6VXNlcjE3MzQzMzI1",
                "avatar_url": "https://avatars2.githubusercontent.com/u/17343325?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/aradnaev",
                "html_url": "https://github.com/aradnaev",
                "followers_url": "https://api.github.com/users/aradnaev/followers",
                "following_url": "https://api.github.com/users/aradnaev/following{/other_user}",
                "gists_url": "https://api.github.com/users/aradnaev/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/aradnaev/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/aradnaev/subscriptions",
                "organizations_url": "https://api.github.com/users/aradnaev/orgs",
                "repos_url": "https://api.github.com/users/aradnaev/repos",
                "events_url": "https://api.github.com/users/aradnaev/events{/privacy}",
                "received_events_url": "https://api.github.com/users/aradnaev/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-02-28T22:19:01Z",
            "updated_at": "2017-02-28T22:19:01Z",
            "author_association": "NONE",
            "body": "having issues with Flask not responding after Chrome receiving 404 - may be related to this issue.\r\n\r\njust posted on SO:\r\nhttp://stackoverflow.com/questions/42519629/flask-not-processing-other-http-requests-after-chrome-browser-receives-404-respo"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/283185575",
            "html_url": "https://github.com/pallets/flask/issues/2188#issuecomment-283185575",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2188",
            "id": 283185575,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4MzE4NTU3NQ==",
            "user": {
                "login": "Parakleta",
                "id": 11205202,
                "node_id": "MDQ6VXNlcjExMjA1MjAy",
                "avatar_url": "https://avatars3.githubusercontent.com/u/11205202?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/Parakleta",
                "html_url": "https://github.com/Parakleta",
                "followers_url": "https://api.github.com/users/Parakleta/followers",
                "following_url": "https://api.github.com/users/Parakleta/following{/other_user}",
                "gists_url": "https://api.github.com/users/Parakleta/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/Parakleta/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Parakleta/subscriptions",
                "organizations_url": "https://api.github.com/users/Parakleta/orgs",
                "repos_url": "https://api.github.com/users/Parakleta/repos",
                "events_url": "https://api.github.com/users/Parakleta/events{/privacy}",
                "received_events_url": "https://api.github.com/users/Parakleta/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-02-28T22:43:59Z",
            "updated_at": "2017-02-28T22:43:59Z",
            "author_association": "NONE",
            "body": "@aradnaev Your issue is not related.  The protocol version must be manually set to `HTTP/1.1` or else `keep-alive` headers manually added to cause this bug, neither of which you are doing.  Your issue seems to be that Chrome is holding the connection when it shouldn't."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/303259742",
            "html_url": "https://github.com/pallets/flask/issues/2188#issuecomment-303259742",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2188",
            "id": 303259742,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwMzI1OTc0Mg==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-05-23T00:54:51Z",
            "updated_at": "2017-05-23T00:54:51Z",
            "author_association": "MEMBER",
            "body": "We can't replicate this."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/303263889",
            "html_url": "https://github.com/pallets/flask/issues/2188#issuecomment-303263889",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2188",
            "id": 303263889,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwMzI2Mzg4OQ==",
            "user": {
                "login": "Parakleta",
                "id": 11205202,
                "node_id": "MDQ6VXNlcjExMjA1MjAy",
                "avatar_url": "https://avatars3.githubusercontent.com/u/11205202?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/Parakleta",
                "html_url": "https://github.com/Parakleta",
                "followers_url": "https://api.github.com/users/Parakleta/followers",
                "following_url": "https://api.github.com/users/Parakleta/following{/other_user}",
                "gists_url": "https://api.github.com/users/Parakleta/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/Parakleta/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Parakleta/subscriptions",
                "organizations_url": "https://api.github.com/users/Parakleta/orgs",
                "repos_url": "https://api.github.com/users/Parakleta/repos",
                "events_url": "https://api.github.com/users/Parakleta/events{/privacy}",
                "received_events_url": "https://api.github.com/users/Parakleta/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-05-23T01:25:00Z",
            "updated_at": "2017-05-23T01:25:00Z",
            "author_association": "NONE",
            "body": "Sorry, but did you try the example I provided?  Because I still have the problem with Python 2.7.13 and Flask 0.13-dev.  There was a missing line in my sample, between the `@app.route` and `return` there should be a `def hello():`.\r\n\r\nIn the linked issue #2205 @brianrusso says that he cannot replicate the curl behaviour, but his post shows a similar Flask error showing that Flask is misbehaving.\r\n\r\nCan you please post the result of running the example I provided."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/303265775",
            "html_url": "https://github.com/pallets/flask/issues/2188#issuecomment-303265775",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2188",
            "id": 303265775,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwMzI2NTc3NQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-05-23T01:38:40Z",
            "updated_at": "2017-05-23T01:38:40Z",
            "author_association": "MEMBER",
            "body": "Yes, we tried your example, with multiple different clients making requests, without encountering the error you had."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/303265970",
            "html_url": "https://github.com/pallets/flask/issues/2188#issuecomment-303265970",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2188",
            "id": 303265970,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwMzI2NTk3MA==",
            "user": {
                "login": "brianrusso",
                "id": 6276108,
                "node_id": "MDQ6VXNlcjYyNzYxMDg=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/6276108?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/brianrusso",
                "html_url": "https://github.com/brianrusso",
                "followers_url": "https://api.github.com/users/brianrusso/followers",
                "following_url": "https://api.github.com/users/brianrusso/following{/other_user}",
                "gists_url": "https://api.github.com/users/brianrusso/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/brianrusso/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brianrusso/subscriptions",
                "organizations_url": "https://api.github.com/users/brianrusso/orgs",
                "repos_url": "https://api.github.com/users/brianrusso/repos",
                "events_url": "https://api.github.com/users/brianrusso/events{/privacy}",
                "received_events_url": "https://api.github.com/users/brianrusso/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-05-23T01:40:05Z",
            "updated_at": "2017-05-23T01:40:22Z",
            "author_association": "NONE",
            "body": "I tried your example, but doing a 'GET / HTTP/1.1' did not result in any error.\r\n\r\n\r\n```\r\nbrian@engel:~/flask-test$ nc localhost 5000\r\nGET / HTTP/1.1\r\n\r\nHTTP/1.1 200 OK\r\nContent-Type: text/html; charset=utf-8\r\nContent-Length: 13\r\nServer: Werkzeug/0.12.2 Python/2.7.12\r\nDate: Tue, 23 May 2017 01:39:16 GMT\r\n\r\nHello World!\r\n```\r\n\r\n```\r\n127.0.0.1 - - [22/May/2017 18:39:16] \"GET / HTTP/1.1\" 200 -\r\n```\r\n\r\n\r\nAm I missing something when replicating?\r\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/303268380",
            "html_url": "https://github.com/pallets/flask/issues/2188#issuecomment-303268380",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2188",
            "id": 303268380,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwMzI2ODM4MA==",
            "user": {
                "login": "Parakleta",
                "id": 11205202,
                "node_id": "MDQ6VXNlcjExMjA1MjAy",
                "avatar_url": "https://avatars3.githubusercontent.com/u/11205202?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/Parakleta",
                "html_url": "https://github.com/Parakleta",
                "followers_url": "https://api.github.com/users/Parakleta/followers",
                "following_url": "https://api.github.com/users/Parakleta/following{/other_user}",
                "gists_url": "https://api.github.com/users/Parakleta/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/Parakleta/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Parakleta/subscriptions",
                "organizations_url": "https://api.github.com/users/Parakleta/orgs",
                "repos_url": "https://api.github.com/users/Parakleta/repos",
                "events_url": "https://api.github.com/users/Parakleta/events{/privacy}",
                "received_events_url": "https://api.github.com/users/Parakleta/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-05-23T01:57:45Z",
            "updated_at": "2017-05-23T01:57:45Z",
            "author_association": "NONE",
            "body": "Thanks.  The curl line that I gave actually does 3 things.  It chains two GET requests one after the other (thus making use of keep-alive), but then also sends additional data with the get request, specifically being the carefully crafted string \"GET /index.html HTTP/1.1\\r\\n\".  The idea is to create a stream of data that looks like a regular GET request, followed by my crafted one, and then have the second GET request return the results of the crafted one."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/303268719",
            "html_url": "https://github.com/pallets/flask/issues/2188#issuecomment-303268719",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2188",
            "id": 303268719,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwMzI2ODcxOQ==",
            "user": {
                "login": "brianrusso",
                "id": 6276108,
                "node_id": "MDQ6VXNlcjYyNzYxMDg=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/6276108?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/brianrusso",
                "html_url": "https://github.com/brianrusso",
                "followers_url": "https://api.github.com/users/brianrusso/followers",
                "following_url": "https://api.github.com/users/brianrusso/following{/other_user}",
                "gists_url": "https://api.github.com/users/brianrusso/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/brianrusso/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brianrusso/subscriptions",
                "organizations_url": "https://api.github.com/users/brianrusso/orgs",
                "repos_url": "https://api.github.com/users/brianrusso/repos",
                "events_url": "https://api.github.com/users/brianrusso/events{/privacy}",
                "received_events_url": "https://api.github.com/users/brianrusso/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-05-23T02:00:01Z",
            "updated_at": "2017-05-23T02:00:15Z",
            "author_association": "NONE",
            "body": "Okay thanks I understand a bit more now. So your thought is that the werkzeug caching is not exhausting the pipeline, which then could result in some type of injection situation?"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/303269373",
            "html_url": "https://github.com/pallets/flask/issues/2188#issuecomment-303269373",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2188",
            "id": 303269373,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwMzI2OTM3Mw==",
            "user": {
                "login": "Parakleta",
                "id": 11205202,
                "node_id": "MDQ6VXNlcjExMjA1MjAy",
                "avatar_url": "https://avatars3.githubusercontent.com/u/11205202?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/Parakleta",
                "html_url": "https://github.com/Parakleta",
                "followers_url": "https://api.github.com/users/Parakleta/followers",
                "following_url": "https://api.github.com/users/Parakleta/following{/other_user}",
                "gists_url": "https://api.github.com/users/Parakleta/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/Parakleta/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Parakleta/subscriptions",
                "organizations_url": "https://api.github.com/users/Parakleta/orgs",
                "repos_url": "https://api.github.com/users/Parakleta/repos",
                "events_url": "https://api.github.com/users/Parakleta/events{/privacy}",
                "received_events_url": "https://api.github.com/users/Parakleta/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-05-23T02:04:27Z",
            "updated_at": "2017-05-23T02:04:27Z",
            "author_association": "NONE",
            "body": "Whoever is responsible (flask or werkzeug) for draining the pipeline is not doing it.  I'm not sure who should control that behaviour.\r\n\r\nRegarding the consequences, the injection was just the easiest way to show it.  I don't think there is really an attack vector there anymore than a malformed Content-Length header would provide, the issue is more that a valid (i.e. well-formed) request can cause the failure of a subsequent request."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/303269692",
            "html_url": "https://github.com/pallets/flask/issues/2188#issuecomment-303269692",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2188",
            "id": 303269692,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwMzI2OTY5Mg==",
            "user": {
                "login": "brianrusso",
                "id": 6276108,
                "node_id": "MDQ6VXNlcjYyNzYxMDg=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/6276108?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/brianrusso",
                "html_url": "https://github.com/brianrusso",
                "followers_url": "https://api.github.com/users/brianrusso/followers",
                "following_url": "https://api.github.com/users/brianrusso/following{/other_user}",
                "gists_url": "https://api.github.com/users/brianrusso/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/brianrusso/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brianrusso/subscriptions",
                "organizations_url": "https://api.github.com/users/brianrusso/orgs",
                "repos_url": "https://api.github.com/users/brianrusso/repos",
                "events_url": "https://api.github.com/users/brianrusso/events{/privacy}",
                "received_events_url": "https://api.github.com/users/brianrusso/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-05-23T02:06:47Z",
            "updated_at": "2017-05-23T02:06:47Z",
            "author_association": "NONE",
            "body": "Okay. Thanks for the clarification. I had misunderstood the issue. I will look into it some more."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/303278810",
            "html_url": "https://github.com/pallets/flask/issues/2188#issuecomment-303278810",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2188",
            "id": 303278810,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwMzI3ODgxMA==",
            "user": {
                "login": "brianrusso",
                "id": 6276108,
                "node_id": "MDQ6VXNlcjYyNzYxMDg=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/6276108?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/brianrusso",
                "html_url": "https://github.com/brianrusso",
                "followers_url": "https://api.github.com/users/brianrusso/followers",
                "following_url": "https://api.github.com/users/brianrusso/following{/other_user}",
                "gists_url": "https://api.github.com/users/brianrusso/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/brianrusso/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brianrusso/subscriptions",
                "organizations_url": "https://api.github.com/users/brianrusso/orgs",
                "repos_url": "https://api.github.com/users/brianrusso/repos",
                "events_url": "https://api.github.com/users/brianrusso/events{/privacy}",
                "received_events_url": "https://api.github.com/users/brianrusso/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-05-23T03:14:56Z",
            "updated_at": "2017-05-23T03:15:21Z",
            "author_association": "NONE",
            "body": "Okay I agree there is definitely something odd going on here.\r\n\r\n@Parakleta This is the issue, correct?\r\n\r\n```\r\nfrom flask import Flask, request\r\nfrom werkzeug.serving import WSGIRequestHandler\r\n\r\n#WSGIRequestHandler.protocol_version = \"HTTP/1.1\"\r\napp = Flask(__name__)\r\n\r\n@app.route(\"/fudge\")\r\ndef fudge():\r\n  return \"Fudge\\n\"\r\n\r\n@app.route(\"/taffy\")\r\ndef taffy():\r\n  return \"Taffy\\n\"\r\n\r\nif __name__ == \"__main__\":\r\n    app.run()\r\n```\r\n\r\n## With protocol_version commented\r\n```\r\nbrian@engel:~/flask-test$ curl -X GET --data-binary $'GET /fudge HTTP/1.1\\r\\n' http://localhost:5000/taffy http://localhost:5000/taffy localhost:5000/taffy localhost:5000/taffy\r\nTaffy\r\nTaffy\r\nTaffy\r\nTaffy\r\n```\r\n\r\n## protocol_version set to HTTP/1.1\r\n```\r\nbrian@engel:~/flask-test$ curl -X GET --data-binary $'GET /fudge HTTP/1.1\\r\\n' http://localhost:5000/taffy http://localhost:5000/taffy localhost:5000/taffy localhost:5000/taffy\r\nTaffy\r\nFudge\r\nFudge\r\nFudge\r\n\r\n```\r\n@davidism  please re-open this issue.\r\n\r\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/303281660",
            "html_url": "https://github.com/pallets/flask/issues/2188#issuecomment-303281660",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2188",
            "id": 303281660,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwMzI4MTY2MA==",
            "user": {
                "login": "Parakleta",
                "id": 11205202,
                "node_id": "MDQ6VXNlcjExMjA1MjAy",
                "avatar_url": "https://avatars3.githubusercontent.com/u/11205202?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/Parakleta",
                "html_url": "https://github.com/Parakleta",
                "followers_url": "https://api.github.com/users/Parakleta/followers",
                "following_url": "https://api.github.com/users/Parakleta/following{/other_user}",
                "gists_url": "https://api.github.com/users/Parakleta/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/Parakleta/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Parakleta/subscriptions",
                "organizations_url": "https://api.github.com/users/Parakleta/orgs",
                "repos_url": "https://api.github.com/users/Parakleta/repos",
                "events_url": "https://api.github.com/users/Parakleta/events{/privacy}",
                "received_events_url": "https://api.github.com/users/Parakleta/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-05-23T03:36:49Z",
            "updated_at": "2017-05-23T03:36:49Z",
            "author_association": "NONE",
            "body": "Yes, that is exactly the issue."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/304490991",
            "html_url": "https://github.com/pallets/flask/issues/2188#issuecomment-304490991",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2188",
            "id": 304490991,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwNDQ5MDk5MQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-05-28T03:50:07Z",
            "updated_at": "2017-05-28T03:50:07Z",
            "author_association": "MEMBER",
            "body": "@brianrusso you mentioned at the sprint that you had an idea for this. Do you still have time to make a PR or at least write some notes?"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/314157575",
            "html_url": "https://github.com/pallets/flask/issues/2188#issuecomment-314157575",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2188",
            "id": 314157575,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMxNDE1NzU3NQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-07-10T16:20:31Z",
            "updated_at": "2017-07-10T17:29:41Z",
            "author_association": "MEMBER",
            "body": "Running the app with Gunicorn does not have this issue.\r\n\r\nThis happens even with a basic `http.server.SimpleHTTPRequestHandler` from the standard library, which is what `WSGIRequestHandler` is based off. This should probably be reported to Python as well.\r\n\r\nIt's definitely not a Flask issue, if we were to fix it, it would be in Werkzeug.\r\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/368174694",
            "html_url": "https://github.com/pallets/flask/issues/2188#issuecomment-368174694",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2188",
            "id": 368174694,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM2ODE3NDY5NA==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-02-24T00:05:01Z",
            "updated_at": "2018-02-24T00:05:01Z",
            "author_association": "MEMBER",
            "body": "Closing this, please reopen against Werkzeug if it's still an issue for you. However, do remember that the dev server is only for development, and production servers already drain the input."
        }
    ]
}