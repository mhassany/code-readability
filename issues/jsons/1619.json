{
    "url": "https://api.github.com/repos/pallets/flask/issues/1619",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/1619/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/1619/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/1619/events",
    "html_url": "https://github.com/pallets/flask/issues/1619",
    "id": 117912970,
    "node_id": "MDU6SXNzdWUxMTc5MTI5NzA=",
    "number": 1619,
    "title": "Flask extremely slow on SQL Server view queries versus pure table queries",
    "user": {
        "login": "erxnmedia",
        "id": 8052009,
        "node_id": "MDQ6VXNlcjgwNTIwMDk=",
        "avatar_url": "https://avatars1.githubusercontent.com/u/8052009?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/erxnmedia",
        "html_url": "https://github.com/erxnmedia",
        "followers_url": "https://api.github.com/users/erxnmedia/followers",
        "following_url": "https://api.github.com/users/erxnmedia/following{/other_user}",
        "gists_url": "https://api.github.com/users/erxnmedia/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/erxnmedia/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/erxnmedia/subscriptions",
        "organizations_url": "https://api.github.com/users/erxnmedia/orgs",
        "repos_url": "https://api.github.com/users/erxnmedia/repos",
        "events_url": "https://api.github.com/users/erxnmedia/events{/privacy}",
        "received_events_url": "https://api.github.com/users/erxnmedia/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2015-11-19T21:36:03Z",
    "updated_at": "2015-11-19T21:44:35Z",
    "closed_at": "2015-11-19T21:38:45Z",
    "author_association": "NONE",
    "body": "Hi,\n\nI\u2019ve noticed that Flask takes 10 or 20 seconds to display a page based on a view query but will display the page in less than a second for a non-view version of the same query.  For example here is a query on view CurveVersionReport:\n\nselect CurveEditID,AsOfDate,TaskDefinition,VersionName,acattribute,DataPoints\nFROM CurveVersionReport\nwhere market = 'Commodity' and submarket = 'Agriculture' and activeversion='Yes' and curvename='CO_PRICE_VAR_USD_OTC_BO'\norder by curvename, curveeditid\n\nand the corresponding non-view version:\n\nselect a.[CurveEditID],[AsOfDate],TaskDefinition  \n      ,[CurveVersion] as VersionName\n      , tree + '.' + attribute as acattribute \n      ,count(*) AS DataPoints\n  FROM [CurveEdits] a, curvedefinition b, submarket c, TaskDefinition d, curveversion e, curvepoints f, acattribute g\n  where a.curveid = b.curveid \n  and b.marketid = c.marketid\n  and a.TaskDefinitionID=d.TaskDefinitionID\n  and a.[CurveVersionID]=e.[CurveVersionID]\n  and f.curveeditid = a.curveeditid\n  and f.acattributeid = g.acattributeid\n  and market = 'Commodity' and submarket = 'Agriculture' and activeversion=1 and curvename='CO_PRICE_VAR_USD_OTC_BO'\n  group by market, submarket, curvename, a.[CurveEditID],[AsOfDate],TaskDefinition,[CurveVersion],[ActiveVersion], tree, attribute \n  order by acattribute\n\nThis is the Flask method that processes the query:\n\n@app.route('/curve/<market>/<submarket>/<curve>')\ndef Curve(market, submarket, curve):\n    global cur\n    query = ...one of the above\n    cur.execute(query, (market, submarket, curve))\n    edits=[x for x in cur.fetchall()]\n    return render_template('curve.html', market=market, submarket=submarket, curve=curve, edits=edits)\n\nHere is the template file:\n\n<h5><img src='/static/wf_logo_50px.png'> \n<a href=\"/\" target=\"_blank_\">PFE Analytics:</a>\n<a href=\"/Markets\" target=\"_blank_\">Market:</a> \n<a href=\"/market/{{market}}\" target=\"_blank_\">Submarket:</a>\n<a href=\"/submarket/{{market}}/{{submarket}}\" target=\"_blank_\">Curve:</a>\n{{market}} {{submarket}} {{curve}}</h5>\n\n\n<table border=\"1\">\n<tr>\n<th>CurveEditID</th>\n<th>AsOfDate</th>\n<th>TaskDefinition</th>\n<th>VersionName</th>\n<th>acattribute</th>\n<th>DataPoints</th></tr>\n\n{% for (CurveEditID,AsOfDate,TaskDefinition,VersionName,acattribute,DataPoints) in edits %}\n<tr>\n<td>{{CurveEditID}}</td>\n<td>{{AsOfDate}}</td>\n<td>{{TaskDefinition}}</td>\n<td>{{VersionName}}</td>\n<td>{{acattribute}}</td>\n<td>{{DataPoints}}</td></tr>\n{% endfor %}\n\n</table>\n\n\nDo you know why view version would be extremely slow versus non-view?\n\nThanks, \n\nLars Ericson\n\nQuantitative Analytics Consultant\nMarket & Institutional Risk Management \n\nWells Fargo Bank, N.A. | 301 S. College St., 4th Floor | Charlotte, NC 28202-6000\nMAC D1053-04X\nTel  704-410-2219 | Cell 917-891-1639\n\nlars.ericson@wellsfargo.com\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/158205694",
            "html_url": "https://github.com/pallets/flask/issues/1619#issuecomment-158205694",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1619",
            "id": 158205694,
            "node_id": "MDEyOklzc3VlQ29tbWVudDE1ODIwNTY5NA==",
            "user": {
                "login": "mitsuhiko",
                "id": 7396,
                "node_id": "MDQ6VXNlcjczOTY=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/7396?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mitsuhiko",
                "html_url": "https://github.com/mitsuhiko",
                "followers_url": "https://api.github.com/users/mitsuhiko/followers",
                "following_url": "https://api.github.com/users/mitsuhiko/following{/other_user}",
                "gists_url": "https://api.github.com/users/mitsuhiko/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mitsuhiko/subscriptions",
                "organizations_url": "https://api.github.com/users/mitsuhiko/orgs",
                "repos_url": "https://api.github.com/users/mitsuhiko/repos",
                "events_url": "https://api.github.com/users/mitsuhiko/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mitsuhiko/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2015-11-19T21:38:45Z",
            "updated_at": "2015-11-19T21:38:45Z",
            "author_association": "MEMBER",
            "body": "This is an issue tracker and not a support forum.  Flask does not contain any database functionality out of the box and it would appear your issue is entirely unrelated to database drivers anyways and caused by your database system.\n\nPlease bring questions like this up on stackoverflow or similar forums.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/158207033",
            "html_url": "https://github.com/pallets/flask/issues/1619#issuecomment-158207033",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1619",
            "id": 158207033,
            "node_id": "MDEyOklzc3VlQ29tbWVudDE1ODIwNzAzMw==",
            "user": {
                "login": "erxnmedia",
                "id": 8052009,
                "node_id": "MDQ6VXNlcjgwNTIwMDk=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/8052009?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/erxnmedia",
                "html_url": "https://github.com/erxnmedia",
                "followers_url": "https://api.github.com/users/erxnmedia/followers",
                "following_url": "https://api.github.com/users/erxnmedia/following{/other_user}",
                "gists_url": "https://api.github.com/users/erxnmedia/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/erxnmedia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/erxnmedia/subscriptions",
                "organizations_url": "https://api.github.com/users/erxnmedia/orgs",
                "repos_url": "https://api.github.com/users/erxnmedia/repos",
                "events_url": "https://api.github.com/users/erxnmedia/events{/privacy}",
                "received_events_url": "https://api.github.com/users/erxnmedia/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2015-11-19T21:44:34Z",
            "updated_at": "2015-11-19T21:44:34Z",
            "author_association": "NONE",
            "body": "actually that was helpful: http://www.sommarskog.se/query-plan-mysteries.html\n\nFrom: Armin Ronacher [mailto:notifications@github.com]\nSent: Thursday, November 19, 2015 4:40 PM\nTo: mitsuhiko/flask\nCc: Ericson, Lars W.\nSubject: Re: [flask] Flask extremely slow on SQL Server view queries versus pure table queries (#1619)\n\nThis is an issue tracker and not a support forum. Flask does not contain any database functionality out of the box and it would appear your issue is entirely unrelated to database drivers anyways and caused by your database system.\n\nPlease bring questions like this up on stackoverflow or similar forums.\n\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/mitsuhiko/flask/issues/1619#issuecomment-158205694.\n"
        }
    ]
}