{
    "url": "https://api.github.com/repos/pallets/flask/issues/2474",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2474/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2474/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2474/events",
    "html_url": "https://github.com/pallets/flask/issues/2474",
    "id": 259814164,
    "node_id": "MDU6SXNzdWUyNTk4MTQxNjQ=",
    "number": 2474,
    "title": "flask thread is always running, can't stop",
    "user": {
        "login": "boringwork",
        "id": 4026598,
        "node_id": "MDQ6VXNlcjQwMjY1OTg=",
        "avatar_url": "https://avatars2.githubusercontent.com/u/4026598?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/boringwork",
        "html_url": "https://github.com/boringwork",
        "followers_url": "https://api.github.com/users/boringwork/followers",
        "following_url": "https://api.github.com/users/boringwork/following{/other_user}",
        "gists_url": "https://api.github.com/users/boringwork/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/boringwork/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/boringwork/subscriptions",
        "organizations_url": "https://api.github.com/users/boringwork/orgs",
        "repos_url": "https://api.github.com/users/boringwork/repos",
        "events_url": "https://api.github.com/users/boringwork/events{/privacy}",
        "received_events_url": "https://api.github.com/users/boringwork/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2017-09-22T13:25:39Z",
    "updated_at": "2017-10-09T15:30:57Z",
    "closed_at": "2017-10-09T15:30:57Z",
    "author_association": "NONE",
    "body": "### flask thread is always running, can't stop\r\nI use flask as http server, for Multi-threaded support, I set `threaded=True`, The Call Stack shows every thread is running and not cancel when function finished.\r\n\r\n![20170920194345](https://user-images.githubusercontent.com/4026598/30746348-24f4018a-9fdc-11e7-9a37-d93867813967.png)\r\n\r\nAnd the memory has been growing until crashed.\r\n![ilekf](https://user-images.githubusercontent.com/4026598/30746436-6139ae24-9fdc-11e7-98a9-8aaa6433f98e.png)\r\n\r\n```\r\n[2017-09-22 21:05:07,303] ERROR in app: Exception on /api [POST]\r\nTraceback (most recent call last):\r\n  File \"D:\\Program_Files\\Python\\Python2\\lib\\site-packages\\flask-0.12.2-py2.7.egg\\flask\\app.py\", line 1982, in wsgi_app\r\n    response = self.full_dispatch_request()\r\n  File \"D:\\Program_Files\\Python\\Python2\\lib\\site-packages\\flask-0.12.2-py2.7.egg\\flask\\app.py\", line 1614, in full_dispatch_request\r\n    rv = self.handle_user_exception(e)\r\n  File \"D:\\Program_Files\\Python\\Python2\\lib\\site-packages\\flask-0.12.2-py2.7.egg\\flask\\app.py\", line 1517, in handle_user_exception\r\n    reraise(exc_type, exc_value, tb)\r\n  File \"D:\\Program_Files\\Python\\Python2\\lib\\site-packages\\flask-0.12.2-py2.7.egg\\flask\\app.py\", line 1612, in full_dispatch_request\r\n    rv = self.dispatch_request()\r\n  File \"D:\\Program_Files\\Python\\Python2\\lib\\site-packages\\flask-0.12.2-py2.7.egg\\flask\\app.py\", line 1598, in dispatch_request\r\n    return self.view_functions[rule.endpoint](**req.view_args)\r\n  File \"d:\\Workspace\\python\\ftp-server\\code\\Http_Server.py\", line 37, in api\r\n    for index in socket_map:\r\nRuntimeError: dictionary changed size during iteration\r\n```\r\n\r\n### Environment\r\n\r\n* Python version: 2.7.13\r\n* Flask version: flask-0.12.2-py2.7.egg\r\n* Werkzeug version: werkzeug-0.12.2-py2.7.egg\r\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/335193488",
            "html_url": "https://github.com/pallets/flask/issues/2474#issuecomment-335193488",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2474",
            "id": 335193488,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMzNTE5MzQ4OA==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-10-09T15:30:57Z",
            "updated_at": "2017-10-09T15:30:57Z",
            "author_association": "MEMBER",
            "body": "I can't reproduce this issue. Threads die as requests finish. Perhaps it has to do with how your IDE debugger is working? Regardless, the dev server should not be used in production. Use a production WSGI server such as uWSGI to handle multiple requests stably."
        }
    ]
}