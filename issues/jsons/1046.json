{
    "url": "https://api.github.com/repos/pallets/flask/issues/1046",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/1046/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/1046/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/1046/events",
    "html_url": "https://github.com/pallets/flask/issues/1046",
    "id": 32771346,
    "node_id": "MDU6SXNzdWUzMjc3MTM0Ng==",
    "number": 1046,
    "title": "unittest loader discover throwing \"AssertionError: View function mapping is overwriting an existing endpoint function\"",
    "user": {
        "login": "docapotamus",
        "id": 1929544,
        "node_id": "MDQ6VXNlcjE5Mjk1NDQ=",
        "avatar_url": "https://avatars1.githubusercontent.com/u/1929544?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/docapotamus",
        "html_url": "https://github.com/docapotamus",
        "followers_url": "https://api.github.com/users/docapotamus/followers",
        "following_url": "https://api.github.com/users/docapotamus/following{/other_user}",
        "gists_url": "https://api.github.com/users/docapotamus/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/docapotamus/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/docapotamus/subscriptions",
        "organizations_url": "https://api.github.com/users/docapotamus/orgs",
        "repos_url": "https://api.github.com/users/docapotamus/repos",
        "events_url": "https://api.github.com/users/docapotamus/events{/privacy}",
        "received_events_url": "https://api.github.com/users/docapotamus/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 4,
    "created_at": "2014-05-04T16:16:51Z",
    "updated_at": "2014-05-04T17:03:54Z",
    "closed_at": "2014-05-04T16:33:17Z",
    "author_association": "NONE",
    "body": "I have have an issue with unittest.TestLoader().discover() throwing the error \"AssertionError: View function mapping is overwriting an existing endpoint function\".\n\nI have an application as a package.\nI brake the package up logically into sub-packages (no blueprints).\nEach sub-package has a 'tests.py' file, which holds the units tests for that sub-package.\nOutside of the application package I have a script called 'run_tests.py', it uses the following code to discover the tests:\n\n``` python\nimport unittest\n\nsuite = unittest.TestLoader().discover('<application package>', pattern='*tests.py')\nunittest.TextTestRunner().run(suite)\n```\n\nAll views are stored in the sub-packages as 'views.py' these are loaded by the applications package '**init**.py' when the application is run. This is also the same file the Flask() application is created.\n\nWhen I run the script 'run_tests.py' I get the following issue:\n\n```\nAssertionError: View function mapping is overwriting an existing endpoint function: <endpint name>\n```\n\nIf however I point discover at '<application package>.<sub-package' I do not get the issue.\n\nIt would appear that 'unittest' loads the modules each time in tries to discover.\n\nI know this is not a good idea for people Googling in future but I have a GH repo branch which replicates the issue: https://github.com/pjuu/pjuu/tree/0.3dev\n\nI am guessing I can fix this issue with an application factory instead of an 'app' variable inside the applications '**init**.py'.\n\nI have fixed the issue by moving all tests to a separate sub package called 'tests' in which no views/endpoints are loaded.\n\nI have asked on IRC and been informed this may be as issue. I will happy to find out it isn't and a pointer to my own mistake/misunderstanding.\n\nIs this a Flask issue, a unittest issue or something else?\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/42137132",
            "html_url": "https://github.com/pallets/flask/issues/1046#issuecomment-42137132",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1046",
            "id": 42137132,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyMTM3MTMy",
            "user": {
                "login": "danielchatfield",
                "id": 1058676,
                "node_id": "MDQ6VXNlcjEwNTg2NzY=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/1058676?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/danielchatfield",
                "html_url": "https://github.com/danielchatfield",
                "followers_url": "https://api.github.com/users/danielchatfield/followers",
                "following_url": "https://api.github.com/users/danielchatfield/following{/other_user}",
                "gists_url": "https://api.github.com/users/danielchatfield/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/danielchatfield/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/danielchatfield/subscriptions",
                "organizations_url": "https://api.github.com/users/danielchatfield/orgs",
                "repos_url": "https://api.github.com/users/danielchatfield/repos",
                "events_url": "https://api.github.com/users/danielchatfield/events{/privacy}",
                "received_events_url": "https://api.github.com/users/danielchatfield/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-05-04T16:28:55Z",
            "updated_at": "2014-05-04T16:28:55Z",
            "author_association": "NONE",
            "body": "This is because the `views.py` files are being imported twice. When `__init__.py` is executed the `views.py` files are imported using `.views` however `unittest` will import them another way (probably `pjuu.auth.views` for example).\n\nWhen unittest imports `auth.tests`, `auth/__init__.py` gets evaluated and thus the views.py file also gets imported. I suggest you remove the import `.views` from the `__init__.py` file and then in the main `__init__.py` file use `import auth.views` etc.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/42137233",
            "html_url": "https://github.com/pallets/flask/issues/1046#issuecomment-42137233",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1046",
            "id": 42137233,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyMTM3MjMz",
            "user": {
                "login": "docapotamus",
                "id": 1929544,
                "node_id": "MDQ6VXNlcjE5Mjk1NDQ=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1929544?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/docapotamus",
                "html_url": "https://github.com/docapotamus",
                "followers_url": "https://api.github.com/users/docapotamus/followers",
                "following_url": "https://api.github.com/users/docapotamus/following{/other_user}",
                "gists_url": "https://api.github.com/users/docapotamus/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/docapotamus/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/docapotamus/subscriptions",
                "organizations_url": "https://api.github.com/users/docapotamus/orgs",
                "repos_url": "https://api.github.com/users/docapotamus/repos",
                "events_url": "https://api.github.com/users/docapotamus/events{/privacy}",
                "received_events_url": "https://api.github.com/users/docapotamus/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-05-04T16:33:16Z",
            "updated_at": "2014-05-04T16:33:16Z",
            "author_association": "NONE",
            "body": "@danielchatfield I thought I was being silly with this. Thank you very much for your help! That's fixed my issue\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/42137284",
            "html_url": "https://github.com/pallets/flask/issues/1046#issuecomment-42137284",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1046",
            "id": 42137284,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyMTM3Mjg0",
            "user": {
                "login": "danielchatfield",
                "id": 1058676,
                "node_id": "MDQ6VXNlcjEwNTg2NzY=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/1058676?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/danielchatfield",
                "html_url": "https://github.com/danielchatfield",
                "followers_url": "https://api.github.com/users/danielchatfield/followers",
                "following_url": "https://api.github.com/users/danielchatfield/following{/other_user}",
                "gists_url": "https://api.github.com/users/danielchatfield/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/danielchatfield/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/danielchatfield/subscriptions",
                "organizations_url": "https://api.github.com/users/danielchatfield/orgs",
                "repos_url": "https://api.github.com/users/danielchatfield/repos",
                "events_url": "https://api.github.com/users/danielchatfield/events{/privacy}",
                "received_events_url": "https://api.github.com/users/danielchatfield/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-05-04T16:34:34Z",
            "updated_at": "2014-05-04T16:34:34Z",
            "author_association": "NONE",
            "body": "No problem, glad I could help :)\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/42138082",
            "html_url": "https://github.com/pallets/flask/issues/1046#issuecomment-42138082",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1046",
            "id": 42138082,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyMTM4MDgy",
            "user": {
                "login": "docapotamus",
                "id": 1929544,
                "node_id": "MDQ6VXNlcjE5Mjk1NDQ=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1929544?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/docapotamus",
                "html_url": "https://github.com/docapotamus",
                "followers_url": "https://api.github.com/users/docapotamus/followers",
                "following_url": "https://api.github.com/users/docapotamus/following{/other_user}",
                "gists_url": "https://api.github.com/users/docapotamus/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/docapotamus/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/docapotamus/subscriptions",
                "organizations_url": "https://api.github.com/users/docapotamus/orgs",
                "repos_url": "https://api.github.com/users/docapotamus/repos",
                "events_url": "https://api.github.com/users/docapotamus/events{/privacy}",
                "received_events_url": "https://api.github.com/users/docapotamus/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-05-04T17:03:54Z",
            "updated_at": "2014-05-04T17:03:54Z",
            "author_association": "NONE",
            "body": ":)\n"
        }
    ]
}