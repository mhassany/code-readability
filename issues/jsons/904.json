{
    "url": "https://api.github.com/repos/pallets/flask/issues/904",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/904/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/904/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/904/events",
    "html_url": "https://github.com/pallets/flask/issues/904",
    "id": 22074354,
    "node_id": "MDU6SXNzdWUyMjA3NDM1NA==",
    "number": 904,
    "title": "POST request from Dropzone.js failing in Flask",
    "user": {
        "login": "teechap",
        "id": 3198219,
        "node_id": "MDQ6VXNlcjMxOTgyMTk=",
        "avatar_url": "https://avatars3.githubusercontent.com/u/3198219?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/teechap",
        "html_url": "https://github.com/teechap",
        "followers_url": "https://api.github.com/users/teechap/followers",
        "following_url": "https://api.github.com/users/teechap/following{/other_user}",
        "gists_url": "https://api.github.com/users/teechap/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/teechap/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/teechap/subscriptions",
        "organizations_url": "https://api.github.com/users/teechap/orgs",
        "repos_url": "https://api.github.com/users/teechap/repos",
        "events_url": "https://api.github.com/users/teechap/events{/privacy}",
        "received_events_url": "https://api.github.com/users/teechap/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2013-11-04T19:42:04Z",
    "updated_at": "2013-11-14T19:13:35Z",
    "closed_at": "2013-11-14T19:13:35Z",
    "author_association": "NONE",
    "body": "I'm trying to post files to a MongoDB collection with Flask. I decided to use the Dropzone.js library to make a file drop zone. After some troubleshooting, I realized my database code was fine, but Flask isn't returning anything when request.method == \"POST\". Does anyone know why Flask isn't hitting the return statement when the request method is post for the index view?\n\n```\n\nfrom flask import Flask, request, render_template, redirect\nfrom flask.ext.mongoengine import MongoEngine \nimport datetime\n\napp = Flask(__name__)\n\n#set up database\napp.config[\"MONGODB_SETTINGS\"] = {'DB': 'pdfs'}\napp.config['SECRET_KEY'] = \"reallysecret\"\n\ndb = MongoEngine(app)\n\nclass PDF(db.Document):\n    pdf = db.FileField()\n    uploaded_at = db.DateTimeField(default=datetime.datetime.now)\n    file_size = None\n\n    def __unicode__(self):\n        return self.uploaded_at\n\n    meta = {\n        'indexes':['-uploaded_at'],\n        'ordering':['-uploaded_at']\n    }\n\n@app.route('/', methods=[\"GET\", \"POST\"])\ndef index():\n    if request.method == \"GET\":\n        return render_template('index.html')\n    if request.method == \"POST\":\n        return \"Didn't do anything with POST, but here's a message.\"\n\n```\n\nMy index.html template looks like this:\n\n```\n\n<!doctype html>\n<head>\n    <title>File Upload</title>\n    <link rel=stylesheet type=text/css href=\"{{ url_for('static', filename='dropzone.css') }}\">\n    <script src=\"{{url_for('static', filename='dropzone.js')}}\"></script>\n</head>\n<body>\n    <form action=\"{{url_for('index')}}\" class=\"dropzone dz-clickable\">\n        <div class=\"dz-default dz-message\"></div>\n    </form>\n</body>\n\n```\n\nIn Terminal, it looks like the POST request succeeded (code 200), but the return message does not display in the browser and Dropzone says the server responded with code 0.\n\nTerminal output: 127.0.0.1 - - [03/Nov/2013 18:37:06] \"GET / HTTP/1.1\" 200 - 127.0.0.1 - - [03/Nov/2013 18:37:06] \"GET /static/dropzone.css HTTP/1.1\" 304 - 127.0.0.1 - - [03/Nov/2013 18:37:06] \"GET /static/dropzone.js HTTP/1.1\" 304 - 127.0.0.1 - - [03/Nov/2013 18:37:06] \"GET /static/spritemap.png HTTP/1.1\" 304 - 127.0.0.1 - - [03/Nov/2013 18:37:07] \"GET /favicon.ico HTTP/1.1\" 500 - 127.0.0.1 - - **[03/Nov/2013 18:37:13] \"POST / HTTP/1.1\" 200 -**\n\n**Browser window**, Dropzone says server responded with code 0: http://imgur.com/JsfISMp\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/27728642",
            "html_url": "https://github.com/pallets/flask/issues/904#issuecomment-27728642",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/904",
            "id": 27728642,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI3NzI4NjQy",
            "user": {
                "login": "noonat",
                "id": 2610,
                "node_id": "MDQ6VXNlcjI2MTA=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/2610?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/noonat",
                "html_url": "https://github.com/noonat",
                "followers_url": "https://api.github.com/users/noonat/followers",
                "following_url": "https://api.github.com/users/noonat/following{/other_user}",
                "gists_url": "https://api.github.com/users/noonat/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/noonat/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/noonat/subscriptions",
                "organizations_url": "https://api.github.com/users/noonat/orgs",
                "repos_url": "https://api.github.com/users/noonat/repos",
                "events_url": "https://api.github.com/users/noonat/events{/privacy}",
                "received_events_url": "https://api.github.com/users/noonat/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-11-04T22:20:04Z",
            "updated_at": "2013-11-04T22:20:04Z",
            "author_association": "NONE",
            "body": "What happens when you POST to the URL with curl? Assuming port 5000:\n\n`curl -v -X POST http://127.0.0.1:5000/`\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/27729582",
            "html_url": "https://github.com/pallets/flask/issues/904#issuecomment-27729582",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/904",
            "id": 27729582,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI3NzI5NTgy",
            "user": {
                "login": "teechap",
                "id": 3198219,
                "node_id": "MDQ6VXNlcjMxOTgyMTk=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/3198219?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/teechap",
                "html_url": "https://github.com/teechap",
                "followers_url": "https://api.github.com/users/teechap/followers",
                "following_url": "https://api.github.com/users/teechap/following{/other_user}",
                "gists_url": "https://api.github.com/users/teechap/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/teechap/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/teechap/subscriptions",
                "organizations_url": "https://api.github.com/users/teechap/orgs",
                "repos_url": "https://api.github.com/users/teechap/repos",
                "events_url": "https://api.github.com/users/teechap/events{/privacy}",
                "received_events_url": "https://api.github.com/users/teechap/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-11-04T22:32:33Z",
            "updated_at": "2013-11-04T22:32:33Z",
            "author_association": "NONE",
            "body": "Here's the output in Terminal, noonat. Looks like the POST return statement was called, so maybe this is an issue with Dropzone/Flask working together...?\n\ncurl -v -X POST http://127.0.0.1:5000/\n- About to connect() to 127.0.0.1 port 5000 (#0)\n-   Trying 127.0.0.1...\n- Adding handle: conn: 0x7fbd1b004000\n- Adding handle: send: 0\n- Adding handle: recv: 0\n- Curl_addHandleToPipeline: length: 1\n- \\- Conn 0 (0x7fbd1b004000) send_pipe: 1, recv_pipe: 0\n- Connected to 127.0.0.1 (127.0.0.1) port 5000 (#0)\n  > POST / HTTP/1.1\n  > User-Agent: curl/7.30.0\n  > Host: 127.0.0.1:5000\n  > Accept: _/_\n  > \n- HTTP 1.0, assume close after body\n  < HTTP/1.0 200 OK\n  < Content-Type: text/html; charset=utf-8\n  < Content-Length: 51\n  < Server: Werkzeug/0.9 Python/2.7.3\n  < Date: Mon, 04 Nov 2013 22:29:34 GMT\n  < \n- Closing connection 0\n  Didn't do anything with POST, but here's a message.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/27739451",
            "html_url": "https://github.com/pallets/flask/issues/904#issuecomment-27739451",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/904",
            "id": 27739451,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI3NzM5NDUx",
            "user": {
                "login": "noonat",
                "id": 2610,
                "node_id": "MDQ6VXNlcjI2MTA=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/2610?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/noonat",
                "html_url": "https://github.com/noonat",
                "followers_url": "https://api.github.com/users/noonat/followers",
                "following_url": "https://api.github.com/users/noonat/following{/other_user}",
                "gists_url": "https://api.github.com/users/noonat/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/noonat/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/noonat/subscriptions",
                "organizations_url": "https://api.github.com/users/noonat/orgs",
                "repos_url": "https://api.github.com/users/noonat/repos",
                "events_url": "https://api.github.com/users/noonat/events{/privacy}",
                "received_events_url": "https://api.github.com/users/noonat/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-11-05T01:20:14Z",
            "updated_at": "2013-11-05T01:20:14Z",
            "author_association": "NONE",
            "body": "I can repro this, but I don't think it's a Flask issue.\n\nIt only happens when I upload files of a sufficient size (a 256k file works fine, 512k file does not). It happens to me in Chrome 30 and Safari 7. But it does **not** happen in Firefox 23, and I am able to upload large files without error via curl.\n\nSo perhaps it's a WebKit-specific or Dropzone.js issue?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/27739909",
            "html_url": "https://github.com/pallets/flask/issues/904#issuecomment-27739909",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/904",
            "id": 27739909,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI3NzM5OTA5",
            "user": {
                "login": "teechap",
                "id": 3198219,
                "node_id": "MDQ6VXNlcjMxOTgyMTk=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/3198219?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/teechap",
                "html_url": "https://github.com/teechap",
                "followers_url": "https://api.github.com/users/teechap/followers",
                "following_url": "https://api.github.com/users/teechap/following{/other_user}",
                "gists_url": "https://api.github.com/users/teechap/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/teechap/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/teechap/subscriptions",
                "organizations_url": "https://api.github.com/users/teechap/orgs",
                "repos_url": "https://api.github.com/users/teechap/repos",
                "events_url": "https://api.github.com/users/teechap/events{/privacy}",
                "received_events_url": "https://api.github.com/users/teechap/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-11-05T01:31:14Z",
            "updated_at": "2013-11-05T01:31:14Z",
            "author_association": "NONE",
            "body": "Interesting, how did you upload via curl? Thanks for the info!\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/27740451",
            "html_url": "https://github.com/pallets/flask/issues/904#issuecomment-27740451",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/904",
            "id": 27740451,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI3NzQwNDUx",
            "user": {
                "login": "noonat",
                "id": 2610,
                "node_id": "MDQ6VXNlcjI2MTA=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/2610?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/noonat",
                "html_url": "https://github.com/noonat",
                "followers_url": "https://api.github.com/users/noonat/followers",
                "following_url": "https://api.github.com/users/noonat/following{/other_user}",
                "gists_url": "https://api.github.com/users/noonat/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/noonat/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/noonat/subscriptions",
                "organizations_url": "https://api.github.com/users/noonat/orgs",
                "repos_url": "https://api.github.com/users/noonat/repos",
                "events_url": "https://api.github.com/users/noonat/events{/privacy}",
                "received_events_url": "https://api.github.com/users/noonat/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-11-05T01:44:03Z",
            "updated_at": "2013-11-05T01:44:03Z",
            "author_association": "NONE",
            "body": "So, at least on my local copy of your code, I can fix this by just referencing the request's files attribute in the handler:\n\n``` python\n@app.route('/', methods=[\"GET\", \"POST\"])\ndef index():\n    if request.method == \"GET\":\n        return render_template('index.html')\n    if request.method == \"POST\":\n        print request.files   # <-- this\n        return \"Didn't do anything with POST, but here's a message.\"\n```\n\nI think this is your issue:\nhttps://code.google.com/p/chromium/issues/detail?id=45980\n\nIt appears that when the connection is closed before Chrome finishes sending the file, it treats it as an XMLHTTPRequest error. It looks like Werkzeug doesn't parse the form data until that attribute is triggered (see [here](https://github.com/mitsuhiko/werkzeug/blob/master/werkzeug/wrappers.py#L512) and [here](https://github.com/mitsuhiko/werkzeug/blob/master/werkzeug/wrappers.py#L335)).\n\nTry doing something with the files and see if it works for you.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/27935487",
            "html_url": "https://github.com/pallets/flask/issues/904#issuecomment-27935487",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/904",
            "id": 27935487,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI3OTM1NDg3",
            "user": {
                "login": "noonat",
                "id": 2610,
                "node_id": "MDQ6VXNlcjI2MTA=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/2610?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/noonat",
                "html_url": "https://github.com/noonat",
                "followers_url": "https://api.github.com/users/noonat/followers",
                "following_url": "https://api.github.com/users/noonat/following{/other_user}",
                "gists_url": "https://api.github.com/users/noonat/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/noonat/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/noonat/subscriptions",
                "organizations_url": "https://api.github.com/users/noonat/orgs",
                "repos_url": "https://api.github.com/users/noonat/repos",
                "events_url": "https://api.github.com/users/noonat/events{/privacy}",
                "received_events_url": "https://api.github.com/users/noonat/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-11-07T03:30:17Z",
            "updated_at": "2013-11-07T03:30:17Z",
            "author_association": "NONE",
            "body": "@mitsuhiko I think this one could be closed.\n"
        }
    ]
}