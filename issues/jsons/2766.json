{
    "url": "https://api.github.com/repos/pallets/flask/issues/2766",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2766/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2766/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2766/events",
    "html_url": "https://github.com/pallets/flask/issues/2766",
    "id": 321319587,
    "node_id": "MDU6SXNzdWUzMjEzMTk1ODc=",
    "number": 2766,
    "title": "send_file: latin-1 encoding not compatible with gunicorn",
    "user": {
        "login": "jrast",
        "id": 146369,
        "node_id": "MDQ6VXNlcjE0NjM2OQ==",
        "avatar_url": "https://avatars3.githubusercontent.com/u/146369?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jrast",
        "html_url": "https://github.com/jrast",
        "followers_url": "https://api.github.com/users/jrast/followers",
        "following_url": "https://api.github.com/users/jrast/following{/other_user}",
        "gists_url": "https://api.github.com/users/jrast/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/jrast/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jrast/subscriptions",
        "organizations_url": "https://api.github.com/users/jrast/orgs",
        "repos_url": "https://api.github.com/users/jrast/repos",
        "events_url": "https://api.github.com/users/jrast/events{/privacy}",
        "received_events_url": "https://api.github.com/users/jrast/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "davidism",
        "id": 1242887,
        "node_id": "MDQ6VXNlcjEyNDI4ODc=",
        "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidism",
        "html_url": "https://github.com/davidism",
        "followers_url": "https://api.github.com/users/davidism/followers",
        "following_url": "https://api.github.com/users/davidism/following{/other_user}",
        "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
        "organizations_url": "https://api.github.com/users/davidism/orgs",
        "repos_url": "https://api.github.com/users/davidism/repos",
        "events_url": "https://api.github.com/users/davidism/events{/privacy}",
        "received_events_url": "https://api.github.com/users/davidism/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "davidism",
            "id": 1242887,
            "node_id": "MDQ6VXNlcjEyNDI4ODc=",
            "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/davidism",
            "html_url": "https://github.com/davidism",
            "followers_url": "https://api.github.com/users/davidism/followers",
            "following_url": "https://api.github.com/users/davidism/following{/other_user}",
            "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
            "organizations_url": "https://api.github.com/users/davidism/orgs",
            "repos_url": "https://api.github.com/users/davidism/repos",
            "events_url": "https://api.github.com/users/davidism/events{/privacy}",
            "received_events_url": "https://api.github.com/users/davidism/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": {
        "url": "https://api.github.com/repos/pallets/flask/milestones/7",
        "html_url": "https://github.com/pallets/flask/milestone/7",
        "labels_url": "https://api.github.com/repos/pallets/flask/milestones/7/labels",
        "id": 3354647,
        "node_id": "MDk6TWlsZXN0b25lMzM1NDY0Nw==",
        "number": 7,
        "title": "1.0.3",
        "description": "",
        "creator": {
            "login": "davidism",
            "id": 1242887,
            "node_id": "MDQ6VXNlcjEyNDI4ODc=",
            "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/davidism",
            "html_url": "https://github.com/davidism",
            "followers_url": "https://api.github.com/users/davidism/followers",
            "following_url": "https://api.github.com/users/davidism/following{/other_user}",
            "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
            "organizations_url": "https://api.github.com/users/davidism/orgs",
            "repos_url": "https://api.github.com/users/davidism/repos",
            "events_url": "https://api.github.com/users/davidism/events{/privacy}",
            "received_events_url": "https://api.github.com/users/davidism/received_events",
            "type": "User",
            "site_admin": false
        },
        "open_issues": 0,
        "closed_issues": 31,
        "state": "closed",
        "created_at": "2018-05-17T13:23:45Z",
        "updated_at": "2019-05-17T17:43:44Z",
        "due_on": null,
        "closed_at": "2019-05-17T17:43:44Z"
    },
    "comments": 7,
    "created_at": "2018-05-08T19:37:23Z",
    "updated_at": "2018-05-28T21:47:51Z",
    "closed_at": "2018-05-28T21:47:51Z",
    "author_association": "NONE",
    "body": "With the latest release (flask 1.0.0), unicode attachement filenames are allowed by flask.\r\nI was waiting for this change and it seems to work great using the builtin dev server. However, gunicorn on the production server does not support `latin-1` encoding for the headers and only supports `ascii`.\r\n\r\nOriginaly flask also opted for ASCII encoding, however commit 336d6a48e0104b53302fd8377dd399af43607cf9 changed this and since then `latin-1` is used.\r\n\r\nWhat was the rational to switch to `latin-1`? I know, officially it's allowed, however gunicorn decided to only support ASCII: (see related issue)\r\n\r\n > it's well documented around the web that HTTP headers should be ASCII\r\n\r\nIs there a change that flask also switches back to ASCII?\r\n\r\nRelated Issues: \r\n- #2223\r\n- benoitc/gunicorn#1353\r\n- benoitc/gunicorn#1778\r\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/387535039",
            "html_url": "https://github.com/pallets/flask/issues/2766#issuecomment-387535039",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2766",
            "id": 387535039,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM4NzUzNTAzOQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-05-08T20:39:06Z",
            "updated_at": "2018-05-08T20:39:06Z",
            "author_association": "MEMBER",
            "body": "Headers are Latin-1. Gunicorn only allowing ASCII is incorrect."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/387541427",
            "html_url": "https://github.com/pallets/flask/issues/2766#issuecomment-387541427",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2766",
            "id": 387541427,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM4NzU0MTQyNw==",
            "user": {
                "login": "jrast",
                "id": 146369,
                "node_id": "MDQ6VXNlcjE0NjM2OQ==",
                "avatar_url": "https://avatars3.githubusercontent.com/u/146369?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/jrast",
                "html_url": "https://github.com/jrast",
                "followers_url": "https://api.github.com/users/jrast/followers",
                "following_url": "https://api.github.com/users/jrast/following{/other_user}",
                "gists_url": "https://api.github.com/users/jrast/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/jrast/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jrast/subscriptions",
                "organizations_url": "https://api.github.com/users/jrast/orgs",
                "repos_url": "https://api.github.com/users/jrast/repos",
                "events_url": "https://api.github.com/users/jrast/events{/privacy}",
                "received_events_url": "https://api.github.com/users/jrast/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-05-08T21:02:47Z",
            "updated_at": "2018-05-08T21:02:47Z",
            "author_association": "NONE",
            "body": "I know, headers should be encoded using latin-1, but I think it's not uncommon to use flask + gunicorn and looking at the closed issue from some time ago, it's not like they will change soon.\r\n\r\nHowever, I will open a new issue in the gunicorn bugtracker, as it's really a gunicorn issue. "
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/387581453",
            "html_url": "https://github.com/pallets/flask/issues/2766#issuecomment-387581453",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2766",
            "id": 387581453,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM4NzU4MTQ1Mw==",
            "user": {
                "login": "benoitc",
                "id": 14498,
                "node_id": "MDQ6VXNlcjE0NDk4",
                "avatar_url": "https://avatars1.githubusercontent.com/u/14498?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/benoitc",
                "html_url": "https://github.com/benoitc",
                "followers_url": "https://api.github.com/users/benoitc/followers",
                "following_url": "https://api.github.com/users/benoitc/following{/other_user}",
                "gists_url": "https://api.github.com/users/benoitc/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/benoitc/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/benoitc/subscriptions",
                "organizations_url": "https://api.github.com/users/benoitc/orgs",
                "repos_url": "https://api.github.com/users/benoitc/repos",
                "events_url": "https://api.github.com/users/benoitc/events{/privacy}",
                "received_events_url": "https://api.github.com/users/benoitc/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-05-09T00:17:09Z",
            "updated_at": "2018-05-09T00:17:09Z",
            "author_association": "NONE",
            "body": "@davidism that's not true according the updated spec 7230: \r\n\r\n> Historically, HTTP has allowed field content with text in the ISO\u20118859\u20111 charset [ISO-8859-1], supporting other charsets only through use of [RFC2047] encoding. In practice, most HTTP header field values use only a subset of the US-ASCII charset [USASCII]. Newly defined header fields SHOULD limit their field values to US\u2011ASCII octets. A recipient SHOULD treat other octets in field content (obs\u2011text) as opaque data.\r\n\r\nAnyway it used to work with previous versions of flask. What changed since?\r\n\r\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/387591540",
            "html_url": "https://github.com/pallets/flask/issues/2766#issuecomment-387591540",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2766",
            "id": 387591540,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM4NzU5MTU0MA==",
            "user": {
                "login": "tilgovi",
                "id": 20818,
                "node_id": "MDQ6VXNlcjIwODE4",
                "avatar_url": "https://avatars3.githubusercontent.com/u/20818?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/tilgovi",
                "html_url": "https://github.com/tilgovi",
                "followers_url": "https://api.github.com/users/tilgovi/followers",
                "following_url": "https://api.github.com/users/tilgovi/following{/other_user}",
                "gists_url": "https://api.github.com/users/tilgovi/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/tilgovi/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tilgovi/subscriptions",
                "organizations_url": "https://api.github.com/users/tilgovi/orgs",
                "repos_url": "https://api.github.com/users/tilgovi/repos",
                "events_url": "https://api.github.com/users/tilgovi/events{/privacy}",
                "received_events_url": "https://api.github.com/users/tilgovi/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-05-09T01:26:41Z",
            "updated_at": "2018-05-09T01:26:41Z",
            "author_association": "NONE",
            "body": "> Anyway it used to work with previous versions of flask. What changed since?\r\n\r\nhttps://github.com/pallets/flask/commit/336d6a48e0104b53302fd8377dd399af43607cf9"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/387601993",
            "html_url": "https://github.com/pallets/flask/issues/2766#issuecomment-387601993",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2766",
            "id": 387601993,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM4NzYwMTk5Mw==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-05-09T02:36:59Z",
            "updated_at": "2018-05-09T02:36:59Z",
            "author_association": "MEMBER",
            "body": "@benoitc I based the change on the [Unicode section of PEP 3333](https://www.python.org/dev/peps/pep-3333/#unicode-issues):\r\n\r\n> Note also that strings passed to `start_response()` as a status or as response headers must follow RFC 2616 with respect to encoding. That is, they must either be ISO-8859-1 characters, or use RFC 2047 MIME encoding.\r\n\r\nWerkzeug encodes with Latin-1 in many other places, including the encoding dance, so I'm not sure why it didn't cause issues before.\r\n\r\nThe wsgiref server uses Latin-1 / ISO-8859-1 as well."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/391733697",
            "html_url": "https://github.com/pallets/flask/issues/2766#issuecomment-391733697",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2766",
            "id": 391733697,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTczMzY5Nw==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-05-24T14:23:34Z",
            "updated_at": "2018-05-24T14:23:34Z",
            "author_association": "MEMBER",
            "body": "Can I get an example of a filename that caused Gunicorn to raise an error? I changed `send_file` to use `ascii` encoding, but our test with a unicode filename still passed without change.\r\n\r\nhttps://github.com/pallets/flask/blob/d22491a3fbf2c1926ebc3d6919e228ed903d0670/tests/test_helpers.py#L641-L649\r\n\r\nHere's the code for the filename header (I replaced `'latin-1'` with `'ascii'` locally):\r\n\r\nhttps://github.com/pallets/flask/blob/d22491a3fbf2c1926ebc3d6919e228ed903d0670/flask/helpers.py#L566-L577"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/391736114",
            "html_url": "https://github.com/pallets/flask/issues/2766#issuecomment-391736114",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2766",
            "id": 391736114,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTczNjExNA==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-05-24T14:30:27Z",
            "updated_at": "2018-05-28T13:31:23Z",
            "author_association": "MEMBER",
            "body": "The following fails with Gunicorn:\r\n\r\n```python\r\nfrom flask import Flask, send_file\r\n\r\napp = Flask(__name__)\r\n\r\n@app.route('/')\r\ndef index():\r\n    return send_file('example.py', as_attachment=True, attachment_filename='ping\u00fcino.txt')\r\n```\r\n\r\n```\r\ngunicorn example:app\r\n```\r\n\r\nThe filename is encodable as Latin-1, so it's passed through as-is. If it had UTF-8 characters, it would trigger the `filename*` behavior and the result would be ASCII, which is why the name from the current test worked."
        }
    ]
}