{
    "url": "https://api.github.com/repos/pallets/flask/issues/3367",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/3367/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/3367/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/3367/events",
    "html_url": "https://github.com/pallets/flask/issues/3367",
    "id": 496024953,
    "node_id": "MDU6SXNzdWU0OTYwMjQ5NTM=",
    "number": 3367,
    "title": "Automatic 308 Redirection does not maintain schema ",
    "user": {
        "login": "csanders-git",
        "id": 4632287,
        "node_id": "MDQ6VXNlcjQ2MzIyODc=",
        "avatar_url": "https://avatars2.githubusercontent.com/u/4632287?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/csanders-git",
        "html_url": "https://github.com/csanders-git",
        "followers_url": "https://api.github.com/users/csanders-git/followers",
        "following_url": "https://api.github.com/users/csanders-git/following{/other_user}",
        "gists_url": "https://api.github.com/users/csanders-git/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/csanders-git/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/csanders-git/subscriptions",
        "organizations_url": "https://api.github.com/users/csanders-git/orgs",
        "repos_url": "https://api.github.com/users/csanders-git/repos",
        "events_url": "https://api.github.com/users/csanders-git/events{/privacy}",
        "received_events_url": "https://api.github.com/users/csanders-git/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 4,
    "created_at": "2019-09-19T21:01:58Z",
    "updated_at": "2019-09-19T21:10:46Z",
    "closed_at": "2019-09-19T21:09:24Z",
    "author_association": "NONE",
    "body": "### Expected Behavior\r\nWhen a user enters a route to a location with a trailing slash but leaves the trailing slash off, they either receive a 404 or they are redirected to that location with a trailing slash using the same scheme they provided (https vs http)\r\n\r\n```python\r\n@sp_app.route('/acs/', methods=[\"GET\", 'POST'])\r\ndef acs():\r\n    # example code here\r\n```\r\n\r\n### Actual Behavior\r\nFlask will happily accept a route appended with a slash. When a user navigates to that route without the trailing slash they will be redirected with a 308 PERMANENT REDIRECT. This redirection does not maintain the schema of the original request, always dropping the request to HTTP. \r\n\r\nThis can be abused by an attacker to force transmission by a user over HTTP by sending a crafted link such as https://mysite.com/acs instead of https://mysite.com/acs/. It is also likely an administrator might make this mistake when configuring locations or distributing links. \r\n\r\n### Environment\r\n* Python version: 2.7.16\r\n* Flask version:  1.1.1\r\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/533309195",
            "html_url": "https://github.com/pallets/flask/issues/3367#issuecomment-533309195",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3367",
            "id": 533309195,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUzMzMwOTE5NQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-09-19T21:05:29Z",
            "updated_at": "2019-09-19T21:05:29Z",
            "author_association": "MEMBER",
            "body": "Sounds like your app is behind a reverse proxy like Nginx and you don't have the `X-Forwarded-Proto` header and `ProxyFix` middleware configured correctly."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/533309566",
            "html_url": "https://github.com/pallets/flask/issues/3367#issuecomment-533309566",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3367",
            "id": 533309566,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUzMzMwOTU2Ng==",
            "user": {
                "login": "csanders-git",
                "id": 4632287,
                "node_id": "MDQ6VXNlcjQ2MzIyODc=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/4632287?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/csanders-git",
                "html_url": "https://github.com/csanders-git",
                "followers_url": "https://api.github.com/users/csanders-git/followers",
                "following_url": "https://api.github.com/users/csanders-git/following{/other_user}",
                "gists_url": "https://api.github.com/users/csanders-git/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/csanders-git/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/csanders-git/subscriptions",
                "organizations_url": "https://api.github.com/users/csanders-git/orgs",
                "repos_url": "https://api.github.com/users/csanders-git/repos",
                "events_url": "https://api.github.com/users/csanders-git/events{/privacy}",
                "received_events_url": "https://api.github.com/users/csanders-git/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-09-19T21:06:35Z",
            "updated_at": "2019-09-19T21:06:35Z",
            "author_association": "NONE",
            "body": "That is correct, it is behind an AWS LB"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/533310424",
            "html_url": "https://github.com/pallets/flask/issues/3367#issuecomment-533310424",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3367",
            "id": 533310424,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUzMzMxMDQyNA==",
            "user": {
                "login": "csanders-git",
                "id": 4632287,
                "node_id": "MDQ6VXNlcjQ2MzIyODc=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/4632287?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/csanders-git",
                "html_url": "https://github.com/csanders-git",
                "followers_url": "https://api.github.com/users/csanders-git/followers",
                "following_url": "https://api.github.com/users/csanders-git/following{/other_user}",
                "gists_url": "https://api.github.com/users/csanders-git/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/csanders-git/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/csanders-git/subscriptions",
                "organizations_url": "https://api.github.com/users/csanders-git/orgs",
                "repos_url": "https://api.github.com/users/csanders-git/repos",
                "events_url": "https://api.github.com/users/csanders-git/events{/privacy}",
                "received_events_url": "https://api.github.com/users/csanders-git/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-09-19T21:09:15Z",
            "updated_at": "2019-09-19T21:09:15Z",
            "author_association": "NONE",
            "body": "@davidism i'm now looking at https://github.com/pallets/werkzeug/issues/1023 -- is there documentation for this anywhere?"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/533310457",
            "html_url": "https://github.com/pallets/flask/issues/3367#issuecomment-533310457",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3367",
            "id": 533310457,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUzMzMxMDQ1Nw==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-09-19T21:09:24Z",
            "updated_at": "2019-09-19T21:10:46Z",
            "author_association": "MEMBER",
            "body": "```python\r\nfrom werkzeug.middlware.proxy_fix import ProxyFix\r\n\r\napp.wsgi_app = ProxyFix(app.wsgi_app)\r\n```\r\n\r\nSee the docs on AWS LB to figure out what `X-Forwarded-` headers it sets and configure [`ProxyFix`](https://werkzeug.palletsprojects.com/middleware/proxy_fix/) appropriately. If there is another reverse proxy behind LB, you'll need to configure its headers correctly too and reflect that in `ProxyFix`."
        }
    ]
}