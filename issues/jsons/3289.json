{
    "url": "https://api.github.com/repos/pallets/flask/issues/3289",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/3289/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/3289/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/3289/events",
    "html_url": "https://github.com/pallets/flask/issues/3289",
    "id": 464957402,
    "node_id": "MDU6SXNzdWU0NjQ5NTc0MDI=",
    "number": 3289,
    "title": "Allow accessing CLI command name from Flask CLI app factory",
    "user": {
        "login": "justanr",
        "id": 4221605,
        "node_id": "MDQ6VXNlcjQyMjE2MDU=",
        "avatar_url": "https://avatars2.githubusercontent.com/u/4221605?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/justanr",
        "html_url": "https://github.com/justanr",
        "followers_url": "https://api.github.com/users/justanr/followers",
        "following_url": "https://api.github.com/users/justanr/following{/other_user}",
        "gists_url": "https://api.github.com/users/justanr/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/justanr/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/justanr/subscriptions",
        "organizations_url": "https://api.github.com/users/justanr/orgs",
        "repos_url": "https://api.github.com/users/justanr/repos",
        "events_url": "https://api.github.com/users/justanr/events{/privacy}",
        "received_events_url": "https://api.github.com/users/justanr/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 5,
    "created_at": "2019-07-07T14:16:26Z",
    "updated_at": "2019-07-07T15:55:39Z",
    "closed_at": "2019-07-07T15:55:39Z",
    "author_association": "NONE",
    "body": "### Expected Behavior\r\n\r\nThe selected command should be available in the application factory provided to the click integration.\r\n\r\nI recently started adding instrumentation to an application, however when I run most CLI commands I don't want to trigger the instrumentation to be initialized. However by the time I gain access to the application it's too late to turn it off (things have been mucked with and monkeypatched, etc). It seems like the easiest thing to do is allow the selected command to be considered when running the application factory so the factory can make informed decisions about what should/shouldn't be initialized during application setup based on what I'm attempting to do.\r\n\r\nThere is the possibility of doing various things such as:\r\n\r\n- adding a `--no-trace` flag to the top level command\r\n- using a custom configuration when executing CLI commands _other_ than run\r\n- probably some other gross things\r\n\r\nI managed to work around this not being available out of the box by adding the following to a custom flask group (something we were already using):\r\n\r\n```python\r\ndef get_command(self, ctx, name):\r\n    # arguably belongs on ScriptInfo.data instead of just shoving it on there\r\n    ctx.ensure_object(ScriptInfo).command = name\r\n    super().get_command(ctx, name)\r\n```\r\n\r\n### Actual Behavior\r\n\r\nUnless I'm missing something, it's not available through vanilla means.\r\n\r\n### Environment\r\n\r\n* Python version: 3.7\r\n* Flask version: 1.0.2\r\n* Werkzeug version: 0.14.1\r\n* Click version: 6.7",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/509004414",
            "html_url": "https://github.com/pallets/flask/issues/3289#issuecomment-509004414",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3289",
            "id": 509004414,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTAwNDQxNA==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-07-07T14:33:33Z",
            "updated_at": "2019-07-07T14:33:53Z",
            "author_association": "MEMBER",
            "body": "I'm sorry, I can't understand what issue with Flask you're trying to describe."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/509005009",
            "html_url": "https://github.com/pallets/flask/issues/3289#issuecomment-509005009",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3289",
            "id": 509005009,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTAwNTAwOQ==",
            "user": {
                "login": "justanr",
                "id": 4221605,
                "node_id": "MDQ6VXNlcjQyMjE2MDU=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/4221605?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/justanr",
                "html_url": "https://github.com/justanr",
                "followers_url": "https://api.github.com/users/justanr/followers",
                "following_url": "https://api.github.com/users/justanr/following{/other_user}",
                "gists_url": "https://api.github.com/users/justanr/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/justanr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justanr/subscriptions",
                "organizations_url": "https://api.github.com/users/justanr/orgs",
                "repos_url": "https://api.github.com/users/justanr/repos",
                "events_url": "https://api.github.com/users/justanr/events{/privacy}",
                "received_events_url": "https://api.github.com/users/justanr/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-07-07T14:42:18Z",
            "updated_at": "2019-07-07T14:42:18Z",
            "author_association": "NONE",
            "body": "What I want to do is do further configuration on my application depending on if I'm running the server OR running a CLI command (shell, routes, using flask-alembic, etc) however it doesn't appear that the `flask <command name>` is exposed to the application factory that can be given to the click integration via `@click.group(class=FlaskGroup, create_app=create_app)`.\r\n\r\nI can't trigger the setup in the command itself because the application has already been created by that point and creating a second app seems like it would be error prone at best.\r\n\r\nInstead, I'd like to be able to access some attribute on the ScriptInfo that would give this information similar to my workaround above.\r\n\r\nMaybe it's better to discuss this in `#pocoo`?"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/509007163",
            "html_url": "https://github.com/pallets/flask/issues/3289#issuecomment-509007163",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3289",
            "id": 509007163,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTAwNzE2Mw==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-07-07T15:12:06Z",
            "updated_at": "2019-07-07T15:12:06Z",
            "author_association": "MEMBER",
            "body": "The CLI needs to create the application to understand what commands are available to it. It looks like you already have a workaround for your specific project. You can also look at `sys.argv` in the factory.\r\n\r\nIt's not clear to me right now that this is something that needs to be changed in Flask, or even what that change would be. I am very reluctant to introduce more complexity into the CLI code."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/509008382",
            "html_url": "https://github.com/pallets/flask/issues/3289#issuecomment-509008382",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3289",
            "id": 509008382,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTAwODM4Mg==",
            "user": {
                "login": "justanr",
                "id": 4221605,
                "node_id": "MDQ6VXNlcjQyMjE2MDU=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/4221605?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/justanr",
                "html_url": "https://github.com/justanr",
                "followers_url": "https://api.github.com/users/justanr/followers",
                "following_url": "https://api.github.com/users/justanr/following{/other_user}",
                "gists_url": "https://api.github.com/users/justanr/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/justanr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justanr/subscriptions",
                "organizations_url": "https://api.github.com/users/justanr/orgs",
                "repos_url": "https://api.github.com/users/justanr/repos",
                "events_url": "https://api.github.com/users/justanr/events{/privacy}",
                "received_events_url": "https://api.github.com/users/justanr/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-07-07T15:28:32Z",
            "updated_at": "2019-07-07T15:28:32Z",
            "author_association": "NONE",
            "body": ">  It looks like you already have a workaround for your specific project.\r\n\r\nI do, but in implementing it, it seemed like a hole in the API but then again maybe I'm just doing something weird.\r\n\r\n> You can also look at sys.argv in the factory.\r\n\r\nSeems odd at best to consult a lower level system when a higher level one can provide it and that means we'd potentially need to parse `sys.argv` again (because iirc some of the flask commands make changes to this, or am I remembering something from an older version/werkzeug?)\r\n\r\n> It's not clear to me right now that this is something that needs to be changed in Flask, or even what that change would be.\r\n\r\nAs far as I can tell, it would be a change to ScriptInfo (add a `command` field) AppGroup.get_command to attach the command we're wanting to run to the ScriptInfo.\r\n\r\nI understand not wanting to introduce more complexity into the CLI code though. \r\n\r\nIt's possible I'm the only one (or one of the few people) trying to do this so if you feel the use case is too specific or not a good fit, feel free to close this issue. Otherwise I'm happy to open a PR to add these changes."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/509010791",
            "html_url": "https://github.com/pallets/flask/issues/3289#issuecomment-509010791",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3289",
            "id": 509010791,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTAxMDc5MQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-07-07T15:55:39Z",
            "updated_at": "2019-07-07T15:55:39Z",
            "author_association": "MEMBER",
            "body": "Thanks for your interest. Your workaround seems fine. I don't think Flask should be changed for this right now."
        }
    ]
}