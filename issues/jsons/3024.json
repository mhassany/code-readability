{
    "url": "https://api.github.com/repos/pallets/flask/issues/3024",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/3024/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/3024/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/3024/events",
    "html_url": "https://github.com/pallets/flask/issues/3024",
    "id": 389372950,
    "node_id": "MDU6SXNzdWUzODkzNzI5NTA=",
    "number": 3024,
    "title": "static_host not requesting https",
    "user": {
        "login": "BrendanMartin",
        "id": 8090350,
        "node_id": "MDQ6VXNlcjgwOTAzNTA=",
        "avatar_url": "https://avatars3.githubusercontent.com/u/8090350?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/BrendanMartin",
        "html_url": "https://github.com/BrendanMartin",
        "followers_url": "https://api.github.com/users/BrendanMartin/followers",
        "following_url": "https://api.github.com/users/BrendanMartin/following{/other_user}",
        "gists_url": "https://api.github.com/users/BrendanMartin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/BrendanMartin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/BrendanMartin/subscriptions",
        "organizations_url": "https://api.github.com/users/BrendanMartin/orgs",
        "repos_url": "https://api.github.com/users/BrendanMartin/repos",
        "events_url": "https://api.github.com/users/BrendanMartin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/BrendanMartin/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 5,
    "created_at": "2018-12-10T16:10:24Z",
    "updated_at": "2018-12-11T14:29:23Z",
    "closed_at": "2018-12-11T14:29:23Z",
    "author_association": "NONE",
    "body": "I have a Flask app on Google App Engine and my static files are in a Google bucket.\r\n\r\nI'm using `static_host` like so:\r\n\r\n```python\r\ndef create_app(config_name):\r\n    app = Flask(__name__, host_matching=True, static_host='storage.googleapis.com/mybucket')\r\n```\r\nAnd I'm also using Flask-SSLify for the basic redirect from http to https:\r\n\r\n```python\r\napp = create_app(os.getenv('FLASK_CONFIG') or 'default')\r\nsslify = SSLify(app, permanent=True)\r\n```\r\n\r\nBut when I launch on App Engine my static files won't load because they are being requested with http. In other words, my app is successfully on https but the static file URLs are being built like `http://storage.googleapis.com/mybucket/...` without https.\r\n\r\nIt seems SSLify is just building a `before_request` to do redirects, so I'm not sure where to tell Flask to request my static host with https. ",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/445880066",
            "html_url": "https://github.com/pallets/flask/issues/3024#issuecomment-445880066",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3024",
            "id": 445880066,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NTg4MDA2Ng==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-12-10T16:32:50Z",
            "updated_at": "2018-12-10T16:32:50Z",
            "author_association": "MEMBER",
            "body": "This is not what `static_host` is for. `static_host` is for when you have multiple host names assigned to your server, and you want to route based on which host the request is made to. `storage.googleapis.com` is presumably not routing to your application.\r\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/445882360",
            "html_url": "https://github.com/pallets/flask/issues/3024#issuecomment-445882360",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3024",
            "id": 445882360,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NTg4MjM2MA==",
            "user": {
                "login": "BrendanMartin",
                "id": 8090350,
                "node_id": "MDQ6VXNlcjgwOTAzNTA=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/8090350?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/BrendanMartin",
                "html_url": "https://github.com/BrendanMartin",
                "followers_url": "https://api.github.com/users/BrendanMartin/followers",
                "following_url": "https://api.github.com/users/BrendanMartin/following{/other_user}",
                "gists_url": "https://api.github.com/users/BrendanMartin/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/BrendanMartin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/BrendanMartin/subscriptions",
                "organizations_url": "https://api.github.com/users/BrendanMartin/orgs",
                "repos_url": "https://api.github.com/users/BrendanMartin/repos",
                "events_url": "https://api.github.com/users/BrendanMartin/events{/privacy}",
                "received_events_url": "https://api.github.com/users/BrendanMartin/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-12-10T16:39:04Z",
            "updated_at": "2018-12-10T16:39:04Z",
            "author_association": "NONE",
            "body": "I do have multiple host names. Currently I have example1.com and example2.com pointing to the same app. I need to have the static files served from a Google bucket."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/445883817",
            "html_url": "https://github.com/pallets/flask/issues/3024#issuecomment-445883817",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3024",
            "id": 445883817,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NTg4MzgxNw==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-12-10T16:42:56Z",
            "updated_at": "2018-12-10T16:49:46Z",
            "author_association": "MEMBER",
            "body": "Right, but that's not the configuration that `static_host` is for. `static_host` is when you still want *Flask* to serve your static files, it tells it what host that's coming in to Flask to use for that.\r\n\r\nYou'll want to configure App Engine to serve requests to `/static` from your bucket rather than passing to Flask, just like you'd configure a server like Nginx.\r\n\r\nOr if you really want Flask to fetch the static files from the bucket and serve them itself (you don't because this would be slow), you'd need to override `Flask.send_static_file` to do that. Or you might have it issue a `redirect` to the bucket URL. At that point you'd use `static_host=\"example1.com\"` to choose which host you control will handle the requests to the `static` endpoint."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/445884405",
            "html_url": "https://github.com/pallets/flask/issues/3024#issuecomment-445884405",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3024",
            "id": 445884405,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NTg4NDQwNQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-12-10T16:44:32Z",
            "updated_at": "2018-12-10T16:50:36Z",
            "author_association": "MEMBER",
            "body": "Also, what does `url_for('some other endpoint', _external=True)` return? If it's not HTTPS either, there's a misconfiguration, either in SSLify or `app.config`. I'm not familiar with SSLify or App Engine though.\r\n\r\nIn that case you might need to use `werkzeug.contrib.fixers.ProxyFix` to tell WSGI it's behind a proxy (App Engine)."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/446204046",
            "html_url": "https://github.com/pallets/flask/issues/3024#issuecomment-446204046",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3024",
            "id": 446204046,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NjIwNDA0Ng==",
            "user": {
                "login": "BrendanMartin",
                "id": 8090350,
                "node_id": "MDQ6VXNlcjgwOTAzNTA=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/8090350?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/BrendanMartin",
                "html_url": "https://github.com/BrendanMartin",
                "followers_url": "https://api.github.com/users/BrendanMartin/followers",
                "following_url": "https://api.github.com/users/BrendanMartin/following{/other_user}",
                "gists_url": "https://api.github.com/users/BrendanMartin/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/BrendanMartin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/BrendanMartin/subscriptions",
                "organizations_url": "https://api.github.com/users/BrendanMartin/orgs",
                "repos_url": "https://api.github.com/users/BrendanMartin/repos",
                "events_url": "https://api.github.com/users/BrendanMartin/events{/privacy}",
                "received_events_url": "https://api.github.com/users/BrendanMartin/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-12-11T13:35:14Z",
            "updated_at": "2018-12-11T13:35:14Z",
            "author_association": "NONE",
            "body": "Adding `_external=True` actually did fix it.\r\n\r\nHere's what I used in my base template:\r\n`<link rel=\"stylesheet\" media=\"all\" href=\"{{ url_for('static', filename='style.css',  _external=True) }}\"/>`\r\n\r\nOut:\r\n`https://storage.googleapis.com/bucket/static/style.css`\r\n\r\nBut I also added this too:\r\n`    app.config.update(dict(\r\n            PREFERRED_URL_SCHEME='https'\r\n    ))`\r\n"
        }
    ]
}