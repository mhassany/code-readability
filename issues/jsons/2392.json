{
    "url": "https://api.github.com/repos/pallets/flask/issues/2392",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2392/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2392/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2392/events",
    "html_url": "https://github.com/pallets/flask/issues/2392",
    "id": 238280420,
    "node_id": "MDU6SXNzdWUyMzgyODA0MjA=",
    "number": 2392,
    "title": "jsonify response converts datetime object into string with GMT regardless of objects tzinfo.",
    "user": {
        "login": "stephen-mw",
        "id": 1299456,
        "node_id": "MDQ6VXNlcjEyOTk0NTY=",
        "avatar_url": "https://avatars2.githubusercontent.com/u/1299456?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stephen-mw",
        "html_url": "https://github.com/stephen-mw",
        "followers_url": "https://api.github.com/users/stephen-mw/followers",
        "following_url": "https://api.github.com/users/stephen-mw/following{/other_user}",
        "gists_url": "https://api.github.com/users/stephen-mw/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/stephen-mw/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/stephen-mw/subscriptions",
        "organizations_url": "https://api.github.com/users/stephen-mw/orgs",
        "repos_url": "https://api.github.com/users/stephen-mw/repos",
        "events_url": "https://api.github.com/users/stephen-mw/events{/privacy}",
        "received_events_url": "https://api.github.com/users/stephen-mw/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2017-06-24T00:19:31Z",
    "updated_at": "2017-06-24T00:35:54Z",
    "closed_at": "2017-06-24T00:35:54Z",
    "author_association": "NONE",
    "body": "### Expected Behavior\r\nFlask's `jsonify` response incorrectly marks the timezone when stringing the datetime object. It always contains the string `GMT`, regardless of if the datetime object is not naive or has tzinfo set.\r\n\r\nI originally suspected it may be something to do with the http_date function, which is called on the datetime object if its detected. However, when I print `http_date(time)` on the object it correctly converts the time zone to GMT.\r\n\r\nI believe that this logic is somehow incorrectly identifying the object as a `date` object and not `datetime`, and thusly calling `timetuple()` (which has this affect) and not `utctimetuple()` which maintains the time).\r\n\r\n```\r\n   65         if isinstance(o, datetime):\r\n   66             return http_date(o.utctimetuple())\r\n   67         if isinstance(o, date):\r\n   68             return http_date(o.timetuple())\r\n```\r\n\r\n### Tell us what should happen.\r\nA `jsonify`'d response should print the correct datetime 3-letter timezone abbreviation according to the datetime's tzinfo response. Or, if forcing a converstion to GMT, should correctly convert the object to GMT time from its localized time zone.\r\n\r\nThe below jsonify'd/stringed 3-letter time-zone response says `GMT`, but the datetime object is PDT. The time in the response is also in PST and has not been converted to GMT.\r\n\r\n```\r\n\"Fri, 23 Jun 2017 17:12:18 GMT\"\r\n```\r\n\r\n```python\r\n#!/usr/bin/env python2.7\r\n\r\nfrom werkzeug.http import http_date\r\nfrom datetime import datetime\r\nimport pytz\r\n\r\nfrom flask import Flask, jsonify\r\n\r\napp = Flask(__name__)\r\n\r\n@app.route('/')\r\ndef root():\r\n    # Localize time\r\n    local_time = pytz.timezone(\"America/Los_Angeles\")\r\n    time = datetime.utcnow().replace(microsecond=0).replace(tzinfo=pytz.utc)\r\n    time = time.astimezone(local_time)\r\n\r\n    print(\"iso format:\", time.isoformat())\r\n    print(\"object:\", time.tzinfo)\r\n    print(\"http date:\", http_date(time))\r\n\r\n    result = [time]\r\n\r\n    print(\"Test object: %s\" % result)\r\n\r\n    return jsonify(result)\r\n\r\napp.run(host='127.0.0.1', port=8080, debug=False)\r\n```\r\n\r\n### Actual Behavior\r\nWebserver returns response with GMT timezone with localized time:\r\n\r\n```\r\n[\r\n\"Fri, 23 Jun 2017 17:12:18 GMT\"\r\n]\r\n```\r\n\r\nThe logs in the console correctly identify the datetime object as PDT:\r\n```\r\n('iso format:', '2017-06-23T17:28:11-07:00')\r\n('object:', <DstTzInfo 'America/Los_Angeles' PDT-1 day, 17:00:00 DST>)\r\n('http date:', 'Sat, 24 Jun 2017 00:28:11 GMT')\r\nTest object: [datetime.datetime(2017, 6, 23, 17, 28, 11, tzinfo=<DstTzInfo 'America/Los_Angeles' PDT-1 day, 17:00:00 DST>)]\r\n127.0.0.1 - - [23/Jun/2017 17:28:11] \"GET / HTTP/1.1\" 200 -\r\n```\r\n\r\n### Environment\r\n\r\n* Python version: 2.7 or 3.6 (affects both in identical way)\r\n* Flask version: Flask==0.12.2\r\n* Werkzeug version: Werkzeug==0.12.2\r\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/310801466",
            "html_url": "https://github.com/pallets/flask/issues/2392#issuecomment-310801466",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2392",
            "id": 310801466,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMxMDgwMTQ2Ng==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-06-24T00:35:54Z",
            "updated_at": "2017-06-24T00:35:54Z",
            "author_association": "MEMBER",
            "body": "Closed by #2374 "
        }
    ]
}