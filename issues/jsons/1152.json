{
    "url": "https://api.github.com/repos/pallets/flask/issues/1152",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/1152/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/1152/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/1152/events",
    "html_url": "https://github.com/pallets/flask/issues/1152",
    "id": 40471226,
    "node_id": "MDU6SXNzdWU0MDQ3MTIyNg==",
    "number": 1152,
    "title": "\"after_response\"?",
    "user": {
        "login": "matthewrobertbell",
        "id": 241705,
        "node_id": "MDQ6VXNlcjI0MTcwNQ==",
        "avatar_url": "https://avatars2.githubusercontent.com/u/241705?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/matthewrobertbell",
        "html_url": "https://github.com/matthewrobertbell",
        "followers_url": "https://api.github.com/users/matthewrobertbell/followers",
        "following_url": "https://api.github.com/users/matthewrobertbell/following{/other_user}",
        "gists_url": "https://api.github.com/users/matthewrobertbell/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/matthewrobertbell/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/matthewrobertbell/subscriptions",
        "organizations_url": "https://api.github.com/users/matthewrobertbell/orgs",
        "repos_url": "https://api.github.com/users/matthewrobertbell/repos",
        "events_url": "https://api.github.com/users/matthewrobertbell/events{/privacy}",
        "received_events_url": "https://api.github.com/users/matthewrobertbell/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 9,
    "created_at": "2014-08-18T09:52:39Z",
    "updated_at": "2014-08-18T17:27:43Z",
    "closed_at": "2014-08-18T17:27:43Z",
    "author_association": "NONE",
    "body": "I am curious why there isn't an after_response function, in the spirit of after_request. There are often tasks that can take a while and don't need to be 100% reliable, such as writing statistics to a data store, or hitting a third party API, and don't affect the response object. It'd therefore be nice to be able to do this work after the response object has been sent to the user, with an after_response function. This could be done with a task queue, but for a lot of projects this vastly increases complexity.\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/52473258",
            "html_url": "https://github.com/pallets/flask/issues/1152#issuecomment-52473258",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1152",
            "id": 52473258,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDczMjU4",
            "user": {
                "login": "danielchatfield",
                "id": 1058676,
                "node_id": "MDQ6VXNlcjEwNTg2NzY=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/1058676?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/danielchatfield",
                "html_url": "https://github.com/danielchatfield",
                "followers_url": "https://api.github.com/users/danielchatfield/followers",
                "following_url": "https://api.github.com/users/danielchatfield/following{/other_user}",
                "gists_url": "https://api.github.com/users/danielchatfield/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/danielchatfield/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/danielchatfield/subscriptions",
                "organizations_url": "https://api.github.com/users/danielchatfield/orgs",
                "repos_url": "https://api.github.com/users/danielchatfield/repos",
                "events_url": "https://api.github.com/users/danielchatfield/events{/privacy}",
                "received_events_url": "https://api.github.com/users/danielchatfield/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-08-18T10:07:31Z",
            "updated_at": "2014-08-18T10:07:31Z",
            "author_association": "NONE",
            "body": "For technical reasons it is not possible in all environments to run code after closing the response.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/52474797",
            "html_url": "https://github.com/pallets/flask/issues/1152#issuecomment-52474797",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1152",
            "id": 52474797,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDc0Nzk3",
            "user": {
                "login": "DasIch",
                "id": 182316,
                "node_id": "MDQ6VXNlcjE4MjMxNg==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/182316?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/DasIch",
                "html_url": "https://github.com/DasIch",
                "followers_url": "https://api.github.com/users/DasIch/followers",
                "following_url": "https://api.github.com/users/DasIch/following{/other_user}",
                "gists_url": "https://api.github.com/users/DasIch/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/DasIch/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/DasIch/subscriptions",
                "organizations_url": "https://api.github.com/users/DasIch/orgs",
                "repos_url": "https://api.github.com/users/DasIch/repos",
                "events_url": "https://api.github.com/users/DasIch/events{/privacy}",
                "received_events_url": "https://api.github.com/users/DasIch/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-08-18T10:24:24Z",
            "updated_at": "2014-08-18T10:24:24Z",
            "author_association": "CONTRIBUTOR",
            "body": "It's simply not possible due to how WSGI works.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/52476010",
            "html_url": "https://github.com/pallets/flask/issues/1152#issuecomment-52476010",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1152",
            "id": 52476010,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDc2MDEw",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-08-18T10:37:22Z",
            "updated_at": "2014-08-18T10:37:22Z",
            "author_association": "MEMBER",
            "body": "@mattseh I think what you want is a task queue. Check out [RQ](python-rq.org/) (easy) or [Celery](http://www.celeryproject.org/) (advanced).\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/52476435",
            "html_url": "https://github.com/pallets/flask/issues/1152#issuecomment-52476435",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1152",
            "id": 52476435,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDc2NDM1",
            "user": {
                "login": "JakeAustwick",
                "id": 1095574,
                "node_id": "MDQ6VXNlcjEwOTU1NzQ=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/1095574?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/JakeAustwick",
                "html_url": "https://github.com/JakeAustwick",
                "followers_url": "https://api.github.com/users/JakeAustwick/followers",
                "following_url": "https://api.github.com/users/JakeAustwick/following{/other_user}",
                "gists_url": "https://api.github.com/users/JakeAustwick/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/JakeAustwick/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/JakeAustwick/subscriptions",
                "organizations_url": "https://api.github.com/users/JakeAustwick/orgs",
                "repos_url": "https://api.github.com/users/JakeAustwick/repos",
                "events_url": "https://api.github.com/users/JakeAustwick/events{/privacy}",
                "received_events_url": "https://api.github.com/users/JakeAustwick/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-08-18T10:42:02Z",
            "updated_at": "2014-08-18T10:42:02Z",
            "author_association": "NONE",
            "body": "I think you guys are missing his point. Certain things don't need to be pushed to a task queue, you just want to do it after you've responded to the client. If you're going to increase a hit counter then why do it in the response cycle and make the user wait? But pushing it to a background queue is a ton of overhead for just increasing a counter.\n\nFor example in the Tornado framework this is possible, check out this:\nhttp://www.tornadoweb.org/en/stable/web.html#tornado.web.RequestHandler.on_finish\n\nIt comes in useful in certain scenarios.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/52476943",
            "html_url": "https://github.com/pallets/flask/issues/1152#issuecomment-52476943",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1152",
            "id": 52476943,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDc2OTQz",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-08-18T10:47:43Z",
            "updated_at": "2014-08-18T10:48:31Z",
            "author_association": "MEMBER",
            "body": "> in the Tornado framework this is possible\n\nThat's because it's not WSGI. We are not missing his point. (I didn't see that he is already aware of task queues, that's true)\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/52477129",
            "html_url": "https://github.com/pallets/flask/issues/1152#issuecomment-52477129",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1152",
            "id": 52477129,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDc3MTI5",
            "user": {
                "login": "danielchatfield",
                "id": 1058676,
                "node_id": "MDQ6VXNlcjEwNTg2NzY=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/1058676?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/danielchatfield",
                "html_url": "https://github.com/danielchatfield",
                "followers_url": "https://api.github.com/users/danielchatfield/followers",
                "following_url": "https://api.github.com/users/danielchatfield/following{/other_user}",
                "gists_url": "https://api.github.com/users/danielchatfield/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/danielchatfield/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/danielchatfield/subscriptions",
                "organizations_url": "https://api.github.com/users/danielchatfield/orgs",
                "repos_url": "https://api.github.com/users/danielchatfield/repos",
                "events_url": "https://api.github.com/users/danielchatfield/events{/privacy}",
                "received_events_url": "https://api.github.com/users/danielchatfield/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-08-18T10:49:46Z",
            "updated_at": "2014-08-18T10:49:46Z",
            "author_association": "NONE",
            "body": "> It comes in useful in certain scenarios.\n\nI completely agree but it is not possible with WSGI.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/52479427",
            "html_url": "https://github.com/pallets/flask/issues/1152#issuecomment-52479427",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1152",
            "id": 52479427,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDc5NDI3",
            "user": {
                "login": "matthewrobertbell",
                "id": 241705,
                "node_id": "MDQ6VXNlcjI0MTcwNQ==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/241705?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/matthewrobertbell",
                "html_url": "https://github.com/matthewrobertbell",
                "followers_url": "https://api.github.com/users/matthewrobertbell/followers",
                "following_url": "https://api.github.com/users/matthewrobertbell/following{/other_user}",
                "gists_url": "https://api.github.com/users/matthewrobertbell/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/matthewrobertbell/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/matthewrobertbell/subscriptions",
                "organizations_url": "https://api.github.com/users/matthewrobertbell/orgs",
                "repos_url": "https://api.github.com/users/matthewrobertbell/repos",
                "events_url": "https://api.github.com/users/matthewrobertbell/events{/privacy}",
                "received_events_url": "https://api.github.com/users/matthewrobertbell/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-08-18T11:17:06Z",
            "updated_at": "2014-08-18T11:17:06Z",
            "author_association": "NONE",
            "body": "What is the specific reason / limitation for this not being possible with WSGI?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/52480325",
            "html_url": "https://github.com/pallets/flask/issues/1152#issuecomment-52480325",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1152",
            "id": 52480325,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDgwMzI1",
            "user": {
                "login": "danielchatfield",
                "id": 1058676,
                "node_id": "MDQ6VXNlcjEwNTg2NzY=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/1058676?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/danielchatfield",
                "html_url": "https://github.com/danielchatfield",
                "followers_url": "https://api.github.com/users/danielchatfield/followers",
                "following_url": "https://api.github.com/users/danielchatfield/following{/other_user}",
                "gists_url": "https://api.github.com/users/danielchatfield/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/danielchatfield/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/danielchatfield/subscriptions",
                "organizations_url": "https://api.github.com/users/danielchatfield/orgs",
                "repos_url": "https://api.github.com/users/danielchatfield/repos",
                "events_url": "https://api.github.com/users/danielchatfield/events{/privacy}",
                "received_events_url": "https://api.github.com/users/danielchatfield/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-08-18T11:29:07Z",
            "updated_at": "2014-08-18T11:29:07Z",
            "author_association": "NONE",
            "body": "This is a simplification but essentially in WSGI the server just calls a callable (a function or something that behaves like one) and the connection is closed when this function returns and therefore anything this function does will hold up the response.\n\nYou can spawn threads to do this stuff but a) that gets messy b) not available on every platform.\n\nDisclaimer: I haven't actually read this but it looks like it gives a fairly good overview\nhttp://www.fullstackpython.com/wsgi-servers.html\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/52480693",
            "html_url": "https://github.com/pallets/flask/issues/1152#issuecomment-52480693",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1152",
            "id": 52480693,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDgwNjkz",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-08-18T11:33:54Z",
            "updated_at": "2014-08-18T11:33:54Z",
            "author_association": "MEMBER",
            "body": "Also after closing the connection, the whole Python process might not even run anymore (in CGI). You can stream your response and do your task directly before closing the connection (and that might even work from a UI perspective), but you're limiting yourself unnecessarily with this. If you think a task queue might be overkill for your purposes, python-rq is probably still what you're looking for, as it is a fairly simple one.\n"
        }
    ]
}