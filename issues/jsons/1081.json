{
    "url": "https://api.github.com/repos/pallets/flask/issues/1081",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/1081/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/1081/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/1081/events",
    "html_url": "https://github.com/pallets/flask/issues/1081",
    "id": 35070673,
    "node_id": "MDU6SXNzdWUzNTA3MDY3Mw==",
    "number": 1081,
    "title": "Support X-Sendfile-Temporary",
    "user": {
        "login": "letmaik",
        "id": 530988,
        "node_id": "MDQ6VXNlcjUzMDk4OA==",
        "avatar_url": "https://avatars1.githubusercontent.com/u/530988?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/letmaik",
        "html_url": "https://github.com/letmaik",
        "followers_url": "https://api.github.com/users/letmaik/followers",
        "following_url": "https://api.github.com/users/letmaik/following{/other_user}",
        "gists_url": "https://api.github.com/users/letmaik/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/letmaik/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/letmaik/subscriptions",
        "organizations_url": "https://api.github.com/users/letmaik/orgs",
        "repos_url": "https://api.github.com/users/letmaik/repos",
        "events_url": "https://api.github.com/users/letmaik/events{/privacy}",
        "received_events_url": "https://api.github.com/users/letmaik/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 4,
    "created_at": "2014-06-05T15:54:58Z",
    "updated_at": "2017-05-16T00:28:59Z",
    "closed_at": "2017-05-16T00:28:59Z",
    "author_association": "NONE",
    "body": "There is [mod_xsendfile](https://tn123.org/mod_xsendfile/beta/) which in it's current beta version supports `X-Sendfile-Temporary` which is like `X-Sendfile` but removes the file afterwards.\n\nIs there some chance of supporting this? If not (because it's beta and not supported by other servers yet), what would be the recommended way to implement this myself? Of course I can just send the header, but I'm not sure if that's enough, judging by the length of `send_file()`.\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/45239379",
            "html_url": "https://github.com/pallets/flask/issues/1081#issuecomment-45239379",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1081",
            "id": 45239379,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MjM5Mzc5",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-06-05T16:07:00Z",
            "updated_at": "2014-06-05T16:07:00Z",
            "author_association": "MEMBER",
            "body": "You can just remove the header from the returned Response object and replace it with the proper one. That way you can even check if sendfile was used or not.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/45245413",
            "html_url": "https://github.com/pallets/flask/issues/1081#issuecomment-45245413",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1081",
            "id": 45245413,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MjQ1NDEz",
            "user": {
                "login": "letmaik",
                "id": 530988,
                "node_id": "MDQ6VXNlcjUzMDk4OA==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/530988?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/letmaik",
                "html_url": "https://github.com/letmaik",
                "followers_url": "https://api.github.com/users/letmaik/followers",
                "following_url": "https://api.github.com/users/letmaik/following{/other_user}",
                "gists_url": "https://api.github.com/users/letmaik/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/letmaik/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/letmaik/subscriptions",
                "organizations_url": "https://api.github.com/users/letmaik/orgs",
                "repos_url": "https://api.github.com/users/letmaik/repos",
                "events_url": "https://api.github.com/users/letmaik/events{/privacy}",
                "received_events_url": "https://api.github.com/users/letmaik/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-06-05T16:56:36Z",
            "updated_at": "2014-06-05T16:56:36Z",
            "author_association": "NONE",
            "body": "Then I also have to set `app.use_x_sendfile = True` right? How would I check if sendfile was used?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/45247040",
            "html_url": "https://github.com/pallets/flask/issues/1081#issuecomment-45247040",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1081",
            "id": 45247040,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MjQ3MDQw",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-06-05T17:10:33Z",
            "updated_at": "2014-06-05T17:10:33Z",
            "author_association": "MEMBER",
            "body": "Yes. And you can print `.headers` of the return value of `send_file`\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/45258008",
            "html_url": "https://github.com/pallets/flask/issues/1081#issuecomment-45258008",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1081",
            "id": 45258008,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MjU4MDA4",
            "user": {
                "login": "letmaik",
                "id": 530988,
                "node_id": "MDQ6VXNlcjUzMDk4OA==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/530988?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/letmaik",
                "html_url": "https://github.com/letmaik",
                "followers_url": "https://api.github.com/users/letmaik/followers",
                "following_url": "https://api.github.com/users/letmaik/following{/other_user}",
                "gists_url": "https://api.github.com/users/letmaik/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/letmaik/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/letmaik/subscriptions",
                "organizations_url": "https://api.github.com/users/letmaik/orgs",
                "repos_url": "https://api.github.com/users/letmaik/repos",
                "events_url": "https://api.github.com/users/letmaik/events{/privacy}",
                "received_events_url": "https://api.github.com/users/letmaik/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-06-05T18:42:30Z",
            "updated_at": "2014-06-05T18:42:30Z",
            "author_association": "NONE",
            "body": "Ok, this is my helper:\n\n``` python\nimport os\nfrom cStringIO import StringIO\nfrom flask.helpers import send_file\nfrom flask import app\n\ndef send_temp_file(tempFilePath, mimetype=None, as_attachment=False, attachment_filename=None):\n    if app.use_x_sendfile:\n        # using X-Sendfile-Temporary to let mod_xsendfile delete the temporary file\n        resp = send_file(tempFilePath, mimetype=mimetype, as_attachment=as_attachment, \n                         attachment_filename=attachment_filename)\n        xsendfile = resp.headers.pop('X-Sendfile')\n        resp.headers['X-Sendfile-Temporary'] = xsendfile\n        return resp\n    else:\n        # fallback for local dev server or if x-sendfile-temporary should not be used\n        try:\n            with open(tempFilePath, 'rb') as f:\n                stream = StringIO(f.read())\n        finally:\n            os.remove(tempFilePath)\n\n        return send_file(stream, mimetype=mimetype, as_attachment=as_attachment, \n                         attachment_filename=attachment_filename)\n```\n\nAs `tempFilePath` is always a path and I test for `app.use_x_sendfile` I don't need to check if `send_file` actually used X-sendfile.\n\nDo you think that's ok?\n"
        }
    ]
}