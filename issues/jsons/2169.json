{
    "url": "https://api.github.com/repos/pallets/flask/issues/2169",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2169/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2169/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2169/events",
    "html_url": "https://github.com/pallets/flask/issues/2169",
    "id": 205324235,
    "node_id": "MDU6SXNzdWUyMDUzMjQyMzU=",
    "number": 2169,
    "title": "CORS requests hanging on Chrome",
    "user": {
        "login": "dland512",
        "id": 1686534,
        "node_id": "MDQ6VXNlcjE2ODY1MzQ=",
        "avatar_url": "https://avatars2.githubusercontent.com/u/1686534?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dland512",
        "html_url": "https://github.com/dland512",
        "followers_url": "https://api.github.com/users/dland512/followers",
        "following_url": "https://api.github.com/users/dland512/following{/other_user}",
        "gists_url": "https://api.github.com/users/dland512/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/dland512/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/dland512/subscriptions",
        "organizations_url": "https://api.github.com/users/dland512/orgs",
        "repos_url": "https://api.github.com/users/dland512/repos",
        "events_url": "https://api.github.com/users/dland512/events{/privacy}",
        "received_events_url": "https://api.github.com/users/dland512/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2017-02-04T05:15:36Z",
    "updated_at": "2019-03-04T06:40:02Z",
    "closed_at": "2017-03-28T15:09:39Z",
    "author_association": "NONE",
    "body": "I'm seeing some strange behavior I can't really explain. My CORS requests are hanging for long periods 10, 20, 30 seconds and I'm not sure why. It seems to be specific to both Flask and Chrome.\r\n\r\nI'm using python 3.4.3, Flask 0.12, and Flask-Cors 3.0.2.\r\n\r\nConsider the following Flask server that returns some basic HTML and some javascript that makes and AJAX request to an API.\r\n\r\n```\r\nfrom flask import Flask\r\n\r\napp = Flask(__name__)\r\n\r\n@app.route(\"/page1\")\r\ndef page1():\r\n    return '''\r\n    <html>\r\n        <head>\r\n            <script>\r\n                function resHandler () {\r\n                    document.getElementById('status').innerHTML = 'done!';\r\n                }\r\n\r\n                function gopherIt() {\r\n                    document.getElementById('status').innerHTML = 'making request...';\r\n                    var oReq = new XMLHttpRequest();\r\n                    oReq.addEventListener(\"load\", resHandler);\r\n                    oReq.open(\"GET\", \"http://localhost:3000/hang\");\r\n                    oReq.send();\r\n                }\r\n            </script>\r\n        </head>\r\n        <body>\r\n            <div>\r\n                <input type=\"button\" value=\"Hang In There\" onclick=\"gopherIt()\" />\r\n                <span id=\"status\">Click the button</span>\r\n            </div>\r\n            <a href=\"http://localhost:8080/page2\">Go to page 2</a>\r\n        </body>\r\n    </html>\r\n    '''\r\n\r\n@app.route(\"/page2\")\r\ndef page2():\r\n    return '''\r\n    <html>\r\n        <body>\r\n            page 2\r\n        </body>\r\n    </html>\r\n    '''\r\n\r\nif __name__ == '__main__':\r\n    app.run(host='0.0.0.0', port=8080)\r\n```\r\n\r\nHere is the Flask API with CORS enabled:\r\n\r\n```\r\nfrom flask import Flask, json\r\nfrom flask_cors import CORS\r\n\r\napp = Flask(__name__)\r\nCORS(app)\r\n\r\n@app.route(\"/hang\")\r\ndef hang10():\r\n    return json.dumps({'iamkule': True})\r\n\r\nif __name__ == '__main__':\r\n    app.run(host='0.0.0.0', port=3000)\r\n```\r\n\r\nWhich renders a page like this:\r\n\r\n![image](https://cloud.githubusercontent.com/assets/1686534/22615826/61772198-ea63-11e6-8a38-e3456bf2d175.png)\r\n\r\nSteps to reproduce:\r\n\r\n1. Click the `Go to page 2` link\r\n2. Click the back browser's button\r\n3. Click the `Hang In There` button\r\n\r\nYou'll see a message next to the button that says \"making request...\" that basically just sits there while the API request hangs. Sometimes clicking it multiple times kinds of wakes it up and fixes it but not always. Sometimes it will also happen right after you refresh the page. It isn't as consistent as using the back button though.\r\n\r\nIf you open the Chrome debugger you can see all the XHR requests just sitting there.\r\n\r\n![image](https://cloud.githubusercontent.com/assets/1686534/22615858/9608c906-ea64-11e6-851c-217028ee2030.png)\r\n\r\n\r\nHere are some interesting points to consider:\r\n\r\n1. This does not happen when the CORS library is not used. If I open Chrome with the same origin policy checks disabled by running `open -a Google\\ Chrome --args --disable-web-security --user-data-dir` and run the app, it will not hang.\r\n\r\n2. This happens in Chrome on both macOS Sierra and Windows 10.\r\n\r\n3. This does not happen in Firefox on Mac or Windows.\r\n\r\n4. This does not happen in node. I rewrote the exact same static server and API using node and express and everything works fine (which is why I'm posting this here).\r\n\r\nSo it kind of seems like some combination of Flask and Chrome not getting along. Does anyone have any ideas about what's going on here?\r\n\r\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/277561378",
            "html_url": "https://github.com/pallets/flask/issues/2169#issuecomment-277561378",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2169",
            "id": 277561378,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI3NzU2MTM3OA==",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-02-06T00:04:58Z",
            "updated_at": "2017-02-06T00:04:58Z",
            "author_association": "MEMBER",
            "body": "The Flask dev server is single-threaded. Maybe CORS does not re-use a a keep-alive connection but always creates a new one? Try running the dev server with threads enabled (`threads=True` in the `run()` call I think)"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/277886428",
            "html_url": "https://github.com/pallets/flask/issues/2169#issuecomment-277886428",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2169",
            "id": 277886428,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI3Nzg4NjQyOA==",
            "user": {
                "login": "dland512",
                "id": 1686534,
                "node_id": "MDQ6VXNlcjE2ODY1MzQ=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/1686534?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/dland512",
                "html_url": "https://github.com/dland512",
                "followers_url": "https://api.github.com/users/dland512/followers",
                "following_url": "https://api.github.com/users/dland512/following{/other_user}",
                "gists_url": "https://api.github.com/users/dland512/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/dland512/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dland512/subscriptions",
                "organizations_url": "https://api.github.com/users/dland512/orgs",
                "repos_url": "https://api.github.com/users/dland512/repos",
                "events_url": "https://api.github.com/users/dland512/events{/privacy}",
                "received_events_url": "https://api.github.com/users/dland512/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-02-07T02:55:11Z",
            "updated_at": "2017-02-07T02:55:11Z",
            "author_association": "NONE",
            "body": "Wow, great call, that does appear to have fixed it. The call to run looks like this:\r\n\r\n`app.run(host='0.0.0.0', threaded=True, port=3000)`\r\n\r\nI'll have to do some research on the `threaded` setting but thanks for the pointer!\r\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/289772767",
            "html_url": "https://github.com/pallets/flask/issues/2169#issuecomment-289772767",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2169",
            "id": 289772767,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4OTc3Mjc2Nw==",
            "user": {
                "login": "cbenz",
                "id": 12686,
                "node_id": "MDQ6VXNlcjEyNjg2",
                "avatar_url": "https://avatars3.githubusercontent.com/u/12686?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/cbenz",
                "html_url": "https://github.com/cbenz",
                "followers_url": "https://api.github.com/users/cbenz/followers",
                "following_url": "https://api.github.com/users/cbenz/following{/other_user}",
                "gists_url": "https://api.github.com/users/cbenz/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/cbenz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/cbenz/subscriptions",
                "organizations_url": "https://api.github.com/users/cbenz/orgs",
                "repos_url": "https://api.github.com/users/cbenz/repos",
                "events_url": "https://api.github.com/users/cbenz/events{/privacy}",
                "received_events_url": "https://api.github.com/users/cbenz/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-03-28T13:40:10Z",
            "updated_at": "2017-03-28T13:40:10Z",
            "author_association": "NONE",
            "body": "See https://github.com/corydolphin/flask-cors/issues/147#issuecomment-289539799"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/343809823",
            "html_url": "https://github.com/pallets/flask/issues/2169#issuecomment-343809823",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2169",
            "id": 343809823,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzgwOTgyMw==",
            "user": {
                "login": "jeiting",
                "id": 138742,
                "node_id": "MDQ6VXNlcjEzODc0Mg==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/138742?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/jeiting",
                "html_url": "https://github.com/jeiting",
                "followers_url": "https://api.github.com/users/jeiting/followers",
                "following_url": "https://api.github.com/users/jeiting/following{/other_user}",
                "gists_url": "https://api.github.com/users/jeiting/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/jeiting/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jeiting/subscriptions",
                "organizations_url": "https://api.github.com/users/jeiting/orgs",
                "repos_url": "https://api.github.com/users/jeiting/repos",
                "events_url": "https://api.github.com/users/jeiting/events{/privacy}",
                "received_events_url": "https://api.github.com/users/jeiting/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-11-13T04:34:29Z",
            "updated_at": "2017-11-13T04:34:29Z",
            "author_association": "NONE",
            "body": "Sorry to wake up a dead thread but I wanted to leave a comment for the next person that has this issue. (I did today.)\r\n\r\nThe issue is the way Chrome opens speculative connections to speed up subsequent requests. If the speculative connection is accepted by the server first it hangs the singly threaded server until it times out. Nothing to do with flask itself.\r\n\r\nI wrote up what I found [here](https://medium.com/@jeiting/chrome-preconnect-breaks-singly-threaded-servers-95944be16400)."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/371365583",
            "html_url": "https://github.com/pallets/flask/issues/2169#issuecomment-371365583",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2169",
            "id": 371365583,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM3MTM2NTU4Mw==",
            "user": {
                "login": "carlospliego",
                "id": 5314361,
                "node_id": "MDQ6VXNlcjUzMTQzNjE=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/5314361?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/carlospliego",
                "html_url": "https://github.com/carlospliego",
                "followers_url": "https://api.github.com/users/carlospliego/followers",
                "following_url": "https://api.github.com/users/carlospliego/following{/other_user}",
                "gists_url": "https://api.github.com/users/carlospliego/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/carlospliego/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/carlospliego/subscriptions",
                "organizations_url": "https://api.github.com/users/carlospliego/orgs",
                "repos_url": "https://api.github.com/users/carlospliego/repos",
                "events_url": "https://api.github.com/users/carlospliego/events{/privacy}",
                "received_events_url": "https://api.github.com/users/carlospliego/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-03-08T03:19:17Z",
            "updated_at": "2018-03-08T03:19:17Z",
            "author_association": "NONE",
            "body": "I just have to say thank you all! You've made my day."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/408760531",
            "html_url": "https://github.com/pallets/flask/issues/2169#issuecomment-408760531",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2169",
            "id": 408760531,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQwODc2MDUzMQ==",
            "user": {
                "login": "GazEdge",
                "id": 1309533,
                "node_id": "MDQ6VXNlcjEzMDk1MzM=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/1309533?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/GazEdge",
                "html_url": "https://github.com/GazEdge",
                "followers_url": "https://api.github.com/users/GazEdge/followers",
                "following_url": "https://api.github.com/users/GazEdge/following{/other_user}",
                "gists_url": "https://api.github.com/users/GazEdge/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/GazEdge/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/GazEdge/subscriptions",
                "organizations_url": "https://api.github.com/users/GazEdge/orgs",
                "repos_url": "https://api.github.com/users/GazEdge/repos",
                "events_url": "https://api.github.com/users/GazEdge/events{/privacy}",
                "received_events_url": "https://api.github.com/users/GazEdge/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-07-30T06:31:07Z",
            "updated_at": "2018-07-30T06:31:07Z",
            "author_association": "NONE",
            "body": "If for whatever reason you don't or cant set threading to true, you can turn the preconnect feature off in chrome and that will fix the issue.\r\n\r\nIn chrome go to settings / advanced / privacy and turn off 'Use a prediction service to load pages more quickly'"
        }
    ]
}