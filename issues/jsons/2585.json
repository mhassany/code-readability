{
    "url": "https://api.github.com/repos/pallets/flask/issues/2585",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2585/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2585/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2585/events",
    "html_url": "https://github.com/pallets/flask/issues/2585",
    "id": 286508011,
    "node_id": "MDU6SXNzdWUyODY1MDgwMTE=",
    "number": 2585,
    "title": "Generic HTTPException error handler is not called due to logic error in _find_error_handler",
    "user": {
        "login": "zackw",
        "id": 325899,
        "node_id": "MDQ6VXNlcjMyNTg5OQ==",
        "avatar_url": "https://avatars0.githubusercontent.com/u/325899?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/zackw",
        "html_url": "https://github.com/zackw",
        "followers_url": "https://api.github.com/users/zackw/followers",
        "following_url": "https://api.github.com/users/zackw/following{/other_user}",
        "gists_url": "https://api.github.com/users/zackw/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/zackw/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zackw/subscriptions",
        "organizations_url": "https://api.github.com/users/zackw/orgs",
        "repos_url": "https://api.github.com/users/zackw/repos",
        "events_url": "https://api.github.com/users/zackw/events{/privacy}",
        "received_events_url": "https://api.github.com/users/zackw/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 8,
    "created_at": "2018-01-06T18:27:45Z",
    "updated_at": "2018-01-09T15:58:37Z",
    "closed_at": "2018-01-09T15:55:40Z",
    "author_association": "NONE",
    "body": "### Expected Behavior\r\n\r\nThe documentation leads me to believe that an error handler registered like so:\r\n\r\n```python\r\napp.config[\"TRAP_HTTP_EXCEPTIONS\"] = True\r\n@app.errorhandler(HTTPException)\r\ndef handle_http_error(err):\r\n    return flask.render_template(\"_error.html\",\r\n                                 errcode=err.code,\r\n                                 errname=err.name,\r\n                                 errdescription=err.description), err.code\r\n```\r\n\r\n... should be called for any HTTP error.  (The requirement to set TRAP_HTTP_EXCEPTIONS is inadequately clear, but that's an unrelated problem.)\r\n\r\n### Actual Behavior\r\n\r\nInstead, this configuration causes any HTTP error to turn into a 500 internal server error with this traceback:\r\n\r\n```pytb\r\n\r\n127.0.0.1 - - [06/Jan/2018 13:09:57] \"GET /fnord.html HTTP/1.1\" 500 -\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3/dist-packages/flask/app.py\", line 1997, in __call__\r\n    return self.wsgi_app(environ, start_response)\r\n  File \"/usr/lib/python3/dist-packages/flask/app.py\", line 1985, in wsgi_app\r\n    response = self.handle_exception(e)\r\n  File \"/usr/lib/python3/dist-packages/flask/app.py\", line 1540, in handle_exception\r\n    reraise(exc_type, exc_value, tb)\r\n  File \"/usr/lib/python3/dist-packages/flask/_compat.py\", line 33, in reraise\r\n    raise value\r\n  File \"/usr/lib/python3/dist-packages/flask/app.py\", line 1982, in wsgi_app\r\n    response = self.full_dispatch_request()\r\n  File \"/usr/lib/python3/dist-packages/flask/app.py\", line 1614, in full_dispatch_request\r\n    rv = self.handle_user_exception(e)\r\n  File \"/usr/lib/python3/dist-packages/flask/app.py\", line 1517, in handle_user_exception\r\n    reraise(exc_type, exc_value, tb)\r\n  File \"/usr/lib/python3/dist-packages/flask/_compat.py\", line 33, in reraise\r\n    raise value\r\n  File \"/usr/lib/python3/dist-packages/flask/app.py\", line 1612, in full_dispatch_request\r\n    rv = self.dispatch_request()\r\n  File \"/usr/lib/python3/dist-packages/flask/app.py\", line 1598, in dispatch_request\r\n    return self.view_functions[rule.endpoint](**req.view_args)\r\n  File \"/home/.../mysite.py\", line 35, in page\r\n    flask.abort(404)\r\n  File \"/usr/lib/python3/dist-packages/werkzeug/exceptions.py\", line 707, in abort\r\n    return _aborter(status, *args, **kwargs)\r\n  File \"/usr/lib/python3/dist-packages/werkzeug/exceptions.py\", line 687, in __call__\r\n    raise self.mapping[code](*args, **kwargs)\r\n```\r\n\r\nI dug around in the debugger a little: this is from the perspective of the `handle_user_exception` frame:\r\n\r\n```python\r\n>>> self.error_handler_spec\r\n{None: {None: {<class 'werkzeug.exceptions.HTTPException'>: <function handle_http_error at 0x7fe7f49b4400>}}}\r\n```\r\n\r\nMy application does not use blueprints, so the outer None in this structure is correct, and `_find_error_handler` understands it.  However, the inner None does not correspond to any HTTP code, and so `_find_error_handler` is unable to pass through that layer of nesting and do the intended lookup by class.\r\n\r\n### Environment\r\n\r\n* Python version: 3.6.4\r\n* Flask version: 0.12.2\r\n* Werkzeug version: 0.13",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/355769909",
            "html_url": "https://github.com/pallets/flask/issues/2585#issuecomment-355769909",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2585",
            "id": 355769909,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM1NTc2OTkwOQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-01-06T19:31:28Z",
            "updated_at": "2018-01-06T19:31:28Z",
            "author_association": "MEMBER",
            "body": "Please test this against master, the error handler code has changed."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/356322100",
            "html_url": "https://github.com/pallets/flask/issues/2585#issuecomment-356322100",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2585",
            "id": 356322100,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM1NjMyMjEwMA==",
            "user": {
                "login": "pts-sergiomartins",
                "id": 23078889,
                "node_id": "MDQ6VXNlcjIzMDc4ODg5",
                "avatar_url": "https://avatars1.githubusercontent.com/u/23078889?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/pts-sergiomartins",
                "html_url": "https://github.com/pts-sergiomartins",
                "followers_url": "https://api.github.com/users/pts-sergiomartins/followers",
                "following_url": "https://api.github.com/users/pts-sergiomartins/following{/other_user}",
                "gists_url": "https://api.github.com/users/pts-sergiomartins/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/pts-sergiomartins/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/pts-sergiomartins/subscriptions",
                "organizations_url": "https://api.github.com/users/pts-sergiomartins/orgs",
                "repos_url": "https://api.github.com/users/pts-sergiomartins/repos",
                "events_url": "https://api.github.com/users/pts-sergiomartins/events{/privacy}",
                "received_events_url": "https://api.github.com/users/pts-sergiomartins/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-01-09T15:44:56Z",
            "updated_at": "2018-01-09T15:44:56Z",
            "author_association": "NONE",
            "body": "I'm having this same problem. The lookup seems to be happening by code only and not by class. I have a generic Exception handler too but it's not invoked either.\r\n```python\r\n(Pdb) self.error_handler_spec.get(request.blueprint, {})\r\n{None: {<class 'werkzeug.exceptions.HTTPException'>: <function handle_http_exception at 0x7fb4f99962f0>, <class 'Exception'>: <function handle_exception at 0x7fb4f9996268>}}\r\n```"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/356322523",
            "html_url": "https://github.com/pallets/flask/issues/2585#issuecomment-356322523",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2585",
            "id": 356322523,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM1NjMyMjUyMw==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-01-09T15:46:10Z",
            "updated_at": "2018-01-09T15:46:10Z",
            "author_association": "MEMBER",
            "body": "And does it happen on master?"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/356323255",
            "html_url": "https://github.com/pallets/flask/issues/2585#issuecomment-356323255",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2585",
            "id": 356323255,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM1NjMyMzI1NQ==",
            "user": {
                "login": "pts-sergiomartins",
                "id": 23078889,
                "node_id": "MDQ6VXNlcjIzMDc4ODg5",
                "avatar_url": "https://avatars1.githubusercontent.com/u/23078889?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/pts-sergiomartins",
                "html_url": "https://github.com/pts-sergiomartins",
                "followers_url": "https://api.github.com/users/pts-sergiomartins/followers",
                "following_url": "https://api.github.com/users/pts-sergiomartins/following{/other_user}",
                "gists_url": "https://api.github.com/users/pts-sergiomartins/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/pts-sergiomartins/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/pts-sergiomartins/subscriptions",
                "organizations_url": "https://api.github.com/users/pts-sergiomartins/orgs",
                "repos_url": "https://api.github.com/users/pts-sergiomartins/repos",
                "events_url": "https://api.github.com/users/pts-sergiomartins/events{/privacy}",
                "received_events_url": "https://api.github.com/users/pts-sergiomartins/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-01-09T15:48:31Z",
            "updated_at": "2018-01-09T15:48:31Z",
            "author_association": "NONE",
            "body": "I'm pulling down master now. Report shortly"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/356324716",
            "html_url": "https://github.com/pallets/flask/issues/2585#issuecomment-356324716",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2585",
            "id": 356324716,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM1NjMyNDcxNg==",
            "user": {
                "login": "pts-sergiomartins",
                "id": 23078889,
                "node_id": "MDQ6VXNlcjIzMDc4ODg5",
                "avatar_url": "https://avatars1.githubusercontent.com/u/23078889?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/pts-sergiomartins",
                "html_url": "https://github.com/pts-sergiomartins",
                "followers_url": "https://api.github.com/users/pts-sergiomartins/followers",
                "following_url": "https://api.github.com/users/pts-sergiomartins/following{/other_user}",
                "gists_url": "https://api.github.com/users/pts-sergiomartins/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/pts-sergiomartins/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/pts-sergiomartins/subscriptions",
                "organizations_url": "https://api.github.com/users/pts-sergiomartins/orgs",
                "repos_url": "https://api.github.com/users/pts-sergiomartins/repos",
                "events_url": "https://api.github.com/users/pts-sergiomartins/events{/privacy}",
                "received_events_url": "https://api.github.com/users/pts-sergiomartins/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-01-09T15:52:51Z",
            "updated_at": "2018-01-09T15:52:51Z",
            "author_association": "NONE",
            "body": "It works on latest master"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/356325658",
            "html_url": "https://github.com/pallets/flask/issues/2585#issuecomment-356325658",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2585",
            "id": 356325658,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM1NjMyNTY1OA==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-01-09T15:55:40Z",
            "updated_at": "2018-01-09T15:55:40Z",
            "author_association": "MEMBER",
            "body": "Thanks for testing it out, really appreciate this kind of help."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/356326117",
            "html_url": "https://github.com/pallets/flask/issues/2585#issuecomment-356326117",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2585",
            "id": 356326117,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM1NjMyNjExNw==",
            "user": {
                "login": "pts-sergiomartins",
                "id": 23078889,
                "node_id": "MDQ6VXNlcjIzMDc4ODg5",
                "avatar_url": "https://avatars1.githubusercontent.com/u/23078889?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/pts-sergiomartins",
                "html_url": "https://github.com/pts-sergiomartins",
                "followers_url": "https://api.github.com/users/pts-sergiomartins/followers",
                "following_url": "https://api.github.com/users/pts-sergiomartins/following{/other_user}",
                "gists_url": "https://api.github.com/users/pts-sergiomartins/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/pts-sergiomartins/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/pts-sergiomartins/subscriptions",
                "organizations_url": "https://api.github.com/users/pts-sergiomartins/orgs",
                "repos_url": "https://api.github.com/users/pts-sergiomartins/repos",
                "events_url": "https://api.github.com/users/pts-sergiomartins/events{/privacy}",
                "received_events_url": "https://api.github.com/users/pts-sergiomartins/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-01-09T15:56:58Z",
            "updated_at": "2018-01-09T15:56:58Z",
            "author_association": "NONE",
            "body": "Happy to help! When can we expect a release?"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/356326662",
            "html_url": "https://github.com/pallets/flask/issues/2585#issuecomment-356326662",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2585",
            "id": 356326662,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM1NjMyNjY2Mg==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-01-09T15:58:37Z",
            "updated_at": "2018-01-09T15:58:37Z",
            "author_association": "MEMBER",
            "body": "Soon\u2122"
        }
    ]
}