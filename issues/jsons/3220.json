{
    "url": "https://api.github.com/repos/pallets/flask/issues/3220",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/3220/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/3220/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/3220/events",
    "html_url": "https://github.com/pallets/flask/issues/3220",
    "id": 448805417,
    "node_id": "MDU6SXNzdWU0NDg4MDU0MTc=",
    "number": 3220,
    "title": "How to change the body of redirection responses since Flask 1.0.3?",
    "user": {
        "login": "s3rvac",
        "id": 5675953,
        "node_id": "MDQ6VXNlcjU2NzU5NTM=",
        "avatar_url": "https://avatars3.githubusercontent.com/u/5675953?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/s3rvac",
        "html_url": "https://github.com/s3rvac",
        "followers_url": "https://api.github.com/users/s3rvac/followers",
        "following_url": "https://api.github.com/users/s3rvac/following{/other_user}",
        "gists_url": "https://api.github.com/users/s3rvac/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/s3rvac/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/s3rvac/subscriptions",
        "organizations_url": "https://api.github.com/users/s3rvac/orgs",
        "repos_url": "https://api.github.com/users/s3rvac/repos",
        "events_url": "https://api.github.com/users/s3rvac/events{/privacy}",
        "received_events_url": "https://api.github.com/users/s3rvac/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2019-05-27T11:29:15Z",
    "updated_at": "2019-05-27T14:24:06Z",
    "closed_at": "2019-05-27T14:24:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "Since Flask 1.0.3 (more specifically since b92b2e6c743c8b09744c9c9788046c719cc38eab), routing exceptions are no longer handled via application error handlers. This breaks our project, which has been using this feature to change the body and headers of redirections. In short, we want to be able to return HTML responses for web endpoints and JSON responses for API endpoints, including redirections. What is the idiomatic way of doing this in Flask 1.0.3?\r\n\r\n### Minimal working example\r\n\r\n```python\r\n# test.py\r\nimport flask\r\nimport werkzeug\r\n\r\nclass App(flask.Flask):\r\n    def __init__(self, *args, **kwargs):\r\n        super().__init__(*args, **kwargs)\r\n\r\n        @self.errorhandler(Exception)\r\n        def handle_exception(e):\r\n            return self._handle_error(e)\r\n\r\n    def _handle_error(self, e):\r\n        if isinstance(e, werkzeug.routing.RequestRedirect):\r\n            return 'redirection\\n', 308\r\n        return 'error\\n', 500\r\n\r\napp = App(__name__)\r\n\r\n@app.route('/test/')\r\ndef test():\r\n    return 'test\\n'\r\n```\r\nRun it via `FLASK_APP=test:app flask run`.\r\n\r\n### Expected behavior\r\n\r\n```\r\n$ curl http://127.0.0.1:5000/test\r\nredirection\r\n```\r\nThis is what happens in Flask 1.0.2 and earlier.\r\n\r\n### Actual behavior\r\n\r\n```\r\n$ curl http://127.0.0.1:5000/test\r\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\">\r\n<title>Redirecting...</title>\r\n<h1>Redirecting...</h1>\r\n* Closing connection 0\r\n<p>You should be redirected automatically to target URL: <a href=\"http://127.0.0.1:5000/test/\">http://127.0.0.1:5000/test/</a>.  If not click the link.\r\n```\r\nThis is what happens in Flask 1.0.3.\r\n\r\n### Question\r\n\r\nWhat is the idiomatic way of changing the body and headers of redirections in Flask 1.0.3? We could do the following to get the original behavior, but it feels like a hack:\r\n```python\r\nclass App(flask.Flask):\r\n    # ...\r\n\r\n    def handle_http_exception(self, e):\r\n        if isinstance(e, werkzeug.routing.RoutingException):\r\n            return self._handle_error(e)\r\n\r\n        return super().handle_http_exception(e)\r\n```\r\nIs there a better way?\r\n\r\n### Environment\r\n\r\n* Python version: 3.7.3 (Linux)\r\n* Flask version: 1.0.2 and 1.0.3 (see above)\r\n* Werkzeug version: 0.15.4\r\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/496229662",
            "html_url": "https://github.com/pallets/flask/issues/3220#issuecomment-496229662",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3220",
            "id": 496229662,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjIyOTY2Mg==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-05-27T14:24:05Z",
            "updated_at": "2019-05-27T14:24:05Z",
            "author_association": "MEMBER",
            "body": "From the changelog:\r\n\r\n-   A catch-all error handler registered for ``HTTPException`` will not\r\n    handle ``RoutingExcpetion``, which is used internally during\r\n    routing. This fixes the unexpected behavior that had been introduced\r\n    in 1.0. (`#2986`_)\r\n\r\nThe \"hack\" you've proposed is fine. Overriding a method is a standard way of customizing behavior in Python and Flask."
        }
    ]
}