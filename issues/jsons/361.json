{
    "url": "https://api.github.com/repos/pallets/flask/issues/361",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/361/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/361/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/361/events",
    "html_url": "https://github.com/pallets/flask/issues/361",
    "id": 2531244,
    "node_id": "MDU6SXNzdWUyNTMxMjQ0",
    "number": 361,
    "title": "send_file uses 2x file's size in memory with conditional = True",
    "user": {
        "login": "qxcv",
        "id": 1258993,
        "node_id": "MDQ6VXNlcjEyNTg5OTM=",
        "avatar_url": "https://avatars3.githubusercontent.com/u/1258993?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/qxcv",
        "html_url": "https://github.com/qxcv",
        "followers_url": "https://api.github.com/users/qxcv/followers",
        "following_url": "https://api.github.com/users/qxcv/following{/other_user}",
        "gists_url": "https://api.github.com/users/qxcv/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/qxcv/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/qxcv/subscriptions",
        "organizations_url": "https://api.github.com/users/qxcv/orgs",
        "repos_url": "https://api.github.com/users/qxcv/repos",
        "events_url": "https://api.github.com/users/qxcv/events{/privacy}",
        "received_events_url": "https://api.github.com/users/qxcv/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2011-12-13T00:49:45Z",
    "updated_at": "2014-08-25T22:53:10Z",
    "closed_at": "2014-08-25T22:53:10Z",
    "author_association": "NONE",
    "body": "https://github.com/mitsuhiko/flask/blob/master/flask/helpers.py#L423\n\nConditional responses (`Response.make_conditional()`) cause the iterator to be converted to a list (which stores the contents of the file in memory) and then `''.join()` is used on the list (!!) which stores the contents of the file in memory AGAIN so Flask can use `len()` to determine content length. So for a short time it uses twice the item size in memory until the list conversion function returns the string from `''.join()` and the original list is destroyed.\n\nThis isn't mentioned anywhere in the Flask docs, and can be avoided by calculating the file size and setting the `Content-Length` header using `os.path.getsize()` or `fp.seek()` and `fp.tell()` before `rv.make_conditional` is called.\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/8029938",
            "html_url": "https://github.com/pallets/flask/issues/361#issuecomment-8029938",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/361",
            "id": 8029938,
            "node_id": "MDEyOklzc3VlQ29tbWVudDgwMjk5Mzg=",
            "user": {
                "login": "ThomasWaldmann",
                "id": 356103,
                "node_id": "MDQ6VXNlcjM1NjEwMw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/356103?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThomasWaldmann",
                "html_url": "https://github.com/ThomasWaldmann",
                "followers_url": "https://api.github.com/users/ThomasWaldmann/followers",
                "following_url": "https://api.github.com/users/ThomasWaldmann/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThomasWaldmann/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThomasWaldmann/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThomasWaldmann/subscriptions",
                "organizations_url": "https://api.github.com/users/ThomasWaldmann/orgs",
                "repos_url": "https://api.github.com/users/ThomasWaldmann/repos",
                "events_url": "https://api.github.com/users/ThomasWaldmann/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThomasWaldmann/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2012-08-26T03:45:04Z",
            "updated_at": "2012-08-26T03:45:04Z",
            "author_association": "CONTRIBUTOR",
            "body": "is this still true?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/53320827",
            "html_url": "https://github.com/pallets/flask/issues/361#issuecomment-53320827",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/361",
            "id": 53320827,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUzMzIwODI3",
            "user": {
                "login": "grampajoe",
                "id": 55005,
                "node_id": "MDQ6VXNlcjU1MDA1",
                "avatar_url": "https://avatars1.githubusercontent.com/u/55005?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/grampajoe",
                "html_url": "https://github.com/grampajoe",
                "followers_url": "https://api.github.com/users/grampajoe/followers",
                "following_url": "https://api.github.com/users/grampajoe/following{/other_user}",
                "gists_url": "https://api.github.com/users/grampajoe/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/grampajoe/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/grampajoe/subscriptions",
                "organizations_url": "https://api.github.com/users/grampajoe/orgs",
                "repos_url": "https://api.github.com/users/grampajoe/repos",
                "events_url": "https://api.github.com/users/grampajoe/events{/privacy}",
                "received_events_url": "https://api.github.com/users/grampajoe/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-08-25T20:07:41Z",
            "updated_at": "2014-08-25T20:07:41Z",
            "author_association": "CONTRIBUTOR",
            "body": "If I'm reading it right, the changes made in mitsuhiko/werkzeug@e7f0ef41cf8af15771b4f6af207c933e1abbc077 mostly alleviate this by using a generator to add up the length of the file's lines instead of reading the whole file into a string at once.\n\n@qxcv, do you think that addresses your issue?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/53348694",
            "html_url": "https://github.com/pallets/flask/issues/361#issuecomment-53348694",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/361",
            "id": 53348694,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUzMzQ4Njk0",
            "user": {
                "login": "qxcv",
                "id": 1258993,
                "node_id": "MDQ6VXNlcjEyNTg5OTM=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/1258993?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/qxcv",
                "html_url": "https://github.com/qxcv",
                "followers_url": "https://api.github.com/users/qxcv/followers",
                "following_url": "https://api.github.com/users/qxcv/following{/other_user}",
                "gists_url": "https://api.github.com/users/qxcv/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/qxcv/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/qxcv/subscriptions",
                "organizations_url": "https://api.github.com/users/qxcv/orgs",
                "repos_url": "https://api.github.com/users/qxcv/repos",
                "events_url": "https://api.github.com/users/qxcv/events{/privacy}",
                "received_events_url": "https://api.github.com/users/qxcv/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-08-25T22:53:10Z",
            "updated_at": "2014-08-25T22:53:10Z",
            "author_association": "NONE",
            "body": "Yes, that should fix the issue. I just tested with 0.10.1 and `send_file` no longer seems to cause an issue. [Here](http://pastebin.com/bbQrP4D1) is a quick test script I wrote to verify.\n"
        }
    ]
}