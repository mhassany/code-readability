{
    "url": "https://api.github.com/repos/pallets/flask/issues/2776",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2776/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2776/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2776/events",
    "html_url": "https://github.com/pallets/flask/issues/2776",
    "id": 322556939,
    "node_id": "MDU6SXNzdWUzMjI1NTY5Mzk=",
    "number": 2776,
    "title": "cannot call app.run() from custom cli command",
    "user": {
        "login": "miguelgrinberg",
        "id": 2715854,
        "node_id": "MDQ6VXNlcjI3MTU4NTQ=",
        "avatar_url": "https://avatars0.githubusercontent.com/u/2715854?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/miguelgrinberg",
        "html_url": "https://github.com/miguelgrinberg",
        "followers_url": "https://api.github.com/users/miguelgrinberg/followers",
        "following_url": "https://api.github.com/users/miguelgrinberg/following{/other_user}",
        "gists_url": "https://api.github.com/users/miguelgrinberg/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/miguelgrinberg/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/miguelgrinberg/subscriptions",
        "organizations_url": "https://api.github.com/users/miguelgrinberg/orgs",
        "repos_url": "https://api.github.com/users/miguelgrinberg/repos",
        "events_url": "https://api.github.com/users/miguelgrinberg/events{/privacy}",
        "received_events_url": "https://api.github.com/users/miguelgrinberg/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2018-05-13T01:57:03Z",
    "updated_at": "2019-07-12T11:48:14Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "body": "### Expected Behavior\r\n\r\nThere are situations in which you may want to implement a custom application runner. Two examples that I can think of are running the application under the Werkzeug profiler, and starting the application in a background thread to perform integration tests against it.\r\n\r\nIn these situations, most people would want to create a custom CLI command that calls `app.run()` to start the application after applying any necessary changes, such as enabling profiling, etc.\r\n\r\nExample `bug.py`:\r\n\r\n```python\r\nfrom flask import Flask\r\n\r\napp = Flask(__name__)\r\n\r\n@app.cli.command()\r\ndef custom_run():\r\n    app.run()\r\n```\r\n\r\nWhat I expect with the above example is that running `flask custom_run` starts the development web server.\r\n\r\n### Actual Behavior\r\n\r\n```\r\n(venv) $ FLASK_APP=bug.py flask custom_run\r\n/home/miguel/bug.py:7: Warning: Silently ignoring app.run() because the application is run from the flask command line executable.  Consider putting app.run() behind an if __name__ == \"__main__\" guard to silence this warning.\r\n```\r\n\r\nI think this warning should only appear when `app.run()` is called from the global scope of the main module. This can be determined from the number of frames in the call stack. The warning should be issued only if the call stack has two frames, but should not if there are more than two. Thoughts?",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/391589017",
            "html_url": "https://github.com/pallets/flask/issues/2776#issuecomment-391589017",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2776",
            "id": 391589017,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTU4OTAxNw==",
            "user": {
                "login": "miguelgrinberg",
                "id": 2715854,
                "node_id": "MDQ6VXNlcjI3MTU4NTQ=",
                "avatar_url": "https://avatars0.githubusercontent.com/u/2715854?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/miguelgrinberg",
                "html_url": "https://github.com/miguelgrinberg",
                "followers_url": "https://api.github.com/users/miguelgrinberg/followers",
                "following_url": "https://api.github.com/users/miguelgrinberg/following{/other_user}",
                "gists_url": "https://api.github.com/users/miguelgrinberg/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/miguelgrinberg/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/miguelgrinberg/subscriptions",
                "organizations_url": "https://api.github.com/users/miguelgrinberg/orgs",
                "repos_url": "https://api.github.com/users/miguelgrinberg/repos",
                "events_url": "https://api.github.com/users/miguelgrinberg/events{/privacy}",
                "received_events_url": "https://api.github.com/users/miguelgrinberg/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-05-24T05:02:36Z",
            "updated_at": "2018-05-24T05:02:36Z",
            "author_association": "MEMBER",
            "body": "FYI, I included a fix for this problem in #2781."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/510857188",
            "html_url": "https://github.com/pallets/flask/issues/2776#issuecomment-510857188",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2776",
            "id": 510857188,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUxMDg1NzE4OA==",
            "user": {
                "login": "sktzofrenic",
                "id": 11902047,
                "node_id": "MDQ6VXNlcjExOTAyMDQ3",
                "avatar_url": "https://avatars2.githubusercontent.com/u/11902047?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/sktzofrenic",
                "html_url": "https://github.com/sktzofrenic",
                "followers_url": "https://api.github.com/users/sktzofrenic/followers",
                "following_url": "https://api.github.com/users/sktzofrenic/following{/other_user}",
                "gists_url": "https://api.github.com/users/sktzofrenic/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/sktzofrenic/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/sktzofrenic/subscriptions",
                "organizations_url": "https://api.github.com/users/sktzofrenic/orgs",
                "repos_url": "https://api.github.com/users/sktzofrenic/repos",
                "events_url": "https://api.github.com/users/sktzofrenic/events{/privacy}",
                "received_events_url": "https://api.github.com/users/sktzofrenic/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-07-12T11:48:14Z",
            "updated_at": "2019-07-12T11:48:14Z",
            "author_association": "NONE",
            "body": "I've found a solution to this that works in my case. I needed to have a separate flask app as a click command which failed when upgrading to 1.0. \r\n\r\nIn my situation, I created `autoapp.py` and `autoapp_proxy.py` and changed out the environment variable for `FLASK_APP=<app>` depending on which version I needed to run so that `flask run` would pull the correct app. \r\n\r\nI think I prefer the fix in your PR but wanted to throw this out there as an option that may work for some people's use case. "
        }
    ]
}