{
    "url": "https://api.github.com/repos/pallets/flask/issues/1065",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/1065/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/1065/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/1065/events",
    "html_url": "https://github.com/pallets/flask/issues/1065",
    "id": 33829676,
    "node_id": "MDU6SXNzdWUzMzgyOTY3Ng==",
    "number": 1065,
    "title": "PREFERRED_URL_SCHEME behavior question",
    "user": {
        "login": "pypingou",
        "id": 1240038,
        "node_id": "MDQ6VXNlcjEyNDAwMzg=",
        "avatar_url": "https://avatars1.githubusercontent.com/u/1240038?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pypingou",
        "html_url": "https://github.com/pypingou",
        "followers_url": "https://api.github.com/users/pypingou/followers",
        "following_url": "https://api.github.com/users/pypingou/following{/other_user}",
        "gists_url": "https://api.github.com/users/pypingou/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/pypingou/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/pypingou/subscriptions",
        "organizations_url": "https://api.github.com/users/pypingou/orgs",
        "repos_url": "https://api.github.com/users/pypingou/repos",
        "events_url": "https://api.github.com/users/pypingou/events{/privacy}",
        "received_events_url": "https://api.github.com/users/pypingou/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 10,
    "created_at": "2014-05-19T19:36:05Z",
    "updated_at": "2014-09-29T07:22:34Z",
    "closed_at": "2014-06-06T15:09:08Z",
    "author_association": "NONE",
    "body": "I have a flask application deployed behind a reversed proxy.\nThe proxy is configured to use https, the application server running the flask application is using http.\n\nWhen setting `PREFERRED_URL_SCHEME='https'` in the configuration I expected flask to return a `location` in the headers using `https`. Using curl we could check the location returned and they are using `http`.\n\nI added debugging statement to the application just before the `return flask.redirect(flask.url_for())` is called.\n- `print APP.config['PREFERRED_URL_SCHEME']` returns 'https'\n- `print flask.current_app.config['PREFERRED_URL_SCHEME']`  returns 'https'\n- `print flask.redirect(url)` returns `<BaseResponse 249 bytes [302 FOUND]>`\n\nUsing the logic presented at http://flask.pocoo.org/snippets/35/ we could make the location returned use `https` however it was my understanding that setting correctly `PREFERRED_URL_SCHEME` would spare us from having to add more code in our application to support https.\n\nCould you please let me know whether this is indeed the expected behavior or our original expectations were the correct one?\n\nFull disclaimer: the application is still running flask 0.9\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/43616315",
            "html_url": "https://github.com/pallets/flask/issues/1065#issuecomment-43616315",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1065",
            "id": 43616315,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzNjE2MzE1",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-05-20T11:59:42Z",
            "updated_at": "2014-05-20T11:59:42Z",
            "author_association": "MEMBER",
            "body": "Can you try `url_for(..., _external=True)`?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/43618274",
            "html_url": "https://github.com/pallets/flask/issues/1065#issuecomment-43618274",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1065",
            "id": 43618274,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzNjE4Mjc0",
            "user": {
                "login": "pypingou",
                "id": 1240038,
                "node_id": "MDQ6VXNlcjEyNDAwMzg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1240038?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/pypingou",
                "html_url": "https://github.com/pypingou",
                "followers_url": "https://api.github.com/users/pypingou/followers",
                "following_url": "https://api.github.com/users/pypingou/following{/other_user}",
                "gists_url": "https://api.github.com/users/pypingou/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/pypingou/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/pypingou/subscriptions",
                "organizations_url": "https://api.github.com/users/pypingou/orgs",
                "repos_url": "https://api.github.com/users/pypingou/repos",
                "events_url": "https://api.github.com/users/pypingou/events{/privacy}",
                "received_events_url": "https://api.github.com/users/pypingou/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-05-20T12:22:57Z",
            "updated_at": "2014-05-20T12:22:57Z",
            "author_association": "NONE",
            "body": "@untitaker that seems to work indeed. Does that mean that I should update all the `url_for(..)` or is there a global settings I could use?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/43618905",
            "html_url": "https://github.com/pallets/flask/issues/1065#issuecomment-43618905",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1065",
            "id": 43618905,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzNjE4OTA1",
            "user": {
                "login": "pypingou",
                "id": 1240038,
                "node_id": "MDQ6VXNlcjEyNDAwMzg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1240038?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/pypingou",
                "html_url": "https://github.com/pypingou",
                "followers_url": "https://api.github.com/users/pypingou/followers",
                "following_url": "https://api.github.com/users/pypingou/following{/other_user}",
                "gists_url": "https://api.github.com/users/pypingou/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/pypingou/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/pypingou/subscriptions",
                "organizations_url": "https://api.github.com/users/pypingou/orgs",
                "repos_url": "https://api.github.com/users/pypingou/repos",
                "events_url": "https://api.github.com/users/pypingou/events{/privacy}",
                "received_events_url": "https://api.github.com/users/pypingou/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-05-20T12:30:22Z",
            "updated_at": "2014-05-20T12:30:22Z",
            "author_association": "NONE",
            "body": "Funny thing, printing the URL in the log show `http://` not `https://`\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/43630639",
            "html_url": "https://github.com/pallets/flask/issues/1065#issuecomment-43630639",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1065",
            "id": 43630639,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzNjMwNjM5",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-05-20T14:13:03Z",
            "updated_at": "2014-05-20T14:13:03Z",
            "author_association": "MEMBER",
            "body": "Currently there is no global setting. You could use your own url_for which wraps Flask's, but that's about it. I think flask.redirect should support PREFERRED_URL_SCHEME when resolving URLs.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/43630736",
            "html_url": "https://github.com/pallets/flask/issues/1065#issuecomment-43630736",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1065",
            "id": 43630736,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzNjMwNzM2",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-05-20T14:13:46Z",
            "updated_at": "2014-05-20T14:13:46Z",
            "author_association": "MEMBER",
            "body": "Wait, the return value of url_for?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/43635006",
            "html_url": "https://github.com/pallets/flask/issues/1065#issuecomment-43635006",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1065",
            "id": 43635006,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzNjM1MDA2",
            "user": {
                "login": "pypingou",
                "id": 1240038,
                "node_id": "MDQ6VXNlcjEyNDAwMzg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1240038?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/pypingou",
                "html_url": "https://github.com/pypingou",
                "followers_url": "https://api.github.com/users/pypingou/followers",
                "following_url": "https://api.github.com/users/pypingou/following{/other_user}",
                "gists_url": "https://api.github.com/users/pypingou/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/pypingou/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/pypingou/subscriptions",
                "organizations_url": "https://api.github.com/users/pypingou/orgs",
                "repos_url": "https://api.github.com/users/pypingou/repos",
                "events_url": "https://api.github.com/users/pypingou/events{/privacy}",
                "received_events_url": "https://api.github.com/users/pypingou/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-05-20T14:42:40Z",
            "updated_at": "2014-05-20T14:42:40Z",
            "author_association": "NONE",
            "body": "The url is `http://localhost:6081/app/...` which makes sense since there is the proxy in front.\n\nFor the fun of it I tried setting the `SERVER_NAME` configuration key but then the application returns a 404 which also make sense in a proxy environment.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/43717716",
            "html_url": "https://github.com/pallets/flask/issues/1065#issuecomment-43717716",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1065",
            "id": 43717716,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzNzE3NzE2",
            "user": {
                "login": "pypingou",
                "id": 1240038,
                "node_id": "MDQ6VXNlcjEyNDAwMzg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1240038?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/pypingou",
                "html_url": "https://github.com/pypingou",
                "followers_url": "https://api.github.com/users/pypingou/followers",
                "following_url": "https://api.github.com/users/pypingou/following{/other_user}",
                "gists_url": "https://api.github.com/users/pypingou/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/pypingou/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/pypingou/subscriptions",
                "organizations_url": "https://api.github.com/users/pypingou/orgs",
                "repos_url": "https://api.github.com/users/pypingou/repos",
                "events_url": "https://api.github.com/users/pypingou/events{/privacy}",
                "received_events_url": "https://api.github.com/users/pypingou/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-05-21T06:46:10Z",
            "updated_at": "2014-05-21T06:46:10Z",
            "author_association": "NONE",
            "body": "I took a look at the werkzeug code, in `werkzeug.utils`, if I print the location at different step of the function, it always remain a relative url `/app/method/arg/` (unless I specify `_external=True` in the `url_for()` of course).\n\nI still think the situation could be improved in flask, but for the moment it looks like I have no choice but to rely on http://flask.pocoo.org/snippets/35/\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/45347325",
            "html_url": "https://github.com/pallets/flask/issues/1065#issuecomment-45347325",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1065",
            "id": 45347325,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MzQ3MzI1",
            "user": {
                "login": "mitsuhiko",
                "id": 7396,
                "node_id": "MDQ6VXNlcjczOTY=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/7396?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mitsuhiko",
                "html_url": "https://github.com/mitsuhiko",
                "followers_url": "https://api.github.com/users/mitsuhiko/followers",
                "following_url": "https://api.github.com/users/mitsuhiko/following{/other_user}",
                "gists_url": "https://api.github.com/users/mitsuhiko/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mitsuhiko/subscriptions",
                "organizations_url": "https://api.github.com/users/mitsuhiko/orgs",
                "repos_url": "https://api.github.com/users/mitsuhiko/repos",
                "events_url": "https://api.github.com/users/mitsuhiko/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mitsuhiko/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-06-06T15:09:08Z",
            "updated_at": "2014-06-06T15:09:08Z",
            "author_association": "MEMBER",
            "body": "The WSGI middleware _is_ how you are supposed to fix it.  This is not something Flask does.  `SERVER_NAME` has nothing to do with that.  The `SERVER_NAME` flag is for subdomain detection and for generating URLs in background scripts.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/57015582",
            "html_url": "https://github.com/pallets/flask/issues/1065#issuecomment-57015582",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1065",
            "id": 57015582,
            "node_id": "MDEyOklzc3VlQ29tbWVudDU3MDE1NTgy",
            "user": {
                "login": "yang",
                "id": 7129,
                "node_id": "MDQ6VXNlcjcxMjk=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/7129?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/yang",
                "html_url": "https://github.com/yang",
                "followers_url": "https://api.github.com/users/yang/followers",
                "following_url": "https://api.github.com/users/yang/following{/other_user}",
                "gists_url": "https://api.github.com/users/yang/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/yang/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/yang/subscriptions",
                "organizations_url": "https://api.github.com/users/yang/orgs",
                "repos_url": "https://api.github.com/users/yang/repos",
                "events_url": "https://api.github.com/users/yang/events{/privacy}",
                "received_events_url": "https://api.github.com/users/yang/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-09-26T20:25:18Z",
            "updated_at": "2014-09-26T20:26:24Z",
            "author_association": "NONE",
            "body": "@mitsuhiko What does `PREFERRED_URL_SCHEME` actually do then? Can this be re-opened as a documentation bug, since the current description is misleading, given that `url_for` does not seem to be affected by `PREFERRED_URL_SCHEME`?  (E.g. `url_for('foo', _external=True)` returns `http://...`)\n\n> `PREFERRED_URL_SCHEME`:\n> \n> The URL scheme that should be used for URL generation if no URL scheme is available. This defaults to http.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/57016915",
            "html_url": "https://github.com/pallets/flask/issues/1065#issuecomment-57016915",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1065",
            "id": 57016915,
            "node_id": "MDEyOklzc3VlQ29tbWVudDU3MDE2OTE1",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-09-26T20:36:27Z",
            "updated_at": "2014-09-26T20:36:27Z",
            "author_association": "MEMBER",
            "body": "This was already fixed with https://github.com/mitsuhiko/flask/commit/b49074eb6b19d8f5fdb3301a6e50f11845dd530d\n"
        }
    ]
}