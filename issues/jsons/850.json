{
    "url": "https://api.github.com/repos/pallets/flask/issues/850",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/850/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/850/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/850/events",
    "html_url": "https://github.com/pallets/flask/issues/850",
    "id": 18615150,
    "node_id": "MDU6SXNzdWUxODYxNTE1MA==",
    "number": 850,
    "title": "Multiple request headers with same name",
    "user": {
        "login": "Tyilo",
        "id": 568036,
        "node_id": "MDQ6VXNlcjU2ODAzNg==",
        "avatar_url": "https://avatars2.githubusercontent.com/u/568036?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Tyilo",
        "html_url": "https://github.com/Tyilo",
        "followers_url": "https://api.github.com/users/Tyilo/followers",
        "following_url": "https://api.github.com/users/Tyilo/following{/other_user}",
        "gists_url": "https://api.github.com/users/Tyilo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/Tyilo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Tyilo/subscriptions",
        "organizations_url": "https://api.github.com/users/Tyilo/orgs",
        "repos_url": "https://api.github.com/users/Tyilo/repos",
        "events_url": "https://api.github.com/users/Tyilo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/Tyilo/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 8,
    "created_at": "2013-08-27T15:33:30Z",
    "updated_at": "2017-10-06T00:09:21Z",
    "closed_at": "2016-06-03T09:00:59Z",
    "author_association": "NONE",
    "body": "I'm deploying my flask website to heroku and they pass 4 headers to flask: `X-Forwarded-For`, `X-Forwarded-Proto`, `X-Forwarded-Port` & `X-Request-Start`.\n\nI want to use all of these headers in flask, however if there are multiple of these headers (except `X-Forwarded-For`) flask will only use the last ones, even when using `request.headers.get_all` or `request.headers.getlist`.\n\nThis is problematic as the client can easily fake these headers, which will override those values passed from heroku.\n\nAs the `request.headers` object is already the type `werkzeug.datastructures.EnvironHeaders`, which subclasses `werkzeug.datastructures.Headers`, which have support for a key with multiple values, I don't think it will be that hard to implement.\n\nExample code:\n`test.py`\n\n```\nimport requests\nfrom flask import Flask, request\napp = Flask(__name__)\n\n@app.route('/')\ndef test():\n    k = 'X-Request-Start'\n    h = request.headers\n    print h.get(k)\n    print h.get_all(k)\n    print h.getlist(k)\n    return 'Check the logs\\n'\n\nif __name__ == '__main__':\n    app.run()\n```\n\nTesting:\n\n```\npython test.py &\ncurl -H 'X-Request-Start: test1' -H 'X-Request-Start: test2' http://127.0.0.1:5000/\n```\n\nLogs:\n\n```\n * Running on http://127.0.0.1:5000/\ntest2\n['test2']\n['test2']\n127.0.0.1 - - [27/Aug/2013 17:30:45] \"GET / HTTP/1.1\" 200 -\n```\n\nExpected result in logs:\n\n```\n * Running on http://127.0.0.1:5000/\ntest2\n['test1', 'test2']\n['test1', 'test2']\n127.0.0.1 - - [27/Aug/2013 17:30:45] \"GET / HTTP/1.1\" 200 -\n```\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/23357368",
            "html_url": "https://github.com/pallets/flask/issues/850#issuecomment-23357368",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/850",
            "id": 23357368,
            "node_id": "MDEyOklzc3VlQ29tbWVudDIzMzU3MzY4",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-08-27T18:03:21Z",
            "updated_at": "2013-08-27T18:03:21Z",
            "author_association": "MEMBER",
            "body": "I don't think this is easily possible with the current builtin server. http://stackoverflow.com/questions/1801124/how-does-wsgi-handle-multiple-request-headers-with-the-same-name suggests that WSGI doesn't do a good job of dealing with multiple values to begin with.\n\nThis kinda behavior seems to exist since Flask 0.9 and Werkzeug 0.8.3\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/23397962",
            "html_url": "https://github.com/pallets/flask/issues/850#issuecomment-23397962",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/850",
            "id": 23397962,
            "node_id": "MDEyOklzc3VlQ29tbWVudDIzMzk3OTYy",
            "user": {
                "login": "ghost",
                "id": 10137,
                "node_id": "MDQ6VXNlcjEwMTM3",
                "avatar_url": "https://avatars3.githubusercontent.com/u/10137?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ghost",
                "html_url": "https://github.com/ghost",
                "followers_url": "https://api.github.com/users/ghost/followers",
                "following_url": "https://api.github.com/users/ghost/following{/other_user}",
                "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
                "organizations_url": "https://api.github.com/users/ghost/orgs",
                "repos_url": "https://api.github.com/users/ghost/repos",
                "events_url": "https://api.github.com/users/ghost/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ghost/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-08-28T08:12:40Z",
            "updated_at": "2013-08-28T08:12:40Z",
            "author_association": "NONE",
            "body": "> This is problematic as the client can easily fake these headers, which will override those values passed from heroku.\n\nWell, this is a problem of Heroku. This is pretty strange, did you test it?\n\nHowever, be sure to checkout [werkzeug.contrib.fixers.ProxyFix](http://werkzeug.pocoo.org/docs/contrib/fixers/#werkzeug.contrib.fixers.ProxyFix).\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/35772423",
            "html_url": "https://github.com/pallets/flask/issues/850#issuecomment-35772423",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/850",
            "id": 35772423,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM1NzcyNDIz",
            "user": {
                "login": "grampajoe",
                "id": 55005,
                "node_id": "MDQ6VXNlcjU1MDA1",
                "avatar_url": "https://avatars1.githubusercontent.com/u/55005?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/grampajoe",
                "html_url": "https://github.com/grampajoe",
                "followers_url": "https://api.github.com/users/grampajoe/followers",
                "following_url": "https://api.github.com/users/grampajoe/following{/other_user}",
                "gists_url": "https://api.github.com/users/grampajoe/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/grampajoe/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/grampajoe/subscriptions",
                "organizations_url": "https://api.github.com/users/grampajoe/orgs",
                "repos_url": "https://api.github.com/users/grampajoe/repos",
                "events_url": "https://api.github.com/users/grampajoe/events{/privacy}",
                "received_events_url": "https://api.github.com/users/grampajoe/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-02-21T20:53:51Z",
            "updated_at": "2014-02-21T20:53:51Z",
            "author_association": "CONTRIBUTOR",
            "body": "If there are multiple values for one of these headers, how can you tell which one is the \"real\" value?\n\nIs this issue still present on Heroku? Is it something that should be addressed in Flask?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/89440076",
            "html_url": "https://github.com/pallets/flask/issues/850#issuecomment-89440076",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/850",
            "id": 89440076,
            "node_id": "MDEyOklzc3VlQ29tbWVudDg5NDQwMDc2",
            "user": {
                "login": "jvinet",
                "id": 84075,
                "node_id": "MDQ6VXNlcjg0MDc1",
                "avatar_url": "https://avatars0.githubusercontent.com/u/84075?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/jvinet",
                "html_url": "https://github.com/jvinet",
                "followers_url": "https://api.github.com/users/jvinet/followers",
                "following_url": "https://api.github.com/users/jvinet/following{/other_user}",
                "gists_url": "https://api.github.com/users/jvinet/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/jvinet/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jvinet/subscriptions",
                "organizations_url": "https://api.github.com/users/jvinet/orgs",
                "repos_url": "https://api.github.com/users/jvinet/repos",
                "events_url": "https://api.github.com/users/jvinet/events{/privacy}",
                "received_events_url": "https://api.github.com/users/jvinet/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2015-04-03T22:45:16Z",
            "updated_at": "2015-04-03T22:45:16Z",
            "author_association": "NONE",
            "body": "@grampajoe, you treat multiple lines as if all values were included on one line.\n\nExamples here: http://www.w3.org/Protocols/HTTP/HTRQ_Headers.html#z3\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/223363994",
            "html_url": "https://github.com/pallets/flask/issues/850#issuecomment-223363994",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/850",
            "id": 223363994,
            "node_id": "MDEyOklzc3VlQ29tbWVudDIyMzM2Mzk5NA==",
            "user": {
                "login": "mathiasbc",
                "id": 1334386,
                "node_id": "MDQ6VXNlcjEzMzQzODY=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/1334386?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mathiasbc",
                "html_url": "https://github.com/mathiasbc",
                "followers_url": "https://api.github.com/users/mathiasbc/followers",
                "following_url": "https://api.github.com/users/mathiasbc/following{/other_user}",
                "gists_url": "https://api.github.com/users/mathiasbc/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mathiasbc/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mathiasbc/subscriptions",
                "organizations_url": "https://api.github.com/users/mathiasbc/orgs",
                "repos_url": "https://api.github.com/users/mathiasbc/repos",
                "events_url": "https://api.github.com/users/mathiasbc/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mathiasbc/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-06-02T17:32:42Z",
            "updated_at": "2016-06-02T17:32:42Z",
            "author_association": "NONE",
            "body": "Still happening on flask version 0.11 although I agree that it should be a Heroku concern more than a feature of Flask.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/223364917",
            "html_url": "https://github.com/pallets/flask/issues/850#issuecomment-223364917",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/850",
            "id": 223364917,
            "node_id": "MDEyOklzc3VlQ29tbWVudDIyMzM2NDkxNw==",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-06-02T17:36:09Z",
            "updated_at": "2016-06-02T17:36:09Z",
            "author_association": "MEMBER",
            "body": "I think we should close this because it's an issue with Heroku. Agreed?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/223367122",
            "html_url": "https://github.com/pallets/flask/issues/850#issuecomment-223367122",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/850",
            "id": 223367122,
            "node_id": "MDEyOklzc3VlQ29tbWVudDIyMzM2NzEyMg==",
            "user": {
                "login": "mathiasbc",
                "id": 1334386,
                "node_id": "MDQ6VXNlcjEzMzQzODY=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/1334386?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mathiasbc",
                "html_url": "https://github.com/mathiasbc",
                "followers_url": "https://api.github.com/users/mathiasbc/followers",
                "following_url": "https://api.github.com/users/mathiasbc/following{/other_user}",
                "gists_url": "https://api.github.com/users/mathiasbc/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mathiasbc/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mathiasbc/subscriptions",
                "organizations_url": "https://api.github.com/users/mathiasbc/orgs",
                "repos_url": "https://api.github.com/users/mathiasbc/repos",
                "events_url": "https://api.github.com/users/mathiasbc/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mathiasbc/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-06-02T17:44:16Z",
            "updated_at": "2016-06-02T17:44:16Z",
            "author_association": "NONE",
            "body": "+1\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/334625246",
            "html_url": "https://github.com/pallets/flask/issues/850#issuecomment-334625246",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/850",
            "id": 334625246,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDYyNTI0Ng==",
            "user": {
                "login": "BartlomiejLewandowski",
                "id": 692229,
                "node_id": "MDQ6VXNlcjY5MjIyOQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/692229?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/BartlomiejLewandowski",
                "html_url": "https://github.com/BartlomiejLewandowski",
                "followers_url": "https://api.github.com/users/BartlomiejLewandowski/followers",
                "following_url": "https://api.github.com/users/BartlomiejLewandowski/following{/other_user}",
                "gists_url": "https://api.github.com/users/BartlomiejLewandowski/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/BartlomiejLewandowski/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/BartlomiejLewandowski/subscriptions",
                "organizations_url": "https://api.github.com/users/BartlomiejLewandowski/orgs",
                "repos_url": "https://api.github.com/users/BartlomiejLewandowski/repos",
                "events_url": "https://api.github.com/users/BartlomiejLewandowski/events{/privacy}",
                "received_events_url": "https://api.github.com/users/BartlomiejLewandowski/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-10-06T00:09:21Z",
            "updated_at": "2017-10-06T00:09:21Z",
            "author_association": "NONE",
            "body": "I'm using httpbin which is built on top of flask for integration testing. We've found a regression in one of our libraries which caused us to send multiple headers to a downstream service.\r\n\r\nThe idea was to use httpbin and flask to send back the headers received, but it turns out that this multiple header story is not supported by flask at all.\r\n\r\nIs there any workaround for this?"
        }
    ]
}