{
    "url": "https://api.github.com/repos/pallets/flask/issues/917",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/917/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/917/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/917/events",
    "html_url": "https://github.com/pallets/flask/issues/917",
    "id": 23353232,
    "node_id": "MDU6SXNzdWUyMzM1MzIzMg==",
    "number": 917,
    "title": "TypeError in CSRF Token Checking Under Python 3",
    "user": {
        "login": "holdenweb",
        "id": 105312,
        "node_id": "MDQ6VXNlcjEwNTMxMg==",
        "avatar_url": "https://avatars1.githubusercontent.com/u/105312?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/holdenweb",
        "html_url": "https://github.com/holdenweb",
        "followers_url": "https://api.github.com/users/holdenweb/followers",
        "following_url": "https://api.github.com/users/holdenweb/following{/other_user}",
        "gists_url": "https://api.github.com/users/holdenweb/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/holdenweb/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/holdenweb/subscriptions",
        "organizations_url": "https://api.github.com/users/holdenweb/orgs",
        "repos_url": "https://api.github.com/users/holdenweb/repos",
        "events_url": "https://api.github.com/users/holdenweb/events{/privacy}",
        "received_events_url": "https://api.github.com/users/holdenweb/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2013-11-26T22:30:57Z",
    "updated_at": "2013-11-27T00:30:20Z",
    "closed_at": "2013-11-27T00:30:20Z",
    "author_association": "NONE",
    "body": "I was trying to check out some DropBox API code, and came up with the following Flask server (mostly lifted from the Dropbpx docs)::\n\n```\nfrom dropbox.client import DropboxOAuth2Flow\nfrom flask import (Flask, request, session, g, redirect, url_for,\n                   abort, render_template, flash)\n\n# configuration\n#DATABASE = '/tmp/flaskr.db'\n#PASSWORD = 'default'\nDEBUG = True\nSECRET_KEY = 'development key'\nUSERNAME = 'admin'\n\napp = Flask(\"test_connect\")\napp.config.from_object(\"test_connect\")\n\nDROPBOX_APP_KEY = 'APP_KEY' # use your own value\nDROPBOX_APP_SECRET = 'APP_SECRET' # use your own value\n\n@app.route('/')\ndef home():\n    if not 'access_token' in session:\n        return redirect(url_for('dropbox_auth_start'))\n    return 'Authenticated.'\n\n@app.route('/dropbox-auth-start')\ndef dropbox_auth_start():\n    return redirect(get_auth_flow().start())\n\n@app.route('/dropbox-auth-finish')\ndef dropbox_auth_finish():\n    try:\n        access_token, user_id, url_state = get_auth_flow().finish(request.args)\n    except ValueError:\n        abort(400)\n    else:\n        session['access_token'] = access_token\n    return redirect(url_for('home'))\n\ndef get_auth_flow():\n    redirect_uri = url_for('dropbox_auth_finish', _external=True)\n    return DropboxOAuth2Flow(DROPBOX_APP_KEY, DROPBOX_APP_SECRET, redirect_uri,\n                         session, 'dropbox-auth-csrf-token')\n\nif __name__ == \"__main__\":\n    app.run()\n```\n\nWhen I submit the root URI I see the following console output:\n\n<pre>\n(py3)localhost:ipynb3 sholden$ 127.0.0.1 - - [26/Nov/2013 14:13:42] \"GET / HTTP/1.1\" 302 -\n127.0.0.1 - - [26/Nov/2013 14:13:42] \"GET /dropbox-auth-start HTTP/1.1\" 302 -\n127.0.0.1 - - [26/Nov/2013 14:13:48] \"GET /dropbox-auth-finish?code=EtdzRFdUsSsAAAAAAAAAAYsGGTJcWs8YtbQB_gvT99c&state=nBOWOVAN6XTqH-wdOaSmpw%3D%3D HTTP/1.1\" 500 -\nTraceback (most recent call last):\n  File \"/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/app.py\", line 1836, in __call__\n    return self.wsgi_app(environ, start_response)\n  File \"/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/app.py\", line 1820, in wsgi_app\n    response = self.make_response(self.handle_exception(e))\n  File \"/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/app.py\", line 1403, in handle_exception\n    reraise(exc_type, exc_value, tb)\n  File \"/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/_compat.py\", line 33, in reraise\n    raise value\n  File \"/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/app.py\", line 1817, in wsgi_app\n    response = self.full_dispatch_request()\n  File \"/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/app.py\", line 1477, in full_dispatch_request\n    rv = self.handle_user_exception(e)\n  File \"/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/app.py\", line 1381, in handle_user_exception\n    reraise(exc_type, exc_value, tb)\n  File \"/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/_compat.py\", line 33, in reraise\n    raise value\n  File \"/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/app.py\", line 1475, in full_dispatch_request\n    rv = self.dispatch_request()\n  File \"/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/app.py\", line 1461, in dispatch_request\n    return self.view_functions[rule.endpoint](**req.view_args)\n  File \"/Users/sholden/Projects/Python/ipynb3/test_connect.py\", line 33, in dropbox_auth_finish\n    access_token, user_id, url_state = get_auth_flow().finish(request.args)\n  File \"/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/dropbox/client.py\", line 1234, in finish\n    if not _safe_equals(csrf_token_from_session, given_csrf_token):\n  File \"/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/dropbox/client.py\", line 1306, in _safe_equals\n    res |= ord(ca) ^ ord(cb)\nTypeError: ord() expected string of length 1, but int found\n</pre>\n\nUsing the excellent Werkzeug debugging features I discovered the trouble appears to be due to the finish() function calling _safe_equals() with one bytes argument and one string.\n\nOf course there could easily be something wrong with my code, in which case sorry for the spurious issue report.\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/29342870",
            "html_url": "https://github.com/pallets/flask/issues/917#issuecomment-29342870",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/917",
            "id": 29342870,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzQyODcw",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-11-26T22:46:30Z",
            "updated_at": "2013-11-26T22:46:30Z",
            "author_association": "MEMBER",
            "body": "That looks more like a problem in the dropbox client than a flask issue\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/29343903",
            "html_url": "https://github.com/pallets/flask/issues/917#issuecomment-29343903",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/917",
            "id": 29343903,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzQzOTAz",
            "user": {
                "login": "holdenweb",
                "id": 105312,
                "node_id": "MDQ6VXNlcjEwNTMxMg==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/105312?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/holdenweb",
                "html_url": "https://github.com/holdenweb",
                "followers_url": "https://api.github.com/users/holdenweb/followers",
                "following_url": "https://api.github.com/users/holdenweb/following{/other_user}",
                "gists_url": "https://api.github.com/users/holdenweb/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/holdenweb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/holdenweb/subscriptions",
                "organizations_url": "https://api.github.com/users/holdenweb/orgs",
                "repos_url": "https://api.github.com/users/holdenweb/repos",
                "events_url": "https://api.github.com/users/holdenweb/events{/privacy}",
                "received_events_url": "https://api.github.com/users/holdenweb/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-11-26T23:00:59Z",
            "updated_at": "2013-11-26T23:00:59Z",
            "author_association": "NONE",
            "body": "Thanks, I'll check it out and close the issue when I found out where I goofed.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/29350565",
            "html_url": "https://github.com/pallets/flask/issues/917#issuecomment-29350565",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/917",
            "id": 29350565,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzUwNTY1",
            "user": {
                "login": "holdenweb",
                "id": 105312,
                "node_id": "MDQ6VXNlcjEwNTMxMg==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/105312?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/holdenweb",
                "html_url": "https://github.com/holdenweb",
                "followers_url": "https://api.github.com/users/holdenweb/followers",
                "following_url": "https://api.github.com/users/holdenweb/following{/other_user}",
                "gists_url": "https://api.github.com/users/holdenweb/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/holdenweb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/holdenweb/subscriptions",
                "organizations_url": "https://api.github.com/users/holdenweb/orgs",
                "repos_url": "https://api.github.com/users/holdenweb/repos",
                "events_url": "https://api.github.com/users/holdenweb/events{/privacy}",
                "received_events_url": "https://api.github.com/users/holdenweb/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-11-27T00:30:20Z",
            "updated_at": "2013-11-27T00:30:20Z",
            "author_association": "NONE",
            "body": "You are correct. The CSRF token is stored in the sessions as a bytes value. Thanks, closing.\n"
        }
    ]
}