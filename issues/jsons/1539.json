{
    "url": "https://api.github.com/repos/pallets/flask/issues/1539",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/1539/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/1539/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/1539/events",
    "html_url": "https://github.com/pallets/flask/pull/1539",
    "id": 96690919,
    "node_id": "MDExOlB1bGxSZXF1ZXN0NDA2MjM1OTY=",
    "number": 1539,
    "title": "Improve function with_metaclass()",
    "user": {
        "login": "mjhennig",
        "id": 640327,
        "node_id": "MDQ6VXNlcjY0MDMyNw==",
        "avatar_url": "https://avatars2.githubusercontent.com/u/640327?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mjhennig",
        "html_url": "https://github.com/mjhennig",
        "followers_url": "https://api.github.com/users/mjhennig/followers",
        "following_url": "https://api.github.com/users/mjhennig/following{/other_user}",
        "gists_url": "https://api.github.com/users/mjhennig/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mjhennig/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mjhennig/subscriptions",
        "organizations_url": "https://api.github.com/users/mjhennig/orgs",
        "repos_url": "https://api.github.com/users/mjhennig/repos",
        "events_url": "https://api.github.com/users/mjhennig/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mjhennig/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 7,
    "created_at": "2015-07-22T23:34:06Z",
    "updated_at": "2015-07-27T17:25:29Z",
    "closed_at": "2015-07-27T17:25:27Z",
    "author_association": "CONTRIBUTOR",
    "pull_request": {
        "url": "https://api.github.com/repos/pallets/flask/pulls/1539",
        "html_url": "https://github.com/pallets/flask/pull/1539",
        "diff_url": "https://github.com/pallets/flask/pull/1539.diff",
        "patch_url": "https://github.com/pallets/flask/pull/1539.patch"
    },
    "body": "The idea of a metaclass _\"that replaces itself with the actual metaclass\"_ is really clever. Yet I cannot help but suspect that the current implementation of function `with_metaclass` is just a bit too much.\n\nWhy does the dummy metaclass extend the one to apply?\n\nIt never utilizes any of the base class' resources, except for the base class itself. Since this is done by direct invocation (not via `super()` or something), there should be no need to inherit from the caller-provided type in the first place.\n\nFurthermore, given that the above obvservation is correct, there should be no need to explicitly utilize `type.__call__` and `type.__init__` any more. Not only because one can directly inherit from `type` here, but also because both seem to be required due to the aforementioned inheritance only: If the given `meta` class implements custom magic, the creation of the `temporary_class` could fail. Or even worse; succeed but silently misinterprete arguments.\n\nSpeaking of the `temporary_class` creation (and still assuming all of the above assumptions to be correct): There's no need to do that via the `metaclass` constructor at all, which actually saves not only the additional function call but also the condition within `__new__`.\n\nGiven I didn't miss something (and there is indeed no actual reason for the metaclass to extend the one to apply), then I believe the patch suggested with this pull request to significantly improve the code without changing any of the expected behavior.\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/124020806",
            "html_url": "https://github.com/pallets/flask/pull/1539#issuecomment-124020806",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1539",
            "id": 124020806,
            "node_id": "MDEyOklzc3VlQ29tbWVudDEyNDAyMDgwNg==",
            "user": {
                "login": "mjhennig",
                "id": 640327,
                "node_id": "MDQ6VXNlcjY0MDMyNw==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/640327?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mjhennig",
                "html_url": "https://github.com/mjhennig",
                "followers_url": "https://api.github.com/users/mjhennig/followers",
                "following_url": "https://api.github.com/users/mjhennig/following{/other_user}",
                "gists_url": "https://api.github.com/users/mjhennig/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mjhennig/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mjhennig/subscriptions",
                "organizations_url": "https://api.github.com/users/mjhennig/orgs",
                "repos_url": "https://api.github.com/users/mjhennig/repos",
                "events_url": "https://api.github.com/users/mjhennig/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mjhennig/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2015-07-23T08:29:05Z",
            "updated_at": "2015-07-23T08:29:05Z",
            "author_association": "CONTRIBUTOR",
            "body": "It turns out that [the _Six_ version contains basically the same optimizations](https://bitbucket.org/gutworth/six/diff/six.py?diff2=eb096fc7ae5b&at=default). They have been applied just a few months after [migrating to use the _Flask_ implementation](https://bitbucket.org/gutworth/six/issues/66/replace-the-implementation-of).\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/124215187",
            "html_url": "https://github.com/pallets/flask/pull/1539#issuecomment-124215187",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1539",
            "id": 124215187,
            "node_id": "MDEyOklzc3VlQ29tbWVudDEyNDIxNTE4Nw==",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2015-07-23T19:14:51Z",
            "updated_at": "2015-07-23T19:14:51Z",
            "author_association": "MEMBER",
            "body": "Could you copy over the exact one of six? Perhaps there's some significant difference we're missing.\n\nOn 23 July 2015 10:29:17 CEST, Matze notifications@github.com wrote:\n\n> It turns out that [the _Six_ version contains basically the same\n> optimizations](https://bitbucket.org/gutworth/six/diff/six.py?diff2=eb096fc7ae5b&at=default).\n> They have been applied just a few months after [migrating to use the\n> _Flask_\n> implementation](https://bitbucket.org/gutworth/six/issues/66/replace-the-implementation-of).\n> \n> ---\n> \n> Reply to this email directly or view it on GitHub:\n> https://github.com/mitsuhiko/flask/pull/1539#issuecomment-124020806\n\n## \n\nSent from my phone. Please excuse my brevity.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/125222452",
            "html_url": "https://github.com/pallets/flask/pull/1539#issuecomment-125222452",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1539",
            "id": 125222452,
            "node_id": "MDEyOklzc3VlQ29tbWVudDEyNTIyMjQ1Mg==",
            "user": {
                "login": "snoack",
                "id": 1525,
                "node_id": "MDQ6VXNlcjE1MjU=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/1525?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/snoack",
                "html_url": "https://github.com/snoack",
                "followers_url": "https://api.github.com/users/snoack/followers",
                "following_url": "https://api.github.com/users/snoack/following{/other_user}",
                "gists_url": "https://api.github.com/users/snoack/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/snoack/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/snoack/subscriptions",
                "organizations_url": "https://api.github.com/users/snoack/orgs",
                "repos_url": "https://api.github.com/users/snoack/repos",
                "events_url": "https://api.github.com/users/snoack/events{/privacy}",
                "received_events_url": "https://api.github.com/users/snoack/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2015-07-27T14:18:21Z",
            "updated_at": "2015-07-27T14:22:53Z",
            "author_association": "NONE",
            "body": "@mjhennig asked me for my opinion on this one. FWIW, I think that using proper class syntax (as done by six and the current version of Flask) is more readable than creating classes with the `type()` built-in function.\n\nHowever, there is also one logical difference between the implementation in six and this patch. That is that the implementation in six (as well as the current version of Flask) is subclassing the provided metaclass, rather than simply wrapping it by a metaclass subclassed from `type`. This could potentially lead to side-effects when the provided metaclass is constructed from yet another metaclass.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/125222592",
            "html_url": "https://github.com/pallets/flask/pull/1539#issuecomment-125222592",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1539",
            "id": 125222592,
            "node_id": "MDEyOklzc3VlQ29tbWVudDEyNTIyMjU5Mg==",
            "user": {
                "login": "mjhennig",
                "id": 640327,
                "node_id": "MDQ6VXNlcjY0MDMyNw==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/640327?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mjhennig",
                "html_url": "https://github.com/mjhennig",
                "followers_url": "https://api.github.com/users/mjhennig/followers",
                "following_url": "https://api.github.com/users/mjhennig/following{/other_user}",
                "gists_url": "https://api.github.com/users/mjhennig/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mjhennig/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mjhennig/subscriptions",
                "organizations_url": "https://api.github.com/users/mjhennig/orgs",
                "repos_url": "https://api.github.com/users/mjhennig/repos",
                "events_url": "https://api.github.com/users/mjhennig/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mjhennig/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2015-07-27T14:18:35Z",
            "updated_at": "2015-07-27T14:18:35Z",
            "author_association": "CONTRIBUTOR",
            "body": "While I see that unifying the implementations is favorable in this case, there are actually two points left I like to address:\n\nFirst, there is indeed an _unintentional_ difference in behavior in the proposed patch: It's now a metaclass called `with_metaclass`, not `metaclass` any more. That of course would be quick and easy to align, and it's not easy to find a scenario where it matters anyway.\n\nSencond, there is also an _intentional_ difference between the behavior of the proposed version and the one from Six: The latter still extends the wrapper `metaclass` from the caller-given `meta`. In my \nundestanding, this is not only overhead but a bug:\n\n```\n>>> class MetaMeta(type):\n...     def __call__(cls, *args, **kwargs):\n...       print(\"CALL\", cls, args, kwargs)\n...       return super(MetaMeta, cls).__call__(*args, **kwargs)\n... \n>>> class Meta(six.with_metaclass(MetaMeta, type)): pass\n... \n>>> class Test(six.with_metaclass(Meta, object)): pass\n... \n('CALL', <class 'six.metaclass'>, ('Test', (<class 'six.temporary_class'>,), {'__module__': '__main__'}), {})\n('CALL', <class '__main__.Meta'>, ('Test', (<type 'object'>,), {'__module__': '__main__'}), {})\n```\n\nWhen using `six.with_metaclass` for a metaclass that has a metaclass for itself, overwriting the `__call__` method, this very method is invoked for the now not-so-invisible-anymore wrapper.\n\nAny feedback on this?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/125228406",
            "html_url": "https://github.com/pallets/flask/pull/1539#issuecomment-125228406",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1539",
            "id": 125228406,
            "node_id": "MDEyOklzc3VlQ29tbWVudDEyNTIyODQwNg==",
            "user": {
                "login": "mjhennig",
                "id": 640327,
                "node_id": "MDQ6VXNlcjY0MDMyNw==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/640327?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mjhennig",
                "html_url": "https://github.com/mjhennig",
                "followers_url": "https://api.github.com/users/mjhennig/followers",
                "following_url": "https://api.github.com/users/mjhennig/following{/other_user}",
                "gists_url": "https://api.github.com/users/mjhennig/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mjhennig/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mjhennig/subscriptions",
                "organizations_url": "https://api.github.com/users/mjhennig/orgs",
                "repos_url": "https://api.github.com/users/mjhennig/repos",
                "events_url": "https://api.github.com/users/mjhennig/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mjhennig/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2015-07-27T14:37:59Z",
            "updated_at": "2015-07-27T14:37:59Z",
            "author_association": "CONTRIBUTOR",
            "body": "I've updated the pull request to address the points discussed above. It's now basically the same as Six' version ([400:8a545f4e906f](https://bitbucket.org/gutworth/six/src/8a545f4)), except for using `type` as anchestor of the `metaclass`.\n\n@snoack Thank you. Seems like we posted at the same time, eh?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/125228763",
            "html_url": "https://github.com/pallets/flask/pull/1539#issuecomment-125228763",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1539",
            "id": 125228763,
            "node_id": "MDEyOklzc3VlQ29tbWVudDEyNTIyODc2Mw==",
            "user": {
                "login": "snoack",
                "id": 1525,
                "node_id": "MDQ6VXNlcjE1MjU=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/1525?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/snoack",
                "html_url": "https://github.com/snoack",
                "followers_url": "https://api.github.com/users/snoack/followers",
                "following_url": "https://api.github.com/users/snoack/following{/other_user}",
                "gists_url": "https://api.github.com/users/snoack/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/snoack/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/snoack/subscriptions",
                "organizations_url": "https://api.github.com/users/snoack/orgs",
                "repos_url": "https://api.github.com/users/snoack/repos",
                "events_url": "https://api.github.com/users/snoack/events{/privacy}",
                "received_events_url": "https://api.github.com/users/snoack/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2015-07-27T14:38:46Z",
            "updated_at": "2015-07-27T14:38:46Z",
            "author_association": "NONE",
            "body": "The new patch looks good to me.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/125279372",
            "html_url": "https://github.com/pallets/flask/pull/1539#issuecomment-125279372",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1539",
            "id": 125279372,
            "node_id": "MDEyOklzc3VlQ29tbWVudDEyNTI3OTM3Mg==",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2015-07-27T17:25:29Z",
            "updated_at": "2015-07-27T17:25:29Z",
            "author_association": "MEMBER",
            "body": "Thanks!\n"
        }
    ]
}