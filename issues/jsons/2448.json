{
    "url": "https://api.github.com/repos/pallets/flask/issues/2448",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2448/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2448/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2448/events",
    "html_url": "https://github.com/pallets/flask/issues/2448",
    "id": 250327588,
    "node_id": "MDU6SXNzdWUyNTAzMjc1ODg=",
    "number": 2448,
    "title": "Changing SESSION_COOKIE_NAME invalidates session cookies earlier than permanent_session_lifetime",
    "user": {
        "login": "ginkoid",
        "id": 26128076,
        "node_id": "MDQ6VXNlcjI2MTI4MDc2",
        "avatar_url": "https://avatars1.githubusercontent.com/u/26128076?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ginkoid",
        "html_url": "https://github.com/ginkoid",
        "followers_url": "https://api.github.com/users/ginkoid/followers",
        "following_url": "https://api.github.com/users/ginkoid/following{/other_user}",
        "gists_url": "https://api.github.com/users/ginkoid/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ginkoid/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ginkoid/subscriptions",
        "organizations_url": "https://api.github.com/users/ginkoid/orgs",
        "repos_url": "https://api.github.com/users/ginkoid/repos",
        "events_url": "https://api.github.com/users/ginkoid/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ginkoid/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2017-08-15T14:16:34Z",
    "updated_at": "2017-08-15T14:36:14Z",
    "closed_at": "2017-08-15T14:24:19Z",
    "author_association": "NONE",
    "body": "### Expected Behavior\r\nNormally, if you want a permanent cookie, you can set\r\n```python\r\nsession.permanent = True\r\napp.permanent_session_lifetime = datetime.timedelta(weeks=156)  # 3 years\r\n```\r\nHowever, if you also change `SESSION_COOKIE_NAME` in app.config to something else, this should only change the name of the cookie, however, it also makes the session cookies invalidate after a browser session, not the `permanent_session_lifetime`.\r\n\r\nDemo:\r\n```python\r\nimport datetime\r\nfrom flask import Flask, session\r\n\r\napp = Flask(__name__)\r\napp.secret_key = 'super_secret'\r\n\r\n@app.before_request\r\ndef settings():\r\n    app.config['PERMANENT_SESSION_LIFETIME'] = datetime.timedelta(weeks=156)  # 3 years\r\n    # app.config['SESSION_COOKIE_NAME'] = 'other_name'\r\n\r\n@app.route('/')\r\ndef index():\r\n    if 'test' in session:\r\n        return 'You have a cookie'\r\n    return 'You do not have a cookie'\r\n    \r\n@app.route('/get_cookie')\r\ndef get_cookie():\r\n    session['test'] = 'testcookie'\r\n    return 'Cookie sent'\r\n\r\napp.run()\r\n```\r\n\r\n### Actual Behavior\r\n\r\nIf you run the above script, and visit `/get_cookie`, then visit `/`, notice that it works as expected. You can also close and reopen the browser, and the cookie stays, as expected, because of the `permanent_session_lifetime`.\r\n\r\nHowever, if you uncomment the bit that sets the `SESSION_COOKIE_NAME`, then re-run the script, and follow the above steps again (including reopening the browser), you will notice that the session is invalidated upon reopening the browser.\r\n\r\n### Environment\r\n\r\n* Python version: 3.5.2\r\n* Flask version: 0.12.2\r\n* Werkzeug version: 0.12.2\r\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/322482028",
            "html_url": "https://github.com/pallets/flask/issues/2448#issuecomment-322482028",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2448",
            "id": 322482028,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMyMjQ4MjAyOA==",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-08-15T14:24:19Z",
            "updated_at": "2017-08-15T14:24:19Z",
            "author_association": "MEMBER",
            "body": "If you change that setting, Flask won't use the old cookie anymore. How could it? It can't know what it was called. This is expected behavior. Don't change the setting halfway through and expect everything to still work."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/322482124",
            "html_url": "https://github.com/pallets/flask/issues/2448#issuecomment-322482124",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2448",
            "id": 322482124,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMyMjQ4MjEyNA==",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-08-15T14:24:35Z",
            "updated_at": "2017-08-15T14:24:35Z",
            "author_association": "MEMBER",
            "body": "Also don't modify your config in a request handler..."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/322483562",
            "html_url": "https://github.com/pallets/flask/issues/2448#issuecomment-322483562",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2448",
            "id": 322483562,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMyMjQ4MzU2Mg==",
            "user": {
                "login": "ginkoid",
                "id": 26128076,
                "node_id": "MDQ6VXNlcjI2MTI4MDc2",
                "avatar_url": "https://avatars1.githubusercontent.com/u/26128076?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ginkoid",
                "html_url": "https://github.com/ginkoid",
                "followers_url": "https://api.github.com/users/ginkoid/followers",
                "following_url": "https://api.github.com/users/ginkoid/following{/other_user}",
                "gists_url": "https://api.github.com/users/ginkoid/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ginkoid/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ginkoid/subscriptions",
                "organizations_url": "https://api.github.com/users/ginkoid/orgs",
                "repos_url": "https://api.github.com/users/ginkoid/repos",
                "events_url": "https://api.github.com/users/ginkoid/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ginkoid/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-08-15T14:28:41Z",
            "updated_at": "2017-08-15T14:28:41Z",
            "author_association": "NONE",
            "body": "Please test this fully.\r\n\r\nI am not expecting flask to recognise a cookie that it doesn't know the name of.\r\nI tested this the exact same way both times, and the cookie name **does** make the cookie be invalidated after the browser restarts."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/322484469",
            "html_url": "https://github.com/pallets/flask/issues/2448#issuecomment-322484469",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2448",
            "id": 322484469,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMyMjQ4NDQ2OQ==",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-08-15T14:30:56Z",
            "updated_at": "2017-08-15T14:30:56Z",
            "author_association": "MEMBER",
            "body": "You are not supposed to change ANYTHING in `app.config` during requests (it wouldn't work nicely with more than one process for example).\r\n\r\nDoes it work fine when you set the cookie name earlier? Without checking the code (so I may be wrong): `before_request` is probably too late to change anything related to the session config."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/322485238",
            "html_url": "https://github.com/pallets/flask/issues/2448#issuecomment-322485238",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2448",
            "id": 322485238,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMyMjQ4NTIzOA==",
            "user": {
                "login": "ginkoid",
                "id": 26128076,
                "node_id": "MDQ6VXNlcjI2MTI4MDc2",
                "avatar_url": "https://avatars1.githubusercontent.com/u/26128076?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ginkoid",
                "html_url": "https://github.com/ginkoid",
                "followers_url": "https://api.github.com/users/ginkoid/followers",
                "following_url": "https://api.github.com/users/ginkoid/following{/other_user}",
                "gists_url": "https://api.github.com/users/ginkoid/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ginkoid/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ginkoid/subscriptions",
                "organizations_url": "https://api.github.com/users/ginkoid/orgs",
                "repos_url": "https://api.github.com/users/ginkoid/repos",
                "events_url": "https://api.github.com/users/ginkoid/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ginkoid/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-08-15T14:32:55Z",
            "updated_at": "2017-08-15T14:32:55Z",
            "author_association": "NONE",
            "body": "Seems like that was it...oops"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/322486396",
            "html_url": "https://github.com/pallets/flask/issues/2448#issuecomment-322486396",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2448",
            "id": 322486396,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMyMjQ4NjM5Ng==",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-08-15T14:36:14Z",
            "updated_at": "2017-08-15T14:36:14Z",
            "author_association": "MEMBER",
            "body": "@Ginkoid I see, sorry I misread your report. Still the advice from @ThiefMaster probably applies."
        }
    ]
}