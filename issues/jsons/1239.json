{
    "url": "https://api.github.com/repos/pallets/flask/issues/1239",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/1239/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/1239/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/1239/events",
    "html_url": "https://github.com/pallets/flask/issues/1239",
    "id": 47785876,
    "node_id": "MDU6SXNzdWU0Nzc4NTg3Ng==",
    "number": 1239,
    "title": "Multiple Ports in URL when using redirect behind BrowserSync",
    "user": {
        "login": "danieldiekmeier",
        "id": 2098462,
        "node_id": "MDQ6VXNlcjIwOTg0NjI=",
        "avatar_url": "https://avatars2.githubusercontent.com/u/2098462?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danieldiekmeier",
        "html_url": "https://github.com/danieldiekmeier",
        "followers_url": "https://api.github.com/users/danieldiekmeier/followers",
        "following_url": "https://api.github.com/users/danieldiekmeier/following{/other_user}",
        "gists_url": "https://api.github.com/users/danieldiekmeier/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/danieldiekmeier/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/danieldiekmeier/subscriptions",
        "organizations_url": "https://api.github.com/users/danieldiekmeier/orgs",
        "repos_url": "https://api.github.com/users/danieldiekmeier/repos",
        "events_url": "https://api.github.com/users/danieldiekmeier/events{/privacy}",
        "received_events_url": "https://api.github.com/users/danieldiekmeier/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 5,
    "created_at": "2014-11-05T00:37:30Z",
    "updated_at": "2014-11-07T20:01:45Z",
    "closed_at": "2014-11-07T20:01:45Z",
    "author_association": "NONE",
    "body": "Hey,\n\nthis may be a bit specific, but I hope there is a way to solve this, and I'm just unable to work it out.\n\nSo, my setup is like this:\n- My Flask-App is running on `127.0.0.1:5000`, `SERVER_NAME` is set to `blickpunkt.dev:5000`, `blickpunkt.dev` is an entry in my hosts-File, it just translates to `127.0.0.1`\n- I'm running [BrowserSync](http://www.browsersync.io) with the proxy setting set to `blickpunkt.dev:5000`, and I can open the browser to `localhost:3000 to` see everything.\n\nThis mostly works. I can see the site, I can click on most links.\n\nExcept: When I'm using `redirect(url_for('some_view'))`, it redirects me to `localhost:3000:5000/some_view`. This is absurd. I looked into the response I was getting from the redirect, but the port isn't even in there. It seems to me that it should just redirect to `/some_view`, but it somehow puts the port the app is running on in there. If I remove the second port from the url, it works again, of course.\n\nCan I fix this behaviour? How can I fix it?\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/61765983",
            "html_url": "https://github.com/pallets/flask/issues/1239#issuecomment-61765983",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1239",
            "id": 61765983,
            "node_id": "MDEyOklzc3VlQ29tbWVudDYxNzY1OTgz",
            "user": {
                "login": "DasIch",
                "id": 182316,
                "node_id": "MDQ6VXNlcjE4MjMxNg==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/182316?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/DasIch",
                "html_url": "https://github.com/DasIch",
                "followers_url": "https://api.github.com/users/DasIch/followers",
                "following_url": "https://api.github.com/users/DasIch/following{/other_user}",
                "gists_url": "https://api.github.com/users/DasIch/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/DasIch/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/DasIch/subscriptions",
                "organizations_url": "https://api.github.com/users/DasIch/orgs",
                "repos_url": "https://api.github.com/users/DasIch/repos",
                "events_url": "https://api.github.com/users/DasIch/events{/privacy}",
                "received_events_url": "https://api.github.com/users/DasIch/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-11-05T06:38:32Z",
            "updated_at": "2014-11-05T06:38:32Z",
            "author_association": "CONTRIBUTOR",
            "body": "Can you post the contents of request.environ?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/61793003",
            "html_url": "https://github.com/pallets/flask/issues/1239#issuecomment-61793003",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1239",
            "id": 61793003,
            "node_id": "MDEyOklzc3VlQ29tbWVudDYxNzkzMDAz",
            "user": {
                "login": "danieldiekmeier",
                "id": 2098462,
                "node_id": "MDQ6VXNlcjIwOTg0NjI=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/2098462?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/danieldiekmeier",
                "html_url": "https://github.com/danieldiekmeier",
                "followers_url": "https://api.github.com/users/danieldiekmeier/followers",
                "following_url": "https://api.github.com/users/danieldiekmeier/following{/other_user}",
                "gists_url": "https://api.github.com/users/danieldiekmeier/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/danieldiekmeier/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/danieldiekmeier/subscriptions",
                "organizations_url": "https://api.github.com/users/danieldiekmeier/orgs",
                "repos_url": "https://api.github.com/users/danieldiekmeier/repos",
                "events_url": "https://api.github.com/users/danieldiekmeier/events{/privacy}",
                "received_events_url": "https://api.github.com/users/danieldiekmeier/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-11-05T11:18:54Z",
            "updated_at": "2014-11-05T11:20:38Z",
            "author_association": "NONE",
            "body": "Yes:\n\n```\n{'CONTENT_LENGTH': '',\n 'CONTENT_TYPE': '',\n 'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n 'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n 'HTTP_ACCEPT_LANGUAGE': 'en-us',\n 'HTTP_CACHE_CONTROL': 'max-age=0',\n 'HTTP_CONNECTION': 'keep-alive',\n 'HTTP_COOKIE': 'session=.eJw1zDEOgCAMAMC_dHYQSCHwGQKlEIOiQZiMf3fyHnAP-Iv7ERq3AW70yQvQ3bMfZ-UGDpS0QSYkRhQYrSaRExsdiFBLSRrXEJNSKyywn6Vw8lv7o3lz91cFJ1CY9wNf4iIT.BzuYUg.YWhUWfP5mpXcbKeHpbKjnaMLQ-k',\n 'HTTP_HOST': 'blickpunkt.dev:5000',\n 'HTTP_REFERER': 'http://blickpunkt.dev:5000/shop/blimu/blimu1404',\n 'HTTP_USER_AGENT': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10) '\n                    'AppleWebKit/600.1.25 (KHTML, like Gecko) Version/8.0 '\n                    'Safari/600.1.25',\n 'PATH_INFO': '/shop/neueste-ausgabe',\n 'QUERY_STRING': '',\n 'REMOTE_ADDR': '127.0.0.1',\n 'REMOTE_PORT': 61470,\n 'REQUEST_METHOD': 'GET',\n 'SCRIPT_NAME': '',\n 'SERVER_NAME': '127.0.0.1',\n 'SERVER_PORT': '5000',\n 'SERVER_PROTOCOL': 'HTTP/1.1',\n 'SERVER_SOFTWARE': 'Werkzeug/0.9.6',\n 'werkzeug.proxy_fix.orig_http_host': 'blickpunkt.dev:5000',\n 'werkzeug.proxy_fix.orig_remote_addr': '127.0.0.1',\n 'werkzeug.proxy_fix.orig_wsgi_url_scheme': 'http',\n 'werkzeug.request': <Request 'http://blickpunkt.dev:5000/shop/neueste-ausgabe' [GET]>,\n 'werkzeug.server.shutdown': <function WSGIRequestHandler.make_environ.<locals>.shutdown_server at 0x105076488>,\n 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='UTF-8'>,\n 'wsgi.input': <_io.BufferedReader name=6>,\n 'wsgi.multiprocess': False,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 0)}\n```\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/61845129",
            "html_url": "https://github.com/pallets/flask/issues/1239#issuecomment-61845129",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1239",
            "id": 61845129,
            "node_id": "MDEyOklzc3VlQ29tbWVudDYxODQ1MTI5",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-11-05T17:15:39Z",
            "updated_at": "2014-11-05T17:15:39Z",
            "author_association": "MEMBER",
            "body": "Could you try this without ProxyFix? I suspect BrowserSync of trying to insert the proper port into the response.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/61892183",
            "html_url": "https://github.com/pallets/flask/issues/1239#issuecomment-61892183",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1239",
            "id": 61892183,
            "node_id": "MDEyOklzc3VlQ29tbWVudDYxODkyMTgz",
            "user": {
                "login": "danieldiekmeier",
                "id": 2098462,
                "node_id": "MDQ6VXNlcjIwOTg0NjI=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/2098462?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/danieldiekmeier",
                "html_url": "https://github.com/danieldiekmeier",
                "followers_url": "https://api.github.com/users/danieldiekmeier/followers",
                "following_url": "https://api.github.com/users/danieldiekmeier/following{/other_user}",
                "gists_url": "https://api.github.com/users/danieldiekmeier/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/danieldiekmeier/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/danieldiekmeier/subscriptions",
                "organizations_url": "https://api.github.com/users/danieldiekmeier/orgs",
                "repos_url": "https://api.github.com/users/danieldiekmeier/repos",
                "events_url": "https://api.github.com/users/danieldiekmeier/events{/privacy}",
                "received_events_url": "https://api.github.com/users/danieldiekmeier/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-11-05T22:20:52Z",
            "updated_at": "2014-11-05T22:20:52Z",
            "author_association": "NONE",
            "body": "I disabled it, but the error persists. This is the output of request.environ now:\n\n```\n{'CONTENT_LENGTH': '',\n 'CONTENT_TYPE': '',\n 'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n 'HTTP_ACCEPT_ENCODING': 'identity',\n 'HTTP_ACCEPT_LANGUAGE': 'en-us',\n 'HTTP_AGENT': 'false',\n 'HTTP_CONNECTION': 'close',\n 'HTTP_COOKIE': '__gads=ID=9924f031cb8b9433:T=1415143621:S=ALNI_MYxR7sGYg-ocHD-U8W3Zf9GIriXvg; '\n                '__utma=111872281.451432634.1414796725.1414799822.1414802858.3; '\n                '__utmz=111872281.1414796725.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)',\n 'HTTP_HOST': 'blickpunkt.dev:5000',\n 'HTTP_REFERER': 'http://localhost:3000/',\n 'HTTP_USER_AGENT': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10) '\n                    'AppleWebKit/600.1.25 (KHTML, like Gecko) Version/8.0 '\n                    'Safari/600.1.25',\n 'PATH_INFO': '/shop/neueste-ausgabe',\n 'QUERY_STRING': '',\n 'REMOTE_ADDR': '127.0.0.1',\n 'REMOTE_PORT': 57595,\n 'REQUEST_METHOD': 'GET',\n 'SCRIPT_NAME': '',\n 'SERVER_NAME': '127.0.0.1',\n 'SERVER_PORT': '5000',\n 'SERVER_PROTOCOL': 'HTTP/1.1',\n 'SERVER_SOFTWARE': 'Werkzeug/0.9.6',\n 'werkzeug.request': <Request 'http://blickpunkt.dev:5000/shop/neueste-ausgabe' [GET]>,\n 'werkzeug.server.shutdown': <function WSGIRequestHandler.make_environ.<locals>.shutdown_server at 0x1060bf598>,\n 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='UTF-8'>,\n 'wsgi.input': <_io.BufferedReader name=4>,\n 'wsgi.multiprocess': False,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 0)}\n```\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/62203375",
            "html_url": "https://github.com/pallets/flask/issues/1239#issuecomment-62203375",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1239",
            "id": 62203375,
            "node_id": "MDEyOklzc3VlQ29tbWVudDYyMjAzMzc1",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-11-07T20:01:43Z",
            "updated_at": "2014-11-07T20:01:43Z",
            "author_association": "MEMBER",
            "body": "I can reproduce this locally, and it's definetly a bug in BrowserSync.\n- Printing response.headers['Location'] in the redirecting endpoint gives the value `/foo`. If accessing the Flask server directly via the browser (on port 5000), Firebug reports the absolute value `http://127.0.0.1:5000/foo`.\n- When accessing the site through BrowserSync, Flask still prints `/foo` to the terminal, but Firebug reports `http://localhost:3000:5000/foo` as location header.\n\nI think you should reraise this on https://github.com/shakyShane/browser-sync/issues. It seems like BrowserSync does a sub-par job at parsing URLs, or its components, see https://github.com/shakyShane/browser-sync/issues/166\n"
        }
    ]
}