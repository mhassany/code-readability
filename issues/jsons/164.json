{
    "url": "https://api.github.com/repos/pallets/flask/issues/164",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/164/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/164/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/164/events",
    "html_url": "https://github.com/pallets/flask/issues/164",
    "id": 574126,
    "node_id": "MDU6SXNzdWU1NzQxMjY=",
    "number": 164,
    "title": "Wrong \"Date\" http header, breaks clientside caching for static files, lots of 304 responses",
    "user": {
        "login": "ThomasWaldmann",
        "id": 356103,
        "node_id": "MDQ6VXNlcjM1NjEwMw==",
        "avatar_url": "https://avatars0.githubusercontent.com/u/356103?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ThomasWaldmann",
        "html_url": "https://github.com/ThomasWaldmann",
        "followers_url": "https://api.github.com/users/ThomasWaldmann/followers",
        "following_url": "https://api.github.com/users/ThomasWaldmann/following{/other_user}",
        "gists_url": "https://api.github.com/users/ThomasWaldmann/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ThomasWaldmann/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ThomasWaldmann/subscriptions",
        "organizations_url": "https://api.github.com/users/ThomasWaldmann/orgs",
        "repos_url": "https://api.github.com/users/ThomasWaldmann/repos",
        "events_url": "https://api.github.com/users/ThomasWaldmann/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ThomasWaldmann/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2011-02-04T03:00:55Z",
    "updated_at": "2011-02-05T17:51:43Z",
    "closed_at": "2011-02-06T00:41:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "quoting from flask.helpers.send_file:\n    # if we know the file modification date, we can store it as the\n    # current time to better support conditional requests.  Werkzeug\n    # as of 0.6.1 will override this value however in the conditional\n    # response with the current time.  This will be fixed in Werkzeug\n    # with a new release, however many WSGI servers will still emit\n    # a separate date header.\n    if mtime is not None:\n        rv.date = int(mtime)\n\nThese 2 lines break clientside caching because they emit a wrong Date header.\n\nAs by rfc 2616, the Date header should tell when the Response originated from\nthe server (== current server time), but this code sets it to the mtime of\nthe static file (== some time in the past).\n\nThis obviously at least breaks Firefox 3.6, because it'll always consider its\ncache entry as stale then (even when the Expires date and max-age would\nnormally not lead to staleness).\n\nWrong behaviour:\n1st request -> 200, all further requests (directly afterwards) -> 304\n\nCorrect behaviour (wrong code removed):\n1st request -> 200, \n(NO further requests happening until Expires is reached), \nnext request (after expiry) -> 304\n\nWrong behaviour was introduced after 0.6.2 due to unknown reasons by:\n\nhttps://github.com/mitsuhiko/flask/commit/85ff63c32e7237280bff3293481a371fb3da180c\n\nI don't see how this shall \"better support conditional requests\", it rather\nlooks like breaking caching and doing lots of unneeded requests.\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/741870",
            "html_url": "https://github.com/pallets/flask/issues/164#issuecomment-741870",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/164",
            "id": 741870,
            "node_id": "MDEyOklzc3VlQ29tbWVudDc0MTg3MA==",
            "user": {
                "login": "mitsuhiko",
                "id": 7396,
                "node_id": "MDQ6VXNlcjczOTY=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/7396?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mitsuhiko",
                "html_url": "https://github.com/mitsuhiko",
                "followers_url": "https://api.github.com/users/mitsuhiko/followers",
                "following_url": "https://api.github.com/users/mitsuhiko/following{/other_user}",
                "gists_url": "https://api.github.com/users/mitsuhiko/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mitsuhiko/subscriptions",
                "organizations_url": "https://api.github.com/users/mitsuhiko/orgs",
                "repos_url": "https://api.github.com/users/mitsuhiko/repos",
                "events_url": "https://api.github.com/users/mitsuhiko/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mitsuhiko/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2011-02-05T16:41:07Z",
            "updated_at": "2011-02-05T16:41:07Z",
            "author_association": "MEMBER",
            "body": "Do not use Date, use Last-Modified. This closed by 0bf777ed81d5296fb722931d35e5db4333e3de39\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/742002",
            "html_url": "https://github.com/pallets/flask/issues/164#issuecomment-742002",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/164",
            "id": 742002,
            "node_id": "MDEyOklzc3VlQ29tbWVudDc0MjAwMg==",
            "user": {
                "login": "ThomasWaldmann",
                "id": 356103,
                "node_id": "MDQ6VXNlcjM1NjEwMw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/356103?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThomasWaldmann",
                "html_url": "https://github.com/ThomasWaldmann",
                "followers_url": "https://api.github.com/users/ThomasWaldmann/followers",
                "following_url": "https://api.github.com/users/ThomasWaldmann/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThomasWaldmann/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThomasWaldmann/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThomasWaldmann/subscriptions",
                "organizations_url": "https://api.github.com/users/ThomasWaldmann/orgs",
                "repos_url": "https://api.github.com/users/ThomasWaldmann/repos",
                "events_url": "https://api.github.com/users/ThomasWaldmann/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThomasWaldmann/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2011-02-05T17:51:43Z",
            "updated_at": "2011-02-05T17:51:43Z",
            "author_association": "CONTRIBUTOR",
            "body": "Thanks for fixing.\n\nNote:\nI was referring to \"flask after 0.6.2\", this is wrong as I was confusing versions with werkzeug. Just see the given flask changeset URL.\n\nWhy I was confusing this is because the issue gets visible only with werkzeug >0.6.2 because it does not overwrite that date value any more with the current server time, but emits the date as given by flask.\n"
        }
    ]
}