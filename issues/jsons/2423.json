{
    "url": "https://api.github.com/repos/pallets/flask/issues/2423",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2423/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2423/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2423/events",
    "html_url": "https://github.com/pallets/flask/issues/2423",
    "id": 243960422,
    "node_id": "MDU6SXNzdWUyNDM5NjA0MjI=",
    "number": 2423,
    "title": "Reloader fails to reload after SyntaxError when the app is in an __init__.py file",
    "user": {
        "login": "segevfiner",
        "id": 24731903,
        "node_id": "MDQ6VXNlcjI0NzMxOTAz",
        "avatar_url": "https://avatars0.githubusercontent.com/u/24731903?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/segevfiner",
        "html_url": "https://github.com/segevfiner",
        "followers_url": "https://api.github.com/users/segevfiner/followers",
        "following_url": "https://api.github.com/users/segevfiner/following{/other_user}",
        "gists_url": "https://api.github.com/users/segevfiner/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/segevfiner/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/segevfiner/subscriptions",
        "organizations_url": "https://api.github.com/users/segevfiner/orgs",
        "repos_url": "https://api.github.com/users/segevfiner/repos",
        "events_url": "https://api.github.com/users/segevfiner/events{/privacy}",
        "received_events_url": "https://api.github.com/users/segevfiner/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 5,
    "created_at": "2017-07-19T08:23:42Z",
    "updated_at": "2018-01-09T16:29:05Z",
    "closed_at": "2018-01-09T16:29:05Z",
    "author_association": "NONE",
    "body": "### Expected Behavior\r\n\r\nThe reloader should work correctly even for an app in a package's `__init__.py` file.\r\n\r\nIn `hello/__init__.py`:\r\n```python\r\nfrom flask import Flask\r\napp = Flask(__name__)\r\n\r\n@app.route('/')\r\ndef hello_world():\r\n    return 'Hello, World!'\r\n```\r\n\r\n```cmd\r\nset FLASK_APP=hello\r\nset FLASK_DEBUG=1\r\nflask run\r\n```\r\n\r\nThan edit `__init__.py` and introduce a syntax error.\r\n\r\n### Actual Behavior\r\n\r\nI get the SyntaxError the first time I try to browse and afterwards get:\r\n\r\n```pytb\r\nTraceback (most recent call last):\r\n  File \"flask\\cli.py\", line 48, in find_best_app\r\n    'using a factory function.' % modules.__name__)\r\nNoAppException: Failed to find application in module \"hello\". Are you sure it contains a Flask application? Maybe you wrapped it in WSGI middleware or you are using a factory function.\r\n```\r\n\r\n### Cause\r\n\r\nThis is caused by weird CPython behavior which might be a bug:\r\n```py\r\n>>> __import__('syntax_error')\r\n...\r\nSyntaxError: ...\r\n>>> a = __import__('syntax_error')  # woot it works?!\r\n>>> a.__file__\r\n'<path to the directory containing __init__.py>'  # Instead of path to __init__.py\r\n```\r\n\r\nAfter the `SyntaxError` in the app, the Wekzeug reloader won't know about the `__init__.py` file any more since it iterates `sys.modules` and the entry there contains the path to the directory instead of the path to the `__init__.py` file, and Flask will call `__import__` repeatedly but will get the weird empty module and will fail to find an app in it, leading to the described exception.\r\n\r\n### Environment\r\n\r\n* Python version: 2.7.13\r\n* Flask version: 0.12.2\r\n* Werkzeug version: 0.12.2\r\n\r\nNot sure if this happens in Python 3.",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/316365611",
            "html_url": "https://github.com/pallets/flask/issues/2423#issuecomment-316365611",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2423",
            "id": 316365611,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjM2NTYxMQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-07-19T12:10:26Z",
            "updated_at": "2017-07-19T12:10:26Z",
            "author_association": "MEMBER",
            "body": "Does this happen with current master?"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/316369899",
            "html_url": "https://github.com/pallets/flask/issues/2423#issuecomment-316369899",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2423",
            "id": 316369899,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjM2OTg5OQ==",
            "user": {
                "login": "segevfiner",
                "id": 24731903,
                "node_id": "MDQ6VXNlcjI0NzMxOTAz",
                "avatar_url": "https://avatars0.githubusercontent.com/u/24731903?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/segevfiner",
                "html_url": "https://github.com/segevfiner",
                "followers_url": "https://api.github.com/users/segevfiner/followers",
                "following_url": "https://api.github.com/users/segevfiner/following{/other_user}",
                "gists_url": "https://api.github.com/users/segevfiner/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/segevfiner/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/segevfiner/subscriptions",
                "organizations_url": "https://api.github.com/users/segevfiner/orgs",
                "repos_url": "https://api.github.com/users/segevfiner/repos",
                "events_url": "https://api.github.com/users/segevfiner/events{/privacy}",
                "received_events_url": "https://api.github.com/users/segevfiner/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-07-19T12:28:08Z",
            "updated_at": "2017-07-19T12:28:24Z",
            "author_association": "NONE",
            "body": "> Does this happen with current master?\r\n\r\nYep."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/316370593",
            "html_url": "https://github.com/pallets/flask/issues/2423#issuecomment-316370593",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2423",
            "id": 316370593,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjM3MDU5Mw==",
            "user": {
                "login": "ghost",
                "id": 10137,
                "node_id": "MDQ6VXNlcjEwMTM3",
                "avatar_url": "https://avatars3.githubusercontent.com/u/10137?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ghost",
                "html_url": "https://github.com/ghost",
                "followers_url": "https://api.github.com/users/ghost/followers",
                "following_url": "https://api.github.com/users/ghost/following{/other_user}",
                "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
                "organizations_url": "https://api.github.com/users/ghost/orgs",
                "repos_url": "https://api.github.com/users/ghost/repos",
                "events_url": "https://api.github.com/users/ghost/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ghost/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-07-19T12:31:06Z",
            "updated_at": "2017-07-19T12:33:03Z",
            "author_association": "NONE",
            "body": "I've been able to verify this behaviour with current master and Pythons 2.7 and 3.6.  On first request, `flask` correctly identifies and returns the `SyntaxError`; on subsequent reloads, a `NoAppException` is returned instead.  Presumably, as OP states, this is due to import module caching.\r\n\r\nOn Python3.6 no `SyntaxError` is ever returned; `flask` immediately replies with a `NoAppException`, but the error message is different:\r\n\r\n```\r\nTraceback (most recent call last):\r\n# ... File this, File that, etc ...\r\n    'Could not import \"{name}\".\"'.format(name=module_name)\r\nflask.cli.NoAppException: Could not import \"hello\".\"\r\n```\r\n\r\nI'm assuming the desired behaviour is for Flask to forward errors that arise during importation rather than fail with `NoAppException`?"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/356065182",
            "html_url": "https://github.com/pallets/flask/issues/2423#issuecomment-356065182",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2423",
            "id": 356065182,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM1NjA2NTE4Mg==",
            "user": {
                "login": "segevfiner",
                "id": 24731903,
                "node_id": "MDQ6VXNlcjI0NzMxOTAz",
                "avatar_url": "https://avatars0.githubusercontent.com/u/24731903?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/segevfiner",
                "html_url": "https://github.com/segevfiner",
                "followers_url": "https://api.github.com/users/segevfiner/followers",
                "following_url": "https://api.github.com/users/segevfiner/following{/other_user}",
                "gists_url": "https://api.github.com/users/segevfiner/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/segevfiner/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/segevfiner/subscriptions",
                "organizations_url": "https://api.github.com/users/segevfiner/orgs",
                "repos_url": "https://api.github.com/users/segevfiner/repos",
                "events_url": "https://api.github.com/users/segevfiner/events{/privacy}",
                "received_events_url": "https://api.github.com/users/segevfiner/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-01-08T19:11:26Z",
            "updated_at": "2018-01-08T19:11:26Z",
            "author_association": "NONE",
            "body": "A fix was released for the reloader failing in Werkzeug. The `NoAppException` on subsequent requests remains though. But the reloader will continue reloading on changes to the __init__.py files."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/356312351",
            "html_url": "https://github.com/pallets/flask/issues/2423#issuecomment-356312351",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2423",
            "id": 356312351,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM1NjMxMjM1MQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-01-09T15:13:26Z",
            "updated_at": "2018-01-09T15:17:14Z",
            "author_association": "MEMBER",
            "body": "I can't reproduce this on Python 2.7 or 3.6, Flask 0.12 or master. I tried starting with valid syntax then editing in an error, and vice versa.\r\n  "
        }
    ]
}