{
    "url": "https://api.github.com/repos/pallets/flask/issues/2236",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2236/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2236/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2236/events",
    "html_url": "https://github.com/pallets/flask/issues/2236",
    "id": 221031646,
    "node_id": "MDU6SXNzdWUyMjEwMzE2NDY=",
    "number": 2236,
    "title": "Bug in url_for() function when you run a Flask application through CGI",
    "user": {
        "login": "koddr",
        "id": 11155743,
        "node_id": "MDQ6VXNlcjExMTU1NzQz",
        "avatar_url": "https://avatars2.githubusercontent.com/u/11155743?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/koddr",
        "html_url": "https://github.com/koddr",
        "followers_url": "https://api.github.com/users/koddr/followers",
        "following_url": "https://api.github.com/users/koddr/following{/other_user}",
        "gists_url": "https://api.github.com/users/koddr/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/koddr/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/koddr/subscriptions",
        "organizations_url": "https://api.github.com/users/koddr/orgs",
        "repos_url": "https://api.github.com/users/koddr/repos",
        "events_url": "https://api.github.com/users/koddr/events{/privacy}",
        "received_events_url": "https://api.github.com/users/koddr/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": true,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 9,
    "created_at": "2017-04-11T17:56:34Z",
    "updated_at": "2017-04-12T03:55:38Z",
    "closed_at": "2017-04-11T18:30:56Z",
    "author_association": "NONE",
    "body": "*Note: I don't observe this bug if I run application on a dedicated server (VDS) with Nginx and uWSGI or Gunicorn, only on an shared hosting (Apache2).*\r\n\r\nMy application structure:\r\n\r\n```bash\r\n\u2514\u2500 site.com\r\n     \u2514\u2500\u2500 public_html\r\n             \u251c\u2500 venv             <-- virtualenv dir with Python 3.4.3\r\n             \u251c\u2500 templates        <-- templates dir with `page.html`\r\n             \u251c\u2500 .htaccess        <-- HTACCESS file\r\n             \u251c\u2500 app.cgi          <-- CGI script\r\n             \u2514\u2500 app.py           <-- Very basic Flask application\r\n```\r\n\r\nFiles ```.htaccess``` and ```app.cgi``` I take from [official docs](http://flask.pocoo.org/docs/0.12/deploying/cgi/), but duplicate for comfort.\r\n\r\nAnd this is **.htaccess** file:\r\n\r\n```bash\r\nRewriteEngine On\r\nRewriteCond %{REQUEST_FILENAME} !-f\r\nRewriteRule ^(.*)$ /home/XXXX/site.com/public_html/app.cgi/$1 [L]\r\n```\r\n\r\nYep, it's **app.cgi**:\r\n\r\n```cgi\r\n#!/home/XXXX/site.com/public_html/venv/bin/python3.4\r\n# -*- coding: utf-8 -*-\r\n\r\nfrom wsgiref.handlers import CGIHandler\r\nfrom app import app\r\n\r\nCGIHandler().run(app)\r\n```\r\n\r\nThis is my **app.py** file:\r\n\r\n```python\r\n# -*- coding: utf-8 -*-\r\n\r\nfrom flask import Flask, render_template, url_for\r\n\r\napp = Flask(__name__)\r\n\r\n@app.route('/<slug>')\r\ndef page(slug):\r\n    return render_template('page.html', slug=slug)\r\n\r\nif __name__ == '__main__':\r\n    app.run(host='0.0.0.0')\r\n```\r\n\r\nTemplate is:\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"utf-8\"/>\r\n    <title>{{ slug }}</title>\r\n</head>\r\n<body>\r\n    <a href=\"{{ url_for('page', slug='about') }}\">About page</a>\r\n    <a href=\"{{ url_for('page', slug='contacts') }}\">Contacts page</a>\r\n</body>\r\n</html>\r\n```\r\n\r\nAll working fine, but if I go to ```http://site.com/about``` and click to ```Contacts page``` link \u2014 URL on browser adress is ```http://site.com/app.cgi/contacts``` instead ```http://site.com/contacts``` O_o I delete ```/app.cgi/``` from adress stroke and get the same page!\r\n\r\nWhat is this? Bug in ```url_for()``` functon? Fix it please.",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/293358423",
            "html_url": "https://github.com/pallets/flask/issues/2236#issuecomment-293358423",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2236",
            "id": 293358423,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzM1ODQyMw==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-04-11T18:30:56Z",
            "updated_at": "2017-04-11T18:32:31Z",
            "author_association": "MEMBER",
            "body": "You're missing `ScriptAlias`. Either add the alias in the config, or if you don't have access to that (shared hosting), apply [`CGIRootFix`](http://werkzeug.pocoo.org/docs/0.11/contrib/fixers/#werkzeug.contrib.fixers.CGIRootFix).\r\n\r\n~~~python\r\nfrom werkzeug.fixers import CGIRootFix\r\n\r\napp.wsgi_app = CGIRootFix(app.wsgi_app)\r\n~~~"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/293359470",
            "html_url": "https://github.com/pallets/flask/issues/2236#issuecomment-293359470",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2236",
            "id": 293359470,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzM1OTQ3MA==",
            "user": {
                "login": "koddr",
                "id": 11155743,
                "node_id": "MDQ6VXNlcjExMTU1NzQz",
                "avatar_url": "https://avatars2.githubusercontent.com/u/11155743?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/koddr",
                "html_url": "https://github.com/koddr",
                "followers_url": "https://api.github.com/users/koddr/followers",
                "following_url": "https://api.github.com/users/koddr/following{/other_user}",
                "gists_url": "https://api.github.com/users/koddr/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/koddr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/koddr/subscriptions",
                "organizations_url": "https://api.github.com/users/koddr/orgs",
                "repos_url": "https://api.github.com/users/koddr/repos",
                "events_url": "https://api.github.com/users/koddr/events{/privacy}",
                "received_events_url": "https://api.github.com/users/koddr/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-04-11T18:33:20Z",
            "updated_at": "2017-04-11T18:36:29Z",
            "author_association": "NONE",
            "body": "Oh, many thanks! \ud83d\udc4d "
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/293370869",
            "html_url": "https://github.com/pallets/flask/issues/2236#issuecomment-293370869",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2236",
            "id": 293370869,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzM3MDg2OQ==",
            "user": {
                "login": "koddr",
                "id": 11155743,
                "node_id": "MDQ6VXNlcjExMTU1NzQz",
                "avatar_url": "https://avatars2.githubusercontent.com/u/11155743?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/koddr",
                "html_url": "https://github.com/koddr",
                "followers_url": "https://api.github.com/users/koddr/followers",
                "following_url": "https://api.github.com/users/koddr/following{/other_user}",
                "gists_url": "https://api.github.com/users/koddr/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/koddr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/koddr/subscriptions",
                "organizations_url": "https://api.github.com/users/koddr/orgs",
                "repos_url": "https://api.github.com/users/koddr/repos",
                "events_url": "https://api.github.com/users/koddr/events{/privacy}",
                "received_events_url": "https://api.github.com/users/koddr/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-04-11T19:12:54Z",
            "updated_at": "2017-04-12T03:55:38Z",
            "author_association": "NONE",
            "body": "@davidism hmm.. maybe I wrong, but this is NOT solve this problem!\r\n\r\nThis is my **app.cgi** after install ```Werkzeug```:\r\n\r\n```python\r\n#!/home/XXXX/site.com/public_html/venv/bin/python3.4\r\n# -*- coding: utf-8 -*-\r\n\r\nfrom wsgiref.handlers import CGIHandler\r\nfrom werkzeug.contrib.fixers import CGIRootFix\r\nfrom app import app\r\n\r\nwsgi_app = CGIRootFix(app, app_root='/home/XXXX/site.com/public_html/')\r\n\r\nCGIHandler().run(app)\r\n```\r\n\r\nAnd I still seen ```/app.cgi/``` on every ```url_for()``` link."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/293371085",
            "html_url": "https://github.com/pallets/flask/issues/2236#issuecomment-293371085",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2236",
            "id": 293371085,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzM3MTA4NQ==",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-04-11T19:13:41Z",
            "updated_at": "2017-04-11T19:14:11Z",
            "author_association": "MEMBER",
            "body": "You assign to `wsgi_app` but use `app` in the CGIHandler. You can keep using `app` there if you do this:\r\n\r\n    app.wsgi_app = CHIRootFix(app.wsgi_app, ...)"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/293371980",
            "html_url": "https://github.com/pallets/flask/issues/2236#issuecomment-293371980",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2236",
            "id": 293371980,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzM3MTk4MA==",
            "user": {
                "login": "koddr",
                "id": 11155743,
                "node_id": "MDQ6VXNlcjExMTU1NzQz",
                "avatar_url": "https://avatars2.githubusercontent.com/u/11155743?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/koddr",
                "html_url": "https://github.com/koddr",
                "followers_url": "https://api.github.com/users/koddr/followers",
                "following_url": "https://api.github.com/users/koddr/following{/other_user}",
                "gists_url": "https://api.github.com/users/koddr/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/koddr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/koddr/subscriptions",
                "organizations_url": "https://api.github.com/users/koddr/orgs",
                "repos_url": "https://api.github.com/users/koddr/repos",
                "events_url": "https://api.github.com/users/koddr/events{/privacy}",
                "received_events_url": "https://api.github.com/users/koddr/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-04-11T19:17:07Z",
            "updated_at": "2017-04-11T19:17:07Z",
            "author_association": "NONE",
            "body": "@ThiefMaster yes, my bad. After change to ```CGIHandler().run(wsgi_app)``` I've 404 for all site's urls.\r\n\r\nWhat's wrong now? Can you help me plase?"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/293372310",
            "html_url": "https://github.com/pallets/flask/issues/2236#issuecomment-293372310",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2236",
            "id": 293372310,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzM3MjMxMA==",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-04-11T19:18:31Z",
            "updated_at": "2017-04-11T19:18:31Z",
            "author_association": "MEMBER",
            "body": "I think you should continue this on IRC. This place isn't really intended for support... Not sure how succesful that'll be though, using CGI for WSGI apps is not a very good idea and thus few people do it."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/293375865",
            "html_url": "https://github.com/pallets/flask/issues/2236#issuecomment-293375865",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2236",
            "id": 293375865,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzM3NTg2NQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-04-11T19:32:32Z",
            "updated_at": "2017-04-12T03:55:14Z",
            "author_association": "MEMBER",
            "body": "The root is the *URL root*, not the *filesystem* root. Leave it as `/` (the default)."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/293376463",
            "html_url": "https://github.com/pallets/flask/issues/2236#issuecomment-293376463",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2236",
            "id": 293376463,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzM3NjQ2Mw==",
            "user": {
                "login": "koddr",
                "id": 11155743,
                "node_id": "MDQ6VXNlcjExMTU1NzQz",
                "avatar_url": "https://avatars2.githubusercontent.com/u/11155743?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/koddr",
                "html_url": "https://github.com/koddr",
                "followers_url": "https://api.github.com/users/koddr/followers",
                "following_url": "https://api.github.com/users/koddr/following{/other_user}",
                "gists_url": "https://api.github.com/users/koddr/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/koddr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/koddr/subscriptions",
                "organizations_url": "https://api.github.com/users/koddr/orgs",
                "repos_url": "https://api.github.com/users/koddr/repos",
                "events_url": "https://api.github.com/users/koddr/events{/privacy}",
                "received_events_url": "https://api.github.com/users/koddr/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-04-11T19:34:53Z",
            "updated_at": "2017-04-11T20:27:42Z",
            "author_association": "NONE",
            "body": "All urls still return 404."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/293381893",
            "html_url": "https://github.com/pallets/flask/issues/2236#issuecomment-293381893",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2236",
            "id": 293381893,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzM4MTg5Mw==",
            "user": {
                "login": "koddr",
                "id": 11155743,
                "node_id": "MDQ6VXNlcjExMTU1NzQz",
                "avatar_url": "https://avatars2.githubusercontent.com/u/11155743?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/koddr",
                "html_url": "https://github.com/koddr",
                "followers_url": "https://api.github.com/users/koddr/followers",
                "following_url": "https://api.github.com/users/koddr/following{/other_user}",
                "gists_url": "https://api.github.com/users/koddr/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/koddr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/koddr/subscriptions",
                "organizations_url": "https://api.github.com/users/koddr/orgs",
                "repos_url": "https://api.github.com/users/koddr/repos",
                "events_url": "https://api.github.com/users/koddr/events{/privacy}",
                "received_events_url": "https://api.github.com/users/koddr/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-04-11T19:55:57Z",
            "updated_at": "2017-04-11T20:27:36Z",
            "author_association": "NONE",
            "body": "If I use this CGI file:\r\n\r\n```python\r\n#!/home/XXXX/site.com/public_html/venv/bin/python3.4\r\n# -*- coding: utf-8 -*-\r\n\r\nfrom wsgiref.handlers import CGIHandler\r\nfrom werkzeug.contrib.fixers import CGIRootFix\r\nfrom app import app\r\n\r\napp.wsgi_app = CGIRootFix(app)\r\n\r\nCGIHandler().run(app.wsgi_app)\r\n```\r\n\r\nI've error 500 and logs tell me:\r\n\r\n```bash\r\n[cgi:error] [pid 24626] [client X.X.X.X:45749] AH01215:   File \"/home/XXXX/site.com/public_html/venv/lib/python3.4/site-packages/werkzeug/contrib/fixers.py\", line 59, in __call__\r\n```"
        }
    ]
}