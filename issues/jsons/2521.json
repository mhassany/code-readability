{
    "url": "https://api.github.com/repos/pallets/flask/issues/2521",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2521/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2521/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2521/events",
    "html_url": "https://github.com/pallets/flask/issues/2521",
    "id": 273907010,
    "node_id": "MDU6SXNzdWUyNzM5MDcwMTA=",
    "number": 2521,
    "title": "Flask.create_url_adapter should use SCRIPT_NAME, not APPLICATION_NAME",
    "user": {
        "login": "ghost",
        "id": 10137,
        "node_id": "MDQ6VXNlcjEwMTM3",
        "avatar_url": "https://avatars3.githubusercontent.com/u/10137?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ghost",
        "html_url": "https://github.com/ghost",
        "followers_url": "https://api.github.com/users/ghost/followers",
        "following_url": "https://api.github.com/users/ghost/following{/other_user}",
        "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
        "organizations_url": "https://api.github.com/users/ghost/orgs",
        "repos_url": "https://api.github.com/users/ghost/repos",
        "events_url": "https://api.github.com/users/ghost/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ghost/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 10,
    "created_at": "2017-11-14T19:06:20Z",
    "updated_at": "2017-11-24T23:34:56Z",
    "closed_at": "2017-11-24T23:34:29Z",
    "author_association": "NONE",
    "body": "When [`Flask.create_url_adapter`](https://github.com/pallets/flask/blob/c74f46979a8b8358437bd7f76e478d04248a9c72/flask/app.py#L1923) is supplied with a request, it passes the request on to [`Map.bind_to_environment` from `werkzeug.routing`](https://github.com/pallets/werkzeug/blob/master/werkzeug/routing.py#L1253). This will result in a call to `Map.bind`, where the `script_name` argument is set to the value of the environment variable `SCRIPT_NAME`.\r\n\r\nHowever, when it isn't supplied with a request, `Flask.create_url_adapter` will call `Map.bind` directly. Instead of `SCRIPT_NAME`, it passes the value of `APPLICATION_NAME` via the `script_name` argument. Per #1714, I understand that `APPLICATION_NAME` has nothing to do with routing. I guess this should change, but I'm not sure.\r\n\r\nI discovered this when debugging a tangentially related issue that turned out to be in my own code (I assumed `MapAdapter` could ultimately be used to translate whole URL paths to endpoints, but it seems I have to strip off `SCRIPT_NAME` myself).",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/344367433",
            "html_url": "https://github.com/pallets/flask/issues/2521#issuecomment-344367433",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2521",
            "id": 344367433,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDM2NzQzMw==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-11-14T19:18:46Z",
            "updated_at": "2017-11-14T19:20:18Z",
            "author_association": "MEMBER",
            "body": "The argument is `server_name`, not `script_name`. The script name is not the server name. If `APPLICATION` is none, `bind` will pull out the `SERVER_NAME` from the environ. It sounds like you might just need to apply `ProxyFix`. You'll need to provide a reproducible example of the issue."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/344424337",
            "html_url": "https://github.com/pallets/flask/issues/2521#issuecomment-344424337",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2521",
            "id": 344424337,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDQyNDMzNw==",
            "user": {
                "login": "ghost",
                "id": 10137,
                "node_id": "MDQ6VXNlcjEwMTM3",
                "avatar_url": "https://avatars3.githubusercontent.com/u/10137?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ghost",
                "html_url": "https://github.com/ghost",
                "followers_url": "https://api.github.com/users/ghost/followers",
                "following_url": "https://api.github.com/users/ghost/following{/other_user}",
                "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
                "organizations_url": "https://api.github.com/users/ghost/orgs",
                "repos_url": "https://api.github.com/users/ghost/repos",
                "events_url": "https://api.github.com/users/ghost/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ghost/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-11-14T22:42:10Z",
            "updated_at": "2017-11-14T22:47:33Z",
            "author_association": "NONE",
            "body": "I don't intend to point to this:\r\n\r\n    return self.url_map.bind_to_environ(request.environ,\r\n        server_name=self.config['SERVER_NAME'])\r\n\r\nI want to point to this:\r\n\r\n    return self.url_map.bind(\r\n        self.config['SERVER_NAME'],\r\n        script_name=self.config['APPLICATION_ROOT'],  # <--- this line\r\n        url_scheme=self.config['PREFERRED_URL_SCHEME'])\r\n\r\n*That* line seems wrong.\r\n\r\nAlso, thank you for pointing out that `ProxyFix` exists, but it can't help my original problem."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/344433650",
            "html_url": "https://github.com/pallets/flask/issues/2521#issuecomment-344433650",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2521",
            "id": 344433650,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDQzMzY1MA==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-11-14T23:22:35Z",
            "updated_at": "2017-11-14T23:22:35Z",
            "author_association": "MEMBER",
            "body": "Please provide an example that reproduces the issue you're having."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/346904944",
            "html_url": "https://github.com/pallets/flask/issues/2521#issuecomment-346904944",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2521",
            "id": 346904944,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjkwNDk0NA==",
            "user": {
                "login": "mitsuhiko",
                "id": 7396,
                "node_id": "MDQ6VXNlcjczOTY=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/7396?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mitsuhiko",
                "html_url": "https://github.com/mitsuhiko",
                "followers_url": "https://api.github.com/users/mitsuhiko/followers",
                "following_url": "https://api.github.com/users/mitsuhiko/following{/other_user}",
                "gists_url": "https://api.github.com/users/mitsuhiko/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mitsuhiko/subscriptions",
                "organizations_url": "https://api.github.com/users/mitsuhiko/orgs",
                "repos_url": "https://api.github.com/users/mitsuhiko/repos",
                "events_url": "https://api.github.com/users/mitsuhiko/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mitsuhiko/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-11-24T23:09:07Z",
            "updated_at": "2017-11-24T23:09:07Z",
            "author_association": "MEMBER",
            "body": "@rhymoid the parameter passed is `APPLICATION_ROOT` to the `script_name` parameter. Flask calls it application root because script name is very confusing. So this is intended behavior."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/346905730",
            "html_url": "https://github.com/pallets/flask/issues/2521#issuecomment-346905730",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2521",
            "id": 346905730,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjkwNTczMA==",
            "user": {
                "login": "ghost",
                "id": 10137,
                "node_id": "MDQ6VXNlcjEwMTM3",
                "avatar_url": "https://avatars3.githubusercontent.com/u/10137?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ghost",
                "html_url": "https://github.com/ghost",
                "followers_url": "https://api.github.com/users/ghost/followers",
                "following_url": "https://api.github.com/users/ghost/following{/other_user}",
                "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
                "organizations_url": "https://api.github.com/users/ghost/orgs",
                "repos_url": "https://api.github.com/users/ghost/repos",
                "events_url": "https://api.github.com/users/ghost/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ghost/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-11-24T23:22:50Z",
            "updated_at": "2017-11-24T23:23:53Z",
            "author_association": "NONE",
            "body": "@mitsuhiko Well, @Larivact's [comment in #1714](https://github.com/pallets/flask/issues/1714#issuecomment-287263356) says otherwise. So [does the documentation](https://github.com/Larivact/flask/commit/2995366dde63b8acd1f246bcd5a4cf7d61f0c1fa). Has that changed?"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/346905854",
            "html_url": "https://github.com/pallets/flask/issues/2521#issuecomment-346905854",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2521",
            "id": 346905854,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjkwNTg1NA==",
            "user": {
                "login": "mitsuhiko",
                "id": 7396,
                "node_id": "MDQ6VXNlcjczOTY=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/7396?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mitsuhiko",
                "html_url": "https://github.com/mitsuhiko",
                "followers_url": "https://api.github.com/users/mitsuhiko/followers",
                "following_url": "https://api.github.com/users/mitsuhiko/following{/other_user}",
                "gists_url": "https://api.github.com/users/mitsuhiko/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mitsuhiko/subscriptions",
                "organizations_url": "https://api.github.com/users/mitsuhiko/orgs",
                "repos_url": "https://api.github.com/users/mitsuhiko/repos",
                "events_url": "https://api.github.com/users/mitsuhiko/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mitsuhiko/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-11-24T23:25:13Z",
            "updated_at": "2017-11-24T23:25:13Z",
            "author_association": "MEMBER",
            "body": "The documentation is slightly misleading here. It's *also* used for the session cookie but not exclusively."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/346905908",
            "html_url": "https://github.com/pallets/flask/issues/2521#issuecomment-346905908",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2521",
            "id": 346905908,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjkwNTkwOA==",
            "user": {
                "login": "mitsuhiko",
                "id": 7396,
                "node_id": "MDQ6VXNlcjczOTY=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/7396?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mitsuhiko",
                "html_url": "https://github.com/mitsuhiko",
                "followers_url": "https://api.github.com/users/mitsuhiko/followers",
                "following_url": "https://api.github.com/users/mitsuhiko/following{/other_user}",
                "gists_url": "https://api.github.com/users/mitsuhiko/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mitsuhiko/subscriptions",
                "organizations_url": "https://api.github.com/users/mitsuhiko/orgs",
                "repos_url": "https://api.github.com/users/mitsuhiko/repos",
                "events_url": "https://api.github.com/users/mitsuhiko/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mitsuhiko/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-11-24T23:26:13Z",
            "updated_at": "2017-11-24T23:26:13Z",
            "author_association": "MEMBER",
            "body": "I'm a little bit confused right now what the exact issue is you're running into here."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/346906269",
            "html_url": "https://github.com/pallets/flask/issues/2521#issuecomment-346906269",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2521",
            "id": 346906269,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjkwNjI2OQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-11-24T23:32:53Z",
            "updated_at": "2017-11-24T23:32:53Z",
            "author_association": "MEMBER",
            "body": "That comment is misleading. The dev docs are already updated to explain both places it's used. I agree with mitsuhiko that it's not clear what the issue is at this point."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/346906354",
            "html_url": "https://github.com/pallets/flask/issues/2521#issuecomment-346906354",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2521",
            "id": 346906354,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjkwNjM1NA==",
            "user": {
                "login": "ghost",
                "id": 10137,
                "node_id": "MDQ6VXNlcjEwMTM3",
                "avatar_url": "https://avatars3.githubusercontent.com/u/10137?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ghost",
                "html_url": "https://github.com/ghost",
                "followers_url": "https://api.github.com/users/ghost/followers",
                "following_url": "https://api.github.com/users/ghost/following{/other_user}",
                "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
                "organizations_url": "https://api.github.com/users/ghost/orgs",
                "repos_url": "https://api.github.com/users/ghost/repos",
                "events_url": "https://api.github.com/users/ghost/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ghost/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-11-24T23:34:29Z",
            "updated_at": "2017-11-24T23:34:29Z",
            "author_association": "NONE",
            "body": "Alright, then it's probably nothing but a documentation bug. If the documentation had been accurate, I'd think this would be a bug waiting to happen for cases where `APPLICATION_ROOT` and `SCRIPT_NAME` were not equal."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/346906382",
            "html_url": "https://github.com/pallets/flask/issues/2521#issuecomment-346906382",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2521",
            "id": 346906382,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjkwNjM4Mg==",
            "user": {
                "login": "mitsuhiko",
                "id": 7396,
                "node_id": "MDQ6VXNlcjczOTY=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/7396?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mitsuhiko",
                "html_url": "https://github.com/mitsuhiko",
                "followers_url": "https://api.github.com/users/mitsuhiko/followers",
                "following_url": "https://api.github.com/users/mitsuhiko/following{/other_user}",
                "gists_url": "https://api.github.com/users/mitsuhiko/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mitsuhiko/subscriptions",
                "organizations_url": "https://api.github.com/users/mitsuhiko/orgs",
                "repos_url": "https://api.github.com/users/mitsuhiko/repos",
                "events_url": "https://api.github.com/users/mitsuhiko/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mitsuhiko/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-11-24T23:34:56Z",
            "updated_at": "2017-11-24T23:34:56Z",
            "author_association": "MEMBER",
            "body": "@davidism for what it's worth i would not be opposed to a mode where we forcefully override the wsgi server for prefixes, server name, ssl etc. I am in fact running myself a wsgi middleware usually that forces stuff to be consistent."
        }
    ]
}