{
    "url": "https://api.github.com/repos/pallets/flask/issues/2700",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2700/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2700/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2700/events",
    "html_url": "https://github.com/pallets/flask/issues/2700",
    "id": 314007974,
    "node_id": "MDU6SXNzdWUzMTQwMDc5NzQ=",
    "number": 2700,
    "title": "TypeError: is not JSON serializable",
    "user": {
        "login": "santhoshdc1590",
        "id": 30614728,
        "node_id": "MDQ6VXNlcjMwNjE0NzI4",
        "avatar_url": "https://avatars2.githubusercontent.com/u/30614728?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/santhoshdc1590",
        "html_url": "https://github.com/santhoshdc1590",
        "followers_url": "https://api.github.com/users/santhoshdc1590/followers",
        "following_url": "https://api.github.com/users/santhoshdc1590/following{/other_user}",
        "gists_url": "https://api.github.com/users/santhoshdc1590/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/santhoshdc1590/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/santhoshdc1590/subscriptions",
        "organizations_url": "https://api.github.com/users/santhoshdc1590/orgs",
        "repos_url": "https://api.github.com/users/santhoshdc1590/repos",
        "events_url": "https://api.github.com/users/santhoshdc1590/events{/privacy}",
        "received_events_url": "https://api.github.com/users/santhoshdc1590/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 4,
    "created_at": "2018-04-13T08:07:04Z",
    "updated_at": "2018-04-13T12:31:11Z",
    "closed_at": "2018-04-13T11:37:26Z",
    "author_association": "NONE",
    "body": "\r\nCan anyone help fix this issue?\r\n\r\n---\r\n\r\n### Expected Behavior\r\n\r\nI'm running [cloud-function-python](https://github.com/MartinSahlen/cloud-f\u2026) using flask.\r\n\r\nError is being pointed to a file called `flask-handler.py`\r\n\r\nCode of `flask-handler.py` [link](https://github.com/MartinSahlen/cloud-functions-python/blob/master/cloudfn/flask_handler.py)\r\n```python\r\nimport json\r\nimport sys\r\nfrom io import StringIO\r\n\r\nimport six\r\nfrom six.moves.urllib_parse import urlparse\r\nfrom werkzeug.datastructures import Headers\r\n\r\n# from .wsgi_util import wsgi\r\n\r\n\r\ndef handle_http_event(app):\r\n    req_json = json.loads(sys.stdin.read())\r\n    c = urlparse(req_json['url'])\r\n    path = c.path\r\n    if path == '':\r\n        path = '/'\r\n\r\n    body = StringIO(req_json.get('body', u''))\r\n\r\n    req_headers = req_json.get('headers', None)\r\n    h = Headers()\r\n    if req_headers is not None:\r\n        for key, value in six.iteritems(req_headers):\r\n            h.add(key, value)\r\n\r\n    with app.test_request_context(\r\n            path=path,\r\n            input_stream=body,\r\n            method=req_json.get('method', 'GET'),\r\n            headers=h,\r\n            query_string=c.query):\r\n        resp = app.full_dispatch_request()\r\n        body = resp.get_data()\r\n        try:\r\n            body = json.loads(body)\r\n        except:\r\n            pass\r\n\r\n        headers = {}\r\n        for header in resp.headers:\r\n            if header[0] in headers:\r\n                headers[header[0]] += ', ' + header[1]\r\n            else:\r\n                headers[header[0]] = header[1]\r\n\r\n        sys.stdout.write(json.dumps({\r\n            'body': body,\r\n            'status_code': resp.status_code,\r\n            'headers': headers,\r\n        }))\r\n```\r\n\r\n### Actual Behavior\r\n\r\nI'm getting back this error\r\n\r\nline 50 this code resides\r\n\r\n```\r\n        sys.stdout.write(json.dumps({\r\n            'body': body,\r\n            'status_code': resp.status_code,\r\n            'headers': headers,\r\n        }))\r\n```\r\n\r\nI tried `json.dump` instead of `json.dumps` but still I'm getting the same error\r\n\r\n```pytb\r\nFailed to execute script function Traceback (most recent call last): \r\nFile \"function.py\", line 33, in <module> File \"site-packages/cloudfn/flask_handler.py\", \r\nline 50, in handle_http_event File \"json/__init__.py\", \r\nline 230, in dumps File \"json/encoder.py\", \r\nline 198, in encode File \"json/encoder.py\", \r\nline 256, in iterencode File \"json/encoder.py\", \r\nline 179, in default TypeError: b'{\\n \"json\": {\\n \"empID\": \"I123\", \\n \"image\": \"http://image\", \\n \"refID\": \"69\", \\n \"refTable\": \"123456\"\\n }, \\n \"message\": \"Hello world!\"\\n}\\n' is not JSON serializable\r\n```\r\nI even raised an [issue](https://github.com/MartinSahlen/cloud-functions-python/issues/49) in `cloud-function-python` but still haven't received any response.\r\n\r\n### Environment\r\n\r\n* Python version: 3.5\r\n* Flask version: 0.12.2\r\n* flack-Cors: 3.0.3\r\n* Werkzeug version: 0.12\r\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/381059503",
            "html_url": "https://github.com/pallets/flask/issues/2700#issuecomment-381059503",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2700",
            "id": 381059503,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM4MTA1OTUwMw==",
            "user": {
                "login": "RonnyPfannschmidt",
                "id": 156838,
                "node_id": "MDQ6VXNlcjE1NjgzOA==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/156838?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/RonnyPfannschmidt",
                "html_url": "https://github.com/RonnyPfannschmidt",
                "followers_url": "https://api.github.com/users/RonnyPfannschmidt/followers",
                "following_url": "https://api.github.com/users/RonnyPfannschmidt/following{/other_user}",
                "gists_url": "https://api.github.com/users/RonnyPfannschmidt/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/RonnyPfannschmidt/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/RonnyPfannschmidt/subscriptions",
                "organizations_url": "https://api.github.com/users/RonnyPfannschmidt/orgs",
                "repos_url": "https://api.github.com/users/RonnyPfannschmidt/repos",
                "events_url": "https://api.github.com/users/RonnyPfannschmidt/events{/privacy}",
                "received_events_url": "https://api.github.com/users/RonnyPfannschmidt/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-04-13T08:12:12Z",
            "updated_at": "2018-04-13T08:12:12Z",
            "author_association": "CONTRIBUTOR",
            "body": "as far as i can tell flask returns correct data, and that thing just breaks\r\nits  just puzzling why they didn't make a wsgi handler, instead they made a half-assed integration using testing utilities\r\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/381069971",
            "html_url": "https://github.com/pallets/flask/issues/2700#issuecomment-381069971",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2700",
            "id": 381069971,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM4MTA2OTk3MQ==",
            "user": {
                "login": "santhoshdc1590",
                "id": 30614728,
                "node_id": "MDQ6VXNlcjMwNjE0NzI4",
                "avatar_url": "https://avatars2.githubusercontent.com/u/30614728?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/santhoshdc1590",
                "html_url": "https://github.com/santhoshdc1590",
                "followers_url": "https://api.github.com/users/santhoshdc1590/followers",
                "following_url": "https://api.github.com/users/santhoshdc1590/following{/other_user}",
                "gists_url": "https://api.github.com/users/santhoshdc1590/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/santhoshdc1590/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/santhoshdc1590/subscriptions",
                "organizations_url": "https://api.github.com/users/santhoshdc1590/orgs",
                "repos_url": "https://api.github.com/users/santhoshdc1590/repos",
                "events_url": "https://api.github.com/users/santhoshdc1590/events{/privacy}",
                "received_events_url": "https://api.github.com/users/santhoshdc1590/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-04-13T08:52:01Z",
            "updated_at": "2018-04-13T08:52:01Z",
            "author_association": "NONE",
            "body": "@RonnyPfannschmidt From your response, I assume this is unlikely to work in its current state.\r\n\r\nWhere can I actually post this issue as a `bug` then?\r\n\r\nIn the mean time, is there a work around this? "
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/381108951",
            "html_url": "https://github.com/pallets/flask/issues/2700#issuecomment-381108951",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2700",
            "id": 381108951,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM4MTEwODk1MQ==",
            "user": {
                "login": "RonnyPfannschmidt",
                "id": 156838,
                "node_id": "MDQ6VXNlcjE1NjgzOA==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/156838?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/RonnyPfannschmidt",
                "html_url": "https://github.com/RonnyPfannschmidt",
                "followers_url": "https://api.github.com/users/RonnyPfannschmidt/followers",
                "following_url": "https://api.github.com/users/RonnyPfannschmidt/following{/other_user}",
                "gists_url": "https://api.github.com/users/RonnyPfannschmidt/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/RonnyPfannschmidt/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/RonnyPfannschmidt/subscriptions",
                "organizations_url": "https://api.github.com/users/RonnyPfannschmidt/orgs",
                "repos_url": "https://api.github.com/users/RonnyPfannschmidt/repos",
                "events_url": "https://api.github.com/users/RonnyPfannschmidt/events{/privacy}",
                "received_events_url": "https://api.github.com/users/RonnyPfannschmidt/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-04-13T11:37:26Z",
            "updated_at": "2018-04-13T11:37:26Z",
            "author_association": "CONTRIBUTOR",
            "body": "@santhoshdc1590 i'm not aware if a workaround and its not a bug or issue with flask,\r\nits an issue with cloud-function-python"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/381120611",
            "html_url": "https://github.com/pallets/flask/issues/2700#issuecomment-381120611",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2700",
            "id": 381120611,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM4MTEyMDYxMQ==",
            "user": {
                "login": "MartinSahlen",
                "id": 4218596,
                "node_id": "MDQ6VXNlcjQyMTg1OTY=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/4218596?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/MartinSahlen",
                "html_url": "https://github.com/MartinSahlen",
                "followers_url": "https://api.github.com/users/MartinSahlen/followers",
                "following_url": "https://api.github.com/users/MartinSahlen/following{/other_user}",
                "gists_url": "https://api.github.com/users/MartinSahlen/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/MartinSahlen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MartinSahlen/subscriptions",
                "organizations_url": "https://api.github.com/users/MartinSahlen/orgs",
                "repos_url": "https://api.github.com/users/MartinSahlen/repos",
                "events_url": "https://api.github.com/users/MartinSahlen/events{/privacy}",
                "received_events_url": "https://api.github.com/users/MartinSahlen/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-04-13T12:31:11Z",
            "updated_at": "2018-04-13T12:31:11Z",
            "author_association": "NONE",
            "body": "Hey, I\u2019m the author of the library. Happy to hear some more input on how the flask wsgi handler could be properly implemented. This is basically just a one-person spare time project where the status is still very alpha and proof of concept."
        }
    ]
}