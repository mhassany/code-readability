{
    "url": "https://api.github.com/repos/pallets/flask/issues/926",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/926/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/926/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/926/events",
    "html_url": "https://github.com/pallets/flask/issues/926",
    "id": 24179395,
    "node_id": "MDU6SXNzdWUyNDE3OTM5NQ==",
    "number": 926,
    "title": "Number of opened sockets grow unlimited ",
    "user": {
        "login": "ThomasJannaud",
        "id": 6170138,
        "node_id": "MDQ6VXNlcjYxNzAxMzg=",
        "avatar_url": "https://avatars0.githubusercontent.com/u/6170138?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ThomasJannaud",
        "html_url": "https://github.com/ThomasJannaud",
        "followers_url": "https://api.github.com/users/ThomasJannaud/followers",
        "following_url": "https://api.github.com/users/ThomasJannaud/following{/other_user}",
        "gists_url": "https://api.github.com/users/ThomasJannaud/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ThomasJannaud/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ThomasJannaud/subscriptions",
        "organizations_url": "https://api.github.com/users/ThomasJannaud/orgs",
        "repos_url": "https://api.github.com/users/ThomasJannaud/repos",
        "events_url": "https://api.github.com/users/ThomasJannaud/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ThomasJannaud/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 7,
    "created_at": "2013-12-12T13:53:24Z",
    "updated_at": "2013-12-13T14:32:23Z",
    "closed_at": "2013-12-13T14:32:23Z",
    "author_association": "NONE",
    "body": "Hi\n\nI have a very small number of requests incoming on my server and yet the flask server always ends up getting stuck/hanging indefinitely.\n\nI tracked down the problem to : the allowed number of files that the server opens reaches ulimit.\n\nThe flask server creates sockets one after the other and I don't know why it doesn't close them. I am not doing anything crazy, just rendering a page or putting a number in a mongo database\n\nAny thoughts ?\n\nSee full issue here : http://stackoverflow.com/questions/20540129/ever-increasing-number-of-opened-sockets-on-python-web-server\n\n(I don't know how issues work on github, first timer here ; I don't mind copying the full issue here if you prefer)\nThanks\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/30423731",
            "html_url": "https://github.com/pallets/flask/issues/926#issuecomment-30423731",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/926",
            "id": 30423731,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwNDIzNzMx",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-12-12T14:01:24Z",
            "updated_at": "2013-12-12T14:01:24Z",
            "author_association": "MEMBER",
            "body": "You should not use the dev server for anything but development/testing.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/30433600",
            "html_url": "https://github.com/pallets/flask/issues/926#issuecomment-30433600",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/926",
            "id": 30433600,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwNDMzNjAw",
            "user": {
                "login": "ThomasJannaud",
                "id": 6170138,
                "node_id": "MDQ6VXNlcjYxNzAxMzg=",
                "avatar_url": "https://avatars0.githubusercontent.com/u/6170138?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThomasJannaud",
                "html_url": "https://github.com/ThomasJannaud",
                "followers_url": "https://api.github.com/users/ThomasJannaud/followers",
                "following_url": "https://api.github.com/users/ThomasJannaud/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThomasJannaud/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThomasJannaud/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThomasJannaud/subscriptions",
                "organizations_url": "https://api.github.com/users/ThomasJannaud/orgs",
                "repos_url": "https://api.github.com/users/ThomasJannaud/repos",
                "events_url": "https://api.github.com/users/ThomasJannaud/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThomasJannaud/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-12-12T15:47:23Z",
            "updated_at": "2013-12-12T15:47:23Z",
            "author_association": "NONE",
            "body": "Where do you see that I am using the dev server ? I don't think I am using it\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/30434456",
            "html_url": "https://github.com/pallets/flask/issues/926#issuecomment-30434456",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/926",
            "id": 30434456,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwNDM0NDU2",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-12-12T15:55:57Z",
            "updated_at": "2013-12-12T15:55:57Z",
            "author_association": "MEMBER",
            "body": "If you use `app.run`, you are using it. `app.run` uses the primitive builtin server from Werkzeug, which \"works\", but only well enough for testing purposes. Its only advantages are ease of use and the lack of dependencies.\n\nSee http://flask.pocoo.org/docs/deploying/ about what to actually use on your server.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/30434824",
            "html_url": "https://github.com/pallets/flask/issues/926#issuecomment-30434824",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/926",
            "id": 30434824,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwNDM0ODI0",
            "user": {
                "login": "ThomasJannaud",
                "id": 6170138,
                "node_id": "MDQ6VXNlcjYxNzAxMzg=",
                "avatar_url": "https://avatars0.githubusercontent.com/u/6170138?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThomasJannaud",
                "html_url": "https://github.com/ThomasJannaud",
                "followers_url": "https://api.github.com/users/ThomasJannaud/followers",
                "following_url": "https://api.github.com/users/ThomasJannaud/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThomasJannaud/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThomasJannaud/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThomasJannaud/subscriptions",
                "organizations_url": "https://api.github.com/users/ThomasJannaud/orgs",
                "repos_url": "https://api.github.com/users/ThomasJannaud/repos",
                "events_url": "https://api.github.com/users/ThomasJannaud/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThomasJannaud/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-12-12T15:59:53Z",
            "updated_at": "2013-12-12T16:00:33Z",
            "author_association": "NONE",
            "body": "I have replaced app.run by tornado and got the same behaviour. (using http://flask.pocoo.org/docs/deploying/wsgi-standalone/#tornado).\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/30435293",
            "html_url": "https://github.com/pallets/flask/issues/926#issuecomment-30435293",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/926",
            "id": 30435293,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwNDM1Mjkz",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-12-12T16:04:31Z",
            "updated_at": "2013-12-12T16:04:31Z",
            "author_association": "MEMBER",
            "body": "That's a little bit surprising. Do you get that behavior with gunicorn too?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/30482598",
            "html_url": "https://github.com/pallets/flask/issues/926#issuecomment-30482598",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/926",
            "id": 30482598,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwNDgyNTk4",
            "user": {
                "login": "pengfei-xue",
                "id": 1533151,
                "node_id": "MDQ6VXNlcjE1MzMxNTE=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/1533151?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/pengfei-xue",
                "html_url": "https://github.com/pengfei-xue",
                "followers_url": "https://api.github.com/users/pengfei-xue/followers",
                "following_url": "https://api.github.com/users/pengfei-xue/following{/other_user}",
                "gists_url": "https://api.github.com/users/pengfei-xue/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/pengfei-xue/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/pengfei-xue/subscriptions",
                "organizations_url": "https://api.github.com/users/pengfei-xue/orgs",
                "repos_url": "https://api.github.com/users/pengfei-xue/repos",
                "events_url": "https://api.github.com/users/pengfei-xue/events{/privacy}",
                "received_events_url": "https://api.github.com/users/pengfei-xue/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-12-13T02:54:05Z",
            "updated_at": "2013-12-13T03:11:59Z",
            "author_association": "CONTRIBUTOR",
            "body": "we are using pymongo + flask + gunicorn, and everything is ok. pymongo will maintain a connection pool, every MongoClient instance has a built-in connection pool. So, if you have too much running mongoclient instances, it may complain about too many open files.\n\n[how-does-connection-pooling-work-in-pymongo](http://api.mongodb.org/python/current/faq.html#how-does-connection-pooling-work-in-pymongo)\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/30512973",
            "html_url": "https://github.com/pallets/flask/issues/926#issuecomment-30512973",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/926",
            "id": 30512973,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMwNTEyOTcz",
            "user": {
                "login": "ThomasJannaud",
                "id": 6170138,
                "node_id": "MDQ6VXNlcjYxNzAxMzg=",
                "avatar_url": "https://avatars0.githubusercontent.com/u/6170138?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThomasJannaud",
                "html_url": "https://github.com/ThomasJannaud",
                "followers_url": "https://api.github.com/users/ThomasJannaud/followers",
                "following_url": "https://api.github.com/users/ThomasJannaud/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThomasJannaud/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThomasJannaud/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThomasJannaud/subscriptions",
                "organizations_url": "https://api.github.com/users/ThomasJannaud/orgs",
                "repos_url": "https://api.github.com/users/ThomasJannaud/repos",
                "events_url": "https://api.github.com/users/ThomasJannaud/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThomasJannaud/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-12-13T14:32:22Z",
            "updated_at": "2013-12-13T14:32:22Z",
            "author_association": "NONE",
            "body": "Hi\nThe culprit was indeed pymongo and the way I opened the client and not closing it. It seems that pymongo does the optimization on its side, so no need to try to do it in our code it will just open too many sockets\nThanks all for your help\n"
        }
    ]
}