{
    "url": "https://api.github.com/repos/pallets/flask/issues/2995",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2995/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2995/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2995/events",
    "html_url": "https://github.com/pallets/flask/issues/2995",
    "id": 380017466,
    "node_id": "MDU6SXNzdWUzODAwMTc0NjY=",
    "number": 2995,
    "title": "How to get a handle_request method for just handle one request",
    "user": {
        "login": "liudonghua123",
        "id": 2276718,
        "node_id": "MDQ6VXNlcjIyNzY3MTg=",
        "avatar_url": "https://avatars3.githubusercontent.com/u/2276718?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/liudonghua123",
        "html_url": "https://github.com/liudonghua123",
        "followers_url": "https://api.github.com/users/liudonghua123/followers",
        "following_url": "https://api.github.com/users/liudonghua123/following{/other_user}",
        "gists_url": "https://api.github.com/users/liudonghua123/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/liudonghua123/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/liudonghua123/subscriptions",
        "organizations_url": "https://api.github.com/users/liudonghua123/orgs",
        "repos_url": "https://api.github.com/users/liudonghua123/repos",
        "events_url": "https://api.github.com/users/liudonghua123/events{/privacy}",
        "received_events_url": "https://api.github.com/users/liudonghua123/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2018-11-13T01:21:30Z",
    "updated_at": "2018-11-13T05:41:11Z",
    "closed_at": "2018-11-13T01:39:37Z",
    "author_association": "NONE",
    "body": "### Expected Behavior\r\n\r\nI tried to write a flask builder for now, and from the exist HTTPServer example https://github.com/liudonghua123/now-builders/blob/master/packages/now-python/now_handler.py, I should get a `handle_request` method executed when a new incoming request arrived.\r\nBut after driving into the acturally code, I could not found such a method. Some code may be add into `flask` and `werkzeug` both.\r\n\r\n\r\n```python\r\nimport json\r\nimport requests\r\nfrom __NOW_HANDLER_FILENAME import app\r\nimport _thread\r\n\r\n\r\ndef now_handler(event, context):\r\n    _thread.start_new_thread(app.handle_request, ())\r\n    payload = json.loads(event['body'])\r\n    path = payload['path']\r\n    headers = payload['headers']\r\n    method = payload['method']\r\n    \r\n    res = requests.request(method, 'http://0.0.0.0:3000' + path, headers=headers)\r\n\r\n    return {\r\n        'statusCode': res.status_code,\r\n        'headers': dict(res.headers),\r\n        'body': res.text\r\n    }\r\n\r\n\r\n```\r\n\r\nThe __NOW_HANDLER_FILENAME file contents may like this\r\n```python\r\nfrom flask import Flask\r\napp = Flask(__name__)\r\n\r\n@app.route('/')\r\ndef hello_world():\r\n    return 'Hello, World!'\r\n```\r\n\r\n### Actual Behavior\r\n\r\nThe `handle_request` or like method does not exist.\r\n\r\n### Environment\r\n\r\n* Python version: 3.7.0\r\n* Flask version: 1.0.2\r\n* Werkzeug version: 0.14.1\r\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/438097206",
            "html_url": "https://github.com/pallets/flask/issues/2995#issuecomment-438097206",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2995",
            "id": 438097206,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzODA5NzIwNg==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-11-13T01:39:37Z",
            "updated_at": "2018-11-13T01:39:37Z",
            "author_association": "MEMBER",
            "body": "It looks like \"Now\" is a serverless platform, you should take a look at Flask-Lambda and Flask-Zappa for examples of how others solved this.\r\n\r\nFrom the example, it's not clear you'd need to actually start the server just to use requests to hit it, you can just use `app.test_client()` to simulate a request and get a response."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/438098055",
            "html_url": "https://github.com/pallets/flask/issues/2995#issuecomment-438098055",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2995",
            "id": 438098055,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzODA5ODA1NQ==",
            "user": {
                "login": "frostming",
                "id": 16336606,
                "node_id": "MDQ6VXNlcjE2MzM2NjA2",
                "avatar_url": "https://avatars3.githubusercontent.com/u/16336606?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/frostming",
                "html_url": "https://github.com/frostming",
                "followers_url": "https://api.github.com/users/frostming/followers",
                "following_url": "https://api.github.com/users/frostming/following{/other_user}",
                "gists_url": "https://api.github.com/users/frostming/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/frostming/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/frostming/subscriptions",
                "organizations_url": "https://api.github.com/users/frostming/orgs",
                "repos_url": "https://api.github.com/users/frostming/repos",
                "events_url": "https://api.github.com/users/frostming/events{/privacy}",
                "received_events_url": "https://api.github.com/users/frostming/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-11-13T01:44:15Z",
            "updated_at": "2018-11-13T01:46:36Z",
            "author_association": "NONE",
            "body": "Flask app is a WSGI handler instead of a HTTP server.\r\n\r\nYou should look for server implementations to get an instance. A straightforward way to fit your case is as follows:\r\n```python\r\nfrom wsgiref.simple_server import make_server\r\nserver = make_server(host, port, app)\r\n\r\n...\r\n_thread.start_new_thread(server.handle_request, ())\r\n```"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/438101502",
            "html_url": "https://github.com/pallets/flask/issues/2995#issuecomment-438101502",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2995",
            "id": 438101502,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzODEwMTUwMg==",
            "user": {
                "login": "liudonghua123",
                "id": 2276718,
                "node_id": "MDQ6VXNlcjIyNzY3MTg=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/2276718?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/liudonghua123",
                "html_url": "https://github.com/liudonghua123",
                "followers_url": "https://api.github.com/users/liudonghua123/followers",
                "following_url": "https://api.github.com/users/liudonghua123/following{/other_user}",
                "gists_url": "https://api.github.com/users/liudonghua123/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/liudonghua123/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/liudonghua123/subscriptions",
                "organizations_url": "https://api.github.com/users/liudonghua123/orgs",
                "repos_url": "https://api.github.com/users/liudonghua123/repos",
                "events_url": "https://api.github.com/users/liudonghua123/events{/privacy}",
                "received_events_url": "https://api.github.com/users/liudonghua123/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-11-13T02:01:52Z",
            "updated_at": "2018-11-13T02:01:52Z",
            "author_association": "NONE",
            "body": "@davidism, @frostming Thanks for you quickly replay, it really help me a lot. Thanks \ud83d\udc4d ."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/438111501",
            "html_url": "https://github.com/pallets/flask/issues/2995#issuecomment-438111501",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2995",
            "id": 438111501,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzODExMTUwMQ==",
            "user": {
                "login": "liudonghua123",
                "id": 2276718,
                "node_id": "MDQ6VXNlcjIyNzY3MTg=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/2276718?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/liudonghua123",
                "html_url": "https://github.com/liudonghua123",
                "followers_url": "https://api.github.com/users/liudonghua123/followers",
                "following_url": "https://api.github.com/users/liudonghua123/following{/other_user}",
                "gists_url": "https://api.github.com/users/liudonghua123/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/liudonghua123/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/liudonghua123/subscriptions",
                "organizations_url": "https://api.github.com/users/liudonghua123/orgs",
                "repos_url": "https://api.github.com/users/liudonghua123/repos",
                "events_url": "https://api.github.com/users/liudonghua123/events{/privacy}",
                "received_events_url": "https://api.github.com/users/liudonghua123/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-11-13T02:52:58Z",
            "updated_at": "2018-11-13T02:52:58Z",
            "author_association": "NONE",
            "body": "@frostming, I tried you suggestion, but this line of code is not right.\r\n```\r\nserver = WSGIServer\r\n```\r\n\r\n`WSGIServer` is a direct subclass of `HTTPServer`, and I need to pass a `RequestHandlerClass` which I could not got from `app` of flask.\r\n![image](https://user-images.githubusercontent.com/2276718/48387829-3e09a280-e732-11e8-8938-0387a9798f85.png)\r\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/438121891",
            "html_url": "https://github.com/pallets/flask/issues/2995#issuecomment-438121891",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2995",
            "id": 438121891,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzODEyMTg5MQ==",
            "user": {
                "login": "frostming",
                "id": 16336606,
                "node_id": "MDQ6VXNlcjE2MzM2NjA2",
                "avatar_url": "https://avatars3.githubusercontent.com/u/16336606?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/frostming",
                "html_url": "https://github.com/frostming",
                "followers_url": "https://api.github.com/users/frostming/followers",
                "following_url": "https://api.github.com/users/frostming/following{/other_user}",
                "gists_url": "https://api.github.com/users/frostming/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/frostming/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/frostming/subscriptions",
                "organizations_url": "https://api.github.com/users/frostming/orgs",
                "repos_url": "https://api.github.com/users/frostming/repos",
                "events_url": "https://api.github.com/users/frostming/events{/privacy}",
                "received_events_url": "https://api.github.com/users/frostming/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-11-13T03:40:04Z",
            "updated_at": "2018-11-13T03:40:04Z",
            "author_association": "NONE",
            "body": "@liudonghua123 The solution is updated, it is recommended to use `make_server` rather than use `WSGIServer` directly"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/438143976",
            "html_url": "https://github.com/pallets/flask/issues/2995#issuecomment-438143976",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2995",
            "id": 438143976,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzODE0Mzk3Ng==",
            "user": {
                "login": "liudonghua123",
                "id": 2276718,
                "node_id": "MDQ6VXNlcjIyNzY3MTg=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/2276718?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/liudonghua123",
                "html_url": "https://github.com/liudonghua123",
                "followers_url": "https://api.github.com/users/liudonghua123/followers",
                "following_url": "https://api.github.com/users/liudonghua123/following{/other_user}",
                "gists_url": "https://api.github.com/users/liudonghua123/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/liudonghua123/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/liudonghua123/subscriptions",
                "organizations_url": "https://api.github.com/users/liudonghua123/orgs",
                "repos_url": "https://api.github.com/users/liudonghua123/repos",
                "events_url": "https://api.github.com/users/liudonghua123/events{/privacy}",
                "received_events_url": "https://api.github.com/users/liudonghua123/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-11-13T05:41:11Z",
            "updated_at": "2018-11-13T05:41:11Z",
            "author_association": "NONE",
            "body": "Now, I wrote a flask builder for now on https://github.com/zeit/now-builders/pull/26."
        }
    ]
}