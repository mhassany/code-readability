{
    "url": "https://api.github.com/repos/pallets/flask/issues/2994",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2994/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2994/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2994/events",
    "html_url": "https://github.com/pallets/flask/pull/2994",
    "id": 379969836,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MjMwMjgyMTky",
    "number": 2994,
    "title": "Handle errors during create_url_adapter",
    "user": {
        "login": "jarek",
        "id": 47415,
        "node_id": "MDQ6VXNlcjQ3NDE1",
        "avatar_url": "https://avatars1.githubusercontent.com/u/47415?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jarek",
        "html_url": "https://github.com/jarek",
        "followers_url": "https://api.github.com/users/jarek/followers",
        "following_url": "https://api.github.com/users/jarek/following{/other_user}",
        "gists_url": "https://api.github.com/users/jarek/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/jarek/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jarek/subscriptions",
        "organizations_url": "https://api.github.com/users/jarek/orgs",
        "repos_url": "https://api.github.com/users/jarek/repos",
        "events_url": "https://api.github.com/users/jarek/events{/privacy}",
        "received_events_url": "https://api.github.com/users/jarek/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": {
        "url": "https://api.github.com/repos/pallets/flask/milestones/3",
        "html_url": "https://github.com/pallets/flask/milestone/3",
        "labels_url": "https://api.github.com/repos/pallets/flask/milestones/3/labels",
        "id": 3093266,
        "node_id": "MDk6TWlsZXN0b25lMzA5MzI2Ng==",
        "number": 3,
        "title": "1.1.0",
        "description": "",
        "creator": {
            "login": "davidism",
            "id": 1242887,
            "node_id": "MDQ6VXNlcjEyNDI4ODc=",
            "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/davidism",
            "html_url": "https://github.com/davidism",
            "followers_url": "https://api.github.com/users/davidism/followers",
            "following_url": "https://api.github.com/users/davidism/following{/other_user}",
            "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
            "organizations_url": "https://api.github.com/users/davidism/orgs",
            "repos_url": "https://api.github.com/users/davidism/repos",
            "events_url": "https://api.github.com/users/davidism/events{/privacy}",
            "received_events_url": "https://api.github.com/users/davidism/received_events",
            "type": "User",
            "site_admin": false
        },
        "open_issues": 0,
        "closed_issues": 48,
        "state": "closed",
        "created_at": "2018-02-06T16:14:43Z",
        "updated_at": "2019-07-06T22:03:23Z",
        "due_on": null,
        "closed_at": "2019-07-06T22:03:23Z"
    },
    "comments": 2,
    "created_at": "2018-11-12T22:02:00Z",
    "updated_at": "2018-11-13T18:56:34Z",
    "closed_at": "2018-11-13T18:55:35Z",
    "author_association": "CONTRIBUTOR",
    "pull_request": {
        "url": "https://api.github.com/repos/pallets/flask/pulls/2994",
        "html_url": "https://github.com/pallets/flask/pull/2994",
        "diff_url": "https://github.com/pallets/flask/pull/2994.diff",
        "patch_url": "https://github.com/pallets/flask/pull/2994.patch"
    },
    "body": "If create_url_adapter raises (which it can if werkzeug cannot bind environment, for example on ~non-ASCII~ non-printable Host header), we should handle it as other routing exceptions rather than raising through. This allows us to return a HTTP 400, rather than a 500 from unhandled exception.\r\n\r\nThis came up in https://github.com/pallets/werkzeug/issues/640\r\n\r\nDo we need to add it to any documentation or changelogs?",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/438076365",
            "html_url": "https://github.com/pallets/flask/pull/2994#issuecomment-438076365",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2994",
            "id": 438076365,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzODA3NjM2NQ==",
            "user": {
                "login": "jarek",
                "id": 47415,
                "node_id": "MDQ6VXNlcjQ3NDE1",
                "avatar_url": "https://avatars1.githubusercontent.com/u/47415?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/jarek",
                "html_url": "https://github.com/jarek",
                "followers_url": "https://api.github.com/users/jarek/followers",
                "following_url": "https://api.github.com/users/jarek/following{/other_user}",
                "gists_url": "https://api.github.com/users/jarek/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/jarek/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jarek/subscriptions",
                "organizations_url": "https://api.github.com/users/jarek/orgs",
                "repos_url": "https://api.github.com/users/jarek/repos",
                "events_url": "https://api.github.com/users/jarek/events{/privacy}",
                "received_events_url": "https://api.github.com/users/jarek/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-11-12T23:59:28Z",
            "updated_at": "2018-11-12T23:59:28Z",
            "author_association": "CONTRIBUTOR",
            "body": "Will take a look at the tests, It Worked On My Machine\u2122"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/438082353",
            "html_url": "https://github.com/pallets/flask/pull/2994#issuecomment-438082353",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2994",
            "id": 438082353,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzODA4MjM1Mw==",
            "user": {
                "login": "jarek",
                "id": 47415,
                "node_id": "MDQ6VXNlcjQ3NDE1",
                "avatar_url": "https://avatars1.githubusercontent.com/u/47415?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/jarek",
                "html_url": "https://github.com/jarek",
                "followers_url": "https://api.github.com/users/jarek/followers",
                "following_url": "https://api.github.com/users/jarek/following{/other_user}",
                "gists_url": "https://api.github.com/users/jarek/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/jarek/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jarek/subscriptions",
                "organizations_url": "https://api.github.com/users/jarek/orgs",
                "repos_url": "https://api.github.com/users/jarek/repos",
                "events_url": "https://api.github.com/users/jarek/events{/privacy}",
                "received_events_url": "https://api.github.com/users/jarek/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-11-13T00:30:04Z",
            "updated_at": "2018-11-13T00:30:04Z",
            "author_association": "CONTRIBUTOR",
            "body": "Failures are in the test doing `response = app.test_client().get('/', headers={'host': '\u0105\u015b\u017a.com'})`\r\n\r\nOn my local machine:\r\n- on Python 3.5.2, testing with `get('/', headers={'host': '\u0105\u00f6\u0436'})` fails (HTTP 200 is returned?!)\r\n- on Python 2.7.12, testing with `get('/', headers={'host': '\u0105\u00f6\u0436'})` works (HTTP 400 is returned)\r\n- on Python 3.5.2, testing with `get('/', headers={'host': '\\x8a'})` (the test case given in original issue) works as expected (HTTP 400 is returned)\r\n- on Python 2.7.12, testing with `get('/', headers={'host': '\\x8a'})` raises exception in the test code (I think?): \r\n\r\n```\r\nvenv2/local/lib/python2.7/site-packages/werkzeug/test.py:830: in get\r\n    return self.open(*args, **kw)\r\nflask/testing.py:200: in open\r\n    follow_redirects=follow_redirects\r\nvenv2/local/lib/python2.7/site-packages/werkzeug/test.py:803: in open\r\n    response = self.run_wsgi_app(environ, buffered=buffered)\r\nvenv2/local/lib/python2.7/site-packages/werkzeug/test.py:718: in run_wsgi_app\r\n    self.cookie_jar.extract_wsgi(environ, rv[2])\r\nvenv2/local/lib/python2.7/site-packages/werkzeug/test.py:191: in extract_wsgi\r\n    U2Request(get_current_url(environ)),\r\nvenv2/local/lib/python2.7/site-packages/werkzeug/wsgi.py:99: in get_current_url\r\n    return uri_to_iri(''.join(tmp))\r\nvenv2/local/lib/python2.7/site-packages/werkzeug/urls.py:614: in uri_to_iri\r\n    uri = url_parse(to_unicode(uri, charset))\r\nvenv2/local/lib/python2.7/site-packages/werkzeug/_compat.py:206: in to_unicode\r\n    return x.decode(charset, errors)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\ninput = 'http://\\x8a/', errors = 'strict'\r\n\r\n    def decode(input, errors='strict'):\r\n>       return codecs.utf_8_decode(input, errors, True)\r\nE       UnicodeDecodeError: 'utf8' codec can't decode byte 0x8a in position 7: invalid start byte\r\n```\r\n\r\n`http://\\x8a/` looks like it's trying to do more with that Host header than I expected. Will dig in some more."
        }
    ]
}