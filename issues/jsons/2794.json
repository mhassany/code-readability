{
    "url": "https://api.github.com/repos/pallets/flask/issues/2794",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2794/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2794/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2794/events",
    "html_url": "https://github.com/pallets/flask/issues/2794",
    "id": 324805213,
    "node_id": "MDU6SXNzdWUzMjQ4MDUyMTM=",
    "number": 2794,
    "title": "Python flask threads does not close",
    "user": {
        "login": "sjd12",
        "id": 39123852,
        "node_id": "MDQ6VXNlcjM5MTIzODUy",
        "avatar_url": "https://avatars2.githubusercontent.com/u/39123852?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sjd12",
        "html_url": "https://github.com/sjd12",
        "followers_url": "https://api.github.com/users/sjd12/followers",
        "following_url": "https://api.github.com/users/sjd12/following{/other_user}",
        "gists_url": "https://api.github.com/users/sjd12/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/sjd12/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/sjd12/subscriptions",
        "organizations_url": "https://api.github.com/users/sjd12/orgs",
        "repos_url": "https://api.github.com/users/sjd12/repos",
        "events_url": "https://api.github.com/users/sjd12/events{/privacy}",
        "received_events_url": "https://api.github.com/users/sjd12/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2018-05-21T06:44:20Z",
    "updated_at": "2018-05-22T12:01:42Z",
    "closed_at": "2018-05-21T12:05:37Z",
    "author_association": "NONE",
    "body": "My python flask app runs using `nohup`. ie it is always live. I see that it creates a thread every time user submits from page. It is because flask.run is with `multithread=true`. But my problem is even after the processing is over, the thread doesn't seem to be closed. I'm checking this with the `ps -eLf |grep userid` command. where i see many threads still active long after the code execution is over. and it gets added when another submit is done. All threads are removed when the app itself is restarted.\r\n\r\nWhat is the criteria for the thread to close without restarting the app?\r\nis it because the memory not getting released?\r\n\r\n```\r\napp = Flask(__name__)\r\n@app.route('/submit',methods = ['GET','POST'])\r\ndef submit():\r\n    #obj1=class1()\r\n    #obj2=class2(obj1)\r\n    #obj3=class3(obj1)\r\n    #refer objects\r\n    #process data\r\n    #done\r\n\r\nif __name__ == \"__main__\":\r\n    app.run(host='0.0.0.0', port=4000, threaded=True, debug=False)\r\n```",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/390635349",
            "html_url": "https://github.com/pallets/flask/issues/2794#issuecomment-390635349",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2794",
            "id": 390635349,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM5MDYzNTM0OQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-05-21T12:05:37Z",
            "updated_at": "2018-05-21T12:06:09Z",
            "author_association": "MEMBER",
            "body": "Don't use the dev server in production. It is not designed to be particularly resource efficient. Use a production WSGI server such as Gunicorn, uWSGI, or mod_wsgi.\r\n\r\nThat said, I can't reproduce the issue you describe, threads are joined after they finish their work."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/390929203",
            "html_url": "https://github.com/pallets/flask/issues/2794#issuecomment-390929203",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2794",
            "id": 390929203,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM5MDkyOTIwMw==",
            "user": {
                "login": "sjd12",
                "id": 39123852,
                "node_id": "MDQ6VXNlcjM5MTIzODUy",
                "avatar_url": "https://avatars2.githubusercontent.com/u/39123852?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/sjd12",
                "html_url": "https://github.com/sjd12",
                "followers_url": "https://api.github.com/users/sjd12/followers",
                "following_url": "https://api.github.com/users/sjd12/following{/other_user}",
                "gists_url": "https://api.github.com/users/sjd12/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/sjd12/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/sjd12/subscriptions",
                "organizations_url": "https://api.github.com/users/sjd12/orgs",
                "repos_url": "https://api.github.com/users/sjd12/repos",
                "events_url": "https://api.github.com/users/sjd12/events{/privacy}",
                "received_events_url": "https://api.github.com/users/sjd12/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-05-22T09:42:14Z",
            "updated_at": "2018-05-22T09:42:14Z",
            "author_association": "NONE",
            "body": "Yup got  it, but as mentioned ,its user base is limited . so kept using flask.\r\nAnyway i think i found the problem. The problem was with paramiko package. paramiko.SFTPClient connection was not closed explicitly when my user defined class is closed. So i called the close for each paramiko object and it releases the threads."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/390964878",
            "html_url": "https://github.com/pallets/flask/issues/2794#issuecomment-390964878",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2794",
            "id": 390964878,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM5MDk2NDg3OA==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-05-22T12:01:42Z",
            "updated_at": "2018-05-22T12:01:42Z",
            "author_association": "MEMBER",
            "body": "I'm not sure what you mean by \"its user base is limited\", but glad you solved it."
        }
    ]
}