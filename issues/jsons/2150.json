{
    "url": "https://api.github.com/repos/pallets/flask/issues/2150",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2150/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2150/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2150/events",
    "html_url": "https://github.com/pallets/flask/issues/2150",
    "id": 200775120,
    "node_id": "MDU6SXNzdWUyMDA3NzUxMjA=",
    "number": 2150,
    "title": "Connection refused for flask redis session",
    "user": {
        "login": "jeff1evesque",
        "id": 2907085,
        "node_id": "MDQ6VXNlcjI5MDcwODU=",
        "avatar_url": "https://avatars0.githubusercontent.com/u/2907085?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jeff1evesque",
        "html_url": "https://github.com/jeff1evesque",
        "followers_url": "https://api.github.com/users/jeff1evesque/followers",
        "following_url": "https://api.github.com/users/jeff1evesque/following{/other_user}",
        "gists_url": "https://api.github.com/users/jeff1evesque/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/jeff1evesque/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jeff1evesque/subscriptions",
        "organizations_url": "https://api.github.com/users/jeff1evesque/orgs",
        "repos_url": "https://api.github.com/users/jeff1evesque/repos",
        "events_url": "https://api.github.com/users/jeff1evesque/events{/privacy}",
        "received_events_url": "https://api.github.com/users/jeff1evesque/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 5,
    "created_at": "2017-01-14T02:47:32Z",
    "updated_at": "2017-01-14T11:18:35Z",
    "closed_at": "2017-01-14T05:39:22Z",
    "author_association": "NONE",
    "body": "I attempted to replace flask's internal [`session`](http://flask.pocoo.org/docs/0.12/quickstart/#sessions) by [implementing](http://flask.pocoo.org/snippets/75/) redis.  I thought this was a good idea, since it would mean more secure sessions, since they are not stored as cookies, rather on the redis-server:\r\n\r\n- http://flask.pocoo.org/snippets/75/\r\n- https://github.com/mrichman/flask-redis/blob/master/redissession.py\r\n\r\nAfter copying the latter [reference](https://github.com/mrichman/flask-redis/blob/master/redissession.py), as [`redis_session.py`](https://github.com/jeff1evesque/machine-learning/blob/340e19ab43cd2162b712d1f485e69411ec83fe91/brain/cache/redis_session.py), followed by adjusting [`factory.py`](https://github.com/jeff1evesque/machine-learning/commit/4eea9251f69e392d2ce2e5ca6bbd2d53c964d2b0):\r\n\r\n```python\r\n            # replace default cookie session with server-side redis\r\n            app.session_interface = RedisSessionInterface()\r\n```\r\n\r\nMy travis ci indicated a [failed](https://travis-ci.org/jeff1evesque/machine-learning/builds/190594385#L3623-L3725) build:\r\n\r\n>E           ConnectionError: Error 111 connecting to localhost:6379. Connection refused.\r\n\r\nI'm not sure why my application failed to connect to redis.  The redis-server should have properly started via [`redis.dockerfile`](https://github.com/jeff1evesque/machine-learning/blob/962cfee5d8031fc09802da82f04b04a6280d4242/redis.dockerfile#L12), which is implemented by the overall [`travis.yaml`](https://github.com/jeff1evesque/machine-learning/blob/e801c5f8bffdf1b402af760c4ccbb2faf9991d76/.travis.yml#L105).  Prior to actually implementing `redis_session.py`, my application was already using redis successfully for other things (like serializing sciki-learn objects, and storing it into redis), as indicated by [prior builds](https://travis-ci.org/jeff1evesque/machine-learning/builds/190431244#L3624).  Specifically, the `test_model_generate` function from [`pytest_svm_file_upload.py`](https://github.com/jeff1evesque/machine-learning/blob/203ec97281314c9ca97ab58b0e3a3e7342990bd5/test/live_server/programmatic_interface/file_upload/pytest_svm_file_upload.py#L106-L125), basically computes a prediction object, then stores it into redis via a custom [`cache`](https://github.com/jeff1evesque/machine-learning/blob/203ec97281314c9ca97ab58b0e3a3e7342990bd5/brain/cache/cache_model.py#L45-L58) method:\r\n\r\n```python\r\n    def cache(self, hash_name, key):\r\n        '''@cache\r\n        This method serializes, then caches the provided model into a redis\r\n        hash cache.\r\n        '''\r\n\r\n        try:\r\n            serialized = Serialize_Model(self.model).serialize()\r\n            self.myRedis.hset(hash_name, key, serialized)\r\n        except Exception, error:\r\n            self.list_error.append(str(error))\r\n            print self.list_error\r\n```\r\n\r\nIf the model was not properly cached into redis, then my successive unit test, [`test_model_predict`](https://github.com/jeff1evesque/machine-learning/blob/203ec97281314c9ca97ab58b0e3a3e7342990bd5/test/live_server/programmatic_interface/file_upload/pytest_svm_file_upload.py#L128-L147) which uncaches the same model, in order to perform corresponding computation, would fail.\r\n\r\nBecause my travis ci [builds](https://travis-ci.org/jeff1evesque/machine-learning/builds) began breaking with the introduction of overloading [`app.session_interface = RedisSessionInterface()`](https://github.com/jeff1evesque/machine-learning/commit/4eea9251f69e392d2ce2e5ca6bbd2d53c964d2b0#diff-ab2c5ef35603caa654ec40f8cad9162aR53) in my app factory, I'm wondering if the problem is redis, flask, docker, or a combination of the three?",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/272599771",
            "html_url": "https://github.com/pallets/flask/issues/2150#issuecomment-272599771",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2150",
            "id": 272599771,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjU5OTc3MQ==",
            "user": {
                "login": "jeff1evesque",
                "id": 2907085,
                "node_id": "MDQ6VXNlcjI5MDcwODU=",
                "avatar_url": "https://avatars0.githubusercontent.com/u/2907085?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/jeff1evesque",
                "html_url": "https://github.com/jeff1evesque",
                "followers_url": "https://api.github.com/users/jeff1evesque/followers",
                "following_url": "https://api.github.com/users/jeff1evesque/following{/other_user}",
                "gists_url": "https://api.github.com/users/jeff1evesque/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/jeff1evesque/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jeff1evesque/subscriptions",
                "organizations_url": "https://api.github.com/users/jeff1evesque/orgs",
                "repos_url": "https://api.github.com/users/jeff1evesque/repos",
                "events_url": "https://api.github.com/users/jeff1evesque/events{/privacy}",
                "received_events_url": "https://api.github.com/users/jeff1evesque/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-01-14T03:58:12Z",
            "updated_at": "2017-01-14T03:58:12Z",
            "author_association": "NONE",
            "body": "I temporarily [removed](https://github.com/jeff1evesque/machine-learning/commit/7f5ce43be1c074a6657c5ade4a831c51489b5ec7) `app.session_interface = RedisSessionInterface()` from my `factory.py`, and noticed the corresponding travis ci [build](https://travis-ci.org/jeff1evesque/machine-learning/builds/191835620#L3616-L3662) did not have the above mentioned error.  Then, I reverted back the redis implementation, with a corresponding commit.  So, it seems I have two choices, either use the default flask session, or carry on debugging the redis implementation within flask."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/272603857",
            "html_url": "https://github.com/pallets/flask/issues/2150#issuecomment-272603857",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2150",
            "id": 272603857,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjYwMzg1Nw==",
            "user": {
                "login": "jeffwidman",
                "id": 483314,
                "node_id": "MDQ6VXNlcjQ4MzMxNA==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/483314?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/jeffwidman",
                "html_url": "https://github.com/jeffwidman",
                "followers_url": "https://api.github.com/users/jeffwidman/followers",
                "following_url": "https://api.github.com/users/jeffwidman/following{/other_user}",
                "gists_url": "https://api.github.com/users/jeffwidman/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/jeffwidman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jeffwidman/subscriptions",
                "organizations_url": "https://api.github.com/users/jeffwidman/orgs",
                "repos_url": "https://api.github.com/users/jeffwidman/repos",
                "events_url": "https://api.github.com/users/jeffwidman/events{/privacy}",
                "received_events_url": "https://api.github.com/users/jeffwidman/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-01-14T05:39:22Z",
            "updated_at": "2017-01-14T05:39:22Z",
            "author_association": "MEMBER",
            "body": "Questions should be asked over on StackOverflow or the Flask mailing list. \r\n\r\nIssue tracker is for bugs/feature requests. Thanks."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/272603993",
            "html_url": "https://github.com/pallets/flask/issues/2150#issuecomment-272603993",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2150",
            "id": 272603993,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjYwMzk5Mw==",
            "user": {
                "login": "jeff1evesque",
                "id": 2907085,
                "node_id": "MDQ6VXNlcjI5MDcwODU=",
                "avatar_url": "https://avatars0.githubusercontent.com/u/2907085?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/jeff1evesque",
                "html_url": "https://github.com/jeff1evesque",
                "followers_url": "https://api.github.com/users/jeff1evesque/followers",
                "following_url": "https://api.github.com/users/jeff1evesque/following{/other_user}",
                "gists_url": "https://api.github.com/users/jeff1evesque/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/jeff1evesque/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jeff1evesque/subscriptions",
                "organizations_url": "https://api.github.com/users/jeff1evesque/orgs",
                "repos_url": "https://api.github.com/users/jeff1evesque/repos",
                "events_url": "https://api.github.com/users/jeff1evesque/events{/privacy}",
                "received_events_url": "https://api.github.com/users/jeff1evesque/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-01-14T05:43:23Z",
            "updated_at": "2017-01-14T05:43:23Z",
            "author_association": "NONE",
            "body": "@jeffwidman couldn't this potentially be a bug with the redis integration, with respect to flask `session`?"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/272605050",
            "html_url": "https://github.com/pallets/flask/issues/2150#issuecomment-272605050",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2150",
            "id": 272605050,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjYwNTA1MA==",
            "user": {
                "login": "jeffwidman",
                "id": 483314,
                "node_id": "MDQ6VXNlcjQ4MzMxNA==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/483314?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/jeffwidman",
                "html_url": "https://github.com/jeffwidman",
                "followers_url": "https://api.github.com/users/jeffwidman/followers",
                "following_url": "https://api.github.com/users/jeffwidman/following{/other_user}",
                "gists_url": "https://api.github.com/users/jeffwidman/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/jeffwidman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jeffwidman/subscriptions",
                "organizations_url": "https://api.github.com/users/jeffwidman/orgs",
                "repos_url": "https://api.github.com/users/jeffwidman/repos",
                "events_url": "https://api.github.com/users/jeffwidman/events{/privacy}",
                "received_events_url": "https://api.github.com/users/jeffwidman/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-01-14T06:09:43Z",
            "updated_at": "2017-01-14T06:09:43Z",
            "author_association": "MEMBER",
            "body": "Last I checked, Flask core has no built-in redis integration, you have to extend the session either by hand (eg, by copying the Flask snippet you linked to) or using a Flask extension. Both of those are not maintained by core, hence why I closed this. If you're using an extension, file an issue with them. IIRC, the snippets aren't maintained much anymore, so if you want to handcraft the Redis integration, check StackOverflow or look for examples others have posted on Github etc."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/272617861",
            "html_url": "https://github.com/pallets/flask/issues/2150#issuecomment-272617861",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2150",
            "id": 272617861,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjYxNzg2MQ==",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-01-14T11:18:35Z",
            "updated_at": "2017-01-14T11:18:35Z",
            "author_association": "MEMBER",
            "body": "\"Connection refused\" means the redis library cannot connect to the redis server. This *cannot* be caused by Flask.\r\n\r\nAnd as others said, the redissession module is not part of flask...\r\n\r\nHowever, I think I see the problem there: It creates a new Redis instance if none is passed - this happens when the RedisSessionInterface is instantiated, something that usually happens at import time or at app factory execution time. Neither is a good time to open a connection that'll be used throughout the app's lifetime. Connecting to redis should probably be done when the connection will actually be used. When a Redis instance is passed to the constructor it also needs to be available when the constructor is executed, i.e. it has the same problem."
        }
    ]
}