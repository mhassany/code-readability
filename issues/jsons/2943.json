{
    "url": "https://api.github.com/repos/pallets/flask/issues/2943",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2943/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2943/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2943/events",
    "html_url": "https://github.com/pallets/flask/issues/2943",
    "id": 370171413,
    "node_id": "MDU6SXNzdWUzNzAxNzE0MTM=",
    "number": 2943,
    "title": "Trouble with function send_file and range",
    "user": {
        "login": "PavelProkhorov",
        "id": 43439988,
        "node_id": "MDQ6VXNlcjQzNDM5OTg4",
        "avatar_url": "https://avatars1.githubusercontent.com/u/43439988?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/PavelProkhorov",
        "html_url": "https://github.com/PavelProkhorov",
        "followers_url": "https://api.github.com/users/PavelProkhorov/followers",
        "following_url": "https://api.github.com/users/PavelProkhorov/following{/other_user}",
        "gists_url": "https://api.github.com/users/PavelProkhorov/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/PavelProkhorov/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/PavelProkhorov/subscriptions",
        "organizations_url": "https://api.github.com/users/PavelProkhorov/orgs",
        "repos_url": "https://api.github.com/users/PavelProkhorov/repos",
        "events_url": "https://api.github.com/users/PavelProkhorov/events{/privacy}",
        "received_events_url": "https://api.github.com/users/PavelProkhorov/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 8,
    "created_at": "2018-10-15T13:46:53Z",
    "updated_at": "2019-01-07T15:02:09Z",
    "closed_at": "2019-01-07T15:02:09Z",
    "author_association": "NONE",
    "body": "Hi! \r\n\r\nWhy function send_file don't support Range header in request?\r\nI send request with next header: Range: bytes=0-10.\r\n\r\n this is part of my code: \r\n return send_file(file, attachment_filename=filename, conditional=True)\r\n\r\n But flask application return status code 200 instead 206. \r\n\r\n---\r\n\r\n### Expected Behavior\r\nstatus code = 206\r\n\r\n\r\n### Actual Behavior\r\nstatus code = 200\r\n\r\n### Environment\r\n\r\n* Python version: 3.5.3\r\n* Flask version: 1.0.2\r\n* Werkzeug version:\r\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/430029253",
            "html_url": "https://github.com/pallets/flask/issues/2943#issuecomment-430029253",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2943",
            "id": 430029253,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDAyOTI1Mw==",
            "user": {
                "login": "IgnasiBosch",
                "id": 7078953,
                "node_id": "MDQ6VXNlcjcwNzg5NTM=",
                "avatar_url": "https://avatars0.githubusercontent.com/u/7078953?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/IgnasiBosch",
                "html_url": "https://github.com/IgnasiBosch",
                "followers_url": "https://api.github.com/users/IgnasiBosch/followers",
                "following_url": "https://api.github.com/users/IgnasiBosch/following{/other_user}",
                "gists_url": "https://api.github.com/users/IgnasiBosch/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/IgnasiBosch/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/IgnasiBosch/subscriptions",
                "organizations_url": "https://api.github.com/users/IgnasiBosch/orgs",
                "repos_url": "https://api.github.com/users/IgnasiBosch/repos",
                "events_url": "https://api.github.com/users/IgnasiBosch/events{/privacy}",
                "received_events_url": "https://api.github.com/users/IgnasiBosch/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-15T21:59:12Z",
            "updated_at": "2018-10-15T21:59:12Z",
            "author_association": "CONTRIBUTOR",
            "body": "Hi @PavelProkhorov I'm getting a 206 response code.\r\nCould you provide more detailed procedure?\r\n\r\n$ curl http://127.0.0.1:5000 -i -H \"Range: bytes=0-10\"\r\nHTTP/1.0 206 PARTIAL CONTENT\r\nContent-Length: 11\r\nContent-Type: text/plain; charset=utf-8\r\nAccept-Ranges: bytes\r\n\r\nPython 3.5\r\nFlask==1.0.2\r\nWerkzeug==0.14.1\r\n\r\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/430141091",
            "html_url": "https://github.com/pallets/flask/issues/2943#issuecomment-430141091",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2943",
            "id": 430141091,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDE0MTA5MQ==",
            "user": {
                "login": "PavelProkhorov",
                "id": 43439988,
                "node_id": "MDQ6VXNlcjQzNDM5OTg4",
                "avatar_url": "https://avatars1.githubusercontent.com/u/43439988?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/PavelProkhorov",
                "html_url": "https://github.com/PavelProkhorov",
                "followers_url": "https://api.github.com/users/PavelProkhorov/followers",
                "following_url": "https://api.github.com/users/PavelProkhorov/following{/other_user}",
                "gists_url": "https://api.github.com/users/PavelProkhorov/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/PavelProkhorov/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/PavelProkhorov/subscriptions",
                "organizations_url": "https://api.github.com/users/PavelProkhorov/orgs",
                "repos_url": "https://api.github.com/users/PavelProkhorov/repos",
                "events_url": "https://api.github.com/users/PavelProkhorov/events{/privacy}",
                "received_events_url": "https://api.github.com/users/PavelProkhorov/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-16T08:04:33Z",
            "updated_at": "2018-10-16T08:06:57Z",
            "author_association": "NONE",
            "body": "Hi @IgnasiBosch \r\ncurl http://127.0.0.1:5000/api/v1/video/test.mp4 -i -H \"Range: bytes=0-10\"\r\n\r\nHTTP/1.0 200 OK\r\nContent-Type: video/mp4\r\nCache-Control: max-age=43200, public\r\nExpires: Tue, 16 Oct 2018 19:54:05 GMT\r\nDate: Tue, 16 Oct 2018 07:54:05 GMT\r\nAccept-Ranges: bytes\r\nAccess-Control-Allow-Origin: *\r\nConnection: close\r\nServer: Werkzeug/0.14.1 Python/3.5.3\r\n\r\nThis is my code, I download video from FTP and it send:\r\n```\r\n@blueprint.route('/api/v1/video/<filename>')\r\ndef get_video(filename):\r\n    with ftplib.FTP(ip, login, password, timeout=timeout) as ftp:\r\n        output = io.BytesIO()\r\n        ftp.retrbinary(\"RETR {}\".format(filename), lambda data: output.write(data))\r\n        output.seek(0)\r\n    return send_file(output, attachment_filename=filename, conditional=True)\r\n```"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/430253965",
            "html_url": "https://github.com/pallets/flask/issues/2943#issuecomment-430253965",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2943",
            "id": 430253965,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDI1Mzk2NQ==",
            "user": {
                "login": "IgnasiBosch",
                "id": 7078953,
                "node_id": "MDQ6VXNlcjcwNzg5NTM=",
                "avatar_url": "https://avatars0.githubusercontent.com/u/7078953?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/IgnasiBosch",
                "html_url": "https://github.com/IgnasiBosch",
                "followers_url": "https://api.github.com/users/IgnasiBosch/followers",
                "following_url": "https://api.github.com/users/IgnasiBosch/following{/other_user}",
                "gists_url": "https://api.github.com/users/IgnasiBosch/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/IgnasiBosch/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/IgnasiBosch/subscriptions",
                "organizations_url": "https://api.github.com/users/IgnasiBosch/orgs",
                "repos_url": "https://api.github.com/users/IgnasiBosch/repos",
                "events_url": "https://api.github.com/users/IgnasiBosch/events{/privacy}",
                "received_events_url": "https://api.github.com/users/IgnasiBosch/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-16T14:14:33Z",
            "updated_at": "2018-10-16T14:14:33Z",
            "author_association": "CONTRIBUTOR",
            "body": "Hi again @PavelProkhorov, \r\njust guessing, what you are trying to do has slight streaming flavor, isn't?. I wouldn't say this is the best approach as it will download from the ftp the entire file, each time! If you use a common file instead (downloading from the ftp just the first time to a temporary folder, cached or whatever) Partial content should work properly. \r\nEventhough I'll take a look if there are any other constrain regarding request a range size of a bytesIO"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/430274016",
            "html_url": "https://github.com/pallets/flask/issues/2943#issuecomment-430274016",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2943",
            "id": 430274016,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDI3NDAxNg==",
            "user": {
                "login": "PavelProkhorov",
                "id": 43439988,
                "node_id": "MDQ6VXNlcjQzNDM5OTg4",
                "avatar_url": "https://avatars1.githubusercontent.com/u/43439988?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/PavelProkhorov",
                "html_url": "https://github.com/PavelProkhorov",
                "followers_url": "https://api.github.com/users/PavelProkhorov/followers",
                "following_url": "https://api.github.com/users/PavelProkhorov/following{/other_user}",
                "gists_url": "https://api.github.com/users/PavelProkhorov/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/PavelProkhorov/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/PavelProkhorov/subscriptions",
                "organizations_url": "https://api.github.com/users/PavelProkhorov/orgs",
                "repos_url": "https://api.github.com/users/PavelProkhorov/repos",
                "events_url": "https://api.github.com/users/PavelProkhorov/events{/privacy}",
                "received_events_url": "https://api.github.com/users/PavelProkhorov/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-16T15:05:19Z",
            "updated_at": "2018-10-16T15:05:19Z",
            "author_association": "NONE",
            "body": "@IgnasiBosch \r\nYes, you're see through me. I'm going to use Redis for cache. \r\n\r\nI found this code and it works fine. \r\n```\r\ndef send_file_partial(file, filename):\r\n    \"\"\"\r\n    Simple wrapper around send_file which handles HTTP 206 Partial Content\r\n    :param file - io.BytesIO object\r\n    :param filename \r\n    :return - flask response object\r\n    \"\"\"\r\n    range_header = request.headers.get('Range', None)\r\n    if not range_header:\r\n        return send_file(file, attachment_filename=filename, conditional=True)\r\n\r\n    size = sys.getsizeof(file)\r\n    byte1, byte2 = 0, None\r\n\r\n    m = re.search('(\\d+)-(\\d*)', range_header)\r\n    g = m.groups()\r\n\r\n    if g[0]:\r\n        byte1 = int(g[0])\r\n    if g[1]:\r\n        byte2 = int(g[1])\r\n\r\n    length = size - byte1\r\n    if byte2 is not None:\r\n        length = byte2 - byte1 + 1\r\n\r\n    file.seek(byte1)\r\n    data = file.read(length)\r\n\r\n    rv = Response(data,\r\n                  206,\r\n                  mimetype=mimetypes.guess_type(filename)[0],\r\n                  direct_passthrough=True)\r\n    rv.headers.add('Content-Range', 'bytes {0}-{1}/{2}'.format(byte1, byte1 + length - 1, size))\r\n    rv.headers.add('Accept-Ranges', 'bytes')\r\n    return rv\r\n```\r\nBut this issue still open for me. "
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/430355636",
            "html_url": "https://github.com/pallets/flask/issues/2943#issuecomment-430355636",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2943",
            "id": 430355636,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDM1NTYzNg==",
            "user": {
                "login": "IgnasiBosch",
                "id": 7078953,
                "node_id": "MDQ6VXNlcjcwNzg5NTM=",
                "avatar_url": "https://avatars0.githubusercontent.com/u/7078953?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/IgnasiBosch",
                "html_url": "https://github.com/IgnasiBosch",
                "followers_url": "https://api.github.com/users/IgnasiBosch/followers",
                "following_url": "https://api.github.com/users/IgnasiBosch/following{/other_user}",
                "gists_url": "https://api.github.com/users/IgnasiBosch/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/IgnasiBosch/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/IgnasiBosch/subscriptions",
                "organizations_url": "https://api.github.com/users/IgnasiBosch/orgs",
                "repos_url": "https://api.github.com/users/IgnasiBosch/repos",
                "events_url": "https://api.github.com/users/IgnasiBosch/events{/privacy}",
                "received_events_url": "https://api.github.com/users/IgnasiBosch/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-16T18:53:30Z",
            "updated_at": "2018-10-16T20:26:37Z",
            "author_association": "CONTRIBUTOR",
            "body": "@PavelProkhorov \r\nI must be missing some detail or I didn't get you.\r\nIf you are using a cached/saved file:\r\n\r\nController:\r\n```python\r\n@app.route('/api/v1/video/<filename>')\r\ndef get_video(filename):\r\n    file = \"./{}\".format(filename)\r\n    return send_file(file, attachment_filename=filename, conditional=True)\r\n```\r\n\r\nRequest:\r\n```shell\r\ncurl http://127.0.0.1:5000/api/v1/video/sample.mp4 -i -H \"Range: bytes=0-10\"\r\n```\r\n\r\nResponse:\r\n```\r\nHTTP/1.0 206 PARTIAL CONTENT\r\nContent-Length: 11\r\nContent-Type: video/mp4\r\nLast-Modified: Tue, 16 Oct 2018 18:41:33 GMT\r\nCache-Control: max-age=43200, public\r\nExpires: Wed, 17 Oct 2018 06:44:40 GMT\r\nETag: \"1539715293.906835-7338852-2705001102\"\r\nDate: Tue, 16 Oct 2018 18:44:40 GMT\r\nAccept-Ranges: bytes\r\nContent-Range: bytes 0-10/7338852\r\nServer: Werkzeug/0.14.1 Python/3.5.3\r\n```\r\n\r\n\r\n```\r\nFlask==1.0.2\r\n```\r\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/430905070",
            "html_url": "https://github.com/pallets/flask/issues/2943#issuecomment-430905070",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2943",
            "id": 430905070,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDkwNTA3MA==",
            "user": {
                "login": "PavelProkhorov",
                "id": 43439988,
                "node_id": "MDQ6VXNlcjQzNDM5OTg4",
                "avatar_url": "https://avatars1.githubusercontent.com/u/43439988?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/PavelProkhorov",
                "html_url": "https://github.com/PavelProkhorov",
                "followers_url": "https://api.github.com/users/PavelProkhorov/followers",
                "following_url": "https://api.github.com/users/PavelProkhorov/following{/other_user}",
                "gists_url": "https://api.github.com/users/PavelProkhorov/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/PavelProkhorov/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/PavelProkhorov/subscriptions",
                "organizations_url": "https://api.github.com/users/PavelProkhorov/orgs",
                "repos_url": "https://api.github.com/users/PavelProkhorov/repos",
                "events_url": "https://api.github.com/users/PavelProkhorov/events{/privacy}",
                "received_events_url": "https://api.github.com/users/PavelProkhorov/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-18T07:31:41Z",
            "updated_at": "2018-10-18T07:31:41Z",
            "author_association": "NONE",
            "body": "@IgnasiBosch hi!\r\n\r\nI don't use cached/saved file. I load it from ftp to io.BytesIO. \r\nDo you try get 206 code responce with io.BytesIO object and function send_file?"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/431186607",
            "html_url": "https://github.com/pallets/flask/issues/2943#issuecomment-431186607",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2943",
            "id": 431186607,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMTE4NjYwNw==",
            "user": {
                "login": "IgnasiBosch",
                "id": 7078953,
                "node_id": "MDQ6VXNlcjcwNzg5NTM=",
                "avatar_url": "https://avatars0.githubusercontent.com/u/7078953?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/IgnasiBosch",
                "html_url": "https://github.com/IgnasiBosch",
                "followers_url": "https://api.github.com/users/IgnasiBosch/followers",
                "following_url": "https://api.github.com/users/IgnasiBosch/following{/other_user}",
                "gists_url": "https://api.github.com/users/IgnasiBosch/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/IgnasiBosch/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/IgnasiBosch/subscriptions",
                "organizations_url": "https://api.github.com/users/IgnasiBosch/orgs",
                "repos_url": "https://api.github.com/users/IgnasiBosch/repos",
                "events_url": "https://api.github.com/users/IgnasiBosch/events{/privacy}",
                "received_events_url": "https://api.github.com/users/IgnasiBosch/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-18T22:33:53Z",
            "updated_at": "2018-10-20T18:15:13Z",
            "author_association": "CONTRIBUTOR",
            "body": "Hi @PavelProkhorov \r\nCould you try this when you have a chance?\r\nhttps://github.com/IgnasiBosch/flask/commit/ab530ea35c2fce1632b67137f76a3d2bef50f918\r\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/432621737",
            "html_url": "https://github.com/pallets/flask/issues/2943#issuecomment-432621737",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2943",
            "id": 432621737,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMjYyMTczNw==",
            "user": {
                "login": "PavelProkhorov",
                "id": 43439988,
                "node_id": "MDQ6VXNlcjQzNDM5OTg4",
                "avatar_url": "https://avatars1.githubusercontent.com/u/43439988?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/PavelProkhorov",
                "html_url": "https://github.com/PavelProkhorov",
                "followers_url": "https://api.github.com/users/PavelProkhorov/followers",
                "following_url": "https://api.github.com/users/PavelProkhorov/following{/other_user}",
                "gists_url": "https://api.github.com/users/PavelProkhorov/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/PavelProkhorov/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/PavelProkhorov/subscriptions",
                "organizations_url": "https://api.github.com/users/PavelProkhorov/orgs",
                "repos_url": "https://api.github.com/users/PavelProkhorov/repos",
                "events_url": "https://api.github.com/users/PavelProkhorov/events{/privacy}",
                "received_events_url": "https://api.github.com/users/PavelProkhorov/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-24T11:40:37Z",
            "updated_at": "2018-10-24T11:40:37Z",
            "author_association": "NONE",
            "body": "Hi! \r\nThank you, I'm going to try this fix. "
        }
    ]
}