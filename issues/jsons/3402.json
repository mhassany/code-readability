{
    "url": "https://api.github.com/repos/pallets/flask/issues/3402",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/3402/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/3402/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/3402/events",
    "html_url": "https://github.com/pallets/flask/issues/3402",
    "id": 510045422,
    "node_id": "MDU6SXNzdWU1MTAwNDU0MjI=",
    "number": 3402,
    "title": "Test test_send_from_directory_bad_request fails in Python 3.8",
    "user": {
        "login": "jdevera",
        "id": 73069,
        "node_id": "MDQ6VXNlcjczMDY5",
        "avatar_url": "https://avatars0.githubusercontent.com/u/73069?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jdevera",
        "html_url": "https://github.com/jdevera",
        "followers_url": "https://api.github.com/users/jdevera/followers",
        "following_url": "https://api.github.com/users/jdevera/following{/other_user}",
        "gists_url": "https://api.github.com/users/jdevera/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/jdevera/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jdevera/subscriptions",
        "organizations_url": "https://api.github.com/users/jdevera/orgs",
        "repos_url": "https://api.github.com/users/jdevera/repos",
        "events_url": "https://api.github.com/users/jdevera/events{/privacy}",
        "received_events_url": "https://api.github.com/users/jdevera/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2019-10-21T15:22:41Z",
    "updated_at": "2019-10-29T01:26:41Z",
    "closed_at": "2019-10-29T01:26:41Z",
    "author_association": "NONE",
    "body": "### Expected Behavior\r\nAll tests should pass in Python 3.8. However this one:\r\n\r\n```python\r\n    def test_send_from_directory_bad_request(self, app, req_ctx):\r\n        app.root_path = os.path.join(\r\n            os.path.dirname(__file__), \"test_apps\", \"subdomaintestmodule\"\r\n        )\r\n\r\n        with pytest.raises(BadRequest):\r\n            flask.send_from_directory(\"static\", \"bad\\x00\")\r\n```\r\n\r\nWhich calls:\r\n\r\n```python\r\ndef send_from_directory(directory, filename, **options):\r\n    # ...\r\n    try:\r\n        if not os.path.isfile(filename):\r\n            raise NotFound()\r\n    except (TypeError, ValueError):\r\n        raise BadRequest()\r\n    # ...\r\n```\r\n\r\nIs now affected by a change from 3.7 to 3.8.\r\n\r\n[Python 3.8 now fixes the bug](https://docs.python.org/3.8/whatsnew/3.8.html#os-path) where a NULL character in a file name would trigger a ValueError in some `os.path` functions, such as `os.path.isfile`:\r\n\r\n> os.path functions that return a boolean result like exists(), lexists(), isdir(), isfile(), islink(), and ismount() now return False instead of raising ValueError or its subclasses UnicodeEncodeError and UnicodeDecodeError for paths that contain characters or bytes unrepresentable at the OS level. (Contributed by Serhiy Storchaka in bpo-33721.)\r\n\r\nThe expectation is that this test should not be there, as it is testing buggy python behaviour. Furthermore, since the correct behaviour is now known, I would expect `send_from_directory` to raise `NotFound` also for paths with NULL characters in them.\r\n\r\n### Actual Behavior\r\n\r\n`send_from_directory` raises `BadRequest` for paths with null characters in them. This makes tests fail in python 3.8\r\n\r\n```pytb\r\n====================================== FAILURES =======================================\r\n__________________ TestSendfile.test_send_from_directory_bad_request __________________\r\ntests/test_helpers.py:789: in test_send_from_directory_bad_request\r\n    flask.send_from_directory(\"static\", \"bad\\x00\")\r\n.tox/py38/lib/python3.8/site-packages/flask/helpers.py:767: in send_from_directory\r\n    raise NotFound()\r\nE   werkzeug.exceptions.NotFound: 404 Not Found: The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.\r\n====================== 1 failed, 572 passed, 1 skipped in 4.14s =======================\r\n```\r\n\r\n### Environment\r\n\r\n* Python version: 3.8\r\n* Flask version: master\r\n* Werkzeug version: 0.16.0\r\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/547196265",
            "html_url": "https://github.com/pallets/flask/issues/3402#issuecomment-547196265",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3402",
            "id": 547196265,
            "node_id": "MDEyOklzc3VlQ29tbWVudDU0NzE5NjI2NQ==",
            "user": {
                "login": "haneybarg",
                "id": 31302805,
                "node_id": "MDQ6VXNlcjMxMzAyODA1",
                "avatar_url": "https://avatars1.githubusercontent.com/u/31302805?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/haneybarg",
                "html_url": "https://github.com/haneybarg",
                "followers_url": "https://api.github.com/users/haneybarg/followers",
                "following_url": "https://api.github.com/users/haneybarg/following{/other_user}",
                "gists_url": "https://api.github.com/users/haneybarg/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/haneybarg/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/haneybarg/subscriptions",
                "organizations_url": "https://api.github.com/users/haneybarg/orgs",
                "repos_url": "https://api.github.com/users/haneybarg/repos",
                "events_url": "https://api.github.com/users/haneybarg/events{/privacy}",
                "received_events_url": "https://api.github.com/users/haneybarg/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-10-28T23:55:40Z",
            "updated_at": "2019-10-28T23:55:40Z",
            "author_association": "CONTRIBUTOR",
            "body": "Hi! Can I take this?\r\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/547199799",
            "html_url": "https://github.com/pallets/flask/issues/3402#issuecomment-547199799",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3402",
            "id": 547199799,
            "node_id": "MDEyOklzc3VlQ29tbWVudDU0NzE5OTc5OQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-10-29T00:10:51Z",
            "updated_at": "2019-10-29T00:10:51Z",
            "author_association": "MEMBER",
            "body": "Go for it! No need to ask first. :-)"
        }
    ]
}