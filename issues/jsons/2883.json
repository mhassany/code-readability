{
    "url": "https://api.github.com/repos/pallets/flask/issues/2883",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2883/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2883/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2883/events",
    "html_url": "https://github.com/pallets/flask/issues/2883",
    "id": 349669987,
    "node_id": "MDU6SXNzdWUzNDk2Njk5ODc=",
    "number": 2883,
    "title": "jinja2 compiled templates not working",
    "user": {
        "login": "iljau",
        "id": 43159,
        "node_id": "MDQ6VXNlcjQzMTU5",
        "avatar_url": "https://avatars3.githubusercontent.com/u/43159?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/iljau",
        "html_url": "https://github.com/iljau",
        "followers_url": "https://api.github.com/users/iljau/followers",
        "following_url": "https://api.github.com/users/iljau/following{/other_user}",
        "gists_url": "https://api.github.com/users/iljau/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/iljau/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/iljau/subscriptions",
        "organizations_url": "https://api.github.com/users/iljau/orgs",
        "repos_url": "https://api.github.com/users/iljau/repos",
        "events_url": "https://api.github.com/users/iljau/events{/privacy}",
        "received_events_url": "https://api.github.com/users/iljau/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2018-08-10T22:03:16Z",
    "updated_at": "2019-06-27T23:52:21Z",
    "closed_at": "2019-06-27T23:52:21Z",
    "author_association": "NONE",
    "body": "### Expected Behavior\r\n\r\nIt should be possible to use jinja2 precompiled templates using loader shown in documentation: http://jinja.pocoo.org/docs/2.10/api/#jinja2.ModuleLoader\r\n\r\nSample repo: https://github.com/iljau/flask_precompiled_templates_issue\r\n\r\n```python\r\nfrom flask import Flask, render_template\r\nfrom jinja2 import ChoiceLoader, FileSystemLoader, ModuleLoader\r\n\r\napp = Flask(__name__)\r\n\r\napp.jinja_env.compile_templates(\r\n    target='templates_compiled', zip=None,\r\n    ignore_errors=False\r\n)\r\n\r\nloader = ChoiceLoader([\r\n    ModuleLoader('templates_compiled'),\r\n    FileSystemLoader('templates')\r\n])\r\napp.jinja_loader = loader\r\n\r\n@app.route('/')\r\ndef hello_world():\r\n    return render_template(\"index.jinja2\")\r\n\r\n\r\nif __name__ == '__main__':\r\n    app.run(debug=True)\r\n```\r\n\r\n### Actual Behavior\r\n\r\nTell us what happens instead.\r\n\r\n```pytb\r\n  File ..\\lib\\site-packages\\flask\\app.py\", line 1813, in full_dispatch_request\r\n    rv = self.dispatch_request()\r\n  File ..\\lib\\site-packages\\flask\\app.py\", line 1799, in dispatch_request\r\n    return self.view_functions[rule.endpoint](**req.view_args)\r\n  File \"C:\\Users\\Ilja\\Code\\flowers_v2\\flowers\\flowers_app.py\", line 301, in general_expenses_list\r\n    return render_template(\"general_expenses.jinja2\", transactions=transactions, form=form)\r\n  File ..\\lib\\site-packages\\flask\\templating.py\", line 134, in render_template\r\n    return _render(ctx.app.jinja_env.get_or_select_template(template_name_or_list),\r\n  File ..\\lib\\site-packages\\jinja2\\environment.py\", line 869, in get_or_select_template\r\n    return self.get_template(template_name_or_list, parent, globals)\r\n  File ..\\lib\\site-packages\\jinja2\\environment.py\", line 830, in get_template\r\n    return self._load_template(name, self.make_globals(globals))\r\n  File ..\\lib\\site-packages\\jinja2\\environment.py\", line 804, in _load_template\r\n    template = self.loader.load(self, name, globals)\r\n  File ..\\lib\\site-packages\\jinja2\\loaders.py\", line 113, in load\r\n    source, filename, uptodate = self.get_source(environment, name)\r\n  File ..\\lib\\site-packages\\flask\\templating.py\", line 58, in get_source\r\n    return self._get_source_fast(environment, template)\r\n  File ..\\lib\\site-packages\\flask\\templating.py\", line 83, in _get_source_fast\r\n    return loader.get_source(environment, template)\r\n  File ..\\lib\\site-packages\\jinja2\\loaders.py\", line 90, in get_source\r\n    self.__class__.__name__)\r\nRuntimeError: ModuleLoader cannot provide access to the source\r\n```\r\n\r\n### Environment\r\n\r\n* Python version: 3.7.0\r\n* Flask version: 1.0.2\r\n* Werkzeug version: 0.14.1",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/415226136",
            "html_url": "https://github.com/pallets/flask/issues/2883#issuecomment-415226136",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2883",
            "id": 415226136,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQxNTIyNjEzNg==",
            "user": {
                "login": "mrcz88",
                "id": 42491063,
                "node_id": "MDQ6VXNlcjQyNDkxMDYz",
                "avatar_url": "https://avatars0.githubusercontent.com/u/42491063?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mrcz88",
                "html_url": "https://github.com/mrcz88",
                "followers_url": "https://api.github.com/users/mrcz88/followers",
                "following_url": "https://api.github.com/users/mrcz88/following{/other_user}",
                "gists_url": "https://api.github.com/users/mrcz88/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mrcz88/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mrcz88/subscriptions",
                "organizations_url": "https://api.github.com/users/mrcz88/orgs",
                "repos_url": "https://api.github.com/users/mrcz88/repos",
                "events_url": "https://api.github.com/users/mrcz88/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mrcz88/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-08-22T23:57:53Z",
            "updated_at": "2018-08-22T23:57:53Z",
            "author_association": "NONE",
            "body": "I have the same problem. Maybe, jinja2.loader.ModuleLoader should override get_source ? "
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/416543511",
            "html_url": "https://github.com/pallets/flask/issues/2883#issuecomment-416543511",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2883",
            "id": 416543511,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQxNjU0MzUxMQ==",
            "user": {
                "login": "cldssty",
                "id": 6035970,
                "node_id": "MDQ6VXNlcjYwMzU5NzA=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/6035970?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/cldssty",
                "html_url": "https://github.com/cldssty",
                "followers_url": "https://api.github.com/users/cldssty/followers",
                "following_url": "https://api.github.com/users/cldssty/following{/other_user}",
                "gists_url": "https://api.github.com/users/cldssty/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/cldssty/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/cldssty/subscriptions",
                "organizations_url": "https://api.github.com/users/cldssty/orgs",
                "repos_url": "https://api.github.com/users/cldssty/repos",
                "events_url": "https://api.github.com/users/cldssty/events{/privacy}",
                "received_events_url": "https://api.github.com/users/cldssty/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-08-28T11:00:43Z",
            "updated_at": "2018-08-28T11:00:43Z",
            "author_association": "NONE",
            "body": "https://github.com/pallets/jinja/blob/master/jinja2/loaders.py\r\nHave noticed that in the ModuleLoader subclass,  `has_source_access = False`, which could be what's making the `get_source` implementation in the BaseLoader class raise the error you are seeing? \r\n\r\nNot sure why `has_source_access` is initialised to `False` there though."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/426693576",
            "html_url": "https://github.com/pallets/flask/issues/2883#issuecomment-426693576",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2883",
            "id": 426693576,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyNjY5MzU3Ng==",
            "user": {
                "login": "diofeher",
                "id": 161360,
                "node_id": "MDQ6VXNlcjE2MTM2MA==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/161360?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/diofeher",
                "html_url": "https://github.com/diofeher",
                "followers_url": "https://api.github.com/users/diofeher/followers",
                "following_url": "https://api.github.com/users/diofeher/following{/other_user}",
                "gists_url": "https://api.github.com/users/diofeher/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/diofeher/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/diofeher/subscriptions",
                "organizations_url": "https://api.github.com/users/diofeher/orgs",
                "repos_url": "https://api.github.com/users/diofeher/repos",
                "events_url": "https://api.github.com/users/diofeher/events{/privacy}",
                "received_events_url": "https://api.github.com/users/diofeher/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-03T16:02:07Z",
            "updated_at": "2018-10-03T16:02:07Z",
            "author_association": "NONE",
            "body": "It looks the problem is on https://github.com/pallets/flask/blob/master/flask/templating.py#L47 `DispatchingJinjaLoader`, it will only try to use loaders with get_source implementation, thus not implementing ModuleLoader"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/431632944",
            "html_url": "https://github.com/pallets/flask/issues/2883#issuecomment-431632944",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2883",
            "id": 431632944,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMTYzMjk0NA==",
            "user": {
                "login": "vuolter",
                "id": 1221092,
                "node_id": "MDQ6VXNlcjEyMjEwOTI=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/1221092?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/vuolter",
                "html_url": "https://github.com/vuolter",
                "followers_url": "https://api.github.com/users/vuolter/followers",
                "following_url": "https://api.github.com/users/vuolter/following{/other_user}",
                "gists_url": "https://api.github.com/users/vuolter/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/vuolter/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/vuolter/subscriptions",
                "organizations_url": "https://api.github.com/users/vuolter/orgs",
                "repos_url": "https://api.github.com/users/vuolter/repos",
                "events_url": "https://api.github.com/users/vuolter/events{/privacy}",
                "received_events_url": "https://api.github.com/users/vuolter/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-21T02:12:23Z",
            "updated_at": "2018-10-21T02:12:23Z",
            "author_association": "NONE",
            "body": "See https://github.com/pallets/flask/issues/101 \ud83d\ude1e "
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/491780757",
            "html_url": "https://github.com/pallets/flask/issues/2883#issuecomment-491780757",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2883",
            "id": 491780757,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MTc4MDc1Nw==",
            "user": {
                "login": "zmwangx",
                "id": 4149852,
                "node_id": "MDQ6VXNlcjQxNDk4NTI=",
                "avatar_url": "https://avatars0.githubusercontent.com/u/4149852?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/zmwangx",
                "html_url": "https://github.com/zmwangx",
                "followers_url": "https://api.github.com/users/zmwangx/followers",
                "following_url": "https://api.github.com/users/zmwangx/following{/other_user}",
                "gists_url": "https://api.github.com/users/zmwangx/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/zmwangx/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zmwangx/subscriptions",
                "organizations_url": "https://api.github.com/users/zmwangx/orgs",
                "repos_url": "https://api.github.com/users/zmwangx/repos",
                "events_url": "https://api.github.com/users/zmwangx/events{/privacy}",
                "received_events_url": "https://api.github.com/users/zmwangx/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-05-13T11:15:13Z",
            "updated_at": "2019-05-13T11:16:45Z",
            "author_association": "NONE",
            "body": "I just encountered this problem. The solution is to override `app.jinja_env.loader` with `ModuleLoader` instead of `app.jinja_loader`.\r\n\r\nThe problem apparently arises when your `ModuleLoader` (or `ChoiceLoader`, or what have you) is being dispatched by `DispatchingJinjaLoader`, which assumes `get_source`, instead of operating on its own. Note that `DispatchingJinjaLoader` is only useful for integrating the base loader with all the blueprint loaders; if you already pre-compiled everything available to the `DispatchingJinjaLoader`, there's no point in dispatching anymore.\r\n\r\nBasically, you can structure your application like this:\r\n\r\n```py\r\nimport flask\r\nimport jinja2\r\n\r\nimport blueprints.foo\r\nimport blueprints.bar\r\n\r\napp = flask.Flask(__name__)\r\n# Make sure to register the blueprints before template compilation.\r\napp.register_blueprint(blueprints.foo.foo)\r\napp.register_blueprint(blueprints.bar.bar)\r\n\r\n# Register filters and context processors before compilation, too.\r\n@app.template_filter('foo')\r\ndef filter_foo(val):\r\n    return val\r\n\r\n@app.context_processor\r\ndef injector():\r\n    return dict()\r\n\r\napp.jinja_env.compile_templates('/path/to/compiled/templates')  # Of course this may be done separately.\r\napp.jinja_env.loader = jinja2.ModuleLoader('/path/to/compiled/templates')\r\n```"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/506550774",
            "html_url": "https://github.com/pallets/flask/issues/2883#issuecomment-506550774",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2883",
            "id": 506550774,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwNjU1MDc3NA==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-06-27T23:52:21Z",
            "updated_at": "2019-06-27T23:52:21Z",
            "author_association": "MEMBER",
            "body": "I think the templating might be due for a general refactor at some point, it's definitely confusing that `app.jinja_loader`, `app.make_global_jinja_loader()`, and `app.jinja_env` are all different things that are interrelated in circuitous ways.\r\n\r\nThe `Flask.make_global_jinja_loader()` method is what you want to override. That gets assigned to `app.jinja_env.loader`. `app.jinja_loader` is used by the default global loader, so just replacing it doesn't replace the behavior of the global loader, which requires `get_source` for explaining the template loading chain during debugging.\r\n\r\nClosing for now as there is an intended way to override this."
        }
    ]
}