{
    "url": "https://api.github.com/repos/pallets/flask/issues/2742",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2742/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2742/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2742/events",
    "html_url": "https://github.com/pallets/flask/issues/2742",
    "id": 318705699,
    "node_id": "MDU6SXNzdWUzMTg3MDU2OTk=",
    "number": 2742,
    "title": "Flask 1.0 backwards incompatible root url_prefix",
    "user": {
        "login": "albertyw",
        "id": 3151040,
        "node_id": "MDQ6VXNlcjMxNTEwNDA=",
        "avatar_url": "https://avatars3.githubusercontent.com/u/3151040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/albertyw",
        "html_url": "https://github.com/albertyw",
        "followers_url": "https://api.github.com/users/albertyw/followers",
        "following_url": "https://api.github.com/users/albertyw/following{/other_user}",
        "gists_url": "https://api.github.com/users/albertyw/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/albertyw/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/albertyw/subscriptions",
        "organizations_url": "https://api.github.com/users/albertyw/orgs",
        "repos_url": "https://api.github.com/users/albertyw/repos",
        "events_url": "https://api.github.com/users/albertyw/events{/privacy}",
        "received_events_url": "https://api.github.com/users/albertyw/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": {
        "url": "https://api.github.com/repos/pallets/flask/milestones/5",
        "html_url": "https://github.com/pallets/flask/milestone/5",
        "labels_url": "https://api.github.com/repos/pallets/flask/milestones/5/labels",
        "id": 3304290,
        "node_id": "MDk6TWlsZXN0b25lMzMwNDI5MA==",
        "number": 5,
        "title": "1.0.1",
        "description": "",
        "creator": {
            "login": "davidism",
            "id": 1242887,
            "node_id": "MDQ6VXNlcjEyNDI4ODc=",
            "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/davidism",
            "html_url": "https://github.com/davidism",
            "followers_url": "https://api.github.com/users/davidism/followers",
            "following_url": "https://api.github.com/users/davidism/following{/other_user}",
            "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
            "organizations_url": "https://api.github.com/users/davidism/orgs",
            "repos_url": "https://api.github.com/users/davidism/repos",
            "events_url": "https://api.github.com/users/davidism/events{/privacy}",
            "received_events_url": "https://api.github.com/users/davidism/received_events",
            "type": "User",
            "site_admin": false
        },
        "open_issues": 0,
        "closed_issues": 18,
        "state": "closed",
        "created_at": "2018-04-27T13:46:37Z",
        "updated_at": "2018-04-30T01:11:27Z",
        "due_on": null,
        "closed_at": "2018-04-30T01:11:27Z"
    },
    "comments": 1,
    "created_at": "2018-04-29T10:18:59Z",
    "updated_at": "2018-04-29T22:47:15Z",
    "closed_at": "2018-04-29T22:47:15Z",
    "author_association": "NONE",
    "body": "Some of the recent PRs in blueprint.py seem to make Flask 1.0 not backwards compatible with 0.x versions.  When `url_prefix=''`, `url_prefix='/'`, or `url_prefix` is not specified, a `ValueError('urls must start with a leading slash')` is now raised. \r\n\r\n### Expected Behavior\r\n\r\nI would have assumed, given the discussion in #2629, that `''` and maybe `/` would be acceptable url_prefixes to indicate the blueprint is meant for the root.\r\n\r\nAn example of a broken library is `flask-sitemap` (https://github.com/inveniosoftware/flask-sitemap/blob/master/flask_sitemap/__init__.py#L120) which uses\r\n\r\n```\r\n            app.register_blueprint(\r\n                self.blueprint,\r\n                url_prefix=app.config.get('SITEMAP_BLUEPRINT_URL_PREFIX') # default is '/'\r\n            )\r\n```\r\n\r\n\r\n### Actual Behavior\r\n\r\n In my testing, I continually get \r\n\r\n```  File \"/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask_sitemap/__init__.py\", line 79, in __init__\r\n    self.init_app(app)\r\n  File \"/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask_sitemap/__init__.py\", line 120, in init_app\r\n    url_prefix='' # app.config.get('SITEMAP_BLUEPRINT_URL_PREFIX')\r\n  File \"/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask/app.py\", line 64, in wrapper_func\r\n    return f(self, *args, **kwargs)\r\n  File \"/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask/app.py\", line 1113, in register_blueprint\r\n    blueprint.register(self, options, first_registration)\r\n  File \"/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask/blueprints.py\", line 186, in register\r\n    deferred(state)\r\n  File \"/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask/blueprints.py\", line 207, in <lambda>\r\n    s.add_url_rule(rule, endpoint, view_func, **options))\r\n  File \"/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask/blueprints.py\", line 79, in add_url_rule\r\n    view_func, defaults=defaults, **options)\r\n  File \"/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask/app.py\", line 64, in wrapper_func\r\n    return f(self, *args, **kwargs)\r\n  File \"/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask/app.py\", line 1211, in add_url_rule\r\n    rule = self.url_rule_class(rule, methods=methods, **options)\r\n  File \"/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/werkzeug/routing.py\", line 603, in __init__\r\n    raise ValueError('urls must start with a leading slash')\r\nValueError: urls must start with a leading slash\r\n```\r\n\r\nunless I set `url_prefix='//'`, in which case the url_prefix is the root.\r\n\r\n### Environment\r\n\r\n* Python version: python 2.7 and 3.6\r\n* Flask version: 1.0\r\n* Werkzeug version: 0.14.1\r\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/385286922",
            "html_url": "https://github.com/pallets/flask/issues/2742#issuecomment-385286922",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2742",
            "id": 385286922,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM4NTI4NjkyMg==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-04-29T22:28:49Z",
            "updated_at": "2018-04-29T22:31:04Z",
            "author_association": "MEMBER",
            "body": "The real error here is that Flask-Sitemap doesn't use a leading slash for the rules, and relied on the prefix being prepended. Flask-Sitemap should be fixed to use an empty prefix and start the rules with leading slashes.\r\n\r\nWe just never added the leading slash check to `Blueprint.route`, and there should be a corresponding \"can't end with trailing slash\" check for the prefix.\r\n\r\nIt's not a big deal to fix in Flask right now, but don't rely on that behavior, write your routes with leading slashes."
        }
    ]
}