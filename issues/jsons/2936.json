{
    "url": "https://api.github.com/repos/pallets/flask/issues/2936",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2936/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2936/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2936/events",
    "html_url": "https://github.com/pallets/flask/pull/2936",
    "id": 368120234,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MjIxMzY4MTcz",
    "number": 2936,
    "title": "Fix #2935: Copy current session object in copy_current_request_context",
    "user": {
        "login": "dchevell",
        "id": 4359608,
        "node_id": "MDQ6VXNlcjQzNTk2MDg=",
        "avatar_url": "https://avatars1.githubusercontent.com/u/4359608?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dchevell",
        "html_url": "https://github.com/dchevell",
        "followers_url": "https://api.github.com/users/dchevell/followers",
        "following_url": "https://api.github.com/users/dchevell/following{/other_user}",
        "gists_url": "https://api.github.com/users/dchevell/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/dchevell/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/dchevell/subscriptions",
        "organizations_url": "https://api.github.com/users/dchevell/orgs",
        "repos_url": "https://api.github.com/users/dchevell/repos",
        "events_url": "https://api.github.com/users/dchevell/events{/privacy}",
        "received_events_url": "https://api.github.com/users/dchevell/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": {
        "url": "https://api.github.com/repos/pallets/flask/milestones/3",
        "html_url": "https://github.com/pallets/flask/milestone/3",
        "labels_url": "https://api.github.com/repos/pallets/flask/milestones/3/labels",
        "id": 3093266,
        "node_id": "MDk6TWlsZXN0b25lMzA5MzI2Ng==",
        "number": 3,
        "title": "1.1.0",
        "description": "",
        "creator": {
            "login": "davidism",
            "id": 1242887,
            "node_id": "MDQ6VXNlcjEyNDI4ODc=",
            "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/davidism",
            "html_url": "https://github.com/davidism",
            "followers_url": "https://api.github.com/users/davidism/followers",
            "following_url": "https://api.github.com/users/davidism/following{/other_user}",
            "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
            "organizations_url": "https://api.github.com/users/davidism/orgs",
            "repos_url": "https://api.github.com/users/davidism/repos",
            "events_url": "https://api.github.com/users/davidism/events{/privacy}",
            "received_events_url": "https://api.github.com/users/davidism/received_events",
            "type": "User",
            "site_admin": false
        },
        "open_issues": 0,
        "closed_issues": 48,
        "state": "closed",
        "created_at": "2018-02-06T16:14:43Z",
        "updated_at": "2019-07-06T22:03:23Z",
        "due_on": null,
        "closed_at": "2019-07-06T22:03:23Z"
    },
    "comments": 20,
    "created_at": "2018-10-09T09:31:00Z",
    "updated_at": "2018-11-04T03:32:37Z",
    "closed_at": "2018-11-04T03:32:25Z",
    "author_association": "CONTRIBUTOR",
    "pull_request": {
        "url": "https://api.github.com/repos/pallets/flask/pulls/2936",
        "html_url": "https://github.com/pallets/flask/pull/2936",
        "diff_url": "https://github.com/pallets/flask/pull/2936.diff",
        "patch_url": "https://github.com/pallets/flask/pull/2936.patch"
    },
    "body": "Updates `flask.copy_current_request_context` to add a copy of the current session object to the request context copy. This prevents `flask.session` pointing to an out-of-date object.\r\n\r\n- [x] add tests that fail without the patch\r\n- [x] ensure all tests pass with ``pytest``\r\n- [x] add documentation to the relevant docstrings or pages\r\n- [x] add ``versionadded`` or ``versionchanged`` directives to relevant docstrings\r\n- [x] add a changelog entry if this patch changes code\r\n\r\nPlease refer to #2935 for background on this",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/428126108",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-428126108",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 428126108,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyODEyNjEwOA==",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-09T09:33:56Z",
            "updated_at": "2018-10-09T09:33:56Z",
            "author_association": "MEMBER",
            "body": "Looks good, but please shorten your commit messages a bit. General recommendation is max 51 chars in the first line, and yours are even beyond the limit where GitHub truncates them.\r\n\r\nAlso, I wonder if we should do a deep copy on the session... otherwise people might get a bad surprise in case of mutable objects stored there."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/428142012",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-428142012",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 428142012,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyODE0MjAxMg==",
            "user": {
                "login": "dchevell",
                "id": 4359608,
                "node_id": "MDQ6VXNlcjQzNTk2MDg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/4359608?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/dchevell",
                "html_url": "https://github.com/dchevell",
                "followers_url": "https://api.github.com/users/dchevell/followers",
                "following_url": "https://api.github.com/users/dchevell/following{/other_user}",
                "gists_url": "https://api.github.com/users/dchevell/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/dchevell/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dchevell/subscriptions",
                "organizations_url": "https://api.github.com/users/dchevell/orgs",
                "repos_url": "https://api.github.com/users/dchevell/repos",
                "events_url": "https://api.github.com/users/dchevell/events{/privacy}",
                "received_events_url": "https://api.github.com/users/dchevell/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-09T10:29:13Z",
            "updated_at": "2018-10-09T21:30:29Z",
            "author_association": "CONTRIBUTOR",
            "body": "Fixed the commit messages @ThiefMaster. \r\n\r\nRe: deep copying, you're right - though it's worth noting that the same issue is already true for `flask.request` which is also susceptible to shallow copy issues with mutable objects. All the same I reproduced a shallowcopy issue on `flask.session` with `threading` (can't replicate it with `greenlet`) and confirmed that it's easily fixed by using `copy.deepcopy(session)` so I'm happy to make that change\r\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/428367364",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-428367364",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 428367364,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyODM2NzM2NA==",
            "user": {
                "login": "dchevell",
                "id": 4359608,
                "node_id": "MDQ6VXNlcjQzNTk2MDg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/4359608?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/dchevell",
                "html_url": "https://github.com/dchevell",
                "followers_url": "https://api.github.com/users/dchevell/followers",
                "following_url": "https://api.github.com/users/dchevell/following{/other_user}",
                "gists_url": "https://api.github.com/users/dchevell/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/dchevell/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dchevell/subscriptions",
                "organizations_url": "https://api.github.com/users/dchevell/orgs",
                "repos_url": "https://api.github.com/users/dchevell/repos",
                "events_url": "https://api.github.com/users/dchevell/events{/privacy}",
                "received_events_url": "https://api.github.com/users/dchevell/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-09T21:58:12Z",
            "updated_at": "2018-10-09T21:58:41Z",
            "author_association": "CONTRIBUTOR",
            "body": "@ThiefMaster is there a chance users would store things in the session object that would fail a deepcopy? I don't want to break people's code. Perhaps a more conservative approach would be:\r\n\r\n```python\r\ntry:\r\n    reqctx.session = deepcopy(session)\r\nexcept TypeError:\r\n    reqctx.session = session.copy()\r\n```"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/428368551",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-428368551",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 428368551,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyODM2ODU1MQ==",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-09T22:02:38Z",
            "updated_at": "2018-10-09T22:02:38Z",
            "author_association": "MEMBER",
            "body": "https://github.com/pallets/flask/blob/master/flask/json/tag.py\r\n\r\nBy default only the object types handled in there can be stored in a session"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/428370116",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-428370116",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 428370116,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyODM3MDExNg==",
            "user": {
                "login": "dchevell",
                "id": 4359608,
                "node_id": "MDQ6VXNlcjQzNTk2MDg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/4359608?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/dchevell",
                "html_url": "https://github.com/dchevell",
                "followers_url": "https://api.github.com/users/dchevell/followers",
                "following_url": "https://api.github.com/users/dchevell/following{/other_user}",
                "gists_url": "https://api.github.com/users/dchevell/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/dchevell/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dchevell/subscriptions",
                "organizations_url": "https://api.github.com/users/dchevell/orgs",
                "repos_url": "https://api.github.com/users/dchevell/repos",
                "events_url": "https://api.github.com/users/dchevell/events{/privacy}",
                "received_events_url": "https://api.github.com/users/dchevell/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-09T22:08:42Z",
            "updated_at": "2018-10-09T22:08:42Z",
            "author_association": "CONTRIBUTOR",
            "body": "Ah, no worries then. Alright, switched to deepcopy."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/429578546",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-429578546",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 429578546,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyOTU3ODU0Ng==",
            "user": {
                "login": "dchevell",
                "id": 4359608,
                "node_id": "MDQ6VXNlcjQzNTk2MDg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/4359608?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/dchevell",
                "html_url": "https://github.com/dchevell",
                "followers_url": "https://api.github.com/users/dchevell/followers",
                "following_url": "https://api.github.com/users/dchevell/following{/other_user}",
                "gists_url": "https://api.github.com/users/dchevell/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/dchevell/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dchevell/subscriptions",
                "organizations_url": "https://api.github.com/users/dchevell/orgs",
                "repos_url": "https://api.github.com/users/dchevell/repos",
                "events_url": "https://api.github.com/users/dchevell/events{/privacy}",
                "received_events_url": "https://api.github.com/users/dchevell/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-13T21:56:48Z",
            "updated_at": "2018-10-13T21:56:48Z",
            "author_association": "CONTRIBUTOR",
            "body": "Anything further needed to review this @ThiefMaster ?"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/429580412",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-429580412",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 429580412,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyOTU4MDQxMg==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-13T22:27:05Z",
            "updated_at": "2018-10-13T22:27:05Z",
            "author_association": "MEMBER",
            "body": "Perhaps we should expose a method on the session interface for copying, so the dev can override deepcopy vs copy?"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/429580791",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-429580791",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 429580791,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyOTU4MDc5MQ==",
            "user": {
                "login": "dchevell",
                "id": 4359608,
                "node_id": "MDQ6VXNlcjQzNTk2MDg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/4359608?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/dchevell",
                "html_url": "https://github.com/dchevell",
                "followers_url": "https://api.github.com/users/dchevell/followers",
                "following_url": "https://api.github.com/users/dchevell/following{/other_user}",
                "gists_url": "https://api.github.com/users/dchevell/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/dchevell/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dchevell/subscriptions",
                "organizations_url": "https://api.github.com/users/dchevell/orgs",
                "repos_url": "https://api.github.com/users/dchevell/repos",
                "events_url": "https://api.github.com/users/dchevell/events{/privacy}",
                "received_events_url": "https://api.github.com/users/dchevell/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-13T22:33:25Z",
            "updated_at": "2018-10-13T22:33:25Z",
            "author_association": "CONTRIBUTOR",
            "body": "@davidism do you mean along the lines of, `@copy_current_request_context(deepcopy_session=True)` ? \r\n\r\nDo you think there are cases to want both behaviours? deepcopy seems safer, since the intent of the method isn't to provide references back to the original objects. I can imagine a case where a user would prefer deepcopy, but not one where they'd prefer a shallow copy."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/429581190",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-429581190",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 429581190,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyOTU4MTE5MA==",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-13T22:40:48Z",
            "updated_at": "2018-10-13T22:40:48Z",
            "author_association": "MEMBER",
            "body": "Maybe an attribute on the Flask class or the session interface (pointing to the copy function to use)? I'd rather subclass once instead of having to specify this again and again."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/429581898",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-429581898",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 429581898,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyOTU4MTg5OA==",
            "user": {
                "login": "dchevell",
                "id": 4359608,
                "node_id": "MDQ6VXNlcjQzNTk2MDg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/4359608?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/dchevell",
                "html_url": "https://github.com/dchevell",
                "followers_url": "https://api.github.com/users/dchevell/followers",
                "following_url": "https://api.github.com/users/dchevell/following{/other_user}",
                "gists_url": "https://api.github.com/users/dchevell/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/dchevell/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dchevell/subscriptions",
                "organizations_url": "https://api.github.com/users/dchevell/orgs",
                "repos_url": "https://api.github.com/users/dchevell/repos",
                "events_url": "https://api.github.com/users/dchevell/events{/privacy}",
                "received_events_url": "https://api.github.com/users/dchevell/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-13T22:53:43Z",
            "updated_at": "2018-10-13T23:11:12Z",
            "author_association": "CONTRIBUTOR",
            "body": "I can do that. First, though, what's the benefit here? What does offering shallow vs deep copy achieve?  Adding API surface increases cost (testability, complexity, documentation, etc.) and given the purpose of this helper function is for the fairly narrow use case of creating a context copy for use in threads or greenlets I'm not sure what shallow copies buy us. Happy to be overruled but I'd like to make sure before I touch any other code."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/430083120",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-430083120",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 430083120,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDA4MzEyMA==",
            "user": {
                "login": "dchevell",
                "id": 4359608,
                "node_id": "MDQ6VXNlcjQzNTk2MDg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/4359608?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/dchevell",
                "html_url": "https://github.com/dchevell",
                "followers_url": "https://api.github.com/users/dchevell/followers",
                "following_url": "https://api.github.com/users/dchevell/following{/other_user}",
                "gists_url": "https://api.github.com/users/dchevell/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/dchevell/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dchevell/subscriptions",
                "organizations_url": "https://api.github.com/users/dchevell/orgs",
                "repos_url": "https://api.github.com/users/dchevell/repos",
                "events_url": "https://api.github.com/users/dchevell/events{/privacy}",
                "received_events_url": "https://api.github.com/users/dchevell/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-16T02:54:53Z",
            "updated_at": "2018-10-16T02:54:53Z",
            "author_association": "CONTRIBUTOR",
            "body": "Just checking in with @davidism to see if there's value / benefit in adding new API's to allow multiple copy behaviours - I'm still erring on the side of not, since this is already pretty edge-casey and it seems like an edge case of an edge case. Still, open to other opinions."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/432052138",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-432052138",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 432052138,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMjA1MjEzOA==",
            "user": {
                "login": "okeuday",
                "id": 61850,
                "node_id": "MDQ6VXNlcjYxODUw",
                "avatar_url": "https://avatars2.githubusercontent.com/u/61850?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/okeuday",
                "html_url": "https://github.com/okeuday",
                "followers_url": "https://api.github.com/users/okeuday/followers",
                "following_url": "https://api.github.com/users/okeuday/following{/other_user}",
                "gists_url": "https://api.github.com/users/okeuday/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/okeuday/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/okeuday/subscriptions",
                "organizations_url": "https://api.github.com/users/okeuday/orgs",
                "repos_url": "https://api.github.com/users/okeuday/repos",
                "events_url": "https://api.github.com/users/okeuday/events{/privacy}",
                "received_events_url": "https://api.github.com/users/okeuday/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-23T01:32:40Z",
            "updated_at": "2018-10-23T01:32:40Z",
            "author_association": "NONE",
            "body": "A separate problem is that `flask.copy_current_request_context` is calling `RequestContext` `copy` which does not copy the contents of `environ`.  By not having a copy of `environ` when using `copy_current_request_context` with threads, it is possible for an old request to get data from a new request (in flask 1.0.2) (e.g., `request.method`).  Such behavior seems to be justified by the code comment of the `RequestContext` `copy` function when it says \"Because the actual request object is the same this cannot be used to move a request context to a different thread unless access to the request object is locked.\".  This indicates that `flask.copy_current_request_context` was previously meant to do a shallow copy and any deep copy functionality should require a boolean flag argument or a separate function.\r\n\r\nI would like to use `flask.copy_current_request_context` if it was copying the `request` `environ`, so I would suggest adding a `deep` boolean keyword argument (defaulting to `False`) to the `RequestContext` `copy` function which is utilized when a boolean flag is passed to `flask.copy_current_request_context`.  However, I know that is separate from @dchevell 's pursuit of a session copy."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/432061048",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-432061048",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 432061048,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMjA2MTA0OA==",
            "user": {
                "login": "dchevell",
                "id": 4359608,
                "node_id": "MDQ6VXNlcjQzNTk2MDg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/4359608?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/dchevell",
                "html_url": "https://github.com/dchevell",
                "followers_url": "https://api.github.com/users/dchevell/followers",
                "following_url": "https://api.github.com/users/dchevell/following{/other_user}",
                "gists_url": "https://api.github.com/users/dchevell/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/dchevell/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dchevell/subscriptions",
                "organizations_url": "https://api.github.com/users/dchevell/orgs",
                "repos_url": "https://api.github.com/users/dchevell/repos",
                "events_url": "https://api.github.com/users/dchevell/events{/privacy}",
                "received_events_url": "https://api.github.com/users/dchevell/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-23T02:13:46Z",
            "updated_at": "2018-10-23T02:13:46Z",
            "author_association": "CONTRIBUTOR",
            "body": "@okeuday To confirm, that's talking about deepcopying the *request*, not the *session*, right? (Of course, it would make sense to go all or nothing)\r\n\r\n*Can* you deepcopy a request? I mean, you can't do it directly - you'll get `TypeError: can't pickle _thread.lock objects`. I'm sure this is solvable but unlike the session object it's not so trivial. \r\n\r\nWhat are your thoughts on reverting this change back to the original shallow copy implementation, then opening a separate issue for a true deepcopy for both `flask.request` and `flask.session` as you and @davidism suggested? It seems like a worthy pursuit, but we're moving beyond the scope of this PR and the original issue."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/432065973",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-432065973",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 432065973,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMjA2NTk3Mw==",
            "user": {
                "login": "okeuday",
                "id": 61850,
                "node_id": "MDQ6VXNlcjYxODUw",
                "avatar_url": "https://avatars2.githubusercontent.com/u/61850?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/okeuday",
                "html_url": "https://github.com/okeuday",
                "followers_url": "https://api.github.com/users/okeuday/followers",
                "following_url": "https://api.github.com/users/okeuday/following{/other_user}",
                "gists_url": "https://api.github.com/users/okeuday/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/okeuday/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/okeuday/subscriptions",
                "organizations_url": "https://api.github.com/users/okeuday/orgs",
                "repos_url": "https://api.github.com/users/okeuday/repos",
                "events_url": "https://api.github.com/users/okeuday/events{/privacy}",
                "received_events_url": "https://api.github.com/users/okeuday/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-23T02:37:01Z",
            "updated_at": "2018-10-23T02:37:01Z",
            "author_association": "NONE",
            "body": "@dchevell I would agree that a deep copy is best that handles the `flask.request` and `flask.session`.  I am not sure if it needs a separate PR because they both seem related and it seems like people would likely want both to get a deep copy.  `flask.copy_current_request_context` seems like a name that covers both a shallow copy and a deep copy, so it seems like it needs a function argument to switch between the different behavior.  For the request copy, when not modifying `RequestContext` `copy`, I found it necessary to modify `flask.copy_current_request_context` so it looks like:\r\n\r\n    def _copy_current_request_context(function):\r\n        top = _request_ctx_stack.top\r\n        if top is None:\r\n            raise RuntimeError('This decorator can only be used at local scopes '\r\n                               'when a request context is on the stack.  '\r\n                               'For instance within view functions.')\r\n        reqctx = top.copy()\r\n        # environ is used by headers too, so only a copy of environ is necessary\r\n        reqctx.request.environ = reqctx.request.environ.copy()\r\n        def wrapper(*args, **kwargs):\r\n            with reqctx:\r\n                return function(*args, **kwargs)\r\n        return update_wrapper(wrapper, function)\r\n\r\nIt should be better to modify `RequestContext` `copy` to do the `environ` copy if a `deep` keyword argument is passed."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/432072299",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-432072299",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 432072299,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMjA3MjI5OQ==",
            "user": {
                "login": "dchevell",
                "id": 4359608,
                "node_id": "MDQ6VXNlcjQzNTk2MDg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/4359608?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/dchevell",
                "html_url": "https://github.com/dchevell",
                "followers_url": "https://api.github.com/users/dchevell/followers",
                "following_url": "https://api.github.com/users/dchevell/following{/other_user}",
                "gists_url": "https://api.github.com/users/dchevell/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/dchevell/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dchevell/subscriptions",
                "organizations_url": "https://api.github.com/users/dchevell/orgs",
                "repos_url": "https://api.github.com/users/dchevell/repos",
                "events_url": "https://api.github.com/users/dchevell/events{/privacy}",
                "received_events_url": "https://api.github.com/users/dchevell/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-23T03:07:50Z",
            "updated_at": "2018-10-23T03:07:50Z",
            "author_association": "CONTRIBUTOR",
            "body": "@okeuday not sure I agree - the scope of this PR was simply, copies of the current request contain the previous session object. Shallow copy / deep copy covers the same area of code, but it's an entirely separate set of concerns. Other than touching the same code, I don't see a relationship between them. \r\n\r\nI agree that a deepcopy has value, just not that it fits within the scope of #2935"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/432094299",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-432094299",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 432094299,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMjA5NDI5OQ==",
            "user": {
                "login": "okeuday",
                "id": 61850,
                "node_id": "MDQ6VXNlcjYxODUw",
                "avatar_url": "https://avatars2.githubusercontent.com/u/61850?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/okeuday",
                "html_url": "https://github.com/okeuday",
                "followers_url": "https://api.github.com/users/okeuday/followers",
                "following_url": "https://api.github.com/users/okeuday/following{/other_user}",
                "gists_url": "https://api.github.com/users/okeuday/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/okeuday/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/okeuday/subscriptions",
                "organizations_url": "https://api.github.com/users/okeuday/orgs",
                "repos_url": "https://api.github.com/users/okeuday/repos",
                "events_url": "https://api.github.com/users/okeuday/events{/privacy}",
                "received_events_url": "https://api.github.com/users/okeuday/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-23T05:09:40Z",
            "updated_at": "2018-10-23T05:09:40Z",
            "author_association": "NONE",
            "body": "@dchevell Ok, np, I moved the deep copy of the current request information to https://github.com/pallets/flask/issues/2960"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/432095847",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-432095847",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 432095847,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMjA5NTg0Nw==",
            "user": {
                "login": "dchevell",
                "id": 4359608,
                "node_id": "MDQ6VXNlcjQzNTk2MDg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/4359608?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/dchevell",
                "html_url": "https://github.com/dchevell",
                "followers_url": "https://api.github.com/users/dchevell/followers",
                "following_url": "https://api.github.com/users/dchevell/following{/other_user}",
                "gists_url": "https://api.github.com/users/dchevell/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/dchevell/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dchevell/subscriptions",
                "organizations_url": "https://api.github.com/users/dchevell/orgs",
                "repos_url": "https://api.github.com/users/dchevell/repos",
                "events_url": "https://api.github.com/users/dchevell/events{/privacy}",
                "received_events_url": "https://api.github.com/users/dchevell/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-10-23T05:18:34Z",
            "updated_at": "2018-10-23T05:20:01Z",
            "author_association": "CONTRIBUTOR",
            "body": "If #2960 covers the need for offering an API for both shallow and deepcopying, I think we should revert the deepcopy change here back to the original shallow copy implementation, then a fix for #2960 should implement a deepcopy option which implements that behaviour for the request *and* session objects"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/435557382",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-435557382",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 435557382,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzNTU1NzM4Mg==",
            "user": {
                "login": "dchevell",
                "id": 4359608,
                "node_id": "MDQ6VXNlcjQzNTk2MDg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/4359608?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/dchevell",
                "html_url": "https://github.com/dchevell",
                "followers_url": "https://api.github.com/users/dchevell/followers",
                "following_url": "https://api.github.com/users/dchevell/following{/other_user}",
                "gists_url": "https://api.github.com/users/dchevell/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/dchevell/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dchevell/subscriptions",
                "organizations_url": "https://api.github.com/users/dchevell/orgs",
                "repos_url": "https://api.github.com/users/dchevell/repos",
                "events_url": "https://api.github.com/users/dchevell/events{/privacy}",
                "received_events_url": "https://api.github.com/users/dchevell/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-11-03T03:43:46Z",
            "updated_at": "2018-11-03T03:44:10Z",
            "author_association": "CONTRIBUTOR",
            "body": "Any more thoughts on this? Given #2960 I would like to revert this to a shallow copy implementation, similar to the existing implementation for how the request object is copied, and then I'd be happy to follow up #2960 to investigate deep copy implementations for both.\r\n\r\n/cc @davidism @ThiefMaster "
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/435629813",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-435629813",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 435629813,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzNTYyOTgxMw==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-11-03T23:47:17Z",
            "updated_at": "2018-11-03T23:49:12Z",
            "author_association": "MEMBER",
            "body": "Looking at the docs for `RequestContext.copy()`:\r\n\r\n> Creates a copy of this request context with the same request object. This can be used to move a request context to a different greenlet. Because the actual request object is the same this cannot be used to move a request context to a different thread unless access to the request object is locked.\r\n\r\nIt's clear copying was never meant to use deepcopy, it requires the user to lock around multiple threads modifying. So let's go back to `copy`. In fact it may even be fine to just do `new.session = session._get_current_object()`, although I think `copy` is fine too, it prevents simple modifications at least."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/435631249",
            "html_url": "https://github.com/pallets/flask/pull/2936#issuecomment-435631249",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2936",
            "id": 435631249,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzNTYzMTI0OQ==",
            "user": {
                "login": "dchevell",
                "id": 4359608,
                "node_id": "MDQ6VXNlcjQzNTk2MDg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/4359608?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/dchevell",
                "html_url": "https://github.com/dchevell",
                "followers_url": "https://api.github.com/users/dchevell/followers",
                "following_url": "https://api.github.com/users/dchevell/following{/other_user}",
                "gists_url": "https://api.github.com/users/dchevell/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/dchevell/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dchevell/subscriptions",
                "organizations_url": "https://api.github.com/users/dchevell/orgs",
                "repos_url": "https://api.github.com/users/dchevell/repos",
                "events_url": "https://api.github.com/users/dchevell/events{/privacy}",
                "received_events_url": "https://api.github.com/users/dchevell/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-11-04T00:14:59Z",
            "updated_at": "2018-11-04T00:14:59Z",
            "author_association": "CONTRIBUTOR",
            "body": "Thanks for the pointers @davidism  - would you mind checking the latest diff to confirm if it matches what you were thinking?"
        }
    ]
}