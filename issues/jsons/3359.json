{
    "url": "https://api.github.com/repos/pallets/flask/issues/3359",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/3359/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/3359/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/3359/events",
    "html_url": "https://github.com/pallets/flask/issues/3359",
    "id": 491619125,
    "node_id": "MDU6SXNzdWU0OTE2MTkxMjU=",
    "number": 3359,
    "title": "Flask generates loggers that may collide with package name hierarchy",
    "user": {
        "login": "jjnurminen",
        "id": 8491321,
        "node_id": "MDQ6VXNlcjg0OTEzMjE=",
        "avatar_url": "https://avatars3.githubusercontent.com/u/8491321?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jjnurminen",
        "html_url": "https://github.com/jjnurminen",
        "followers_url": "https://api.github.com/users/jjnurminen/followers",
        "following_url": "https://api.github.com/users/jjnurminen/following{/other_user}",
        "gists_url": "https://api.github.com/users/jjnurminen/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/jjnurminen/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jjnurminen/subscriptions",
        "organizations_url": "https://api.github.com/users/jjnurminen/orgs",
        "repos_url": "https://api.github.com/users/jjnurminen/repos",
        "events_url": "https://api.github.com/users/jjnurminen/events{/privacy}",
        "received_events_url": "https://api.github.com/users/jjnurminen/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2019-09-10T11:40:35Z",
    "updated_at": "2019-09-11T13:05:55Z",
    "closed_at": "2019-09-10T12:06:45Z",
    "author_association": "NONE",
    "body": "Hi,\r\n\r\nI have a Python package, let's call it `mypackage`. After creating a Flask app inside the package, I noticed that all logging messages from my own package started appearing twice.\r\n\r\nI tracked the cause to Flask automatically creating a `logging.Logger` instance (accessible as `app.logger`) that has the name `mypackage`. This follows from the fact that name of my Flask app is also `mypackage` (this is required to set up some static assets correctly). However, as `logging.Logger` instances are singletons, Flask ends up accessing an existing logger inside my package hierarchy and silently attaching its own stderr handler to it. Since all logging messages from my package end up propagating into the `mypackage` logger (before they propagate to the root logger), I now get all log messages twice.\r\n\r\nPossible remedies that I can think\r\n\r\n- do not automatically set up logging handlers inside Flask, or only set them up in special circumstances\r\n- if the app logger really needs to be automagically set up and equipped with a handler, give it a name of 'Flask.{insert_appname}' or something to reduce chance of name collisions\r\n\r\nUsing Flask 1.1.1, Python 2.7.16\r\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/529904256",
            "html_url": "https://github.com/pallets/flask/issues/3359#issuecomment-529904256",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3359",
            "id": 529904256,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTkwNDI1Ng==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-09-10T12:06:45Z",
            "updated_at": "2019-09-10T12:06:45Z",
            "author_association": "MEMBER",
            "body": "Flask only attaches a handler if none are availablr already. Configure logging before accessing `app.logger` to avoid that.\r\n\r\nI'm not changing this again. I can't make everyone happy, and the behavior has been this way forever. Override `Flask.logger()` if you need other behavior."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/529916040",
            "html_url": "https://github.com/pallets/flask/issues/3359#issuecomment-529916040",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3359",
            "id": 529916040,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTkxNjA0MA==",
            "user": {
                "login": "jjnurminen",
                "id": 8491321,
                "node_id": "MDQ6VXNlcjg0OTEzMjE=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/8491321?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/jjnurminen",
                "html_url": "https://github.com/jjnurminen",
                "followers_url": "https://api.github.com/users/jjnurminen/followers",
                "following_url": "https://api.github.com/users/jjnurminen/following{/other_user}",
                "gists_url": "https://api.github.com/users/jjnurminen/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/jjnurminen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jjnurminen/subscriptions",
                "organizations_url": "https://api.github.com/users/jjnurminen/orgs",
                "repos_url": "https://api.github.com/users/jjnurminen/repos",
                "events_url": "https://api.github.com/users/jjnurminen/events{/privacy}",
                "received_events_url": "https://api.github.com/users/jjnurminen/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-09-10T12:41:19Z",
            "updated_at": "2019-09-10T12:41:19Z",
            "author_association": "NONE",
            "body": ">Flask only attaches a handler if none are availablr already. Configure logging before accessing >app.logger to avoid that\r\n\r\n@davidism  I never accessed `app.logger`, it got accessed due to the name collision. I think changing the logger name, as suggested above, would be an easy way to avoid Flask loggers being confused with existing loggers.\r\n\r\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/529916988",
            "html_url": "https://github.com/pallets/flask/issues/3359#issuecomment-529916988",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3359",
            "id": 529916988,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTkxNjk4OA==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-09-10T12:43:51Z",
            "updated_at": "2019-09-10T12:43:51Z",
            "author_association": "MEMBER",
            "body": "Then something else is going on in your code. Flask only configures the logger when it's accessed through that proprety and is not already configured."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/529926506",
            "html_url": "https://github.com/pallets/flask/issues/3359#issuecomment-529926506",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3359",
            "id": 529926506,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTkyNjUwNg==",
            "user": {
                "login": "jjnurminen",
                "id": 8491321,
                "node_id": "MDQ6VXNlcjg0OTEzMjE=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/8491321?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/jjnurminen",
                "html_url": "https://github.com/jjnurminen",
                "followers_url": "https://api.github.com/users/jjnurminen/followers",
                "following_url": "https://api.github.com/users/jjnurminen/following{/other_user}",
                "gists_url": "https://api.github.com/users/jjnurminen/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/jjnurminen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jjnurminen/subscriptions",
                "organizations_url": "https://api.github.com/users/jjnurminen/orgs",
                "repos_url": "https://api.github.com/users/jjnurminen/repos",
                "events_url": "https://api.github.com/users/jjnurminen/events{/privacy}",
                "received_events_url": "https://api.github.com/users/jjnurminen/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-09-10T13:09:19Z",
            "updated_at": "2019-09-10T13:09:19Z",
            "author_association": "NONE",
            "body": "@davidism Regardless of the configuration issue, I think Flask will rather easily end up using an existing logger due to a name collision (as the logging module provides loggers as singletons). IMO this is not desirable and could be easily avoided by naming the logger differently.\r\n\r\nThe logger getting configured automatically is another issue. I'm 100% sure my code is not touching `app.logger` (I was not even aware of it before I started debugging). However I'm using Flask via the Dash library, which may be doing something with `app.logger`.\r\n\r\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/529996311",
            "html_url": "https://github.com/pallets/flask/issues/3359#issuecomment-529996311",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3359",
            "id": 529996311,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTk5NjMxMQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-09-10T15:40:11Z",
            "updated_at": "2019-09-10T15:40:11Z",
            "author_association": "MEMBER",
            "body": "That it shares the name with your project is intentional. Your app *is* your project. It is explicitly bound to the package name by `Flask(__name__)`. `app.logger` is used to log things you're doing from your app. If we were to log things about Flask's internals, then we'd use the `flask.app` name.\r\n\r\nIf your messages are appearing twice, it's because you configured your own handler *after* touching `app.logger`. Regardless of if you're using Flask, it is always good practice to configure logging as early as possible. Move your logging configuration to earlier in your startup process. If it's Dash that's doing this, and it's not fixed by moving the configuration earlier, then take it up with Dash.\r\n\r\nOr if you want to change the behavior more thoroughly, override the `Flask.logger()` property with your own implementation, such as returning a logger with your preferred name.\r\n\r\n```python\r\nimport logging\r\n\r\nfrom flask import Flask\r\nfrom flask.helpers import locked_cached_property\r\n\r\nclass MyFlask(Flask):\r\n    @locked_cached_property\r\n    def logger():\r\n        return logging.getLogger(\"myproject.myapp\")\r\n\r\napp = MyFlask(__name__)\r\n```\r\n\r\nI already tried changing this to `flask.app`, and received valid issues asking to change it back. `flask.{name}` is confusing as it looks like messages logged from your project code are actually part of Flask's code. I do not plan to change the behavior of `app.logger` again at this point, at least as described by this issue."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/530371081",
            "html_url": "https://github.com/pallets/flask/issues/3359#issuecomment-530371081",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3359",
            "id": 530371081,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUzMDM3MTA4MQ==",
            "user": {
                "login": "jjnurminen",
                "id": 8491321,
                "node_id": "MDQ6VXNlcjg0OTEzMjE=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/8491321?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/jjnurminen",
                "html_url": "https://github.com/jjnurminen",
                "followers_url": "https://api.github.com/users/jjnurminen/followers",
                "following_url": "https://api.github.com/users/jjnurminen/following{/other_user}",
                "gists_url": "https://api.github.com/users/jjnurminen/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/jjnurminen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jjnurminen/subscriptions",
                "organizations_url": "https://api.github.com/users/jjnurminen/orgs",
                "repos_url": "https://api.github.com/users/jjnurminen/repos",
                "events_url": "https://api.github.com/users/jjnurminen/events{/privacy}",
                "received_events_url": "https://api.github.com/users/jjnurminen/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-09-11T13:05:55Z",
            "updated_at": "2019-09-11T13:05:55Z",
            "author_association": "NONE",
            "body": "Thanks for your trouble @davidism . I understand the point about naming the logger.\r\n\r\nFWIW, it turned out to be Dash that forcibly installs a logging handler. I'll take the issue up with them."
        }
    ]
}