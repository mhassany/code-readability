{
    "url": "https://api.github.com/repos/pallets/flask/issues/2008",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2008/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2008/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2008/events",
    "html_url": "https://github.com/pallets/flask/issues/2008",
    "id": 175333327,
    "node_id": "MDU6SXNzdWUxNzUzMzMzMjc=",
    "number": 2008,
    "title": "AttributeError: 'str' object has no attribute 'write' during unhandled exception logging",
    "user": {
        "login": "Miserlou",
        "id": 139987,
        "node_id": "MDQ6VXNlcjEzOTk4Nw==",
        "avatar_url": "https://avatars1.githubusercontent.com/u/139987?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Miserlou",
        "html_url": "https://github.com/Miserlou",
        "followers_url": "https://api.github.com/users/Miserlou/followers",
        "following_url": "https://api.github.com/users/Miserlou/following{/other_user}",
        "gists_url": "https://api.github.com/users/Miserlou/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/Miserlou/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Miserlou/subscriptions",
        "organizations_url": "https://api.github.com/users/Miserlou/orgs",
        "repos_url": "https://api.github.com/users/Miserlou/repos",
        "events_url": "https://api.github.com/users/Miserlou/events{/privacy}",
        "received_events_url": "https://api.github.com/users/Miserlou/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 8,
    "created_at": "2016-09-06T19:42:55Z",
    "updated_at": "2017-01-14T23:26:07Z",
    "closed_at": "2016-09-06T20:51:44Z",
    "author_association": "NONE",
    "body": "Flask + Zappa users are complaining about an error stemming from Flask's logging of exceptions.\n\nWe can reproduce this by generating an unhandled exception in a Flask application that breaks our handler's behavior, but which works for other frameworks (Django, Pyramid, etc.).\n\nIt looks like something in Flask is treating a string as if it were a stream, but I've been trying to disable all possible logging and I still see this error. I don't know what's happening. This is occurring with the Flask==0.11.1.\n\nHere is an example:\n\n```\n[1473180521973] Traceback (most recent call last):\n[1473180521973] File \"/usr/lib64/python2.7/logging/init.py\", line 880, in emit\n[1473180521992] stream.write(fs % msg)\n[1473180521992] File \"/private/var/folders/00/vp4bg2md3ng4sqkg3hrz_j1003frjd/T/pip-build-RmqRtJ/Werkzeug/werkzeug/local.py\", line 343, in getattr\n[1473180521992] AttributeError: 'str' object has no attribute 'write'\n[1473180521992] Logged from file app.py, line 1587\n[1473180521992] [ERROR] 2016-09-06T16:48:41.973Z c29bebc5-7451-11e6-a6f9-bdc91c60ab58 Exception on /fail [GET]\nTraceback (most recent call last):\nFile \"/private/var/folders/00/vp4bg2md3ng4sqkg3hrz_j1003frjd/T/pip-build-KC9Xdu/flask/flask/app.py\", line 1988, in wsgi_app\nFile \"/private/var/folders/00/vp4bg2md3ng4sqkg3hrz_j1003frjd/T/pip-build-KC9Xdu/flask/flask/app.py\", line 1641, in full_dispatch_request\nFile \"/private/var/folders/00/vp4bg2md3ng4sqkg3hrz_j1003frjd/T/pip-build-KC9Xdu/flask/flask/app.py\", line 1544, in handle_user_exception\nFile \"/private/var/folders/00/vp4bg2md3ng4sqkg3hrz_j1003frjd/T/pip-build-KC9Xdu/flask/flask/app.py\", line 1639, in full_dispatch_request\nFile \"/private/var/folders/00/vp4bg2md3ng4sqkg3hrz_j1003frjd/T/pip-build-KC9Xdu/flask/flask/app.py\", line 1625, in dispatch_request\nFile \"/var/task/app.py\", line 22, in fail\nreturn 1/0\nZeroDivisionError: integer division or modulo by zero\n```\n\nHere is an example using Pyramid instead, failing as expected:\nhttps://css89s7off.execute-api.us-east-1.amazonaws.com/dev/hello/asdf\n\nand the same error in Flask, failing with the stream writing error:\nhttps://pxzhirpoxd.execute-api.us-east-1.amazonaws.com/devor/fail\n\nI am not sure what exactly is happening, and nobody in our little community has been able to figure it out either. We use Werkzeug for some middleware functionality, but since the other frameworks use this same code, I don't think this is the issue, unless there is a specific interaction between Flask and WZ, which I don't think there is.\n\nSo, I have a few theories:\n    \\* A log handler has been configured to write to a file by default. Since Lambda is (essentially) a read-only environment, this will fail.\n    \\* Code written for Python 3 isn't properly working in Python 2.\n    \\* Something related to this is happening: https://github.com/pallets/flask/issues/1995\n\nDoes anybody have any ideas what might be happening here?\n\nRelated tickets and discussion:\nhttps://github.com/Miserlou/Zappa/issues/283\nhttps://github.com/Miserlou/Zappa/pull/302\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/245081832",
            "html_url": "https://github.com/pallets/flask/issues/2008#issuecomment-245081832",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2008",
            "id": 245081832,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI0NTA4MTgzMg==",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-09-06T20:34:27Z",
            "updated_at": "2016-09-06T20:34:27Z",
            "author_association": "MEMBER",
            "body": "This does seem like a Werkzeug bug. Could you post the output of `pip freeze`?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/245082914",
            "html_url": "https://github.com/pallets/flask/issues/2008#issuecomment-245082914",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2008",
            "id": 245082914,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI0NTA4MjkxNA==",
            "user": {
                "login": "Miserlou",
                "id": 139987,
                "node_id": "MDQ6VXNlcjEzOTk4Nw==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/139987?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/Miserlou",
                "html_url": "https://github.com/Miserlou",
                "followers_url": "https://api.github.com/users/Miserlou/followers",
                "following_url": "https://api.github.com/users/Miserlou/following{/other_user}",
                "gists_url": "https://api.github.com/users/Miserlou/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/Miserlou/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Miserlou/subscriptions",
                "organizations_url": "https://api.github.com/users/Miserlou/orgs",
                "repos_url": "https://api.github.com/users/Miserlou/repos",
                "events_url": "https://api.github.com/users/Miserlou/events{/privacy}",
                "received_events_url": "https://api.github.com/users/Miserlou/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-09-06T20:37:58Z",
            "updated_at": "2016-09-06T20:37:58Z",
            "author_association": "NONE",
            "body": "Werkzeug==0.11.10\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/245087224",
            "html_url": "https://github.com/pallets/flask/issues/2008#issuecomment-245087224",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2008",
            "id": 245087224,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI0NTA4NzIyNA==",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-09-06T20:51:44Z",
            "updated_at": "2016-09-06T20:51:44Z",
            "author_association": "MEMBER",
            "body": "To be honest I don't see anything actionable in this bugreport. I can't see a reason why, under proper usage, the `stream` used for logging would be a Werkzeug local proxy. The best thing I can advise here is to run a modified Werkzeug that prints the repr of `_get_current_object()`'s return value right here: https://github.com/pallets/werkzeug/blob/79190a5be3e3267feb5c110ffff26ff0c28e0347/werkzeug/local.py#L343 , or use pdb to debug this. Anyway I think it's too soon to say that there's any bug in Flask or Werkzeug.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/245087731",
            "html_url": "https://github.com/pallets/flask/issues/2008#issuecomment-245087731",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2008",
            "id": 245087731,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI0NTA4NzczMQ==",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-09-06T20:53:23Z",
            "updated_at": "2016-09-06T20:53:23Z",
            "author_association": "MEMBER",
            "body": "(BTW #1995 is unrelated as far as I can tell)\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/262984831",
            "html_url": "https://github.com/pallets/flask/issues/2008#issuecomment-262984831",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2008",
            "id": 262984831,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI2Mjk4NDgzMQ==",
            "user": {
                "login": "albe-rosado",
                "id": 18025582,
                "node_id": "MDQ6VXNlcjE4MDI1NTgy",
                "avatar_url": "https://avatars2.githubusercontent.com/u/18025582?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/albe-rosado",
                "html_url": "https://github.com/albe-rosado",
                "followers_url": "https://api.github.com/users/albe-rosado/followers",
                "following_url": "https://api.github.com/users/albe-rosado/following{/other_user}",
                "gists_url": "https://api.github.com/users/albe-rosado/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/albe-rosado/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/albe-rosado/subscriptions",
                "organizations_url": "https://api.github.com/users/albe-rosado/orgs",
                "repos_url": "https://api.github.com/users/albe-rosado/repos",
                "events_url": "https://api.github.com/users/albe-rosado/events{/privacy}",
                "received_events_url": "https://api.github.com/users/albe-rosado/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-11-25T15:53:17Z",
            "updated_at": "2016-11-25T15:53:17Z",
            "author_association": "NONE",
            "body": "I'm having the same error\r\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/272601639",
            "html_url": "https://github.com/pallets/flask/issues/2008#issuecomment-272601639",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2008",
            "id": 272601639,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjYwMTYzOQ==",
            "user": {
                "login": "dacut",
                "id": 1291220,
                "node_id": "MDQ6VXNlcjEyOTEyMjA=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1291220?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/dacut",
                "html_url": "https://github.com/dacut",
                "followers_url": "https://api.github.com/users/dacut/followers",
                "following_url": "https://api.github.com/users/dacut/following{/other_user}",
                "gists_url": "https://api.github.com/users/dacut/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/dacut/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dacut/subscriptions",
                "organizations_url": "https://api.github.com/users/dacut/orgs",
                "repos_url": "https://api.github.com/users/dacut/repos",
                "events_url": "https://api.github.com/users/dacut/events{/privacy}",
                "received_events_url": "https://api.github.com/users/dacut/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-01-14T04:43:27Z",
            "updated_at": "2017-01-14T04:43:27Z",
            "author_association": "NONE",
            "body": "Doing some cheezy print()-style debugging, things mysteriously work when I replace the call to `StreamHandler.emit()` in `ProductionHandler.emit()` with the actual method body from `StreamHandler.emit()`.\r\n\r\nUnfortunately, it's impossible to replace the logging module since it's part of the Lambda startup environment.\r\n\r\nLambda definitely has some custom logging bits in there (that's how it gets it into CloudWatch, for example). I'll take a look at the AMI."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/272661037",
            "html_url": "https://github.com/pallets/flask/issues/2008#issuecomment-272661037",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2008",
            "id": 272661037,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjY2MTAzNw==",
            "user": {
                "login": "dacut",
                "id": 1291220,
                "node_id": "MDQ6VXNlcjEyOTEyMjA=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1291220?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/dacut",
                "html_url": "https://github.com/dacut",
                "followers_url": "https://api.github.com/users/dacut/followers",
                "following_url": "https://api.github.com/users/dacut/following{/other_user}",
                "gists_url": "https://api.github.com/users/dacut/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/dacut/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dacut/subscriptions",
                "organizations_url": "https://api.github.com/users/dacut/orgs",
                "repos_url": "https://api.github.com/users/dacut/repos",
                "events_url": "https://api.github.com/users/dacut/events{/privacy}",
                "received_events_url": "https://api.github.com/users/dacut/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-01-14T23:23:56Z",
            "updated_at": "2017-01-14T23:23:56Z",
            "author_association": "NONE",
            "body": "This turned out to be a Zappa bug, where it was initializing wsgi.errors to \"\" instead of a stream -- see related issue."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/272661164",
            "html_url": "https://github.com/pallets/flask/issues/2008#issuecomment-272661164",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2008",
            "id": 272661164,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjY2MTE2NA==",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-01-14T23:26:07Z",
            "updated_at": "2017-01-14T23:26:07Z",
            "author_association": "MEMBER",
            "body": "Good to know, thanks for reporting back."
        }
    ]
}