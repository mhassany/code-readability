{
    "url": "https://api.github.com/repos/pallets/flask/issues/3263",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/3263/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/3263/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/3263/events",
    "html_url": "https://github.com/pallets/flask/issues/3263",
    "id": 456562526,
    "node_id": "MDU6SXNzdWU0NTY1NjI1MjY=",
    "number": 3263,
    "title": "FlaskGroup does not work when nested in a click.group",
    "user": {
        "login": "gustapia06",
        "id": 21017154,
        "node_id": "MDQ6VXNlcjIxMDE3MTU0",
        "avatar_url": "https://avatars2.githubusercontent.com/u/21017154?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gustapia06",
        "html_url": "https://github.com/gustapia06",
        "followers_url": "https://api.github.com/users/gustapia06/followers",
        "following_url": "https://api.github.com/users/gustapia06/following{/other_user}",
        "gists_url": "https://api.github.com/users/gustapia06/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/gustapia06/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gustapia06/subscriptions",
        "organizations_url": "https://api.github.com/users/gustapia06/orgs",
        "repos_url": "https://api.github.com/users/gustapia06/repos",
        "events_url": "https://api.github.com/users/gustapia06/events{/privacy}",
        "received_events_url": "https://api.github.com/users/gustapia06/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2019-06-15T18:11:48Z",
    "updated_at": "2019-06-28T23:43:21Z",
    "closed_at": null,
    "author_association": "NONE",
    "body": "### Expected Behavior\r\nWhen using Flask CLI, I came to the case that we have a group of commands for a big program that uses `click`.\r\n```python\r\n# main group\r\n@click.group()\r\n@click.pass_context\r\ndef my_big_cli_group(ctx):\r\n    pass\r\n\r\n# sub group\r\n@my_big_cli_group.group()\r\n@click.pass_context\r\ndef my_nested_group(ctx):\r\n    pass\r\n\r\n# command for sub group\r\n@my_nested_group.command()\r\n@click.pass_context\r\n@click.option('-s', '--start', is_flag=True)\r\ndef my_command(ctx, start):\r\n    click.echo(start)\r\n```\r\n\r\nThe issue comes when nesting my flask app into the bigger group using `cls=FlaskGroup` and passing my `create_app` factory function.\r\n\r\n```python\r\n# flask app sub group\r\n@my_big_cli_group.group(cls=FlaskGroup, create_app=create_app)\r\n@click.pass_context\r\ndef my_flask_app(ctx):\r\n    pass\r\n```\r\n\r\nAfter running my `setup.py` pointing my entry point to `'my_big_cli = path.to:my_big_cli_group'`, I should expect the app to start once I do:\r\n```bash\r\n$ my_big_cli my_flask_app run\r\n```\r\n\r\n### Actual Behavior\r\nInstead, I get a `flask.cli.NoAppException`. It seems that `create_app` does not get passed on to `Group.group` instances on `click`.\r\n\r\n```pytb\r\nTraceback (most recent call last):\r\n File \u201c/Users/the_user/Desktop/venv/lib/python3.7/site-packages/flask/cli.py\u201d, line 540, in list_commands\r\n   rv.update(info.load_app().cli.list_commands(ctx))\r\n File \u201c/Users/the_user/Desktop/venv/lib/python3.7/site-packages/flask/cli.py\u201d, line 393, in load_app\r\n   \u2018Could not locate a Flask application. You did not provide \u2019\r\nflask.cli.NoAppException: Could not locate a Flask application. You did not provide the \u201cFLASK_APP\u201d environment variable, and a \u201cwsgi.py\u201d or \u201capp.py\u201d module was not found in the current directory.\r\n```\r\n\r\n### Work around\r\nIf I don't nest the flask app into a group but rather make it a new `click.group`, then after changing my `setup.py` to point to this new entry point as well, everything works as expected.\r\n\r\n```python\r\n# flask app group\r\n@click.group(cls=FlaskGroup, create_app=create_app)\r\n@click.pass_context\r\ndef my_flask_app(ctx):\r\n    pass\r\n```\r\nThen\r\n```bash\r\n$ my_flask_app run\r\n```\r\nworks perfectly fine\r\n\r\n\r\n### Environment\r\n\r\n* Python version: 3.7.3\r\n* Flask version: 1.0.3\r\n* Werkzeug version: 0.15.4",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/506627926",
            "html_url": "https://github.com/pallets/flask/issues/3263#issuecomment-506627926",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3263",
            "id": 506627926,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwNjYyNzkyNg==",
            "user": {
                "login": "frostming",
                "id": 16336606,
                "node_id": "MDQ6VXNlcjE2MzM2NjA2",
                "avatar_url": "https://avatars3.githubusercontent.com/u/16336606?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/frostming",
                "html_url": "https://github.com/frostming",
                "followers_url": "https://api.github.com/users/frostming/followers",
                "following_url": "https://api.github.com/users/frostming/following{/other_user}",
                "gists_url": "https://api.github.com/users/frostming/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/frostming/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/frostming/subscriptions",
                "organizations_url": "https://api.github.com/users/frostming/orgs",
                "repos_url": "https://api.github.com/users/frostming/repos",
                "events_url": "https://api.github.com/users/frostming/events{/privacy}",
                "received_events_url": "https://api.github.com/users/frostming/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-06-28T07:05:52Z",
            "updated_at": "2019-06-28T07:05:52Z",
            "author_association": "NONE",
            "body": "There are some bootstrap code in `FlaskGroup.main()`, so I think it is not allowed to nest it in another group, because the function is never called."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/506788187",
            "html_url": "https://github.com/pallets/flask/issues/3263#issuecomment-506788187",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3263",
            "id": 506788187,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwNjc4ODE4Nw==",
            "user": {
                "login": "gustapia06",
                "id": 21017154,
                "node_id": "MDQ6VXNlcjIxMDE3MTU0",
                "avatar_url": "https://avatars2.githubusercontent.com/u/21017154?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/gustapia06",
                "html_url": "https://github.com/gustapia06",
                "followers_url": "https://api.github.com/users/gustapia06/followers",
                "following_url": "https://api.github.com/users/gustapia06/following{/other_user}",
                "gists_url": "https://api.github.com/users/gustapia06/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/gustapia06/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gustapia06/subscriptions",
                "organizations_url": "https://api.github.com/users/gustapia06/orgs",
                "repos_url": "https://api.github.com/users/gustapia06/repos",
                "events_url": "https://api.github.com/users/gustapia06/events{/privacy}",
                "received_events_url": "https://api.github.com/users/gustapia06/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-06-28T16:05:09Z",
            "updated_at": "2019-06-28T16:05:09Z",
            "author_association": "NONE",
            "body": "Ah, interesting. Could there be any workaround for this to be allowed? I guess at the end `Flask` should be fully compatible with all `click` functionalities (group `nesting` being one of the main ones)."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/506906579",
            "html_url": "https://github.com/pallets/flask/issues/3263#issuecomment-506906579",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3263",
            "id": 506906579,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwNjkwNjU3OQ==",
            "user": {
                "login": "frostming",
                "id": 16336606,
                "node_id": "MDQ6VXNlcjE2MzM2NjA2",
                "avatar_url": "https://avatars3.githubusercontent.com/u/16336606?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/frostming",
                "html_url": "https://github.com/frostming",
                "followers_url": "https://api.github.com/users/frostming/followers",
                "following_url": "https://api.github.com/users/frostming/following{/other_user}",
                "gists_url": "https://api.github.com/users/frostming/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/frostming/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/frostming/subscriptions",
                "organizations_url": "https://api.github.com/users/frostming/orgs",
                "repos_url": "https://api.github.com/users/frostming/repos",
                "events_url": "https://api.github.com/users/frostming/events{/privacy}",
                "received_events_url": "https://api.github.com/users/frostming/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-06-28T23:43:21Z",
            "updated_at": "2019-06-28T23:43:21Z",
            "author_association": "NONE",
            "body": "Passing create_app as a parameter doesn't work in this case, but you can still use FLASK_APP environment variable to do the trick. Note that some functionalities are still missing, such as dotenv loading."
        }
    ]
}