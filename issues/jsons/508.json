{
    "url": "https://api.github.com/repos/pallets/flask/issues/508",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/508/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/508/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/508/events",
    "html_url": "https://github.com/pallets/flask/issues/508",
    "id": 4569664,
    "node_id": "MDU6SXNzdWU0NTY5NjY0",
    "number": 508,
    "title": "Context not available when combining decorators and generators",
    "user": {
        "login": "NicolasT",
        "id": 102605,
        "node_id": "MDQ6VXNlcjEwMjYwNQ==",
        "avatar_url": "https://avatars2.githubusercontent.com/u/102605?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/NicolasT",
        "html_url": "https://github.com/NicolasT",
        "followers_url": "https://api.github.com/users/NicolasT/followers",
        "following_url": "https://api.github.com/users/NicolasT/following{/other_user}",
        "gists_url": "https://api.github.com/users/NicolasT/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/NicolasT/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/NicolasT/subscriptions",
        "organizations_url": "https://api.github.com/users/NicolasT/orgs",
        "repos_url": "https://api.github.com/users/NicolasT/repos",
        "events_url": "https://api.github.com/users/NicolasT/events{/privacy}",
        "received_events_url": "https://api.github.com/users/NicolasT/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2012-05-14T18:40:00Z",
    "updated_at": "2012-06-27T14:28:06Z",
    "closed_at": "2012-06-27T14:28:06Z",
    "author_association": "NONE",
    "body": "In some application I was writing I created a decorator to allow for streaming responses:\n\n``` python\ndef stream(*args, **kwargs):\n    def wrapper(f):\n        @functools.wraps(f)\n        def wrapped(*a, **kw):\n            return flask.Response(f(*a, **kw), *args, **kwargs)\n\n        return wrapped\n\n    return wrapper\n```\n\nand another one to JSON'ify the response:\n\n``` python\n\ndef jsonify(f):\n    @stream(\n        content_type='application/json',\n        headers={\n            'Cache-Control': 'no-cache',\n        })\n    @functools.wraps(f)\n    def wrapped(*args, **kwargs):\n        res = f(*args, **kwargs)\n\n        for chunk in json.JSONEncoder().iterencode(res):\n            yield chunk\n\n    return wrapped\n```\n\nUsing these on handlers which require access to a context fails though:\n\nRuntimeError: working outside of request context\n\nFull example with some ok and not-ok handers is available at https://gist.github.com/4a443e8214c2c6eea1a5\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/6558666",
            "html_url": "https://github.com/pallets/flask/issues/508#issuecomment-6558666",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/508",
            "id": 6558666,
            "node_id": "MDEyOklzc3VlQ29tbWVudDY1NTg2NjY=",
            "user": {
                "login": "dAnjou",
                "id": 117147,
                "node_id": "MDQ6VXNlcjExNzE0Nw==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/117147?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/dAnjou",
                "html_url": "https://github.com/dAnjou",
                "followers_url": "https://api.github.com/users/dAnjou/followers",
                "following_url": "https://api.github.com/users/dAnjou/following{/other_user}",
                "gists_url": "https://api.github.com/users/dAnjou/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/dAnjou/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dAnjou/subscriptions",
                "organizations_url": "https://api.github.com/users/dAnjou/orgs",
                "repos_url": "https://api.github.com/users/dAnjou/repos",
                "events_url": "https://api.github.com/users/dAnjou/events{/privacy}",
                "received_events_url": "https://api.github.com/users/dAnjou/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2012-06-25T20:27:14Z",
            "updated_at": "2012-06-25T20:27:14Z",
            "author_association": "NONE",
            "body": "I think, my issue is caused by the same problem. Here is [a failing example](https://gist.github.com/2984504) with full traceback. Mind the comment.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/6600435",
            "html_url": "https://github.com/pallets/flask/issues/508#issuecomment-6600435",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/508",
            "id": 6600435,
            "node_id": "MDEyOklzc3VlQ29tbWVudDY2MDA0MzU=",
            "user": {
                "login": "mitsuhiko",
                "id": 7396,
                "node_id": "MDQ6VXNlcjczOTY=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/7396?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mitsuhiko",
                "html_url": "https://github.com/mitsuhiko",
                "followers_url": "https://api.github.com/users/mitsuhiko/followers",
                "following_url": "https://api.github.com/users/mitsuhiko/following{/other_user}",
                "gists_url": "https://api.github.com/users/mitsuhiko/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mitsuhiko/subscriptions",
                "organizations_url": "https://api.github.com/users/mitsuhiko/orgs",
                "repos_url": "https://api.github.com/users/mitsuhiko/repos",
                "events_url": "https://api.github.com/users/mitsuhiko/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mitsuhiko/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2012-06-27T11:03:09Z",
            "updated_at": "2012-06-27T11:03:09Z",
            "author_association": "MEMBER",
            "body": "That's currently intended behavior. Not sure if we should provide a way to extend the context's lifetime.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/6604765",
            "html_url": "https://github.com/pallets/flask/issues/508#issuecomment-6604765",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/508",
            "id": 6604765,
            "node_id": "MDEyOklzc3VlQ29tbWVudDY2MDQ3NjU=",
            "user": {
                "login": "mitsuhiko",
                "id": 7396,
                "node_id": "MDQ6VXNlcjczOTY=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/7396?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mitsuhiko",
                "html_url": "https://github.com/mitsuhiko",
                "followers_url": "https://api.github.com/users/mitsuhiko/followers",
                "following_url": "https://api.github.com/users/mitsuhiko/following{/other_user}",
                "gists_url": "https://api.github.com/users/mitsuhiko/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mitsuhiko/subscriptions",
                "organizations_url": "https://api.github.com/users/mitsuhiko/orgs",
                "repos_url": "https://api.github.com/users/mitsuhiko/repos",
                "events_url": "https://api.github.com/users/mitsuhiko/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mitsuhiko/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2012-06-27T14:28:05Z",
            "updated_at": "2012-06-27T14:28:05Z",
            "author_association": "MEMBER",
            "body": "0.9 now provides a method called `stream_with_context` that allows you to preserve the context until the request truly ends.\n"
        }
    ]
}