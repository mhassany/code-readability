{
    "url": "https://api.github.com/repos/pallets/flask/issues/2066",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2066/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2066/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2066/events",
    "html_url": "https://github.com/pallets/flask/pull/2066",
    "id": 185528842,
    "node_id": "MDExOlB1bGxSZXF1ZXN0OTExMDIyNDU=",
    "number": 2066,
    "title": "Process responses generated by exceptions",
    "user": {
        "login": "LiraNuna",
        "id": 205628,
        "node_id": "MDQ6VXNlcjIwNTYyOA==",
        "avatar_url": "https://avatars2.githubusercontent.com/u/205628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LiraNuna",
        "html_url": "https://github.com/LiraNuna",
        "followers_url": "https://api.github.com/users/LiraNuna/followers",
        "following_url": "https://api.github.com/users/LiraNuna/following{/other_user}",
        "gists_url": "https://api.github.com/users/LiraNuna/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/LiraNuna/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/LiraNuna/subscriptions",
        "organizations_url": "https://api.github.com/users/LiraNuna/orgs",
        "repos_url": "https://api.github.com/users/LiraNuna/repos",
        "events_url": "https://api.github.com/users/LiraNuna/events{/privacy}",
        "received_events_url": "https://api.github.com/users/LiraNuna/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2016-10-26T22:36:59Z",
    "updated_at": "2016-10-29T15:06:39Z",
    "closed_at": "2016-10-27T18:06:11Z",
    "author_association": "NONE",
    "pull_request": {
        "url": "https://api.github.com/repos/pallets/flask/pulls/2066",
        "html_url": "https://github.com/pallets/flask/pull/2066",
        "diff_url": "https://github.com/pallets/flask/pull/2066.diff",
        "patch_url": "https://github.com/pallets/flask/pull/2066.patch"
    },
    "body": "When handling exceptions, some post processing on requests are not being called, such as `after_request` and `request_finished`.\nThis can be quite a problem in production environments when things such as logging and consistant headers are required.\n\nFor example, let's take this simple application:\n\n``` python\nfrom flask import Flask, request\n\nfrom mysite.business_logic import do_work\nfrom mysite.logging import log_req_res\n\napp = Flask(__name__)\n\n@app.route('/')\ndef index():\n    return do_work(request)\n\n\n@app.errorhandler(500)\ndef error_handler(exception):\n    # Render a nice error message here\n    pass\n\n\n@app.after_request\ndef add_response_headers(response):\n    response.headers['P3P'] = 'CP=\"IDC DSP COR ADM DEVi TAIi PSA PSD IVAi IVDi CONi HIS OUR IND CNT\"'\n\n\n@app.after_request\ndef log_request_response(response)\n    from flask import request\n\n    log_req_res(request, response)\n    return response\n```\n\nOne day, a change is made within `mysite.business_logic:do_work` that causes it to raise an exception to some users. Because of the current way things are working, the req/res will not be logged as well as not be applied the P3P header.\nCurrently there is no way to intercept ALL requests and responses for these use cases.\n\nA simple solution, proposd in this PR is to process exception responses similarly to successful responses. This could be a breaking change to some library consumers so I'm putting it up as an RFC.\n\n[tests to come soon]\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/256624511",
            "html_url": "https://github.com/pallets/flask/pull/2066#issuecomment-256624511",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2066",
            "id": 256624511,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI1NjYyNDUxMQ==",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-10-27T12:15:34Z",
            "updated_at": "2016-10-27T12:15:34Z",
            "author_association": "MEMBER",
            "body": "`handle_exception` calls `finalize_request`...\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/256719532",
            "html_url": "https://github.com/pallets/flask/pull/2066#issuecomment-256719532",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2066",
            "id": 256719532,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI1NjcxOTUzMg==",
            "user": {
                "login": "LiraNuna",
                "id": 205628,
                "node_id": "MDQ6VXNlcjIwNTYyOA==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/205628?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/LiraNuna",
                "html_url": "https://github.com/LiraNuna",
                "followers_url": "https://api.github.com/users/LiraNuna/followers",
                "following_url": "https://api.github.com/users/LiraNuna/following{/other_user}",
                "gists_url": "https://api.github.com/users/LiraNuna/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/LiraNuna/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/LiraNuna/subscriptions",
                "organizations_url": "https://api.github.com/users/LiraNuna/orgs",
                "repos_url": "https://api.github.com/users/LiraNuna/repos",
                "events_url": "https://api.github.com/users/LiraNuna/events{/privacy}",
                "received_events_url": "https://api.github.com/users/LiraNuna/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-10-27T17:49:38Z",
            "updated_at": "2016-10-27T17:49:38Z",
            "author_association": "NONE",
            "body": "No wonder I was having issues proving my tests work. We are using version 0.11.1 and in that version `handle_exception` does not call `finalize_request` (in fact `finalize_request` does not exist). \n\nIt seems this is fixed with https://github.com/pallets/flask/pull/2013 already!\n\nWhen is version 0.12 going to be released?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/257096619",
            "html_url": "https://github.com/pallets/flask/pull/2066#issuecomment-257096619",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2066",
            "id": 257096619,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI1NzA5NjYxOQ==",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-10-29T15:06:39Z",
            "updated_at": "2016-10-29T15:06:39Z",
            "author_association": "MEMBER",
            "body": "Will do 0.12 soonish (because why not), but it requires coordination.\n"
        }
    ]
}