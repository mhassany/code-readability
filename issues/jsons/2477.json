{
    "url": "https://api.github.com/repos/pallets/flask/issues/2477",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2477/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2477/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2477/events",
    "html_url": "https://github.com/pallets/flask/pull/2477",
    "id": 261078184,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MTQzNDcwMjA2",
    "number": 2477,
    "title": "Add a concept of application teardown",
    "user": {
        "login": "lalinsky",
        "id": 220839,
        "node_id": "MDQ6VXNlcjIyMDgzOQ==",
        "avatar_url": "https://avatars0.githubusercontent.com/u/220839?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/lalinsky",
        "html_url": "https://github.com/lalinsky",
        "followers_url": "https://api.github.com/users/lalinsky/followers",
        "following_url": "https://api.github.com/users/lalinsky/following{/other_user}",
        "gists_url": "https://api.github.com/users/lalinsky/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/lalinsky/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/lalinsky/subscriptions",
        "organizations_url": "https://api.github.com/users/lalinsky/orgs",
        "repos_url": "https://api.github.com/users/lalinsky/repos",
        "events_url": "https://api.github.com/users/lalinsky/events{/privacy}",
        "received_events_url": "https://api.github.com/users/lalinsky/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2017-09-27T18:44:10Z",
    "updated_at": "2017-10-09T14:14:13Z",
    "closed_at": "2017-10-09T14:12:26Z",
    "author_association": "NONE",
    "pull_request": {
        "url": "https://api.github.com/repos/pallets/flask/pulls/2477",
        "html_url": "https://github.com/pallets/flask/pull/2477",
        "diff_url": "https://github.com/pallets/flask/pull/2477.diff",
        "patch_url": "https://github.com/pallets/flask/pull/2477.patch"
    },
    "body": "The main purpose of this is to have a single place where extensions\r\ncan register their cleanup functions. If you are creating many app\r\ninstances for testing purposes, you need to keep track of all\r\nindividual extensions and release the resources from all of them.\r\nAllowing them to register a cleanup function inside init_app would\r\nhide the complexity and app.close() would be the only thing tests\r\nneed to care about.",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/332618659",
            "html_url": "https://github.com/pallets/flask/pull/2477#issuecomment-332618659",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2477",
            "id": 332618659,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMzMjYxODY1OQ==",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-09-27T18:45:51Z",
            "updated_at": "2017-09-27T18:45:51Z",
            "author_association": "MEMBER",
            "body": "Any reason why you create many app instances in your tests? Usually you'd use a session-scoped pytest fixture for the app (so it runs only once) and then a function-scoped appcontext fixture so your tests are separated from each other."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/332620044",
            "html_url": "https://github.com/pallets/flask/pull/2477#issuecomment-332620044",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2477",
            "id": 332620044,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMzMjYyMDA0NA==",
            "user": {
                "login": "lalinsky",
                "id": 220839,
                "node_id": "MDQ6VXNlcjIyMDgzOQ==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/220839?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/lalinsky",
                "html_url": "https://github.com/lalinsky",
                "followers_url": "https://api.github.com/users/lalinsky/followers",
                "following_url": "https://api.github.com/users/lalinsky/following{/other_user}",
                "gists_url": "https://api.github.com/users/lalinsky/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/lalinsky/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lalinsky/subscriptions",
                "organizations_url": "https://api.github.com/users/lalinsky/orgs",
                "repos_url": "https://api.github.com/users/lalinsky/repos",
                "events_url": "https://api.github.com/users/lalinsky/events{/privacy}",
                "received_events_url": "https://api.github.com/users/lalinsky/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-09-27T18:50:59Z",
            "updated_at": "2017-09-27T18:50:59Z",
            "author_association": "NONE",
            "body": "We wanted complete isolation of the app instance, since there are many extensions with external connections registered on it."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/335170522",
            "html_url": "https://github.com/pallets/flask/pull/2477#issuecomment-335170522",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2477",
            "id": 335170522,
            "node_id": "MDEyOklzc3VlQ29tbWVudDMzNTE3MDUyMg==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2017-10-09T14:12:26Z",
            "updated_at": "2017-10-09T14:14:13Z",
            "author_association": "MEMBER",
            "body": "I understand the use case, and appreciate you making a PR to discuss it. However, I think it's better to keep this in your application. You could make the app fixture clean up after yield, for example:\r\n\r\n```python\r\n@pytest.fixture()\r\ndef app():\r\n    app = create_app()\r\n    yield app\r\n    # do cleanup here (or make yield fixtures for other extensions)\r\n```\r\n\r\nIn most use cases, holding a pool of connections shouldn't matter (not saying it doesn't in your specific case, this is just speaking from my experiences testing). If it does matter, perhaps the extension should be modified instead so that connections are cleaned up on `teardown_appcontext`. You'd still need to be aware of any extensions that didn't use this new hook, so you wouldn't really reduce the work anyway.\r\n\r\nAdditionally, the WSGI spec does not have any concept of \"app closed\". So this would never execute when running the server, which will probably confuse developers who try to use it for resource cleanup outside testing."
        }
    ]
}