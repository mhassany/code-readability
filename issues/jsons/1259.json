{
    "url": "https://api.github.com/repos/pallets/flask/issues/1259",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/1259/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/1259/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/1259/events",
    "html_url": "https://github.com/pallets/flask/issues/1259",
    "id": 50297833,
    "node_id": "MDU6SXNzdWU1MDI5NzgzMw==",
    "number": 1259,
    "title": "Unicode in Flask - Uploading Files",
    "user": {
        "login": "nklever",
        "id": 2207403,
        "node_id": "MDQ6VXNlcjIyMDc0MDM=",
        "avatar_url": "https://avatars1.githubusercontent.com/u/2207403?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nklever",
        "html_url": "https://github.com/nklever",
        "followers_url": "https://api.github.com/users/nklever/followers",
        "following_url": "https://api.github.com/users/nklever/following{/other_user}",
        "gists_url": "https://api.github.com/users/nklever/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/nklever/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/nklever/subscriptions",
        "organizations_url": "https://api.github.com/users/nklever/orgs",
        "repos_url": "https://api.github.com/users/nklever/repos",
        "events_url": "https://api.github.com/users/nklever/events{/privacy}",
        "received_events_url": "https://api.github.com/users/nklever/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 5,
    "created_at": "2014-11-27T14:39:24Z",
    "updated_at": "2014-11-27T17:38:54Z",
    "closed_at": "2014-11-27T15:46:52Z",
    "author_association": "NONE",
    "body": "As you mentioned in [Unicode in Flas](http://flask.pocoo.org/docs/0.10/unicode/) Flask is totally Unicode based. And more \"Flask just assumes that if you are sending Unicode out you want it to be UTF-8 encoded. Flask will do the encoding and setting of the appropriate headers for you.\" \n\nThis assumption is on my opinion be broken in uploading files, because the read method of the FileStorage io.BytesIO stream in the following code is returning an ascii string (type 'str') and not an unicode string (type 'unicode') - so you have to decode this string to the Flask Unicode Behaviour:\n\n``` python\n@app.route('/upload', methods=['GET', 'POST'])\ndef upload_file():\n    if request.method == 'POST':\n        f = request.files['the_file']\n        content = f.stream.read()\n        if isinstance(content, str): print('content is str')\n        content = content.decode('utf-8')\n        if isinstance(content, unicode): print('content is unicode')\n        ...\n```\n\nI know, that Flask don't knows if an uploaded file will be `utf-8` or any other, but analogue as in the assumption above, Flask should assume `utf-8` and not `ascii` as default encoding.\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/64805561",
            "html_url": "https://github.com/pallets/flask/issues/1259#issuecomment-64805561",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1259",
            "id": 64805561,
            "node_id": "MDEyOklzc3VlQ29tbWVudDY0ODA1NTYx",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-11-27T15:46:52Z",
            "updated_at": "2014-11-27T15:46:52Z",
            "author_association": "MEMBER",
            "body": "As Flask doesn't know the encoding, it returns a sequence of bytes, which is known as `bytes` in Python 3, and `str` in Python 2 (`str` is not an \"ascii\"-string, it is a \"byte\"-string).\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/64810901",
            "html_url": "https://github.com/pallets/flask/issues/1259#issuecomment-64810901",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1259",
            "id": 64810901,
            "node_id": "MDEyOklzc3VlQ29tbWVudDY0ODEwOTAx",
            "user": {
                "login": "nklever",
                "id": 2207403,
                "node_id": "MDQ6VXNlcjIyMDc0MDM=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/2207403?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/nklever",
                "html_url": "https://github.com/nklever",
                "followers_url": "https://api.github.com/users/nklever/followers",
                "following_url": "https://api.github.com/users/nklever/following{/other_user}",
                "gists_url": "https://api.github.com/users/nklever/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/nklever/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nklever/subscriptions",
                "organizations_url": "https://api.github.com/users/nklever/orgs",
                "repos_url": "https://api.github.com/users/nklever/repos",
                "events_url": "https://api.github.com/users/nklever/events{/privacy}",
                "received_events_url": "https://api.github.com/users/nklever/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-11-27T16:37:02Z",
            "updated_at": "2014-11-27T16:37:02Z",
            "author_association": "NONE",
            "body": "Yes, that's not the point. My proposal was, that Flask should assume incoming \"byte\"-strings as `utf-8` in the same manner as it does in the outgoing assumption. It is obvious, that this assumption is only useful on files of mimetype class `text`. \n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/64811224",
            "html_url": "https://github.com/pallets/flask/issues/1259#issuecomment-64811224",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1259",
            "id": 64811224,
            "node_id": "MDEyOklzc3VlQ29tbWVudDY0ODExMjI0",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-11-27T16:40:09Z",
            "updated_at": "2014-11-27T16:40:09Z",
            "author_association": "MEMBER",
            "body": "You mean Flask should try to decode with utf-8 if the mimetype contains `text`? This would break badly if the client sends arbitrary bytes with a (perhaps intentionally) invalid mimetype.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/64811747",
            "html_url": "https://github.com/pallets/flask/issues/1259#issuecomment-64811747",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1259",
            "id": 64811747,
            "node_id": "MDEyOklzc3VlQ29tbWVudDY0ODExNzQ3",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-11-27T16:45:17Z",
            "updated_at": "2014-11-27T16:45:17Z",
            "author_association": "MEMBER",
            "body": "Also the reasoning that Flask does the same thing with HTTP responses is faulty: Encoding unicode strings into utf-8 doesn't involve any encoding-guessing, decoding does.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/64816706",
            "html_url": "https://github.com/pallets/flask/issues/1259#issuecomment-64816706",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1259",
            "id": 64816706,
            "node_id": "MDEyOklzc3VlQ29tbWVudDY0ODE2NzA2",
            "user": {
                "login": "nklever",
                "id": 2207403,
                "node_id": "MDQ6VXNlcjIyMDc0MDM=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/2207403?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/nklever",
                "html_url": "https://github.com/nklever",
                "followers_url": "https://api.github.com/users/nklever/followers",
                "following_url": "https://api.github.com/users/nklever/following{/other_user}",
                "gists_url": "https://api.github.com/users/nklever/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/nklever/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nklever/subscriptions",
                "organizations_url": "https://api.github.com/users/nklever/orgs",
                "repos_url": "https://api.github.com/users/nklever/repos",
                "events_url": "https://api.github.com/users/nklever/events{/privacy}",
                "received_events_url": "https://api.github.com/users/nklever/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-11-27T17:38:54Z",
            "updated_at": "2014-11-27T17:38:54Z",
            "author_association": "NONE",
            "body": "Yes, your comments are all reproducible and correct. And you can all leave to the application - no problem. I thought of this assumption in the same manner as today operating systems are defaulting to `utf-8` in using text files. You have the same problems in opening non-text files in operating systems as you describe above and also the same problems in opening text files with other encodings. But the default in operating systems is `utf-8` - I only wanted to point out, that this behaviour could also be done during the upload process in Flask. But I agree - you can also leave it to the application !\n"
        }
    ]
}