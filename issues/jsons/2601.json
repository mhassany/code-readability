{
    "url": "https://api.github.com/repos/pallets/flask/issues/2601",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2601/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2601/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2601/events",
    "html_url": "https://github.com/pallets/flask/issues/2601",
    "id": 289584896,
    "node_id": "MDU6SXNzdWUyODk1ODQ4OTY=",
    "number": 2601,
    "title": "Internal error when requesting route with url-part == defaults",
    "user": {
        "login": "d3QUone",
        "id": 4642885,
        "node_id": "MDQ6VXNlcjQ2NDI4ODU=",
        "avatar_url": "https://avatars1.githubusercontent.com/u/4642885?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/d3QUone",
        "html_url": "https://github.com/d3QUone",
        "followers_url": "https://api.github.com/users/d3QUone/followers",
        "following_url": "https://api.github.com/users/d3QUone/following{/other_user}",
        "gists_url": "https://api.github.com/users/d3QUone/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/d3QUone/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/d3QUone/subscriptions",
        "organizations_url": "https://api.github.com/users/d3QUone/orgs",
        "repos_url": "https://api.github.com/users/d3QUone/repos",
        "events_url": "https://api.github.com/users/d3QUone/events{/privacy}",
        "received_events_url": "https://api.github.com/users/d3QUone/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 32876,
            "node_id": "MDU6TGFiZWwzMjg3Ng==",
            "url": "https://api.github.com/repos/pallets/flask/labels/docs",
            "name": "docs",
            "color": "0e8a16",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": {
        "url": "https://api.github.com/repos/pallets/flask/milestones/5",
        "html_url": "https://github.com/pallets/flask/milestone/5",
        "labels_url": "https://api.github.com/repos/pallets/flask/milestones/5/labels",
        "id": 3304290,
        "node_id": "MDk6TWlsZXN0b25lMzMwNDI5MA==",
        "number": 5,
        "title": "1.0.1",
        "description": "",
        "creator": {
            "login": "davidism",
            "id": 1242887,
            "node_id": "MDQ6VXNlcjEyNDI4ODc=",
            "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/davidism",
            "html_url": "https://github.com/davidism",
            "followers_url": "https://api.github.com/users/davidism/followers",
            "following_url": "https://api.github.com/users/davidism/following{/other_user}",
            "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
            "organizations_url": "https://api.github.com/users/davidism/orgs",
            "repos_url": "https://api.github.com/users/davidism/repos",
            "events_url": "https://api.github.com/users/davidism/events{/privacy}",
            "received_events_url": "https://api.github.com/users/davidism/received_events",
            "type": "User",
            "site_admin": false
        },
        "open_issues": 0,
        "closed_issues": 18,
        "state": "closed",
        "created_at": "2018-04-27T13:46:37Z",
        "updated_at": "2018-04-30T01:11:27Z",
        "due_on": null,
        "closed_at": "2018-04-30T01:11:27Z"
    },
    "comments": 7,
    "created_at": "2018-01-18T10:51:31Z",
    "updated_at": "2018-04-27T17:12:01Z",
    "closed_at": "2018-04-27T17:12:00Z",
    "author_association": "NONE",
    "body": "http://flask.pocoo.org/docs/0.12/api/#url-route-registrations\r\n\r\nGetting a 5xx-error when requesting a route with defaults parameter \r\n\r\n### Code Example\r\n\r\n```python\r\nview = Blueprint(\"a\", __name__, url_prefix=\"/a\")\r\n\r\n@view.route(\"/b\", defaults={\"consumer_id\": \"test\"}, methods=[\"POST\"])\r\n@view.route(\"/b/<consumer_id>\", methods=[\"POST\"])\r\ndef check_consumers(consumer_id):\r\n    return \"consumer_id: {}\".format(consumer_id)\r\n```\r\n\r\n---\r\n\r\n### Expected Behavior\r\n\r\nSend any other parameter - OK\r\n```\r\ncurl -X POST '0.0.0.0:5500/a/b/anything'\r\n```\r\n```\r\nconsumer_id: anything\r\n```\r\nSend parameter == default one\r\n```\r\ncurl -X POST '0.0.0.0:5500/a/b/test'\r\n```\r\n```\r\nconsumer_id: test\r\n```\r\n\r\n---\r\n\r\n### Actual Behavior\r\n\r\nSend parameter == `defaults` and get an internal error\r\n```\r\ncurl -X POST '0.0.0.0:5500/a/b/test' -vvv\r\n```\r\n```\r\n* Hostname was NOT found in DNS cache\r\n*   Trying 0.0.0.0...\r\n* Connected to 0.0.0.0 (127.0.0.1) port 5500 (#0)\r\n> POST /a/b/test HTTP/1.1\r\n> User-Agent: curl/7.35.0\r\n> Host: 0.0.0.0:5500\r\n> Accept: */*\r\n> \r\n* Empty reply from server\r\n* Connection #0 to host 0.0.0.0 left intact\r\ncurl: (52) Empty reply from server\r\n```\r\n\r\nTraceback:\r\n```pytb\r\nNote: this exception is only raised in debug mode\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python2.7/dist-packages/flask/app.py\", line 1612, in full_dispatch_request\r\n    rv = self.dispatch_request()\r\n  File \"/usr/local/lib/python2.7/dist-packages/flask/app.py\", line 1590, in dispatch_request\r\n    self.raise_routing_exception(req)\r\n  File \"/usr/local/lib/python2.7/dist-packages/flask/app.py\", line 1576, in raise_routing_exception\r\n    raise FormDataRoutingRedirect(request)\r\nFormDataRoutingRedirect: A request was sent to this URL (http://0.0.0.0:5500/a/b/test) but a redirect was issued automatically by the routing system to \"http://0.0.0.0:5500/a/b\".  Make sure to directly send your POST-request to this URL since we can't make browsers or HTTP clients redirect with form data reliably or without user interaction.\r\n```\r\n\r\n---\r\n\r\n### Environment\r\n\r\n* Python version: 2.7.6\r\n* Flask version: 0.12.2\r\n* Werkzeug version: 0.14.1\r\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/358713882",
            "html_url": "https://github.com/pallets/flask/issues/2601#issuecomment-358713882",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2601",
            "id": 358713882,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM1ODcxMzg4Mg==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-01-18T17:07:36Z",
            "updated_at": "2018-01-18T17:27:25Z",
            "author_association": "MEMBER",
            "body": "This is mostly a Werkzeug behavior. By design, a URL containing a default value will redirect to its simpler form, and Werkzeug uses a 301 redirect. As the error explains, 301 redirects don't preserve form data. (307 redirects probably weren't commonly supported when this code was written.)\r\n\r\nThe quick fix is to not have the default route, or to write your own that issues a 307 redirect.\r\n\r\n```python\r\n@bp.route('/b', methods=('GET', 'POST'))\r\ndef default_check_consumers():\r\n    return redirect(url_for('.check_consumers', id=1), code=307)\r\n```"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/358718838",
            "html_url": "https://github.com/pallets/flask/issues/2601#issuecomment-358718838",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2601",
            "id": 358718838,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM1ODcxODgzOA==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-01-18T17:23:45Z",
            "updated_at": "2018-01-18T17:23:45Z",
            "author_association": "MEMBER",
            "body": "Alternatively, while it makes some sense to show a default id on GET requests, it doesn't make as much sense to send POST data to a default, I'd always want to see a specific id being posted to.\r\n\r\nChange the default route to only be for GET, and it works.\r\n\r\n```python\r\n@bp.route('/b', defaults={'id': 1})\r\n@bp.route('/b/<int:id>', methods=('GET', 'POST'))\r\n```"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/358719863",
            "html_url": "https://github.com/pallets/flask/issues/2601#issuecomment-358719863",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2601",
            "id": 358719863,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM1ODcxOTg2Mw==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-01-18T17:26:25Z",
            "updated_at": "2018-01-18T17:26:37Z",
            "author_association": "MEMBER",
            "body": "Another alternative is to place the default in the function args.\r\n\r\n```python\r\n@app.route('/', methods=('GET', 'POST'))\r\n@app.route('/<int:id>', methods=('GET', 'POST'))\r\ndef check_consumers(id=1):\r\n```"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/358771340",
            "html_url": "https://github.com/pallets/flask/issues/2601#issuecomment-358771340",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2601",
            "id": 358771340,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM1ODc3MTM0MA==",
            "user": {
                "login": "d3QUone",
                "id": 4642885,
                "node_id": "MDQ6VXNlcjQ2NDI4ODU=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/4642885?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/d3QUone",
                "html_url": "https://github.com/d3QUone",
                "followers_url": "https://api.github.com/users/d3QUone/followers",
                "following_url": "https://api.github.com/users/d3QUone/following{/other_user}",
                "gists_url": "https://api.github.com/users/d3QUone/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/d3QUone/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/d3QUone/subscriptions",
                "organizations_url": "https://api.github.com/users/d3QUone/orgs",
                "repos_url": "https://api.github.com/users/d3QUone/repos",
                "events_url": "https://api.github.com/users/d3QUone/events{/privacy}",
                "received_events_url": "https://api.github.com/users/d3QUone/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-01-18T20:26:45Z",
            "updated_at": "2018-01-18T20:26:45Z",
            "author_association": "NONE",
            "body": "@davidism thank you for fast reply! I guess there are several possible solutions in this case:\r\n* add an issue in Werkzeug's project\r\n* add a description of this behaviour in Flask documentation and/or possible issues"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/358776647",
            "html_url": "https://github.com/pallets/flask/issues/2601#issuecomment-358776647",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2601",
            "id": 358776647,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM1ODc3NjY0Nw==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-01-18T20:47:27Z",
            "updated_at": "2018-01-18T20:47:27Z",
            "author_association": "MEMBER",
            "body": "If you have time and can document that a default value redirects to the simpler route, and that this affects POST requests, that would be great!\r\n\r\nIt may also be good to have Werkzeug use 307 instead, so an issue there would be good. It's mostly down to figuring out what browsers support it."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/381255165",
            "html_url": "https://github.com/pallets/flask/issues/2601#issuecomment-381255165",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2601",
            "id": 381255165,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM4MTI1NTE2NQ==",
            "user": {
                "login": "rochacbruno",
                "id": 458654,
                "node_id": "MDQ6VXNlcjQ1ODY1NA==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/458654?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/rochacbruno",
                "html_url": "https://github.com/rochacbruno",
                "followers_url": "https://api.github.com/users/rochacbruno/followers",
                "following_url": "https://api.github.com/users/rochacbruno/following{/other_user}",
                "gists_url": "https://api.github.com/users/rochacbruno/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/rochacbruno/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rochacbruno/subscriptions",
                "organizations_url": "https://api.github.com/users/rochacbruno/orgs",
                "repos_url": "https://api.github.com/users/rochacbruno/repos",
                "events_url": "https://api.github.com/users/rochacbruno/events{/privacy}",
                "received_events_url": "https://api.github.com/users/rochacbruno/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-04-13T20:41:08Z",
            "updated_at": "2018-04-13T20:41:45Z",
            "author_association": "CONTRIBUTOR",
            "body": "You can also set `redirect_defaults` to false"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/381255343",
            "html_url": "https://github.com/pallets/flask/issues/2601#issuecomment-381255343",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2601",
            "id": 381255343,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM4MTI1NTM0Mw==",
            "user": {
                "login": "rochacbruno",
                "id": 458654,
                "node_id": "MDQ6VXNlcjQ1ODY1NA==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/458654?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/rochacbruno",
                "html_url": "https://github.com/rochacbruno",
                "followers_url": "https://api.github.com/users/rochacbruno/followers",
                "following_url": "https://api.github.com/users/rochacbruno/following{/other_user}",
                "gists_url": "https://api.github.com/users/rochacbruno/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/rochacbruno/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rochacbruno/subscriptions",
                "organizations_url": "https://api.github.com/users/rochacbruno/orgs",
                "repos_url": "https://api.github.com/users/rochacbruno/repos",
                "events_url": "https://api.github.com/users/rochacbruno/events{/privacy}",
                "received_events_url": "https://api.github.com/users/rochacbruno/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-04-13T20:41:54Z",
            "updated_at": "2018-04-13T20:41:54Z",
            "author_association": "CONTRIBUTOR",
            "body": "```\r\n`defaults`\r\n    An optional dict with defaults for other rules with the same endpoint.\r\n    This is a bit tricky but useful if you want to have unique URLs::\r\n\r\n        url_map = Map([\r\n            Rule('/all/', defaults={'page': 1}, endpoint='all_entries'),\r\n            Rule('/all/page/<int:page>', endpoint='all_entries')\r\n        ])\r\n\r\n    If a user now visits ``http://example.com/all/page/1`` he will be\r\n    redirected to ``http://example.com/all/``.  If `redirect_defaults` is\r\n    disabled on the `Map` instance this will only affect the URL\r\n    generation.\r\n\r\n```"
        }
    ]
}