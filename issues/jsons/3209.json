{
    "url": "https://api.github.com/repos/pallets/flask/issues/3209",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/3209/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/3209/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/3209/events",
    "html_url": "https://github.com/pallets/flask/issues/3209",
    "id": 446130538,
    "node_id": "MDU6SXNzdWU0NDYxMzA1Mzg=",
    "number": 3209,
    "title": "Flask with dotenv change the current working directory if .env file is found",
    "user": {
        "login": "erdnaxeli",
        "id": 479441,
        "node_id": "MDQ6VXNlcjQ3OTQ0MQ==",
        "avatar_url": "https://avatars2.githubusercontent.com/u/479441?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/erdnaxeli",
        "html_url": "https://github.com/erdnaxeli",
        "followers_url": "https://api.github.com/users/erdnaxeli/followers",
        "following_url": "https://api.github.com/users/erdnaxeli/following{/other_user}",
        "gists_url": "https://api.github.com/users/erdnaxeli/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/erdnaxeli/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/erdnaxeli/subscriptions",
        "organizations_url": "https://api.github.com/users/erdnaxeli/orgs",
        "repos_url": "https://api.github.com/users/erdnaxeli/repos",
        "events_url": "https://api.github.com/users/erdnaxeli/events{/privacy}",
        "received_events_url": "https://api.github.com/users/erdnaxeli/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2019-05-20T13:52:39Z",
    "updated_at": "2019-05-20T14:59:36Z",
    "closed_at": "2019-05-20T14:21:20Z",
    "author_association": "NONE",
    "body": "### Expected Behavior\r\n\r\nI run my flask application from a given folder A, I expect the current working directory to be A.\r\n\r\n### Actual Behavior\r\n\r\nInstead, the working directory is changed to the directory where a `.env` file is found.\r\n\r\n### Environment\r\n\r\n* Python version: 3.6.5\r\n* Flask version: 1.03\r\n* Werkzeug version: 0.15.4\r\n\r\n### Example\r\n\r\nHere is a bash session where we can see the bug:\r\n```\r\n$ pipenv install flask[dotenv]\r\n[ some pipenv output ]\r\n$ cat hello.py \r\nimport os\r\nfrom flask import Flask\r\n\r\n\r\napp = Flask(__name__)\r\n\r\n@app.route(\"/\")\r\ndef hello():\r\n    return os.getcwd() + \"\\n\"\r\n$ pwd  # my current working directory\r\n/tmp/dotenv\r\n$ FLASK_APP=hello.py pipenv run flask run &\r\n[1] 18872\r\n$  * Serving Flask app \"hello.py\"\r\n * Environment: production\r\n   WARNING: This is a development server. Do not use it in a production deployment.\r\n   Use a production WSGI server instead.\r\n * Debug mode: off\r\n * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)\r\n\r\n$ curl localhost:5000/  # all is good\r\n127.0.0.1 - - [20/May/2019 15:40:46] \"GET / HTTP/1.1\" 200 -\r\n/tmp/dotenv\r\n$ touch /tmp/.env  # now I introduce a dot env file\r\n$ fg  # let's restart the server\r\nFLASK_APP=hello.py pipenv run flask run\r\n^C\r\n$ FLASK_APP=hello.py pipenv run flask run &\r\n[1] 18920\r\n$  * Serving Flask app \"hello.py\"\r\n * Environment: production\r\n   WARNING: This is a development server. Do not use it in a production deployment.\r\n   Use a production WSGI server instead.\r\n * Debug mode: off\r\nUsage: flask run [OPTIONS]\r\n\r\nError: Could not import \"hello\".\r\n\r\n[1]+  Termine 2               FLASK_APP=hello.py pipenv run flask run\r\n$ # We can note Flask itself is not able to load my app anymore!\r\n$ echo -e \"\\napp.run()\" >> hello.py  # let's run the app from the script\r\n$ pipenv run python hello.py &\r\n[1] 19031\r\n$  * Serving Flask app \"hello\" (lazy loading)\r\n * Environment: production\r\n   WARNING: This is a development server. Do not use it in a production deployment.\r\n   Use a production WSGI server instead.\r\n * Debug mode: off\r\n * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)\r\n\r\n$ curl localhost:5000/\r\n127.0.0.1 - - [20/May/2019 15:42:27] \"GET / HTTP/1.1\" 200 -\r\n/tmp\r\n$ # My working directory is not the expected value\r\n```\r\n\r\nThis came from [this exact line](https://github.com/pallets/flask/commit/491d331e6e0a7915c9e6d9b3287688ac7a3f56ca#diff-61bbd5ac9238364564a7315cc6bc2156R555). I can't see why this is useful, as the `.env` is already loaded at this time.",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/494008394",
            "html_url": "https://github.com/pallets/flask/issues/3209#issuecomment-494008394",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3209",
            "id": 494008394,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NDAwODM5NA==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-05-20T14:21:20Z",
            "updated_at": "2019-05-20T14:21:20Z",
            "author_association": "MEMBER",
            "body": "This is intended behavior. From the `load_dotenv` docs:\r\n\r\n> Changes the current working directory to the location of the first file found, with the assumption that it is in the top level project directory and will be where the Python path should import local packages from.\r\n\r\nYou should never rely on the current working directory in a web application. Use the variables such as `app.instance_path` and `os.path` functions to construct absolute paths to known locations.\r\n\r\nTo disable Flask's dotenv behavior, you can uninstall python-dotenv, or set the env var `FLASK_SKIP_DOTENV=1` if you need python-dotenv installed still. You can then use python-dotenv or another tool to load the env yourself."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/494024193",
            "html_url": "https://github.com/pallets/flask/issues/3209#issuecomment-494024193",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3209",
            "id": 494024193,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NDAyNDE5Mw==",
            "user": {
                "login": "erdnaxeli",
                "id": 479441,
                "node_id": "MDQ6VXNlcjQ3OTQ0MQ==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/479441?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/erdnaxeli",
                "html_url": "https://github.com/erdnaxeli",
                "followers_url": "https://api.github.com/users/erdnaxeli/followers",
                "following_url": "https://api.github.com/users/erdnaxeli/following{/other_user}",
                "gists_url": "https://api.github.com/users/erdnaxeli/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/erdnaxeli/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/erdnaxeli/subscriptions",
                "organizations_url": "https://api.github.com/users/erdnaxeli/orgs",
                "repos_url": "https://api.github.com/users/erdnaxeli/repos",
                "events_url": "https://api.github.com/users/erdnaxeli/events{/privacy}",
                "received_events_url": "https://api.github.com/users/erdnaxeli/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-05-20T14:59:36Z",
            "updated_at": "2019-05-20T14:59:36Z",
            "author_association": "NONE",
            "body": "> You should never rely on the current working directory in a web application. \r\n\r\nI find this questionable, but why not. However in my case I am using `Flask.cli` and I give a relative path as an argument to my command. I definitely expect my working directory to be the one I am currently in."
        }
    ]
}