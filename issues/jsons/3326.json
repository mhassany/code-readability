{
    "url": "https://api.github.com/repos/pallets/flask/issues/3326",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/3326/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/3326/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/3326/events",
    "html_url": "https://github.com/pallets/flask/issues/3326",
    "id": 478899458,
    "node_id": "MDU6SXNzdWU0Nzg4OTk0NTg=",
    "number": 3326,
    "title": "Flash messages not showing when route is called by ajax",
    "user": {
        "login": "gelflein",
        "id": 52651330,
        "node_id": "MDQ6VXNlcjUyNjUxMzMw",
        "avatar_url": "https://avatars0.githubusercontent.com/u/52651330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gelflein",
        "html_url": "https://github.com/gelflein",
        "followers_url": "https://api.github.com/users/gelflein/followers",
        "following_url": "https://api.github.com/users/gelflein/following{/other_user}",
        "gists_url": "https://api.github.com/users/gelflein/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/gelflein/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gelflein/subscriptions",
        "organizations_url": "https://api.github.com/users/gelflein/orgs",
        "repos_url": "https://api.github.com/users/gelflein/repos",
        "events_url": "https://api.github.com/users/gelflein/events{/privacy}",
        "received_events_url": "https://api.github.com/users/gelflein/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2019-08-09T09:47:50Z",
    "updated_at": "2019-08-09T09:53:33Z",
    "closed_at": "2019-08-09T09:53:33Z",
    "author_association": "NONE",
    "body": "Hello,\r\n\r\nI am submitting a form to insert data in my oracle-database.\r\nBecause I don't want to reload the page when submitting the form I am calling a js-function.\r\n\r\nHere is my submit-button:\r\n`<button class=\"btn btn-primary mt-3\" type=\"button\" onclick=\"createSubmit()\">Speichern</button>`\r\n\r\nThe js-function called by the button:\r\n```\r\nfunction createSubmit() {\r\n    var shortcode = document.getElementById(\"shortcode\").value;\r\n    var product = document.getElementById(\"productInput-hidden\").value;\r\n    var serialnumber = document.getElementById(\"serialnumber\").value;\r\n    var status = document.getElementById(\"statusInput-hidden\").value;\r\n    var user = document.getElementById(\"userInput-hidden\").value;\r\n    var acquireddate = document.getElementById(\"acquireddate\").value;\r\n    var installdate = document.getElementById(\"installdate\").value;\r\n    var remarks = document.getElementById(\"remarks\").value;\r\n\r\n    req = $.ajax({\r\n        url : \"/create_submit\",\r\n        type : \"POST\",\r\n        data : { shortcode : shortcode, product : product, serialnumber : serialnumber, status : status, user : user, acquireddate : acquireddate, installdate : installdate, remarks : remarks }\r\n    });\r\n}\r\n```\r\n\r\nAnd here we got the route:\r\n```\r\n@bp.route('/create_submit', methods=['POST'])\r\n@login_required\r\ndef create_submit():\r\n    error = None\r\n    short_code = request.form['shortcode']\r\n    product = request.form['product']\r\n    serial_number = request.form['serialnumber']\r\n    status = request.form['status']\r\n    user = request.form['user']\r\n    acquired_date = request.form['acquireddate']\r\n    date_installed = request.form['installdate']\r\n    remarks = request.form['remarks']\r\n\r\n    try:\r\n        new = Items(short_code, remarks, short_code, '38', acquired_date, date_installed, product, serial_number,\r\n                    status, '1', user, g.user[1])\r\n        new.post()\r\n    except:\r\n        error = 'Request Fehler'\r\n        new = False\r\n\r\n    if new is not False:\r\n        if new.r_status_code == 201:\r\n            flash('Asset angelegt', 'success')\r\n        elif new.r_status_code is not None:\r\n            error = 'API Fehler'\r\n        else:\r\n            error = 'Keine Antwort'\r\n    else:\r\n        error = 'Objekt Fehler'\r\n\r\n    if error is not None:\r\n        flash(error, 'error')\r\n\r\n    return jsonify({'result' : 'success'})\r\n```\r\n\r\nIn general the mechanism is working corret, but the flash-messages generated by /create_submit are not showing immediately. The show up after a page refresh.\r\nI think this happens because I am using ajax to call /create_submit and the return is not correct.\r\n\r\nIs there a way to get the flash-messages to show immediately?\r\n\r\n### Environment\r\n\r\n* Python version: 3.7.3\r\n* Flask version: 1.0.3\r\n* Werkzeug version: 0.15.4\r\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/519858657",
            "html_url": "https://github.com/pallets/flask/issues/3326#issuecomment-519858657",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3326",
            "id": 519858657,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUxOTg1ODY1Nw==",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-08-09T09:53:33Z",
            "updated_at": "2019-08-09T09:53:33Z",
            "author_association": "MEMBER",
            "body": "Write some custom code that includes the flashed messages (via `get_flashed_messages()`) in your AJAX response and then use JS to handle it on the client side.\r\n\r\nIf you have additional questions please use IRC, Discord or Stack Overflow since this is not the right place for it.\r\n\r\nPS: **never** use bare `except:`; and generally `is not` shouldn't beu sed for booleans unless you really care that it is a boolean and not just a truthy/falsy object (in this case you probably want `new = None` in the error case and then `if new is not None`)"
        }
    ]
}