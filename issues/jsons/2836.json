{
    "url": "https://api.github.com/repos/pallets/flask/issues/2836",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2836/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2836/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2836/events",
    "html_url": "https://github.com/pallets/flask/issues/2836",
    "id": 333856282,
    "node_id": "MDU6SXNzdWUzMzM4NTYyODI=",
    "number": 2836,
    "title": "request points to wrong object in debugger when threading is enabled",
    "user": {
        "login": "rkomorn",
        "id": 523308,
        "node_id": "MDQ6VXNlcjUyMzMwOA==",
        "avatar_url": "https://avatars2.githubusercontent.com/u/523308?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkomorn",
        "html_url": "https://github.com/rkomorn",
        "followers_url": "https://api.github.com/users/rkomorn/followers",
        "following_url": "https://api.github.com/users/rkomorn/following{/other_user}",
        "gists_url": "https://api.github.com/users/rkomorn/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/rkomorn/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/rkomorn/subscriptions",
        "organizations_url": "https://api.github.com/users/rkomorn/orgs",
        "repos_url": "https://api.github.com/users/rkomorn/repos",
        "events_url": "https://api.github.com/users/rkomorn/events{/privacy}",
        "received_events_url": "https://api.github.com/users/rkomorn/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2018-06-19T22:06:39Z",
    "updated_at": "2019-05-30T13:39:16Z",
    "closed_at": null,
    "author_association": "NONE",
    "body": "### Expected Behavior\r\n\r\nDebugger should show the right request object.\r\n\r\n```python\r\nPaste a minimal example that causes the problem.from flask import Flask, request\r\napp = Flask(__name__)\r\n\r\n@app.route('/')\r\ndef hello_world():\r\n    print(request)\r\n    x = y\r\n    return 'Hello, World!'\r\n\r\nif __name__ == \"__main__\":\r\n    app.run(debug=True)\r\n```\r\n\r\n### Actual Behavior\r\n\r\nWe're seeing some honestly kind of dumbfounding behavior that makes no sense to us. I'm not a novice when it comes to troubleshooting things, but this one really baffles me because I'm basically certain I'm not doing anything weird.\r\n\r\nDebugger doesn't show the right \"request\" object often. See https://pasteboard.co/HqFNzwq.png for a screenshot of a case where the browser's URL bar shows the right thing, printing the request object shows the right thing in console logs, but using the debugger does not.\r\n\r\nThe request object is sometimes unbound, sometimes right, and seemingly often \"off by 1\" based on history.\r\n\r\nSo far, we can only seem to reproduce this on Linux, using Chrome and Firefox (edit: at first we thought it wasn't happening with Firefox but we found a repro with Firefox on Ubuntu 16.04 ). It doesn't seem to be happening from a Mac OS chrome client.\r\n\r\n### Environment\r\n* Python version: both 2.7 and 3.6 (in virtualenv-based environments)\r\n* Flask version: 1.0.x and it seems 0.12 as well\r\n* Werkzeug version: 0.14.1\r\n* Linux version(s): Ubuntu 18.04 , Ubuntu 16.04\r\n* Chrome: Chrome/65.0.3325.183",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/399731074",
            "html_url": "https://github.com/pallets/flask/issues/2836#issuecomment-399731074",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2836",
            "id": 399731074,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTczMTA3NA==",
            "user": {
                "login": "scotchka",
                "id": 5314578,
                "node_id": "MDQ6VXNlcjUzMTQ1Nzg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/5314578?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/scotchka",
                "html_url": "https://github.com/scotchka",
                "followers_url": "https://api.github.com/users/scotchka/followers",
                "following_url": "https://api.github.com/users/scotchka/following{/other_user}",
                "gists_url": "https://api.github.com/users/scotchka/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/scotchka/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scotchka/subscriptions",
                "organizations_url": "https://api.github.com/users/scotchka/orgs",
                "repos_url": "https://api.github.com/users/scotchka/repos",
                "events_url": "https://api.github.com/users/scotchka/events{/privacy}",
                "received_events_url": "https://api.github.com/users/scotchka/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-06-24T05:37:52Z",
            "updated_at": "2018-06-24T06:02:46Z",
            "author_association": "NONE",
            "body": "I ran git bisect, and according to it, this is the first \"bad\" commit:\r\nhttps://github.com/pallets/flask/commit/3738f7ff99661fa0319ebe2d8228ad8c479fb46a\r\n\r\nThis commit turned on threading by default. So I tried turning off threading, and indeed the bug seems to go away.\r\n\r\nI am running Flask on Ubuntu 16.04.3 inside Vagrant VM hosted on a Mac (High Sierra). I cannot reproduce the bug running natively on the Mac.\r\n\r\nIf threading is indeed the deciding factor, would it be reasonable for the documentation to stipulate that threading should be turned off in debug mode, or have threading default to false when in debug mode?"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/399733828",
            "html_url": "https://github.com/pallets/flask/issues/2836#issuecomment-399733828",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2836",
            "id": 399733828,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTczMzgyOA==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-06-24T06:45:41Z",
            "updated_at": "2018-06-24T06:45:41Z",
            "author_association": "MEMBER",
            "body": "I'd rather try to fix the debugger."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/452027319",
            "html_url": "https://github.com/pallets/flask/issues/2836#issuecomment-452027319",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2836",
            "id": 452027319,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MjAyNzMxOQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-01-07T18:09:53Z",
            "updated_at": "2019-01-07T18:10:09Z",
            "author_association": "MEMBER",
            "body": "The debugger is actually good with multiple threads, it's Flask's `request` object that's not. When there's an error, a single context is preserved on the stack, but this can get out of sync with multiple threads. @mitsuhiko mentioned he had an idea for fixing this."
        }
    ]
}