{
    "url": "https://api.github.com/repos/pallets/flask/issues/2099",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2099/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2099/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2099/events",
    "html_url": "https://github.com/pallets/flask/issues/2099",
    "id": 191509918,
    "node_id": "MDU6SXNzdWUxOTE1MDk5MTg=",
    "number": 2099,
    "title": "Problems with unicode",
    "user": {
        "login": "javixeneize",
        "id": 12761574,
        "node_id": "MDQ6VXNlcjEyNzYxNTc0",
        "avatar_url": "https://avatars0.githubusercontent.com/u/12761574?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/javixeneize",
        "html_url": "https://github.com/javixeneize",
        "followers_url": "https://api.github.com/users/javixeneize/followers",
        "following_url": "https://api.github.com/users/javixeneize/following{/other_user}",
        "gists_url": "https://api.github.com/users/javixeneize/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/javixeneize/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/javixeneize/subscriptions",
        "organizations_url": "https://api.github.com/users/javixeneize/orgs",
        "repos_url": "https://api.github.com/users/javixeneize/repos",
        "events_url": "https://api.github.com/users/javixeneize/events{/privacy}",
        "received_events_url": "https://api.github.com/users/javixeneize/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 7,
    "created_at": "2016-11-24T12:35:18Z",
    "updated_at": "2016-12-02T17:43:29Z",
    "closed_at": "2016-12-02T17:43:29Z",
    "author_association": "NONE",
    "body": "Hi\r\n\r\nLooks like flask works different than plain python with Unicode. Let me explain\r\n\r\nIf i assign an unicode string to a parameter, (test=\"%$\u00a3\") it works fine\r\n\r\nWhen i run this code as part of a flask execution, i have an error. UnicodeDecodeError: 'ascii' codec can't decode byte 0xc2 in position 3: ordinal not in range(128)\r\n\r\nI can encode this in utf-8, but i would like to understand why the behaviour is different using flask?\r\n\r\nThanks\r\n\r\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/262767003",
            "html_url": "https://github.com/pallets/flask/issues/2099#issuecomment-262767003",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2099",
            "id": 262767003,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI2Mjc2NzAwMw==",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-11-24T12:37:28Z",
            "updated_at": "2016-11-24T12:38:28Z",
            "author_association": "MEMBER",
            "body": "You forgot to include a traceback or a minimal script to reproduce the issue. Also, unless you are using Python 3 or Python 2 with `from __future__ import unicode_literals` what you posted is a bytestring with whatever charset you declared in the first line of your file, not a unicode string since it does not use the `u'...'` unicode literal syntax."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/262768317",
            "html_url": "https://github.com/pallets/flask/issues/2099#issuecomment-262768317",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2099",
            "id": 262768317,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI2Mjc2ODMxNw==",
            "user": {
                "login": "javixeneize",
                "id": 12761574,
                "node_id": "MDQ6VXNlcjEyNzYxNTc0",
                "avatar_url": "https://avatars0.githubusercontent.com/u/12761574?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/javixeneize",
                "html_url": "https://github.com/javixeneize",
                "followers_url": "https://api.github.com/users/javixeneize/followers",
                "following_url": "https://api.github.com/users/javixeneize/following{/other_user}",
                "gists_url": "https://api.github.com/users/javixeneize/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/javixeneize/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/javixeneize/subscriptions",
                "organizations_url": "https://api.github.com/users/javixeneize/orgs",
                "repos_url": "https://api.github.com/users/javixeneize/repos",
                "events_url": "https://api.github.com/users/javixeneize/events{/privacy}",
                "received_events_url": "https://api.github.com/users/javixeneize/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-11-24T12:44:36Z",
            "updated_at": "2016-11-28T14:14:46Z",
            "author_association": "NONE",
            "body": "I am using python 2.7\r\n\r\nThats my code\r\n\r\n```\r\n@app.route('/test', methods=['POST'])\r\ndef test():   \r\n    params='test'\r\n    paramb=params.replace('st','%$\u00a3')\r\n```\r\n\r\n\r\nThanks"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/262902801",
            "html_url": "https://github.com/pallets/flask/issues/2099#issuecomment-262902801",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2099",
            "id": 262902801,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI2MjkwMjgwMQ==",
            "user": {
                "login": "runfalk",
                "id": 864128,
                "node_id": "MDQ6VXNlcjg2NDEyOA==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/864128?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/runfalk",
                "html_url": "https://github.com/runfalk",
                "followers_url": "https://api.github.com/users/runfalk/followers",
                "following_url": "https://api.github.com/users/runfalk/following{/other_user}",
                "gists_url": "https://api.github.com/users/runfalk/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/runfalk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/runfalk/subscriptions",
                "organizations_url": "https://api.github.com/users/runfalk/orgs",
                "repos_url": "https://api.github.com/users/runfalk/repos",
                "events_url": "https://api.github.com/users/runfalk/events{/privacy}",
                "received_events_url": "https://api.github.com/users/runfalk/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-11-25T08:19:01Z",
            "updated_at": "2016-11-25T08:19:01Z",
            "author_association": "NONE",
            "body": "While your example does result in a UnicodeDecodeError, so does the same code without Flask:\r\n\r\n```\r\nfrom flask import Flask\r\n\r\napp = Flask(\"test\")\r\n\r\n@app.route(\"/test\")\r\ndef test():\r\n    params = 'test'\r\n    paramb = params.replace(\"st\", \"%$\u00a3\")\r\n\r\napp.run()\r\n```\r\n\r\nThis results in UnicodeDecodeError on line 8 when run. The problem is the British pound sign which is not part of the ASCII character set. This error happens even before Python has loaded Flask. It can be fixed by adding ``# -*- coding: utf-8 -*-`` to the top of your file (as described in PEP 0263). If I reduce your code to a single line: ``\"test\".replace(\"st\", \"%$\u00a3\")``, I still get the same error. \r\n\r\nYour working case is testing this in a REPL, I assume, which is why it works. This is because the REPL already knows the encoding of the input, which is by it works."
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/262909349",
            "html_url": "https://github.com/pallets/flask/issues/2099#issuecomment-262909349",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2099",
            "id": 262909349,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI2MjkwOTM0OQ==",
            "user": {
                "login": "javixeneize",
                "id": 12761574,
                "node_id": "MDQ6VXNlcjEyNzYxNTc0",
                "avatar_url": "https://avatars0.githubusercontent.com/u/12761574?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/javixeneize",
                "html_url": "https://github.com/javixeneize",
                "followers_url": "https://api.github.com/users/javixeneize/followers",
                "following_url": "https://api.github.com/users/javixeneize/following{/other_user}",
                "gists_url": "https://api.github.com/users/javixeneize/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/javixeneize/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/javixeneize/subscriptions",
                "organizations_url": "https://api.github.com/users/javixeneize/orgs",
                "repos_url": "https://api.github.com/users/javixeneize/repos",
                "events_url": "https://api.github.com/users/javixeneize/events{/privacy}",
                "received_events_url": "https://api.github.com/users/javixeneize/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-11-25T08:58:04Z",
            "updated_at": "2016-11-25T08:58:04Z",
            "author_association": "NONE",
            "body": "Hi\n\nI have added this and still same error\n\n    v = self._sslobj.write(data)\nUnicodeEncodeError: 'ascii' codec can't encode character u'\\xa3' in\nposition 120\n: ordinal not in range(128)\n127.0.0.1 - - [25/Nov/2016 08:56:45] \"POST /send HTTP/1.1\" 500 -\n\n\n\nOn Fri, Nov 25, 2016 at 8:19 AM, Andreas Runfalk <notifications@github.com>\nwrote:\n\n> While your example does result in a UnicodeDecodeError, so does the same\n> code without Flask:\n>\n> from flask import Flask\n>\n> app = Flask(\"test\")\n>\n> @app.route(\"/test\")\n> def test():\n>     params = 'test'\n>     paramb = params.replace(\"st\", \"%$\u00a3\")\n>\n> app.run()\n>\n> This results in UnicodeDecodeError on line 8 when run. The problem is the\n> British pound sign which is not part of the ASCII character set. This error\n> happens even before Python has loaded Flask. It can be fixed by adding #\n> -*- coding: utf-8 -*- to the top of your file (as described in PEP 0263).\n> If I reduce your code to a single line: \"test\".replace(\"st\", \"%$\u00a3\"), I\n> still get the same error.\n>\n> Your working case is testing this in a REPL, I assume, which is why it\n> works. This is because the REPL already knows the encoding of the input,\n> which is by it works.\n>\n> \u2014\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/pallets/flask/issues/2099#issuecomment-262902801>, or mute\n> the thread\n> <https://github.com/notifications/unsubscribe-auth/AMK55jdxhQA_IifFV2stHle7V5uTNC3yks5rBpoSgaJpZM4K7mzp>\n> .\n>\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/262909556",
            "html_url": "https://github.com/pallets/flask/issues/2099#issuecomment-262909556",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2099",
            "id": 262909556,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI2MjkwOTU1Ng==",
            "user": {
                "login": "xiaocaiyidie",
                "id": 20656272,
                "node_id": "MDQ6VXNlcjIwNjU2Mjcy",
                "avatar_url": "https://avatars1.githubusercontent.com/u/20656272?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/xiaocaiyidie",
                "html_url": "https://github.com/xiaocaiyidie",
                "followers_url": "https://api.github.com/users/xiaocaiyidie/followers",
                "following_url": "https://api.github.com/users/xiaocaiyidie/following{/other_user}",
                "gists_url": "https://api.github.com/users/xiaocaiyidie/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/xiaocaiyidie/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/xiaocaiyidie/subscriptions",
                "organizations_url": "https://api.github.com/users/xiaocaiyidie/orgs",
                "repos_url": "https://api.github.com/users/xiaocaiyidie/repos",
                "events_url": "https://api.github.com/users/xiaocaiyidie/events{/privacy}",
                "received_events_url": "https://api.github.com/users/xiaocaiyidie/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-11-25T08:59:14Z",
            "updated_at": "2016-11-25T08:59:14Z",
            "author_association": "NONE",
            "body": "mark, i get the same error"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/264509083",
            "html_url": "https://github.com/pallets/flask/issues/2099#issuecomment-264509083",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2099",
            "id": 264509083,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI2NDUwOTA4Mw==",
            "user": {
                "login": "javixeneize",
                "id": 12761574,
                "node_id": "MDQ6VXNlcjEyNzYxNTc0",
                "avatar_url": "https://avatars0.githubusercontent.com/u/12761574?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/javixeneize",
                "html_url": "https://github.com/javixeneize",
                "followers_url": "https://api.github.com/users/javixeneize/followers",
                "following_url": "https://api.github.com/users/javixeneize/following{/other_user}",
                "gists_url": "https://api.github.com/users/javixeneize/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/javixeneize/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/javixeneize/subscriptions",
                "organizations_url": "https://api.github.com/users/javixeneize/orgs",
                "repos_url": "https://api.github.com/users/javixeneize/repos",
                "events_url": "https://api.github.com/users/javixeneize/events{/privacy}",
                "received_events_url": "https://api.github.com/users/javixeneize/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-12-02T17:18:57Z",
            "updated_at": "2016-12-02T17:18:57Z",
            "author_association": "NONE",
            "body": "Hi. Any update on this?\r\n\r\nI have tried python app directly from the console and it is displayed converted (['\\xc2\\xa3']), but flask is still failing \r\n\r\nThanks"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/264515059",
            "html_url": "https://github.com/pallets/flask/issues/2099#issuecomment-264515059",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2099",
            "id": 264515059,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI2NDUxNTA1OQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-12-02T17:43:29Z",
            "updated_at": "2016-12-02T17:43:29Z",
            "author_association": "MEMBER",
            "body": "The one line of traceback you provided, `v = self._sslobj.write(data)`, is clearly not related to the code you say causes the error, `paramb = params.replace(\"st\", \"%$\u00a3\")`.\r\n\r\nI cannot reproduce your error in Python 2 or 3. The following code returns the expected response without error in both versions.\r\n\r\n~~~python\r\n# coding=utf-8\r\nfrom flask import Flask\r\n\r\napp = Flask(__name__)\r\n\r\n@app.route('/')\r\ndef index():\r\n\treturn 'test'.replace('st', '%$\u00a3')\r\n\r\napp.run()\r\n~~~\r\n\r\nPlease use Stack Overflow for support with your own code. This tracker is for issues with Flask's code. Be sure to include a [Minimal, Complete, and Verifiable Example](http://stackoverflow.com/help/mcve) when asking, as well as in any future bug reports. Part of this would be the full traceback, as well as code that actually reproduces the problem."
        }
    ]
}