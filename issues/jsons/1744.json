{
    "url": "https://api.github.com/repos/pallets/flask/issues/1744",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/1744/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/1744/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/1744/events",
    "html_url": "https://github.com/pallets/flask/issues/1744",
    "id": 138586696,
    "node_id": "MDU6SXNzdWUxMzg1ODY2OTY=",
    "number": 1744,
    "title": "auto_find_instance_path() gives inconsistent results",
    "user": {
        "login": "rbrtmrtn",
        "id": 1463553,
        "node_id": "MDQ6VXNlcjE0NjM1NTM=",
        "avatar_url": "https://avatars0.githubusercontent.com/u/1463553?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rbrtmrtn",
        "html_url": "https://github.com/rbrtmrtn",
        "followers_url": "https://api.github.com/users/rbrtmrtn/followers",
        "following_url": "https://api.github.com/users/rbrtmrtn/following{/other_user}",
        "gists_url": "https://api.github.com/users/rbrtmrtn/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/rbrtmrtn/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/rbrtmrtn/subscriptions",
        "organizations_url": "https://api.github.com/users/rbrtmrtn/orgs",
        "repos_url": "https://api.github.com/users/rbrtmrtn/repos",
        "events_url": "https://api.github.com/users/rbrtmrtn/events{/privacy}",
        "received_events_url": "https://api.github.com/users/rbrtmrtn/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2016-03-04T21:10:07Z",
    "updated_at": "2016-03-04T21:43:03Z",
    "closed_at": "2016-03-04T21:24:09Z",
    "author_association": "NONE",
    "body": "I have a fairly straightforward project scaffolded out that looks like \n\n```\nmy_app/\n    my_app/\n        __init__.py\n        models.py\n        mod1/\n        mod2/\n    instance/\n        config.py\n    config.py\n    setup.py\n```\n\nI installed this as a package to a virtualenv with `setup.py develop`.  My `__init__.py` looks like:\n\n```\nfrom flask import Flask\nfrom flask.ext.sqlalchemy import SQLAlchemy\n\napp = Flask(__name__, instance_relative_config=True)\napp.config.from_pyfile('config.py')\n\ndb = SQLAlchemy(app)\n```\n\nIf I run this file, I get an error `Unable to load configuration file (No such file or directory): '/home/my_app/my_app/instance/config.py'`. Indeed, this is the wrong path; it should be looking in `/home/my_app/instance/config.py`.\n\nThe file `models.py` contains only one line of code so far: `from my_app import db`. I can run this without any errors, which is obviously executing all the code in `__init__.py` as well. If I check the value of `Flask.auto_find_instance_path` in this context it has the correct path, unlike above.\n\nUnless I am doing something wrong here, or this is a consequence of `setup.py develop`ing that I'm not understanding -- I believe this is an issue with the `find_package` helper  called by `auto_find_instance_path` . When I run  `__init__.py` directly, `__name__` is set to `__main__`, which causes `find_package` to return `os.getcwd()`. When I run `models.py`, the `__name__` for `__init__.py` is set to `my_app` which causes it to resolve properly via the module name.\n\nThis is my first large/packaged Flask project so maybe I'm missing something, but I believe the docs say that your `instance` folder should be next to your main application module, not inside it. If that's the case, why does `find_package` attempt to look in the current working directory? Shouldn't it look in the parent directory?\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/192471547",
            "html_url": "https://github.com/pallets/flask/issues/1744#issuecomment-192471547",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1744",
            "id": 192471547,
            "node_id": "MDEyOklzc3VlQ29tbWVudDE5MjQ3MTU0Nw==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-03-04T21:24:09Z",
            "updated_at": "2016-03-04T21:35:58Z",
            "author_association": "MEMBER",
            "body": "There is no problem with `auto_find_instance_path`.  If your app is a package, you should not be running it with `python __init__.py`.  If you've installed it in develop mode , that won't effect it, it only switches to production mode if you install it _not_ in develop mode.  See http://flask.pocoo.org/docs/0.10/config/#instance-folders for an explanation of how the path is determined.  Note that a package installed in dev mode is considered \"uninstalled package\".  Here's an example of an installable app and how to run it: https://github.com/sopython/sopython-site.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/192478486",
            "html_url": "https://github.com/pallets/flask/issues/1744#issuecomment-192478486",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1744",
            "id": 192478486,
            "node_id": "MDEyOklzc3VlQ29tbWVudDE5MjQ3ODQ4Ng==",
            "user": {
                "login": "rbrtmrtn",
                "id": 1463553,
                "node_id": "MDQ6VXNlcjE0NjM1NTM=",
                "avatar_url": "https://avatars0.githubusercontent.com/u/1463553?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/rbrtmrtn",
                "html_url": "https://github.com/rbrtmrtn",
                "followers_url": "https://api.github.com/users/rbrtmrtn/followers",
                "following_url": "https://api.github.com/users/rbrtmrtn/following{/other_user}",
                "gists_url": "https://api.github.com/users/rbrtmrtn/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/rbrtmrtn/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rbrtmrtn/subscriptions",
                "organizations_url": "https://api.github.com/users/rbrtmrtn/orgs",
                "repos_url": "https://api.github.com/users/rbrtmrtn/repos",
                "events_url": "https://api.github.com/users/rbrtmrtn/events{/privacy}",
                "received_events_url": "https://api.github.com/users/rbrtmrtn/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-03-04T21:37:03Z",
            "updated_at": "2016-03-04T21:37:03Z",
            "author_association": "NONE",
            "body": "The pattern I was missing was in here:\n\nhttp://flask.pocoo.org/docs/0.10/patterns/packages/\n\n> But how do you run your application now? The naive python yourapplication/**init**.py will not work. Let\u2019s just say that Python does not want modules in packages to be the startup file. But that is not a big problem, just add a new file called runserver.py next to the inner yourapplication folder [...]\n"
        }
    ]
}