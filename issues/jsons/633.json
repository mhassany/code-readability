{
    "url": "https://api.github.com/repos/pallets/flask/issues/633",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/633/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/633/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/633/events",
    "html_url": "https://github.com/pallets/flask/issues/633",
    "id": 8301411,
    "node_id": "MDU6SXNzdWU4MzAxNDEx",
    "number": 633,
    "title": "send_file breaks when flask app run as nobody",
    "user": {
        "login": "ernwa",
        "id": 2781076,
        "node_id": "MDQ6VXNlcjI3ODEwNzY=",
        "avatar_url": "https://avatars1.githubusercontent.com/u/2781076?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ernwa",
        "html_url": "https://github.com/ernwa",
        "followers_url": "https://api.github.com/users/ernwa/followers",
        "following_url": "https://api.github.com/users/ernwa/following{/other_user}",
        "gists_url": "https://api.github.com/users/ernwa/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ernwa/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ernwa/subscriptions",
        "organizations_url": "https://api.github.com/users/ernwa/orgs",
        "repos_url": "https://api.github.com/users/ernwa/repos",
        "events_url": "https://api.github.com/users/ernwa/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ernwa/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2012-11-12T20:04:09Z",
    "updated_at": "2013-01-27T01:16:43Z",
    "closed_at": "2013-01-27T01:16:43Z",
    "author_association": "NONE",
    "body": "on my system I am trying to run a flask app with minimum permissions. In this case, it is run as:\n\n```\nsudo -u nobody python flask_webapp.py\n```\n\nall the files in its directory are readable by everyone, but some parent directories are not. The app fails whenever I try to serve up a file, either indirectly by trying to access http://myapp.com/static/test.html, or directly by the following code:\n\n```\n@app.route('/test')\ndef web_app():\n    return send_file(\"./static/test.html\")\n```\n\nThe problem is, flask converts all relative paths to absolute paths in the send_file function. This breaks if it doesn't have directory read access all the way to the system root.\n\nThe problem seems to arise from the following lines, 543 to 545 of helpers.py\n\n```\nif filename is not None:\n    if not os.path.isabs(filename):\n        filename = os.path.join(current_app.root_path, filename)\n```\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/10318842",
            "html_url": "https://github.com/pallets/flask/issues/633#issuecomment-10318842",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/633",
            "id": 10318842,
            "node_id": "MDEyOklzc3VlQ29tbWVudDEwMzE4ODQy",
            "user": {
                "login": "soulseekah",
                "id": 685880,
                "node_id": "MDQ6VXNlcjY4NTg4MA==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/685880?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/soulseekah",
                "html_url": "https://github.com/soulseekah",
                "followers_url": "https://api.github.com/users/soulseekah/followers",
                "following_url": "https://api.github.com/users/soulseekah/following{/other_user}",
                "gists_url": "https://api.github.com/users/soulseekah/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/soulseekah/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/soulseekah/subscriptions",
                "organizations_url": "https://api.github.com/users/soulseekah/orgs",
                "repos_url": "https://api.github.com/users/soulseekah/repos",
                "events_url": "https://api.github.com/users/soulseekah/events{/privacy}",
                "received_events_url": "https://api.github.com/users/soulseekah/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2012-11-13T08:25:57Z",
            "updated_at": "2012-11-13T08:28:20Z",
            "author_association": "CONTRIBUTOR",
            "body": "I should imagine any webserver would have issues serving files \"behind\" an inaccessible directory in an absolute path. Many web-applications would have issues with this, too. I would humbly argue that this is a workspace setup issue.\n\nYou don't need \"read\" access all the way to `/`, but rather \"recurse\" access (`0751` or `o+x`) which keep things safe while allowing traversal onward from `/`.\n\nIf you're still unsure about this, what sort of solutions can be implemented? What implications would the solutions have (other than allowing for arguably \"bad practices\")?\n\nMeanwhile, see this maybe http://flask.pocoo.org/mailinglist/archive/2010/7/18/specify-flask-root-path/ (which is a bit out of date)\nAlso look into here https://github.com/mitsuhiko/flask/blob/master/flask/app.py#L597\nOr you could pass in a file pointer as in `send_file( open( 'static/text.html', 'rb' ) )` and have that read directly.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/12745774",
            "html_url": "https://github.com/pallets/flask/issues/633#issuecomment-12745774",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/633",
            "id": 12745774,
            "node_id": "MDEyOklzc3VlQ29tbWVudDEyNzQ1Nzc0",
            "user": {
                "login": "mitsuhiko",
                "id": 7396,
                "node_id": "MDQ6VXNlcjczOTY=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/7396?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mitsuhiko",
                "html_url": "https://github.com/mitsuhiko",
                "followers_url": "https://api.github.com/users/mitsuhiko/followers",
                "following_url": "https://api.github.com/users/mitsuhiko/following{/other_user}",
                "gists_url": "https://api.github.com/users/mitsuhiko/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mitsuhiko/subscriptions",
                "organizations_url": "https://api.github.com/users/mitsuhiko/orgs",
                "repos_url": "https://api.github.com/users/mitsuhiko/repos",
                "events_url": "https://api.github.com/users/mitsuhiko/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mitsuhiko/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-01-27T01:16:43Z",
            "updated_at": "2013-01-27T01:16:43Z",
            "author_association": "MEMBER",
            "body": "The current working directory is not reliable in WSGI, Flask has to convert it to absolute paths.\n"
        }
    ]
}