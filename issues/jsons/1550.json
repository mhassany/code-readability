{
    "url": "https://api.github.com/repos/pallets/flask/issues/1550",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/1550/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/1550/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/1550/events",
    "html_url": "https://github.com/pallets/flask/issues/1550",
    "id": 99096530,
    "node_id": "MDU6SXNzdWU5OTA5NjUzMA==",
    "number": 1550,
    "title": "Flask function decorator run at defintion time and call time?",
    "user": {
        "login": "kevinschaich",
        "id": 9244728,
        "node_id": "MDQ6VXNlcjkyNDQ3Mjg=",
        "avatar_url": "https://avatars1.githubusercontent.com/u/9244728?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kevinschaich",
        "html_url": "https://github.com/kevinschaich",
        "followers_url": "https://api.github.com/users/kevinschaich/followers",
        "following_url": "https://api.github.com/users/kevinschaich/following{/other_user}",
        "gists_url": "https://api.github.com/users/kevinschaich/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/kevinschaich/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/kevinschaich/subscriptions",
        "organizations_url": "https://api.github.com/users/kevinschaich/orgs",
        "repos_url": "https://api.github.com/users/kevinschaich/repos",
        "events_url": "https://api.github.com/users/kevinschaich/events{/privacy}",
        "received_events_url": "https://api.github.com/users/kevinschaich/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2015-08-05T01:31:22Z",
    "updated_at": "2015-08-05T02:42:32Z",
    "closed_at": "2015-08-05T02:42:32Z",
    "author_association": "NONE",
    "body": "I'm trying to implement a decorator function in Flask that does two things: register a page route and add some things to my DB on definition time, and then on runtime, when a request is made to a page it processes whether a user is authenticated.\n\nI know that I can do these in two separate decorator functions, but this won't work because I eventually need to process the same set of information (app, rule, access groups, etc.) at both definition time and runtime.\n\nThe code below is what I have been messing with, but I have not been able to get it to work. It compiles and you are able to see \"Definition time\" in the console and \"index\" in the browser, but \"Runtime\" never gets printed. Can anyone suggest what I may be doing wrong?\n\n``` python\nfrom flask import Flask\nfrom functools import wraps\n\napp = Flask(__name__)\n\n\ndef register(app, rule, **options):\n    def wrapper(f):\n        print \"Definition time\"\n        endpoint = options.pop('endpoint', f.__name__)\n        access_groups = options.pop('access_groups', None)\n        methods = options.get('methods', ['GET'])\n\n        app.add_url_rule(rule, endpoint, f, **options)\n\n        @wraps(f)\n        def wrapped(*args, **kwargs):\n            print \"Runtime\"\n            return f(*args, **kwargs)\n        return wrapped\n\n    return wrapper\n\n\n@register(app, '/', methods=['GET', 'POST'], access_groups=['all-access'])\ndef index():\n    return \"index\"\n\nif __name__ == '__main__':\n    app.run(debug=True)\n```\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/127822849",
            "html_url": "https://github.com/pallets/flask/issues/1550#issuecomment-127822849",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1550",
            "id": 127822849,
            "node_id": "MDEyOklzc3VlQ29tbWVudDEyNzgyMjg0OQ==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2015-08-05T02:38:09Z",
            "updated_at": "2015-08-05T02:38:09Z",
            "author_association": "MEMBER",
            "body": "You passed `f` rather than `wrapped` to `add_url_rule`.  Please ask support questions on Stack Overflow or IRC, rather than the issue tracker.  (In this case, you already did: http://stackoverflow.com/a/31822417/400617)\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/127823224",
            "html_url": "https://github.com/pallets/flask/issues/1550#issuecomment-127823224",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1550",
            "id": 127823224,
            "node_id": "MDEyOklzc3VlQ29tbWVudDEyNzgyMzIyNA==",
            "user": {
                "login": "kevinschaich",
                "id": 9244728,
                "node_id": "MDQ6VXNlcjkyNDQ3Mjg=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/9244728?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/kevinschaich",
                "html_url": "https://github.com/kevinschaich",
                "followers_url": "https://api.github.com/users/kevinschaich/followers",
                "following_url": "https://api.github.com/users/kevinschaich/following{/other_user}",
                "gists_url": "https://api.github.com/users/kevinschaich/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/kevinschaich/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kevinschaich/subscriptions",
                "organizations_url": "https://api.github.com/users/kevinschaich/orgs",
                "repos_url": "https://api.github.com/users/kevinschaich/repos",
                "events_url": "https://api.github.com/users/kevinschaich/events{/privacy}",
                "received_events_url": "https://api.github.com/users/kevinschaich/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2015-08-05T02:42:32Z",
            "updated_at": "2015-08-05T02:42:32Z",
            "author_association": "NONE",
            "body": "Thanks, I'll continue on that thread now. Sorry about that.\n"
        }
    ]
}