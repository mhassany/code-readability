{
    "url": "https://api.github.com/repos/pallets/flask/issues/2048",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/2048/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/2048/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/2048/events",
    "html_url": "https://github.com/pallets/flask/issues/2048",
    "id": 180854436,
    "node_id": "MDU6SXNzdWUxODA4NTQ0MzY=",
    "number": 2048,
    "title": "Binary file corrupted between the server and the client",
    "user": {
        "login": "Gallaecio",
        "id": 705211,
        "node_id": "MDQ6VXNlcjcwNTIxMQ==",
        "avatar_url": "https://avatars2.githubusercontent.com/u/705211?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Gallaecio",
        "html_url": "https://github.com/Gallaecio",
        "followers_url": "https://api.github.com/users/Gallaecio/followers",
        "following_url": "https://api.github.com/users/Gallaecio/following{/other_user}",
        "gists_url": "https://api.github.com/users/Gallaecio/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/Gallaecio/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Gallaecio/subscriptions",
        "organizations_url": "https://api.github.com/users/Gallaecio/orgs",
        "repos_url": "https://api.github.com/users/Gallaecio/repos",
        "events_url": "https://api.github.com/users/Gallaecio/events{/privacy}",
        "received_events_url": "https://api.github.com/users/Gallaecio/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 8,
    "created_at": "2016-10-04T10:14:05Z",
    "updated_at": "2016-10-04T11:20:58Z",
    "closed_at": "2016-10-04T11:20:58Z",
    "author_association": "NONE",
    "body": "I am using **Python 3** and the following code:\n\n```\n@app.route('/')\ndef pdf():\n    # [Generate PDF as a byte string]\n    with open('file.pdf', 'wb') as f:\n        f.write(pdf)\n    return send_file(BytesIO(pdf))\n```\n\nOn the server, a valid PDF file is written. On the client, I get an invalid PDF about twice the expected size.\n\nit looks like an encoding issue, so I am guessing that the fact that I am using Python 3 may be relevant. The differences between the file saved on the server and the one I get on the client is similar to that of [this StackOverflow question](http://stackoverflow.com/questions/35368352/pdf-response-is-corrupted-in-python-3-but-works-in-python-2), but the poster there was passing the PDF data as a string, whereas in my code `pdf` is made of bytes (Python 3 would not let me write the file otherwise).\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/251350662",
            "html_url": "https://github.com/pallets/flask/issues/2048#issuecomment-251350662",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2048",
            "id": 251350662,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI1MTM1MDY2Mg==",
            "user": {
                "login": "RonnyPfannschmidt",
                "id": 156838,
                "node_id": "MDQ6VXNlcjE1NjgzOA==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/156838?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/RonnyPfannschmidt",
                "html_url": "https://github.com/RonnyPfannschmidt",
                "followers_url": "https://api.github.com/users/RonnyPfannschmidt/followers",
                "following_url": "https://api.github.com/users/RonnyPfannschmidt/following{/other_user}",
                "gists_url": "https://api.github.com/users/RonnyPfannschmidt/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/RonnyPfannschmidt/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/RonnyPfannschmidt/subscriptions",
                "organizations_url": "https://api.github.com/users/RonnyPfannschmidt/orgs",
                "repos_url": "https://api.github.com/users/RonnyPfannschmidt/repos",
                "events_url": "https://api.github.com/users/RonnyPfannschmidt/events{/privacy}",
                "received_events_url": "https://api.github.com/users/RonnyPfannschmidt/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-10-04T10:20:32Z",
            "updated_at": "2016-10-04T10:20:32Z",
            "author_association": "CONTRIBUTOR",
            "body": "if you do have a bytestring, why not just return it ?!\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/251350999",
            "html_url": "https://github.com/pallets/flask/issues/2048#issuecomment-251350999",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2048",
            "id": 251350999,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI1MTM1MDk5OQ==",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-10-04T10:22:11Z",
            "updated_at": "2016-10-04T10:22:11Z",
            "author_association": "MEMBER",
            "body": "You're possibly having multiple requests writing to the same filepath...\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/251354050",
            "html_url": "https://github.com/pallets/flask/issues/2048#issuecomment-251354050",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2048",
            "id": 251354050,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI1MTM1NDA1MA==",
            "user": {
                "login": "Gallaecio",
                "id": 705211,
                "node_id": "MDQ6VXNlcjcwNTIxMQ==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/705211?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/Gallaecio",
                "html_url": "https://github.com/Gallaecio",
                "followers_url": "https://api.github.com/users/Gallaecio/followers",
                "following_url": "https://api.github.com/users/Gallaecio/following{/other_user}",
                "gists_url": "https://api.github.com/users/Gallaecio/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/Gallaecio/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Gallaecio/subscriptions",
                "organizations_url": "https://api.github.com/users/Gallaecio/orgs",
                "repos_url": "https://api.github.com/users/Gallaecio/repos",
                "events_url": "https://api.github.com/users/Gallaecio/events{/privacy}",
                "received_events_url": "https://api.github.com/users/Gallaecio/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-10-04T10:38:21Z",
            "updated_at": "2016-10-04T10:38:21Z",
            "author_association": "NONE",
            "body": "If I just return the bytestring, it works for a \u201cwget URL -O file.pdf\u201d call, but since I am not setting the Content-Type header, it does not display correctly in a web browser.\n\nAnd if I use `make_response` (as follows), I get the same behavior as with `send_file`.\n\n```\nresponse = make_response(pdf)\nresponse.headers['Content-Type'] = 'application/pdf'\nreturn response\n```\n\nSince returning the bytestring \u201cworks\u201d and I am using a REST client, I don\u2019t think I am writing to the same file twice. The contents of the PDF are not just twice the size, they are corrupted in a similar fashion to that described in the linked StackOverflow question.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/251354588",
            "html_url": "https://github.com/pallets/flask/issues/2048#issuecomment-251354588",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2048",
            "id": 251354588,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI1MTM1NDU4OA==",
            "user": {
                "login": "RonnyPfannschmidt",
                "id": 156838,
                "node_id": "MDQ6VXNlcjE1NjgzOA==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/156838?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/RonnyPfannschmidt",
                "html_url": "https://github.com/RonnyPfannschmidt",
                "followers_url": "https://api.github.com/users/RonnyPfannschmidt/followers",
                "following_url": "https://api.github.com/users/RonnyPfannschmidt/following{/other_user}",
                "gists_url": "https://api.github.com/users/RonnyPfannschmidt/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/RonnyPfannschmidt/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/RonnyPfannschmidt/subscriptions",
                "organizations_url": "https://api.github.com/users/RonnyPfannschmidt/orgs",
                "repos_url": "https://api.github.com/users/RonnyPfannschmidt/repos",
                "events_url": "https://api.github.com/users/RonnyPfannschmidt/events{/privacy}",
                "received_events_url": "https://api.github.com/users/RonnyPfannschmidt/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-10-04T10:41:35Z",
            "updated_at": "2016-10-04T10:41:35Z",
            "author_association": "CONTRIBUTOR",
            "body": "that sounds like a potential decode/re-encode issue, more context is needed to determine the location of the cause\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/251356896",
            "html_url": "https://github.com/pallets/flask/issues/2048#issuecomment-251356896",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2048",
            "id": 251356896,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI1MTM1Njg5Ng==",
            "user": {
                "login": "Gallaecio",
                "id": 705211,
                "node_id": "MDQ6VXNlcjcwNTIxMQ==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/705211?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/Gallaecio",
                "html_url": "https://github.com/Gallaecio",
                "followers_url": "https://api.github.com/users/Gallaecio/followers",
                "following_url": "https://api.github.com/users/Gallaecio/following{/other_user}",
                "gists_url": "https://api.github.com/users/Gallaecio/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/Gallaecio/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Gallaecio/subscriptions",
                "organizations_url": "https://api.github.com/users/Gallaecio/orgs",
                "repos_url": "https://api.github.com/users/Gallaecio/repos",
                "events_url": "https://api.github.com/users/Gallaecio/events{/privacy}",
                "received_events_url": "https://api.github.com/users/Gallaecio/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-10-04T10:54:50Z",
            "updated_at": "2016-10-04T10:56:37Z",
            "author_association": "NONE",
            "body": "I am debugging the issue, and so far data remains intact (as `b'\u2026'`, and content verified by writing it to a file with the debugger) at least until `self.wfile.write(data)` in `werkzeug/serving.py:165`.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/251357802",
            "html_url": "https://github.com/pallets/flask/issues/2048#issuecomment-251357802",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2048",
            "id": 251357802,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI1MTM1NzgwMg==",
            "user": {
                "login": "Gallaecio",
                "id": 705211,
                "node_id": "MDQ6VXNlcjcwNTIxMQ==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/705211?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/Gallaecio",
                "html_url": "https://github.com/Gallaecio",
                "followers_url": "https://api.github.com/users/Gallaecio/followers",
                "following_url": "https://api.github.com/users/Gallaecio/following{/other_user}",
                "gists_url": "https://api.github.com/users/Gallaecio/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/Gallaecio/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Gallaecio/subscriptions",
                "organizations_url": "https://api.github.com/users/Gallaecio/orgs",
                "repos_url": "https://api.github.com/users/Gallaecio/repos",
                "events_url": "https://api.github.com/users/Gallaecio/events{/privacy}",
                "received_events_url": "https://api.github.com/users/Gallaecio/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-10-04T10:59:50Z",
            "updated_at": "2016-10-04T10:59:50Z",
            "author_association": "NONE",
            "body": "> more context is needed to determine the location of the cause\n\nAny hints on what additional data may prove helpful?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/251360157",
            "html_url": "https://github.com/pallets/flask/issues/2048#issuecomment-251360157",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2048",
            "id": 251360157,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI1MTM2MDE1Nw==",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-10-04T11:13:30Z",
            "updated_at": "2016-10-04T11:13:30Z",
            "author_association": "MEMBER",
            "body": "On Tue, Oct 04, 2016 at 03:38:30AM -0700, Gallaecio wrote:\n\n> If I just return the bytestring, it works for a \u201cwget URL -O file.pdf\u201d call,\n> but since I am not setting the Content-Type header, it does not display\n> correctly in a web browser.\n\nThen set the content-type header. If there is documentation that is omitting\nthat, it is a problem with the docs.\n\n> I don\u2019t\n> think I am writing to the same file twice.\n\nYou have a hardcoded temporary path in your example. You _are_ writing to the\nsame file.\n\n> Since returning the bytestring \u201cworks\u201d and I am using a REST client\n\nREST-clients are irrelevant to this issue. The fact that using the bytestring\nworks is an indication that it has something to do with the file.\n\n> just twice the size, they are corrupted in a similar fashion to that\n> described in the linked StackOverflow question.\n\nThere is also an answer to the question, which indicates that this is not an\nissue with Flask at all.\n\n> ## \n> \n> You are receiving this because you commented.\n> Reply to this email directly or view it on GitHub:\n> https://github.com/pallets/flask/issues/2048#issuecomment-251354050\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/251361489",
            "html_url": "https://github.com/pallets/flask/issues/2048#issuecomment-251361489",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/2048",
            "id": 251361489,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI1MTM2MTQ4OQ==",
            "user": {
                "login": "Gallaecio",
                "id": 705211,
                "node_id": "MDQ6VXNlcjcwNTIxMQ==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/705211?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/Gallaecio",
                "html_url": "https://github.com/Gallaecio",
                "followers_url": "https://api.github.com/users/Gallaecio/followers",
                "following_url": "https://api.github.com/users/Gallaecio/following{/other_user}",
                "gists_url": "https://api.github.com/users/Gallaecio/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/Gallaecio/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Gallaecio/subscriptions",
                "organizations_url": "https://api.github.com/users/Gallaecio/orgs",
                "repos_url": "https://api.github.com/users/Gallaecio/repos",
                "events_url": "https://api.github.com/users/Gallaecio/events{/privacy}",
                "received_events_url": "https://api.github.com/users/Gallaecio/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2016-10-04T11:20:58Z",
            "updated_at": "2016-10-04T11:20:58Z",
            "author_association": "NONE",
            "body": "As I was trying to write a self-contained example I noticed that I was not allowed to start a server on 5000 even after killing the existing one. After I killed even the Python process itself, and restarted the server, the make_response approach started working.\n\nI have no idea what the issue was. The write function you see in the original post was not the problem, it only writes the contents of `pdf` (correctly) on the server side, I just added that in order to check that the contents of `pdf` where not corrupt at that point. The results were the same without the write function (there was no write function there when the problem presented itself first).\n\nSorry for the trouble, and thanks for the help.\n"
        }
    ]
}