{
    "url": "https://api.github.com/repos/pallets/flask/issues/1130",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/1130/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/1130/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/1130/events",
    "html_url": "https://github.com/pallets/flask/issues/1130",
    "id": 38436945,
    "node_id": "MDU6SXNzdWUzODQzNjk0NQ==",
    "number": 1130,
    "title": "Automatic route redirect changes domain to 127.0.0.1:port",
    "user": {
        "login": "danieldiekmeier",
        "id": 2098462,
        "node_id": "MDQ6VXNlcjIwOTg0NjI=",
        "avatar_url": "https://avatars2.githubusercontent.com/u/2098462?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danieldiekmeier",
        "html_url": "https://github.com/danieldiekmeier",
        "followers_url": "https://api.github.com/users/danieldiekmeier/followers",
        "following_url": "https://api.github.com/users/danieldiekmeier/following{/other_user}",
        "gists_url": "https://api.github.com/users/danieldiekmeier/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/danieldiekmeier/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/danieldiekmeier/subscriptions",
        "organizations_url": "https://api.github.com/users/danieldiekmeier/orgs",
        "repos_url": "https://api.github.com/users/danieldiekmeier/repos",
        "events_url": "https://api.github.com/users/danieldiekmeier/events{/privacy}",
        "received_events_url": "https://api.github.com/users/danieldiekmeier/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2014-07-22T19:51:30Z",
    "updated_at": "2014-07-23T06:54:56Z",
    "closed_at": "2014-07-23T06:54:56Z",
    "author_association": "NONE",
    "body": "Okay, so I got an application running on `127.0.0.1:62781`.\n\nI'm redirecting all traffic to this port, via htaccess.\n\nEverything works quite well. Except for the automatic route redirect that kicks in if you have specified routes like these:\n\n```\n@app.route('/users/', defaults={'page': 1})\n@app.route('/users/page/<int:page>')\ndef show_users(page):\n    pass\n```\n\nOf course, I'm mostly using url_for, so it's not a huge problem, but if a user visits <domain>/users/page/1, he should get redirected to <domain>/users, but instead flask wants to send him to 127.0.0.1:62781/users.\n\nHow can I prevent that from happening?\n\nI tried it with gunicorn and the \"standard\" run.py that looks like this:\n\n```\nimport lesetagebuch.main as main\nmain.app.run(\n    host='0.0.0.0',\n    port=62781\n)\n```\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/49806402",
            "html_url": "https://github.com/pallets/flask/issues/1130#issuecomment-49806402",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1130",
            "id": 49806402,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ5ODA2NDAy",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-07-22T21:51:28Z",
            "updated_at": "2014-07-22T21:51:44Z",
            "author_association": "MEMBER",
            "body": "This depends on how your production setup looks like. The problem you mentioned is related to a wrong value in the HOST environment variable, often caused by reverse proxying.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/49812073",
            "html_url": "https://github.com/pallets/flask/issues/1130#issuecomment-49812073",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1130",
            "id": 49812073,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ5ODEyMDcz",
            "user": {
                "login": "danieldiekmeier",
                "id": 2098462,
                "node_id": "MDQ6VXNlcjIwOTg0NjI=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/2098462?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/danieldiekmeier",
                "html_url": "https://github.com/danieldiekmeier",
                "followers_url": "https://api.github.com/users/danieldiekmeier/followers",
                "following_url": "https://api.github.com/users/danieldiekmeier/following{/other_user}",
                "gists_url": "https://api.github.com/users/danieldiekmeier/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/danieldiekmeier/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/danieldiekmeier/subscriptions",
                "organizations_url": "https://api.github.com/users/danieldiekmeier/orgs",
                "repos_url": "https://api.github.com/users/danieldiekmeier/repos",
                "events_url": "https://api.github.com/users/danieldiekmeier/events{/privacy}",
                "received_events_url": "https://api.github.com/users/danieldiekmeier/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-07-22T22:49:31Z",
            "updated_at": "2014-07-22T22:49:42Z",
            "author_association": "NONE",
            "body": "I'm not sure if I'm using reverse proxying.\n\nMy .htaccess contains only this:\n\n```\nRewriteEngine On\nRewriteRule (.*) http://127.0.0.1:62781/$1 [P]\n```\n\nHow can I set the right value for HOST?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/49812182",
            "html_url": "https://github.com/pallets/flask/issues/1130#issuecomment-49812182",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1130",
            "id": 49812182,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ5ODEyMTgy",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-07-22T22:50:40Z",
            "updated_at": "2014-07-22T22:51:22Z",
            "author_association": "MEMBER",
            "body": "Yes, that's reverse proxying. Using the proper hostname instead of `127.0.0.1` would probably work.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/49812729",
            "html_url": "https://github.com/pallets/flask/issues/1130#issuecomment-49812729",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1130",
            "id": 49812729,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ5ODEyNzI5",
            "user": {
                "login": "danieldiekmeier",
                "id": 2098462,
                "node_id": "MDQ6VXNlcjIwOTg0NjI=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/2098462?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/danieldiekmeier",
                "html_url": "https://github.com/danieldiekmeier",
                "followers_url": "https://api.github.com/users/danieldiekmeier/followers",
                "following_url": "https://api.github.com/users/danieldiekmeier/following{/other_user}",
                "gists_url": "https://api.github.com/users/danieldiekmeier/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/danieldiekmeier/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/danieldiekmeier/subscriptions",
                "organizations_url": "https://api.github.com/users/danieldiekmeier/orgs",
                "repos_url": "https://api.github.com/users/danieldiekmeier/repos",
                "events_url": "https://api.github.com/users/danieldiekmeier/events{/privacy}",
                "received_events_url": "https://api.github.com/users/danieldiekmeier/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-07-22T22:57:30Z",
            "updated_at": "2014-07-22T22:57:30Z",
            "author_association": "NONE",
            "body": "Well, it kind of works.\n\nWhen I change the rewrite rule to the hostname and the host-parameter to the same hostname, the automatic redirects bring me to hostname:62781.\n\nBut I can not change the port to 80:\n\n```\ntest_socket.bind((hostname, port))\nPermissionError: [Errno 13] Permission denied\n```\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/49813142",
            "html_url": "https://github.com/pallets/flask/issues/1130#issuecomment-49813142",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1130",
            "id": 49813142,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ5ODEzMTQy",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-07-22T23:02:06Z",
            "updated_at": "2014-07-22T23:02:06Z",
            "author_association": "MEMBER",
            "body": "You need to use this:\n\n```\nRewriteEngine On\nRewriteCond %{REQUEST_FILENAME} !-f\nRewriteBase /\nRewriteRule ^(.*)$ http://localhost:''' + port + '''/$1 [P,L]\nRequestHeader set X-Forwarded-Proto https env=HTTPS\n```\n\nAnd use proxyfixer like this:\n\n```\nfrom werkzeug.contrib.fixers import ProxyFix\napp.wsgi_app = ProxyFix(app.wsgi_app)\n```\n\nSee http://flask.pocoo.org/docs/deploying/wsgi-standalone/#proxy-setups and https://github.com/untitaker/uberspace-deploy-scripts\n\nBinding to port 80 fails because you need to be root for that.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/49839223",
            "html_url": "https://github.com/pallets/flask/issues/1130#issuecomment-49839223",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1130",
            "id": 49839223,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ5ODM5MjIz",
            "user": {
                "login": "danieldiekmeier",
                "id": 2098462,
                "node_id": "MDQ6VXNlcjIwOTg0NjI=",
                "avatar_url": "https://avatars2.githubusercontent.com/u/2098462?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/danieldiekmeier",
                "html_url": "https://github.com/danieldiekmeier",
                "followers_url": "https://api.github.com/users/danieldiekmeier/followers",
                "following_url": "https://api.github.com/users/danieldiekmeier/following{/other_user}",
                "gists_url": "https://api.github.com/users/danieldiekmeier/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/danieldiekmeier/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/danieldiekmeier/subscriptions",
                "organizations_url": "https://api.github.com/users/danieldiekmeier/orgs",
                "repos_url": "https://api.github.com/users/danieldiekmeier/repos",
                "events_url": "https://api.github.com/users/danieldiekmeier/events{/privacy}",
                "received_events_url": "https://api.github.com/users/danieldiekmeier/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-07-23T06:54:56Z",
            "updated_at": "2014-07-23T06:54:56Z",
            "author_association": "NONE",
            "body": "Nice, that works. Thank you!\n"
        }
    ]
}