{
    "url": "https://api.github.com/repos/pallets/flask/issues/3419",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/3419/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/3419/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/3419/events",
    "html_url": "https://github.com/pallets/flask/pull/3419",
    "id": 519451568,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MzM4MTkxMzMx",
    "number": 3419,
    "title": "Issue 3358 fix",
    "user": {
        "login": "anirudhnarayanan",
        "id": 16200000,
        "node_id": "MDQ6VXNlcjE2MjAwMDAw",
        "avatar_url": "https://avatars1.githubusercontent.com/u/16200000?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/anirudhnarayanan",
        "html_url": "https://github.com/anirudhnarayanan",
        "followers_url": "https://api.github.com/users/anirudhnarayanan/followers",
        "following_url": "https://api.github.com/users/anirudhnarayanan/following{/other_user}",
        "gists_url": "https://api.github.com/users/anirudhnarayanan/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/anirudhnarayanan/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/anirudhnarayanan/subscriptions",
        "organizations_url": "https://api.github.com/users/anirudhnarayanan/orgs",
        "repos_url": "https://api.github.com/users/anirudhnarayanan/repos",
        "events_url": "https://api.github.com/users/anirudhnarayanan/events{/privacy}",
        "received_events_url": "https://api.github.com/users/anirudhnarayanan/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2019-11-07T18:58:25Z",
    "updated_at": "2019-11-19T05:45:57Z",
    "closed_at": "2019-11-19T05:45:57Z",
    "author_association": "NONE",
    "pull_request": {
        "url": "https://api.github.com/repos/pallets/flask/pulls/3419",
        "html_url": "https://github.com/pallets/flask/pull/3419",
        "diff_url": "https://github.com/pallets/flask/pull/3419.diff",
        "patch_url": "https://github.com/pallets/flask/pull/3419.patch"
    },
    "body": "fixes #3358",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/551221469",
            "html_url": "https://github.com/pallets/flask/pull/3419#issuecomment-551221469",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3419",
            "id": 551221469,
            "node_id": "MDEyOklzc3VlQ29tbWVudDU1MTIyMTQ2OQ==",
            "user": {
                "login": "anirudhnarayanan",
                "id": 16200000,
                "node_id": "MDQ6VXNlcjE2MjAwMDAw",
                "avatar_url": "https://avatars1.githubusercontent.com/u/16200000?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/anirudhnarayanan",
                "html_url": "https://github.com/anirudhnarayanan",
                "followers_url": "https://api.github.com/users/anirudhnarayanan/followers",
                "following_url": "https://api.github.com/users/anirudhnarayanan/following{/other_user}",
                "gists_url": "https://api.github.com/users/anirudhnarayanan/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/anirudhnarayanan/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/anirudhnarayanan/subscriptions",
                "organizations_url": "https://api.github.com/users/anirudhnarayanan/orgs",
                "repos_url": "https://api.github.com/users/anirudhnarayanan/repos",
                "events_url": "https://api.github.com/users/anirudhnarayanan/events{/privacy}",
                "received_events_url": "https://api.github.com/users/anirudhnarayanan/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-11-07T19:12:04Z",
            "updated_at": "2019-11-07T19:12:04Z",
            "author_association": "NONE",
            "body": "Will refactor code to avoid repetition, and will check the test cases\n\nOn Thu, Nov 7, 2019 at 2:10 PM David Lord <notifications@github.com> wrote:\n\n> *@davidism* requested changes on this pull request.\n>\n> Needs tests and changelog as well\n> ------------------------------\n>\n> In src/flask/helpers.py\n> <https://github.com/pallets/flask/pull/3419#discussion_r343820747>:\n>\n> > @@ -41,6 +41,10 @@\n>  from .globals import session\n>  from .signals import message_flashed\n>\n> +if sys.version_info >= (3, 0):\n>\n> This is already handled in flask._compat\n> ------------------------------\n>\n> In src/flask/helpers.py\n> <https://github.com/pallets/flask/pull/3419#discussion_r343821990>:\n>\n> > @@ -630,6 +634,21 @@ def send_file(\n>              mtime = os.path.getmtime(filename)\n>              fsize = os.path.getsize(filename)\n>              headers[\"Content-Length\"] = fsize\n> +\n> +        elif isinstance(file,io.StringIO):\n> +            \"\"\"\n> +            Reaches String IO parsing to BytesIO\n> +            \"\"\"\n> +            mem = BytesIO()\n> +            mem.write(file.getvalue().encode('utf-8'))\n> +            mem.seek(0)\n> +            file = mem\n>\n> Just do file = BytesIO initially\n> ------------------------------\n>\n> In src/flask/helpers.py\n> <https://github.com/pallets/flask/pull/3419#discussion_r343822328>:\n>\n> > @@ -630,6 +634,21 @@ def send_file(\n>              mtime = os.path.getmtime(filename)\n>              fsize = os.path.getsize(filename)\n>              headers[\"Content-Length\"] = fsize\n> +\n> +        elif isinstance(file,io.StringIO):\n> +            \"\"\"\n> +            Reaches String IO parsing to BytesIO\n> +            \"\"\"\n> +            mem = BytesIO()\n> +            mem.write(file.getvalue().encode('utf-8'))\n> +            mem.seek(0)\n> +            file = mem\n> +            try:\n> +                fsize = file.getbuffer().nbytes\n>\n> Duplicates code below, if/elif/elif needs to be refactored to avoid that.\n>\n> \u2014\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/pallets/flask/pull/3419?email_source=notifications&email_token=AD3TCQBSV7AFDZV6RUBXTUTQSRR2PA5CNFSM4JKL4YS2YY3PNVWWK3TUL52HS4DFWFIHK3DMKJSXC5LFON2FEZLWNFSXPKTDN5WW2ZLOORPWSZGOCKYKLVI#pullrequestreview-313566677>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AD3TCQHH4QPENWAEDB5VBDLQSRR2PANCNFSM4JKL4YSQ>\n> .\n>\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/551365688",
            "html_url": "https://github.com/pallets/flask/pull/3419#issuecomment-551365688",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3419",
            "id": 551365688,
            "node_id": "MDEyOklzc3VlQ29tbWVudDU1MTM2NTY4OA==",
            "user": {
                "login": "anirudhnarayanan",
                "id": 16200000,
                "node_id": "MDQ6VXNlcjE2MjAwMDAw",
                "avatar_url": "https://avatars1.githubusercontent.com/u/16200000?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/anirudhnarayanan",
                "html_url": "https://github.com/anirudhnarayanan",
                "followers_url": "https://api.github.com/users/anirudhnarayanan/followers",
                "following_url": "https://api.github.com/users/anirudhnarayanan/following{/other_user}",
                "gists_url": "https://api.github.com/users/anirudhnarayanan/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/anirudhnarayanan/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/anirudhnarayanan/subscriptions",
                "organizations_url": "https://api.github.com/users/anirudhnarayanan/orgs",
                "repos_url": "https://api.github.com/users/anirudhnarayanan/repos",
                "events_url": "https://api.github.com/users/anirudhnarayanan/events{/privacy}",
                "received_events_url": "https://api.github.com/users/anirudhnarayanan/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-11-08T03:10:57Z",
            "updated_at": "2019-11-08T03:10:57Z",
            "author_association": "NONE",
            "body": "Hi David,\nthe reason I need to do the version check, is because in python2.7 stringio\nis imported from StringIO and not from io. I have fixed the repetition. In\nmy new pull request I did fail one test,\n\"stylecheck: commands failed\"\n\nCould you please assist me on fixing it? Also are there any other changes I\nneed to make/include?\n\nBest,\nAnirudh\n\nOn Thu, Nov 7, 2019 at 2:11 PM Anirudh Narayanan <anirudh95@gmail.com>\nwrote:\n\n> Will refactor code to avoid repetition, and will check the test cases\n>\n> On Thu, Nov 7, 2019 at 2:10 PM David Lord <notifications@github.com>\n> wrote:\n>\n>> *@davidism* requested changes on this pull request.\n>>\n>> Needs tests and changelog as well\n>> ------------------------------\n>>\n>> In src/flask/helpers.py\n>> <https://github.com/pallets/flask/pull/3419#discussion_r343820747>:\n>>\n>> > @@ -41,6 +41,10 @@\n>>  from .globals import session\n>>  from .signals import message_flashed\n>>\n>> +if sys.version_info >= (3, 0):\n>>\n>> This is already handled in flask._compat\n>> ------------------------------\n>>\n>> In src/flask/helpers.py\n>> <https://github.com/pallets/flask/pull/3419#discussion_r343821990>:\n>>\n>> > @@ -630,6 +634,21 @@ def send_file(\n>>              mtime = os.path.getmtime(filename)\n>>              fsize = os.path.getsize(filename)\n>>              headers[\"Content-Length\"] = fsize\n>> +\n>> +        elif isinstance(file,io.StringIO):\n>> +            \"\"\"\n>> +            Reaches String IO parsing to BytesIO\n>> +            \"\"\"\n>> +            mem = BytesIO()\n>> +            mem.write(file.getvalue().encode('utf-8'))\n>> +            mem.seek(0)\n>> +            file = mem\n>>\n>> Just do file = BytesIO initially\n>> ------------------------------\n>>\n>> In src/flask/helpers.py\n>> <https://github.com/pallets/flask/pull/3419#discussion_r343822328>:\n>>\n>> > @@ -630,6 +634,21 @@ def send_file(\n>>              mtime = os.path.getmtime(filename)\n>>              fsize = os.path.getsize(filename)\n>>              headers[\"Content-Length\"] = fsize\n>> +\n>> +        elif isinstance(file,io.StringIO):\n>> +            \"\"\"\n>> +            Reaches String IO parsing to BytesIO\n>> +            \"\"\"\n>> +            mem = BytesIO()\n>> +            mem.write(file.getvalue().encode('utf-8'))\n>> +            mem.seek(0)\n>> +            file = mem\n>> +            try:\n>> +                fsize = file.getbuffer().nbytes\n>>\n>> Duplicates code below, if/elif/elif needs to be refactored to avoid that.\n>>\n>> \u2014\n>> You are receiving this because you authored the thread.\n>> Reply to this email directly, view it on GitHub\n>> <https://github.com/pallets/flask/pull/3419?email_source=notifications&email_token=AD3TCQBSV7AFDZV6RUBXTUTQSRR2PA5CNFSM4JKL4YS2YY3PNVWWK3TUL52HS4DFWFIHK3DMKJSXC5LFON2FEZLWNFSXPKTDN5WW2ZLOORPWSZGOCKYKLVI#pullrequestreview-313566677>,\n>> or unsubscribe\n>> <https://github.com/notifications/unsubscribe-auth/AD3TCQHH4QPENWAEDB5VBDLQSRR2PANCNFSM4JKL4YSQ>\n>> .\n>>\n>\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/555343784",
            "html_url": "https://github.com/pallets/flask/pull/3419#issuecomment-555343784",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/3419",
            "id": 555343784,
            "node_id": "MDEyOklzc3VlQ29tbWVudDU1NTM0Mzc4NA==",
            "user": {
                "login": "davidism",
                "id": 1242887,
                "node_id": "MDQ6VXNlcjEyNDI4ODc=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1242887?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/davidism",
                "html_url": "https://github.com/davidism",
                "followers_url": "https://api.github.com/users/davidism/followers",
                "following_url": "https://api.github.com/users/davidism/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidism/subscriptions",
                "organizations_url": "https://api.github.com/users/davidism/orgs",
                "repos_url": "https://api.github.com/users/davidism/repos",
                "events_url": "https://api.github.com/users/davidism/events{/privacy}",
                "received_events_url": "https://api.github.com/users/davidism/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2019-11-19T05:45:57Z",
            "updated_at": "2019-11-19T05:45:57Z",
            "author_association": "MEMBER",
            "body": "Thanks for working on this. After reviewing the issue, I've decided `send_file` is not meant to handle text, only bytes."
        }
    ]
}