{
    "url": "https://api.github.com/repos/pallets/flask/issues/1227",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/1227/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/1227/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/1227/events",
    "html_url": "https://github.com/pallets/flask/issues/1227",
    "id": 47126111,
    "node_id": "MDU6SXNzdWU0NzEyNjExMQ==",
    "number": 1227,
    "title": "teardown_{request,appcontext} not called on first request if it throws an exception when DEBUG is True",
    "user": {
        "login": "mathiasson",
        "id": 440343,
        "node_id": "MDQ6VXNlcjQ0MDM0Mw==",
        "avatar_url": "https://avatars2.githubusercontent.com/u/440343?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mathiasson",
        "html_url": "https://github.com/mathiasson",
        "followers_url": "https://api.github.com/users/mathiasson/followers",
        "following_url": "https://api.github.com/users/mathiasson/following{/other_user}",
        "gists_url": "https://api.github.com/users/mathiasson/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mathiasson/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mathiasson/subscriptions",
        "organizations_url": "https://api.github.com/users/mathiasson/orgs",
        "repos_url": "https://api.github.com/users/mathiasson/repos",
        "events_url": "https://api.github.com/users/mathiasson/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mathiasson/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 4,
    "created_at": "2014-10-29T09:25:14Z",
    "updated_at": "2014-10-30T08:07:17Z",
    "closed_at": "2014-10-29T17:44:20Z",
    "author_association": "NONE",
    "body": "``` python\nfrom flask import Flask\n\napp = Flask(__name__)\napp.config['DEBUG'] = True\n\n@app.teardown_appcontext\ndef td_ac(exc):\n    # This will not get called on the first request if the first request fails,\n    # that is if /err is requested. It will be called on subsequent requests,\n    # no matter if they're throwing exceptions or not.\n    print('td_ac exception: %r' % exc)\n\n@app.teardown_request\ndef td_req(exc):\n    # This will not get called on the first request if the first request fails,\n    # that is if /err is requested. It will be called on subsequent requests,\n    # no matter if they're throwing exceptions or not.\n    print('td_req exception: %r' % exc)\n\n@app.route('/ok')\ndef ok():\n    return 'ok'\n\n@app.route('/err')\ndef err():\n    raise Exception('error')\n\nif __name__ == '__main__':\n    app.run()\n```\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/60970235",
            "html_url": "https://github.com/pallets/flask/issues/1227#issuecomment-60970235",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1227",
            "id": 60970235,
            "node_id": "MDEyOklzc3VlQ29tbWVudDYwOTcwMjM1",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-10-29T17:44:20Z",
            "updated_at": "2014-10-29T17:44:20Z",
            "author_association": "MEMBER",
            "body": "In debug mode teardown is delayed until the next request comes in, such that the debugger can still access everything.\n\nI assume you tested this by accessing the `/err` route twice, and saw that only one teardown was called, but the truth is that this happened because the one teardown you see is the one from the first request. If you hit `/ok` after this test, you'll see the teardown for the second request.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/60971397",
            "html_url": "https://github.com/pallets/flask/issues/1227#issuecomment-60971397",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1227",
            "id": 60971397,
            "node_id": "MDEyOklzc3VlQ29tbWVudDYwOTcxMzk3",
            "user": {
                "login": "mathiasson",
                "id": 440343,
                "node_id": "MDQ6VXNlcjQ0MDM0Mw==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/440343?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mathiasson",
                "html_url": "https://github.com/mathiasson",
                "followers_url": "https://api.github.com/users/mathiasson/followers",
                "following_url": "https://api.github.com/users/mathiasson/following{/other_user}",
                "gists_url": "https://api.github.com/users/mathiasson/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mathiasson/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mathiasson/subscriptions",
                "organizations_url": "https://api.github.com/users/mathiasson/orgs",
                "repos_url": "https://api.github.com/users/mathiasson/repos",
                "events_url": "https://api.github.com/users/mathiasson/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mathiasson/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-10-29T17:50:31Z",
            "updated_at": "2014-10-29T17:50:31Z",
            "author_association": "NONE",
            "body": "That is indeed what happens.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/61000272",
            "html_url": "https://github.com/pallets/flask/issues/1227#issuecomment-61000272",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1227",
            "id": 61000272,
            "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDAwMjcy",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-10-29T20:37:17Z",
            "updated_at": "2014-10-29T20:37:17Z",
            "author_association": "MEMBER",
            "body": "@mathiasson Just to clarify, that does mean that this is not a bug, just unexpected behavior?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/61057022",
            "html_url": "https://github.com/pallets/flask/issues/1227#issuecomment-61057022",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1227",
            "id": 61057022,
            "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDU3MDIy",
            "user": {
                "login": "mathiasson",
                "id": 440343,
                "node_id": "MDQ6VXNlcjQ0MDM0Mw==",
                "avatar_url": "https://avatars2.githubusercontent.com/u/440343?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mathiasson",
                "html_url": "https://github.com/mathiasson",
                "followers_url": "https://api.github.com/users/mathiasson/followers",
                "following_url": "https://api.github.com/users/mathiasson/following{/other_user}",
                "gists_url": "https://api.github.com/users/mathiasson/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mathiasson/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mathiasson/subscriptions",
                "organizations_url": "https://api.github.com/users/mathiasson/orgs",
                "repos_url": "https://api.github.com/users/mathiasson/repos",
                "events_url": "https://api.github.com/users/mathiasson/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mathiasson/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-10-30T08:07:17Z",
            "updated_at": "2014-10-30T08:07:17Z",
            "author_association": "NONE",
            "body": "Yes. It behaves exactly like you described it. No teardown's are lost, they're just delayed.\n"
        }
    ]
}