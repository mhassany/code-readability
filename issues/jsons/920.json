{
    "url": "https://api.github.com/repos/pallets/flask/issues/920",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/920/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/920/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/920/events",
    "html_url": "https://github.com/pallets/flask/issues/920",
    "id": 23633126,
    "node_id": "MDU6SXNzdWUyMzYzMzEyNg==",
    "number": 920,
    "title": "Python3 compatibility: test_client response not UTF-8",
    "user": {
        "login": "LarsKumbier",
        "id": 647850,
        "node_id": "MDQ6VXNlcjY0Nzg1MA==",
        "avatar_url": "https://avatars1.githubusercontent.com/u/647850?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarsKumbier",
        "html_url": "https://github.com/LarsKumbier",
        "followers_url": "https://api.github.com/users/LarsKumbier/followers",
        "following_url": "https://api.github.com/users/LarsKumbier/following{/other_user}",
        "gists_url": "https://api.github.com/users/LarsKumbier/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/LarsKumbier/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/LarsKumbier/subscriptions",
        "organizations_url": "https://api.github.com/users/LarsKumbier/orgs",
        "repos_url": "https://api.github.com/users/LarsKumbier/repos",
        "events_url": "https://api.github.com/users/LarsKumbier/events{/privacy}",
        "received_events_url": "https://api.github.com/users/LarsKumbier/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 5,
    "created_at": "2013-12-03T10:24:16Z",
    "updated_at": "2014-02-08T22:20:08Z",
    "closed_at": "2014-02-08T22:20:08Z",
    "author_association": "NONE",
    "body": "When using the test_client for unittesting, the return of the the tester is cast to bytestring instead of utf-8. As the default charset for webpages is now utf-8 and Flask also returning utf-8, the test_client should honor that.\n\n_app.py_:\n\n``` python\nfrom flask import Flask\napp = Flask(__name__)\n\n@app.route(\"/\")\ndef hello():\n    return \"H\u00e9llo, W\u00f4rld!\"\n\nif __name__ == \"__main__\":\n    app.run()\n```\n\n_test.py_\n\n``` python\nfrom app import app\n\nimport unittest\n\nclass BasicTestCase(unittest.TestCase):\n    def test_DefaultReturnShouldBeUtf8(self):\n        tester = app.test_client(self)\n        response = tester.get(\"/\", content_type=\"html/text\")\n        self.assertRegex(response.content_type, \"charset=utf-8\")\n        self.assertEqual(response.data, \"H\u00e9llo, W\u00f4rld!\")\n\n    def test_DefaultReturnShouldBeUtf8_Workaround(self):\n        tester = app.test_client(self)\n        response = tester.get(\"/\", content_type=\"html/text\")\n        self.assertRegex(response.content_type, \"charset=utf-8\")\n        self.assertEqual(response.data.decode(\"utf-8\", \"strict\"), \"H\u00e9llo, W\u00f4rld!\")\n\nif __name__ == \"__main__\":\n    unittest.main()\n```\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/29699930",
            "html_url": "https://github.com/pallets/flask/issues/920#issuecomment-29699930",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/920",
            "id": 29699930,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI5Njk5OTMw",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-12-03T10:51:30Z",
            "updated_at": "2013-12-03T10:51:30Z",
            "author_association": "MEMBER",
            "body": "You are assuming that only HTML and other text-ish data is transmitted over HTTP.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/29722508",
            "html_url": "https://github.com/pallets/flask/issues/920#issuecomment-29722508",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/920",
            "id": 29722508,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI5NzIyNTA4",
            "user": {
                "login": "LarsKumbier",
                "id": 647850,
                "node_id": "MDQ6VXNlcjY0Nzg1MA==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/647850?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/LarsKumbier",
                "html_url": "https://github.com/LarsKumbier",
                "followers_url": "https://api.github.com/users/LarsKumbier/followers",
                "following_url": "https://api.github.com/users/LarsKumbier/following{/other_user}",
                "gists_url": "https://api.github.com/users/LarsKumbier/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/LarsKumbier/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/LarsKumbier/subscriptions",
                "organizations_url": "https://api.github.com/users/LarsKumbier/orgs",
                "repos_url": "https://api.github.com/users/LarsKumbier/repos",
                "events_url": "https://api.github.com/users/LarsKumbier/events{/privacy}",
                "received_events_url": "https://api.github.com/users/LarsKumbier/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-12-03T16:04:48Z",
            "updated_at": "2013-12-03T16:04:48Z",
            "author_association": "NONE",
            "body": "No, but what I do assume, that if the contents charset is set to UTF-8, that the test runner does honor that. \n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/29723667",
            "html_url": "https://github.com/pallets/flask/issues/920#issuecomment-29723667",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/920",
            "id": 29723667,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI5NzIzNjY3",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-12-03T16:16:34Z",
            "updated_at": "2013-12-03T16:16:34Z",
            "author_association": "MEMBER",
            "body": "Unrelated, but why do you use `assertRegex` to check against a plain string?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/29738287",
            "html_url": "https://github.com/pallets/flask/issues/920#issuecomment-29738287",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/920",
            "id": 29738287,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI5NzM4Mjg3",
            "user": {
                "login": "LarsKumbier",
                "id": 647850,
                "node_id": "MDQ6VXNlcjY0Nzg1MA==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/647850?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/LarsKumbier",
                "html_url": "https://github.com/LarsKumbier",
                "followers_url": "https://api.github.com/users/LarsKumbier/followers",
                "following_url": "https://api.github.com/users/LarsKumbier/following{/other_user}",
                "gists_url": "https://api.github.com/users/LarsKumbier/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/LarsKumbier/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/LarsKumbier/subscriptions",
                "organizations_url": "https://api.github.com/users/LarsKumbier/orgs",
                "repos_url": "https://api.github.com/users/LarsKumbier/repos",
                "events_url": "https://api.github.com/users/LarsKumbier/events{/privacy}",
                "received_events_url": "https://api.github.com/users/LarsKumbier/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-12-03T18:42:35Z",
            "updated_at": "2013-12-03T18:52:12Z",
            "author_association": "NONE",
            "body": "Just so see if the return is declared as being utf-8 - the string may\ncontain other information as well, so this seemed to be the safest bet.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/34558249",
            "html_url": "https://github.com/pallets/flask/issues/920#issuecomment-34558249",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/920",
            "id": 34558249,
            "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTU4MjQ5",
            "user": {
                "login": "mitsuhiko",
                "id": 7396,
                "node_id": "MDQ6VXNlcjczOTY=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/7396?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/mitsuhiko",
                "html_url": "https://github.com/mitsuhiko",
                "followers_url": "https://api.github.com/users/mitsuhiko/followers",
                "following_url": "https://api.github.com/users/mitsuhiko/following{/other_user}",
                "gists_url": "https://api.github.com/users/mitsuhiko/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mitsuhiko/subscriptions",
                "organizations_url": "https://api.github.com/users/mitsuhiko/orgs",
                "repos_url": "https://api.github.com/users/mitsuhiko/repos",
                "events_url": "https://api.github.com/users/mitsuhiko/events{/privacy}",
                "received_events_url": "https://api.github.com/users/mitsuhiko/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-02-08T22:20:08Z",
            "updated_at": "2014-02-08T22:20:08Z",
            "author_association": "MEMBER",
            "body": "Not going to make this change.  This mixing and matching of different data types on the same attribute is very easy to cause confusing.  There is `response.get_data(as_text=True)` which already does a utf-8 decode.\n"
        }
    ]
}