{
    "url": "https://api.github.com/repos/pallets/flask/issues/773",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/773/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/773/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/773/events",
    "html_url": "https://github.com/pallets/flask/issues/773",
    "id": 15671624,
    "node_id": "MDU6SXNzdWUxNTY3MTYyNA==",
    "number": 773,
    "title": "url_for + redirect does not respect http vs https",
    "user": {
        "login": "sebsto",
        "id": 401798,
        "node_id": "MDQ6VXNlcjQwMTc5OA==",
        "avatar_url": "https://avatars0.githubusercontent.com/u/401798?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sebsto",
        "html_url": "https://github.com/sebsto",
        "followers_url": "https://api.github.com/users/sebsto/followers",
        "following_url": "https://api.github.com/users/sebsto/following{/other_user}",
        "gists_url": "https://api.github.com/users/sebsto/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/sebsto/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/sebsto/subscriptions",
        "organizations_url": "https://api.github.com/users/sebsto/orgs",
        "repos_url": "https://api.github.com/users/sebsto/repos",
        "events_url": "https://api.github.com/users/sebsto/events{/privacy}",
        "received_events_url": "https://api.github.com/users/sebsto/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 8,
    "created_at": "2013-06-18T06:37:52Z",
    "updated_at": "2018-12-08T21:46:30Z",
    "closed_at": "2013-06-18T07:11:43Z",
    "author_association": "NONE",
    "body": "I am using Flask with SSL.\nTesting in dev environment with stunnel and a self-signed certificate.\n\nhttp://localhost:5000 is Flask\nhttps://localhost:8000 is SSL Flask through stunnel\n\nWhen using redirect(url_for(...)) in the program below, the browser is redirected to http://localhost:8000/ssl (HTTP protocol instead of HTTPS)\n\nCorrect URL should be https://localhost:8000/ssl\n\nHere is a sample program to demonstrate:\n\n```\nfrom flask import Flask, request, url_for, redirect\n\n# Flask Initialization\napp = Flask(__name__)\n\n@app.route(\"/\")\ndef index():\n    return \"Hello World\"\n\n@app.route(\"/ssl\")\ndef ssl():\n    return \"Hello SSL World\"\n\n@app.route('/redirect/')\ndef redirectToSSL():\n    return redirect(url_for('ssl'))\n\nif __name__ == \"__main__\":\n    app.run(debug=True)\n```\n\nMy stunnel config is \n\n```\npid =\nforeground = yes\n\ncert = ./stunnel.crt\nkey = ./stunnel.pem\n\n[https]\naccept=8000\nconnect=5000\n```\n\nTo test this,\n- start your stunnel\n- start the application\n- connect to https://localhost:8000 - you should see 'Hello World'\n- connect to https://localhost:8000/redirect - you should receive an error page as the browser is redirected to http://localhost:8000/ssl (instead of https:// ...)\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/19594273",
            "html_url": "https://github.com/pallets/flask/issues/773#issuecomment-19594273",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/773",
            "id": 19594273,
            "node_id": "MDEyOklzc3VlQ29tbWVudDE5NTk0Mjcz",
            "user": {
                "login": "sebsto",
                "id": 401798,
                "node_id": "MDQ6VXNlcjQwMTc5OA==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/401798?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/sebsto",
                "html_url": "https://github.com/sebsto",
                "followers_url": "https://api.github.com/users/sebsto/followers",
                "following_url": "https://api.github.com/users/sebsto/following{/other_user}",
                "gists_url": "https://api.github.com/users/sebsto/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/sebsto/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/sebsto/subscriptions",
                "organizations_url": "https://api.github.com/users/sebsto/orgs",
                "repos_url": "https://api.github.com/users/sebsto/repos",
                "events_url": "https://api.github.com/users/sebsto/events{/privacy}",
                "received_events_url": "https://api.github.com/users/sebsto/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-06-18T06:58:34Z",
            "updated_at": "2013-06-18T06:58:34Z",
            "author_association": "NONE",
            "body": "Looks like the problem originates from werkzeug urls.py in one of the url_parse / url_unparse functions\nhttps://github.com/mitsuhiko/werkzeug/blob/master/werkzeug/urls.py\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/19594342",
            "html_url": "https://github.com/pallets/flask/issues/773#issuecomment-19594342",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/773",
            "id": 19594342,
            "node_id": "MDEyOklzc3VlQ29tbWVudDE5NTk0MzQy",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-06-18T07:00:51Z",
            "updated_at": "2013-06-18T07:00:51Z",
            "author_association": "MEMBER",
            "body": "Use url_for(..., _scheme=\"https\") if you want url_for to return an absolute URL with https.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/19594414",
            "html_url": "https://github.com/pallets/flask/issues/773#issuecomment-19594414",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/773",
            "id": 19594414,
            "node_id": "MDEyOklzc3VlQ29tbWVudDE5NTk0NDE0",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-06-18T07:02:49Z",
            "updated_at": "2013-06-18T07:04:30Z",
            "author_association": "MEMBER",
            "body": "It could be sensible for flask.redirect to use the current scheme when getting protocol-relative URLs to detect whether it should return a https url, and just fallback to http when no req ctx is available.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/19594711",
            "html_url": "https://github.com/pallets/flask/issues/773#issuecomment-19594711",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/773",
            "id": 19594711,
            "node_id": "MDEyOklzc3VlQ29tbWVudDE5NTk0NzEx",
            "user": {
                "login": "sebsto",
                "id": 401798,
                "node_id": "MDQ6VXNlcjQwMTc5OA==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/401798?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/sebsto",
                "html_url": "https://github.com/sebsto",
                "followers_url": "https://api.github.com/users/sebsto/followers",
                "following_url": "https://api.github.com/users/sebsto/following{/other_user}",
                "gists_url": "https://api.github.com/users/sebsto/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/sebsto/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/sebsto/subscriptions",
                "organizations_url": "https://api.github.com/users/sebsto/orgs",
                "repos_url": "https://api.github.com/users/sebsto/repos",
                "events_url": "https://api.github.com/users/sebsto/events{/privacy}",
                "received_events_url": "https://api.github.com/users/sebsto/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-06-18T07:11:19Z",
            "updated_at": "2013-06-18T07:11:19Z",
            "author_association": "NONE",
            "body": "Thank for pointing me to this - I tried and it works (also using _external=True)\nI agree with your second comment, Flask.redirect might be smarter and to use the current scheme when available / detectable.\nThanks for your help\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/19608135",
            "html_url": "https://github.com/pallets/flask/issues/773#issuecomment-19608135",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/773",
            "id": 19608135,
            "node_id": "MDEyOklzc3VlQ29tbWVudDE5NjA4MTM1",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-06-18T12:34:42Z",
            "updated_at": "2013-06-18T12:34:54Z",
            "author_association": "MEMBER",
            "body": "Actually `flask.redirect` is not responsible for this. Your code example should've worked. Check if the URL scheme is available inside of your request context, ie do `print flask.request.environ['wsgi.url_scheme']` to check if your setup even passes the scheme to the flask app.\n\nAlso, Flask can't magically detect that it should redirect to anything else than the current port, so if you want to redirect from 5000 to 8000, you have to define explicitly so and can't just define the scheme.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/40522409",
            "html_url": "https://github.com/pallets/flask/issues/773#issuecomment-40522409",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/773",
            "id": 40522409,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQwNTIyNDA5",
            "user": {
                "login": "loleg",
                "id": 31819,
                "node_id": "MDQ6VXNlcjMxODE5",
                "avatar_url": "https://avatars2.githubusercontent.com/u/31819?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/loleg",
                "html_url": "https://github.com/loleg",
                "followers_url": "https://api.github.com/users/loleg/followers",
                "following_url": "https://api.github.com/users/loleg/following{/other_user}",
                "gists_url": "https://api.github.com/users/loleg/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/loleg/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/loleg/subscriptions",
                "organizations_url": "https://api.github.com/users/loleg/orgs",
                "repos_url": "https://api.github.com/users/loleg/repos",
                "events_url": "https://api.github.com/users/loleg/events{/privacy}",
                "received_events_url": "https://api.github.com/users/loleg/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-04-15T19:18:08Z",
            "updated_at": "2014-04-15T19:18:08Z",
            "author_association": "NONE",
            "body": "What worked best for me in a similar situation is the [ReverseProxied snippet](http://flask.pocoo.org/snippets/35/).\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/53304506",
            "html_url": "https://github.com/pallets/flask/issues/773#issuecomment-53304506",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/773",
            "id": 53304506,
            "node_id": "MDEyOklzc3VlQ29tbWVudDUzMzA0NTA2",
            "user": {
                "login": "hickford",
                "id": 105314,
                "node_id": "MDQ6VXNlcjEwNTMxNA==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/105314?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/hickford",
                "html_url": "https://github.com/hickford",
                "followers_url": "https://api.github.com/users/hickford/followers",
                "following_url": "https://api.github.com/users/hickford/following{/other_user}",
                "gists_url": "https://api.github.com/users/hickford/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/hickford/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hickford/subscriptions",
                "organizations_url": "https://api.github.com/users/hickford/orgs",
                "repos_url": "https://api.github.com/users/hickford/repos",
                "events_url": "https://api.github.com/users/hickford/events{/privacy}",
                "received_events_url": "https://api.github.com/users/hickford/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-08-25T18:14:44Z",
            "updated_at": "2014-08-25T20:48:08Z",
            "author_association": "NONE",
            "body": "Hi. My app works fine locally, but when I deploy it to Heroku, it keeps dropping from https to http. Can you help?\n\nThe problem I believe happens here:\n\n```\nreturn redirect(url_for('index'))\n```\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/441502588",
            "html_url": "https://github.com/pallets/flask/issues/773#issuecomment-441502588",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/773",
            "id": 441502588,
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MTUwMjU4OA==",
            "user": {
                "login": "aardvark82",
                "id": 32086262,
                "node_id": "MDQ6VXNlcjMyMDg2MjYy",
                "avatar_url": "https://avatars2.githubusercontent.com/u/32086262?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/aardvark82",
                "html_url": "https://github.com/aardvark82",
                "followers_url": "https://api.github.com/users/aardvark82/followers",
                "following_url": "https://api.github.com/users/aardvark82/following{/other_user}",
                "gists_url": "https://api.github.com/users/aardvark82/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/aardvark82/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/aardvark82/subscriptions",
                "organizations_url": "https://api.github.com/users/aardvark82/orgs",
                "repos_url": "https://api.github.com/users/aardvark82/repos",
                "events_url": "https://api.github.com/users/aardvark82/events{/privacy}",
                "received_events_url": "https://api.github.com/users/aardvark82/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2018-11-26T02:41:11Z",
            "updated_at": "2018-11-26T02:41:11Z",
            "author_association": "NONE",
            "body": "To add to this, I encountered a similar issue and solved it using the suggestion above to use the ReverseProxied snippet.\r\n\r\n"
        }
    ]
}