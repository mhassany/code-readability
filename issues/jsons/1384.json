{
    "url": "https://api.github.com/repos/pallets/flask/issues/1384",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/1384/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/1384/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/1384/events",
    "html_url": "https://github.com/pallets/flask/issues/1384",
    "id": 62713775,
    "node_id": "MDU6SXNzdWU2MjcxMzc3NQ==",
    "number": 1384,
    "title": "request.files is empty after POSTing a file",
    "user": {
        "login": "bepetersn",
        "id": 1389463,
        "node_id": "MDQ6VXNlcjEzODk0NjM=",
        "avatar_url": "https://avatars1.githubusercontent.com/u/1389463?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bepetersn",
        "html_url": "https://github.com/bepetersn",
        "followers_url": "https://api.github.com/users/bepetersn/followers",
        "following_url": "https://api.github.com/users/bepetersn/following{/other_user}",
        "gists_url": "https://api.github.com/users/bepetersn/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/bepetersn/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bepetersn/subscriptions",
        "organizations_url": "https://api.github.com/users/bepetersn/orgs",
        "repos_url": "https://api.github.com/users/bepetersn/repos",
        "events_url": "https://api.github.com/users/bepetersn/events{/privacy}",
        "received_events_url": "https://api.github.com/users/bepetersn/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 5,
    "created_at": "2015-03-18T14:54:48Z",
    "updated_at": "2015-03-23T20:58:55Z",
    "closed_at": "2015-03-23T20:58:55Z",
    "author_association": "NONE",
    "body": "Hey guys, I don't know if this is the right place to make this bug report, but I could sure use some help, I have been banging my head against a wall for a bit. See this repo where I'm reproducing my error: https://github.com/bepetersn/special-repo. \n\nI'm seeing weird behavior around the Flask `request` object. After uploading a file with the requests library, e.g. `requests.post(uri, files=<my_files>)`, by the time the `request` propagated to my view function, `request.files` was empty. Oddly, I observed that the contents of the file itself was available under `request.form[None]`. \n\nMy only lead was that when I debugged this at length, I saw that the request data was being treated as a mimetype of \"application/x-www-form-urlencoded\" rather than the correct \"multipart/form\" for uploading binary files... But, I just threw this example together really quickly, and I'm not seeing that right now, so I'm no longer sure.\n\nI've also seen some other errors on this repo involving calling `request.data` vs `request.form`. I don't really know anything about that. I'd greatly appreciate a pointer in the right direction.\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/83016303",
            "html_url": "https://github.com/pallets/flask/issues/1384#issuecomment-83016303",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1384",
            "id": 83016303,
            "node_id": "MDEyOklzc3VlQ29tbWVudDgzMDE2MzAz",
            "user": {
                "login": "SBillion",
                "id": 1070649,
                "node_id": "MDQ6VXNlcjEwNzA2NDk=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/1070649?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/SBillion",
                "html_url": "https://github.com/SBillion",
                "followers_url": "https://api.github.com/users/SBillion/followers",
                "following_url": "https://api.github.com/users/SBillion/following{/other_user}",
                "gists_url": "https://api.github.com/users/SBillion/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/SBillion/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/SBillion/subscriptions",
                "organizations_url": "https://api.github.com/users/SBillion/orgs",
                "repos_url": "https://api.github.com/users/SBillion/repos",
                "events_url": "https://api.github.com/users/SBillion/events{/privacy}",
                "received_events_url": "https://api.github.com/users/SBillion/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2015-03-18T15:09:07Z",
            "updated_at": "2015-03-18T15:09:07Z",
            "author_association": "NONE",
            "body": "No problem with Flask but with your way to use requests:\n\nhttp://docs.python-requests.org/en/latest/user/advanced/#streaming-uploads\n\nYou should send your attachments as a stream. It doesn't like you are\nsending any binary data in your current requests.post\n\nLe mercredi 18 mars 2015 \u00e0 07:55 -0700, Brian Everett Peterson a \u00e9crit :\n\n> Hey guys, I don't know if this is the right place to make this bug\n> report, but I could sure use some help, I have been banging my head\n> against a wall for a bit. See this repo where I'm reproducing my\n> error: https://github.com/bepetersn/special-repo. \n> \n> I'm seeing weird behavior around the Flask request object. After\n> uploading a file with the requests library, e.g. requests.post(uri,\n> files=<my_files>), by the time the request propagated to my view\n> function, request.files was empty. Oddly, I observed that the contents\n> of the file itself was available under request.form[None]. \n> \n> My only lead was that when I debugged this at length, I saw that the\n> request data was being treated as a mimetype of\n> \"application/x-www-form-urlencoded\" rather than the correct\n> \"multipart/form\" for uploading binary files... But, I just threw this\n> example together really quickly, and I'm not seeing that right now, so\n> I'm no longer sure.\n> \n> I've also seen some other errors on this repo involving calling\n> request.data vs request.form. I don't really know anything about that.\n> I'd greatly appreciate a pointer in the right direction.\n> \n> \u2014\n> Reply to this email directly or view it on GitHub.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/83019328",
            "html_url": "https://github.com/pallets/flask/issues/1384#issuecomment-83019328",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1384",
            "id": 83019328,
            "node_id": "MDEyOklzc3VlQ29tbWVudDgzMDE5MzI4",
            "user": {
                "login": "bepetersn",
                "id": 1389463,
                "node_id": "MDQ6VXNlcjEzODk0NjM=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1389463?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/bepetersn",
                "html_url": "https://github.com/bepetersn",
                "followers_url": "https://api.github.com/users/bepetersn/followers",
                "following_url": "https://api.github.com/users/bepetersn/following{/other_user}",
                "gists_url": "https://api.github.com/users/bepetersn/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/bepetersn/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bepetersn/subscriptions",
                "organizations_url": "https://api.github.com/users/bepetersn/orgs",
                "repos_url": "https://api.github.com/users/bepetersn/repos",
                "events_url": "https://api.github.com/users/bepetersn/events{/privacy}",
                "received_events_url": "https://api.github.com/users/bepetersn/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2015-03-18T15:20:22Z",
            "updated_at": "2015-03-18T15:27:17Z",
            "author_association": "NONE",
            "body": "Hmmm, merci beaucoup pour votre r\u00e9ponse rapide. :) I thought maybe it had to do more with requests, I just couldn't prove my reasoning. Do you think the size of the file leaves a chance for it throw the POST request off? I have seen this error around ~4 times, but similar operations to this have been done thousands of times in production. I'm wondering if that fits with your understanding of why this is happening.   \n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/83112005",
            "html_url": "https://github.com/pallets/flask/issues/1384#issuecomment-83112005",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1384",
            "id": 83112005,
            "node_id": "MDEyOklzc3VlQ29tbWVudDgzMTEyMDA1",
            "user": {
                "login": "bepetersn",
                "id": 1389463,
                "node_id": "MDQ6VXNlcjEzODk0NjM=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1389463?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/bepetersn",
                "html_url": "https://github.com/bepetersn",
                "followers_url": "https://api.github.com/users/bepetersn/followers",
                "following_url": "https://api.github.com/users/bepetersn/following{/other_user}",
                "gists_url": "https://api.github.com/users/bepetersn/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/bepetersn/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bepetersn/subscriptions",
                "organizations_url": "https://api.github.com/users/bepetersn/orgs",
                "repos_url": "https://api.github.com/users/bepetersn/repos",
                "events_url": "https://api.github.com/users/bepetersn/events{/privacy}",
                "received_events_url": "https://api.github.com/users/bepetersn/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2015-03-18T18:29:10Z",
            "updated_at": "2015-03-18T18:29:17Z",
            "author_association": "NONE",
            "body": "I'm gonna throw this over to the requests github as well. In the meantime, I updated my repo: https://github.com/bepetersn/special-repo. Would you be willing to look at that and tell me if that's a valid way to stream the bytes with requests, like you were suggesting? It still did not work for me.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/83164218",
            "html_url": "https://github.com/pallets/flask/issues/1384#issuecomment-83164218",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1384",
            "id": 83164218,
            "node_id": "MDEyOklzc3VlQ29tbWVudDgzMTY0MjE4",
            "user": {
                "login": "bepetersn",
                "id": 1389463,
                "node_id": "MDQ6VXNlcjEzODk0NjM=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1389463?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/bepetersn",
                "html_url": "https://github.com/bepetersn",
                "followers_url": "https://api.github.com/users/bepetersn/followers",
                "following_url": "https://api.github.com/users/bepetersn/following{/other_user}",
                "gists_url": "https://api.github.com/users/bepetersn/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/bepetersn/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bepetersn/subscriptions",
                "organizations_url": "https://api.github.com/users/bepetersn/orgs",
                "repos_url": "https://api.github.com/users/bepetersn/repos",
                "events_url": "https://api.github.com/users/bepetersn/events{/privacy}",
                "received_events_url": "https://api.github.com/users/bepetersn/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2015-03-18T20:46:15Z",
            "updated_at": "2015-03-18T20:46:15Z",
            "author_association": "NONE",
            "body": "See my new issue, with slightly more information at their repo: https://github.com/kennethreitz/requests/issues/2505. It looks to me like requests is SLIGHTLY incorrectly encoding the file metadata (specifically the document filename) for the form/multipart mimetype. Werkzeug gives up in interpreting it, doesn't create a `werkzeug.datastructures.FileStorage` instance, and thus doesn't populate `request.files`.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/85193926",
            "html_url": "https://github.com/pallets/flask/issues/1384#issuecomment-85193926",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/1384",
            "id": 85193926,
            "node_id": "MDEyOklzc3VlQ29tbWVudDg1MTkzOTI2",
            "user": {
                "login": "bepetersn",
                "id": 1389463,
                "node_id": "MDQ6VXNlcjEzODk0NjM=",
                "avatar_url": "https://avatars1.githubusercontent.com/u/1389463?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/bepetersn",
                "html_url": "https://github.com/bepetersn",
                "followers_url": "https://api.github.com/users/bepetersn/followers",
                "following_url": "https://api.github.com/users/bepetersn/following{/other_user}",
                "gists_url": "https://api.github.com/users/bepetersn/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/bepetersn/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bepetersn/subscriptions",
                "organizations_url": "https://api.github.com/users/bepetersn/orgs",
                "repos_url": "https://api.github.com/users/bepetersn/repos",
                "events_url": "https://api.github.com/users/bepetersn/events{/privacy}",
                "received_events_url": "https://api.github.com/users/bepetersn/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2015-03-23T20:58:44Z",
            "updated_at": "2015-03-23T20:58:44Z",
            "author_association": "NONE",
            "body": "So others know, this behavior can be reproduced if there is a newline character in the title of a file POSTed with requests. Under the hood, it results in requests encoding the document differently (see RFC 2231), and werkzeug doesn't handle this possibility. \n"
        }
    ]
}