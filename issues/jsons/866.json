{
    "url": "https://api.github.com/repos/pallets/flask/issues/866",
    "repository_url": "https://api.github.com/repos/pallets/flask",
    "labels_url": "https://api.github.com/repos/pallets/flask/issues/866/labels{/name}",
    "comments_url": "https://api.github.com/repos/pallets/flask/issues/866/comments",
    "events_url": "https://api.github.com/repos/pallets/flask/issues/866/events",
    "html_url": "https://github.com/pallets/flask/issues/866",
    "id": 19512836,
    "node_id": "MDU6SXNzdWUxOTUxMjgzNg==",
    "number": 866,
    "title": "InstanceTestCase tests fail when run by a non-standard user",
    "user": {
        "login": "nieder",
        "id": 1105137,
        "node_id": "MDQ6VXNlcjExMDUxMzc=",
        "avatar_url": "https://avatars3.githubusercontent.com/u/1105137?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nieder",
        "html_url": "https://github.com/nieder",
        "followers_url": "https://api.github.com/users/nieder/followers",
        "following_url": "https://api.github.com/users/nieder/following{/other_user}",
        "gists_url": "https://api.github.com/users/nieder/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/nieder/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/nieder/subscriptions",
        "organizations_url": "https://api.github.com/users/nieder/orgs",
        "repos_url": "https://api.github.com/users/nieder/repos",
        "events_url": "https://api.github.com/users/nieder/events{/privacy}",
        "received_events_url": "https://api.github.com/users/nieder/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 8,
    "created_at": "2013-09-15T01:28:43Z",
    "updated_at": "2017-04-19T12:58:17Z",
    "closed_at": "2014-11-04T02:30:19Z",
    "author_association": "NONE",
    "body": "The InstanceTestCase tests fail on OS X when being packaged by an unprivileged user:\n\n```\n/sw/bin/python2.7 run-tests.py || exit 2\n........................................................................................................................F..FF.....................................................................................................\n======================================================================\nFAIL: test_main_module_paths (flask.testsuite.config.InstanceTestCase)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/config.py\", line 155, in test_main_module_paths\n    self.assert_equal(app.instance_path, os.path.join(here, 'instance'))\n  File \"/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/__init__.py\", line 139, in assert_equal\n    return self.assertEqual(x, y)\nAssertionError: '/sw/var/run-tests-instance' != '/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/instance'\n\n======================================================================\nFAIL: test_uninstalled_module_paths (flask.testsuite.config.InstanceTestCase)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/config.py\", line 162, in test_uninstalled_module_paths\n    self.assert_equal(app.instance_path, os.path.join(here, 'test_apps', 'instance'))\n  File \"/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/__init__.py\", line 139, in assert_equal\n    return self.assertEqual(x, y)\nAssertionError: '/sw/var/config_module_app-instance' != '/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/test_apps/instance'\n\n======================================================================\nFAIL: test_uninstalled_package_paths (flask.testsuite.config.InstanceTestCase)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/config.py\", line 167, in test_uninstalled_package_paths\n    self.assert_equal(app.instance_path, os.path.join(here, 'test_apps', 'instance'))\n  File \"/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/__init__.py\", line 139, in assert_equal\n    return self.assertEqual(x, y)\nAssertionError: '/sw/var/config_package_app-instance' != '/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/test_apps/instance'\n\n----------------------------------------------------------------------\nRan 226 tests in 1.038s\n\nFAILED (failures=3)\n```\n\nI'm packaging flask for use in the Fink project (an OS X package manager).  We use an unprivileged user to build and assemble a package before installation.  The above three tests fail during our build process.  If I build and test flask as a normal user, the tests pass, so it seems that there is some incorrect assumption being made somewhere about what the environment should be.  '/sw' is our prefix. '/sw/build.build' is the sandboxed build root.\n",
    "comments_inline": [
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/24470057",
            "html_url": "https://github.com/pallets/flask/issues/866#issuecomment-24470057",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/866",
            "id": 24470057,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI0NDcwMDU3",
            "user": {
                "login": "ThiefMaster",
                "id": 179599,
                "node_id": "MDQ6VXNlcjE3OTU5OQ==",
                "avatar_url": "https://avatars1.githubusercontent.com/u/179599?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ThiefMaster",
                "html_url": "https://github.com/ThiefMaster",
                "followers_url": "https://api.github.com/users/ThiefMaster/followers",
                "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions",
                "organizations_url": "https://api.github.com/users/ThiefMaster/orgs",
                "repos_url": "https://api.github.com/users/ThiefMaster/repos",
                "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ThiefMaster/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-09-15T11:45:59Z",
            "updated_at": "2013-09-15T11:45:59Z",
            "author_association": "MEMBER",
            "body": "Looks a bit like comparing a symlink to a dereferenced symlink...\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/24474365",
            "html_url": "https://github.com/pallets/flask/issues/866#issuecomment-24474365",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/866",
            "id": 24474365,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI0NDc0MzY1",
            "user": {
                "login": "ghost",
                "id": 10137,
                "node_id": "MDQ6VXNlcjEwMTM3",
                "avatar_url": "https://avatars3.githubusercontent.com/u/10137?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/ghost",
                "html_url": "https://github.com/ghost",
                "followers_url": "https://api.github.com/users/ghost/followers",
                "following_url": "https://api.github.com/users/ghost/following{/other_user}",
                "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
                "organizations_url": "https://api.github.com/users/ghost/orgs",
                "repos_url": "https://api.github.com/users/ghost/repos",
                "events_url": "https://api.github.com/users/ghost/events{/privacy}",
                "received_events_url": "https://api.github.com/users/ghost/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-09-15T16:15:44Z",
            "updated_at": "2013-09-15T16:15:44Z",
            "author_association": "NONE",
            "body": "@ThiefMaster same sensation. Can you verify, @nieder?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/24474941",
            "html_url": "https://github.com/pallets/flask/issues/866#issuecomment-24474941",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/866",
            "id": 24474941,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI0NDc0OTQx",
            "user": {
                "login": "nieder",
                "id": 1105137,
                "node_id": "MDQ6VXNlcjExMDUxMzc=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/1105137?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/nieder",
                "html_url": "https://github.com/nieder",
                "followers_url": "https://api.github.com/users/nieder/followers",
                "following_url": "https://api.github.com/users/nieder/following{/other_user}",
                "gists_url": "https://api.github.com/users/nieder/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/nieder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nieder/subscriptions",
                "organizations_url": "https://api.github.com/users/nieder/orgs",
                "repos_url": "https://api.github.com/users/nieder/repos",
                "events_url": "https://api.github.com/users/nieder/events{/privacy}",
                "received_events_url": "https://api.github.com/users/nieder/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-09-15T16:46:06Z",
            "updated_at": "2013-09-15T16:46:06Z",
            "author_association": "NONE",
            "body": "```\n$ ls -l /sw/var/config_package_app-instance /sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/test_apps/instance\nls: /sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/test_apps/instance: No such file or directory\nls: /sw/var/config_package_app-instance: No such file or directory\n```\n\n/sw/var/config_package_app-instance has never existed in this system as far as I can tell.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/24475254",
            "html_url": "https://github.com/pallets/flask/issues/866#issuecomment-24475254",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/866",
            "id": 24475254,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI0NDc1MjU0",
            "user": {
                "login": "DasIch",
                "id": 182316,
                "node_id": "MDQ6VXNlcjE4MjMxNg==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/182316?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/DasIch",
                "html_url": "https://github.com/DasIch",
                "followers_url": "https://api.github.com/users/DasIch/followers",
                "following_url": "https://api.github.com/users/DasIch/following{/other_user}",
                "gists_url": "https://api.github.com/users/DasIch/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/DasIch/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/DasIch/subscriptions",
                "organizations_url": "https://api.github.com/users/DasIch/orgs",
                "repos_url": "https://api.github.com/users/DasIch/repos",
                "events_url": "https://api.github.com/users/DasIch/events{/privacy}",
                "received_events_url": "https://api.github.com/users/DasIch/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-09-15T17:00:50Z",
            "updated_at": "2013-09-15T17:00:50Z",
            "author_association": "CONTRIBUTOR",
            "body": "Any files or directories created by the tests are deleted, even if the tests fail. Unless you run the tests in a debugger and set a breakpoint before the assertion you wouldn't be able to find them on the file system.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/24504574",
            "html_url": "https://github.com/pallets/flask/issues/866#issuecomment-24504574",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/866",
            "id": 24504574,
            "node_id": "MDEyOklzc3VlQ29tbWVudDI0NTA0NTc0",
            "user": {
                "login": "nieder",
                "id": 1105137,
                "node_id": "MDQ6VXNlcjExMDUxMzc=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/1105137?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/nieder",
                "html_url": "https://github.com/nieder",
                "followers_url": "https://api.github.com/users/nieder/followers",
                "following_url": "https://api.github.com/users/nieder/following{/other_user}",
                "gists_url": "https://api.github.com/users/nieder/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/nieder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nieder/subscriptions",
                "organizations_url": "https://api.github.com/users/nieder/orgs",
                "repos_url": "https://api.github.com/users/nieder/repos",
                "events_url": "https://api.github.com/users/nieder/events{/privacy}",
                "received_events_url": "https://api.github.com/users/nieder/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2013-09-16T11:53:42Z",
            "updated_at": "2013-09-16T11:53:42Z",
            "author_association": "NONE",
            "body": "How else can I check if this is a dereferenced symlink as @ThiefMaster suggested?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/61426745",
            "html_url": "https://github.com/pallets/flask/issues/866#issuecomment-61426745",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/866",
            "id": 61426745,
            "node_id": "MDEyOklzc3VlQ29tbWVudDYxNDI2NzQ1",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-11-02T22:24:25Z",
            "updated_at": "2014-11-02T22:24:25Z",
            "author_association": "MEMBER",
            "body": "@nieder Are you still able to reproduce this? The new testsuite shouldn't delete tmpdirs if the tests fail.\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/61432747",
            "html_url": "https://github.com/pallets/flask/issues/866#issuecomment-61432747",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/866",
            "id": 61432747,
            "node_id": "MDEyOklzc3VlQ29tbWVudDYxNDMyNzQ3",
            "user": {
                "login": "nieder",
                "id": 1105137,
                "node_id": "MDQ6VXNlcjExMDUxMzc=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/1105137?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/nieder",
                "html_url": "https://github.com/nieder",
                "followers_url": "https://api.github.com/users/nieder/followers",
                "following_url": "https://api.github.com/users/nieder/following{/other_user}",
                "gists_url": "https://api.github.com/users/nieder/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/nieder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nieder/subscriptions",
                "organizations_url": "https://api.github.com/users/nieder/orgs",
                "repos_url": "https://api.github.com/users/nieder/repos",
                "events_url": "https://api.github.com/users/nieder/events{/privacy}",
                "received_events_url": "https://api.github.com/users/nieder/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-11-03T01:18:40Z",
            "updated_at": "2014-11-03T01:18:40Z",
            "author_association": "NONE",
            "body": "I still get the same failures with flask-0.10.1 (I've update my OS and python since the original report), but if I update to today's git HEAD (a1b27365), install click, py.test, and update to the latest werkzeug, then the flask tests pass.\n\n```\n$ /sw/bin/py.test-2.7 \n======================================================== test session starts =========================================================\nplatform darwin -- Python 2.7.8 -- py-1.4.23 -- pytest-2.6.1\ncollected 251 items \n\nexamples/blueprintexample/test_blueprintexample.py .\nexamples/flaskr/test_flaskr.py ...\nexamples/minitwit/test_minitwit.py ....\ntests/test_appctx.py .........\ntests/test_basic.py ...................................................................\ntests/test_blueprints.py ..............................\ntests/test_config.py ............\ntests/test_deprecations.py ..\ntests/test_ext.py ..............\ntests/test_helpers.py .............................\ntests/test_instance_config.py ............\ntests/test_regression.py s..\ntests/test_reqctx.py ......ss\ntests/test_signals.py ssssss\ntests/test_subclassing.py .\ntests/test_templating.py ............................\ntests/test_testing.py .............\ntests/test_views.py ........\ntests/test_apps/blueprintapp/apps/admin/static/test.txt .\n\n=============================================== 242 passed, 9 skipped in 6.23 seconds ================================================\n```\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/61481706",
            "html_url": "https://github.com/pallets/flask/issues/866#issuecomment-61481706",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/866",
            "id": 61481706,
            "node_id": "MDEyOklzc3VlQ29tbWVudDYxNDgxNzA2",
            "user": {
                "login": "untitaker",
                "id": 837573,
                "node_id": "MDQ6VXNlcjgzNzU3Mw==",
                "avatar_url": "https://avatars0.githubusercontent.com/u/837573?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/untitaker",
                "html_url": "https://github.com/untitaker",
                "followers_url": "https://api.github.com/users/untitaker/followers",
                "following_url": "https://api.github.com/users/untitaker/following{/other_user}",
                "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions",
                "organizations_url": "https://api.github.com/users/untitaker/orgs",
                "repos_url": "https://api.github.com/users/untitaker/repos",
                "events_url": "https://api.github.com/users/untitaker/events{/privacy}",
                "received_events_url": "https://api.github.com/users/untitaker/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-11-03T14:09:01Z",
            "updated_at": "2014-11-03T14:09:01Z",
            "author_association": "MEMBER",
            "body": "Hmm, i suppose that this could be closed then?\n"
        },
        {
            "url": "https://api.github.com/repos/pallets/flask/issues/comments/61584881",
            "html_url": "https://github.com/pallets/flask/issues/866#issuecomment-61584881",
            "issue_url": "https://api.github.com/repos/pallets/flask/issues/866",
            "id": 61584881,
            "node_id": "MDEyOklzc3VlQ29tbWVudDYxNTg0ODgx",
            "user": {
                "login": "nieder",
                "id": 1105137,
                "node_id": "MDQ6VXNlcjExMDUxMzc=",
                "avatar_url": "https://avatars3.githubusercontent.com/u/1105137?v=4",
                "gravatar_id": "",
                "url": "https://api.github.com/users/nieder",
                "html_url": "https://github.com/nieder",
                "followers_url": "https://api.github.com/users/nieder/followers",
                "following_url": "https://api.github.com/users/nieder/following{/other_user}",
                "gists_url": "https://api.github.com/users/nieder/gists{/gist_id}",
                "starred_url": "https://api.github.com/users/nieder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nieder/subscriptions",
                "organizations_url": "https://api.github.com/users/nieder/orgs",
                "repos_url": "https://api.github.com/users/nieder/repos",
                "events_url": "https://api.github.com/users/nieder/events{/privacy}",
                "received_events_url": "https://api.github.com/users/nieder/received_events",
                "type": "User",
                "site_admin": false
            },
            "created_at": "2014-11-04T02:30:19Z",
            "updated_at": "2014-11-04T02:30:19Z",
            "author_association": "NONE",
            "body": "Closing since it's now fixed in HEAD.\n"
        }
    ]
}